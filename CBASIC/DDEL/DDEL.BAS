%INCLUDE PSBF01G.J86
%INCLUDE PSBF20G.J86
%INCLUDE DIRORDEC.J86 
%INCLUDE KFASMEXT.J86 ! Keyed file assembler functions              !HMW
%INCLUDE EALHSASC.J86 
 



%INCLUDE PSBF01E.J86                                                   !HSMG
%INCLUDE DIROREXT.J86                                                                                                    
%INCLUDE PSBF20E.J86
 



ON ERROR GOTO ERROR.DETECTED

	GOSUB INITIALIZATION
	GOSUB MAIN.PROGRAM
	GOSUB TERMINATION

STOP

INITIALIZATION:

BLOCK.FILE$ = "C:/DORDER.TXT"
     CALL DIRORD.SET

	 FUNCTION.FLAG$ EQ "O" 

     PASSED.INTEGER% EQ DIRORD.REPORT.NUM% 
     PASSED.STRING$ EQ DIRORD.FILE.NAME$
     GOSUB CALL.F20.SESS.NUM.UTILITY
     DIRORD.SESS.NUM% EQ F20.INTEGER.FILE.NO% 	 
	 
	 PASSED.INTEGER% EQ 456 
     PASSED.STRING$ EQ BLOCK.FILE$
     GOSUB CALL.F20.SESS.NUM.UTILITY
     BLOCK.SESS.NUM% EQ F20.INTEGER.FILE.NO%
	 
	 
	 OPEN BLOCK.FILE$ AS BLOCK.SESS.NUM%

RETURN

CALL.F20.SESS.NUM.UTILITY: 
        
         FILE.OPERATION$ = FUNCTION.FLAG$
         CURRENT.REPORT.NUM% = PASSED.INTEGER%
         RC% = SESS.NUM.UTILITY (FUNCTION.FLAG$, PASSED.INTEGER%,       \
                                 PASSED.STRING$)
         IF RC% <> 0 THEN GOTO ERROR.DETECTED

RETURN



MAIN.PROGRAM:

	IF END #DIRORD.SESS.NUM% THEN NO.FILE
	OPEN DIRORD.FILE.NAME$ KEYED RECL DIRORD.RECL% AS DIRORD.SESS.NUM% NODEL	 
	 
READ.BEGIN:
	WHILE NOT EOF1 

    IF END #BLOCK.SESS.NUM% THEN NO.FILE
    READ #BLOCK.SESS.NUM% ;LINE LINE.RECORD$
	
	CMD$ = LEFT$(LINE.RECORD$,7) 
	
	 

	 
WEND     
      
	  

 

NO.FILE:

    EOF1 = TRUE
	
	EOF = TRUE

	GOTO TERMINATION

RETURN


TERMINATION:

     PASSED.INTEGER% EQ DIRORD.REPORT.NUM% 
     PASSED.STRING$ EQ DIRORD.FILE.NAME$
     GOSUB CALL.F20.SESS.NUM.UTILITY
     DIRORD.SESS.NUM% EQ F20.INTEGER.FILE.NO% 	 
	 
	 PASSED.INTEGER% EQ 456 
     PASSED.STRING$ EQ BLOCK.FILE$
     GOSUB CALL.F20.SESS.NUM.UTILITY
     BLOCK.SESS.NUM% EQ F20.INTEGER.FILE.NO%

	CLOSE DIRORD.SESS.NUM%
 

RETURN



ERROR.DETECTED:

PRINT   "An Error Occurred "   + ERR   + STR$(ERRF%)   + STR$(ERRL)  + CMD$

 

END



