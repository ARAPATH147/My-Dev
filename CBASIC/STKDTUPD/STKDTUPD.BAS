%INCLUDE STOCKDEC.J86
%INCLUDE PSBF01G.J86
%INCLUDE PSBF20G.J86


   INTEGER*2 ITEMS.FILE.SESS.NUM%
   INTEGER*2 PASSED.INTEGER%
   INTEGER*2 CURRENT.REPORT.NUM%
   INTEGER*2 RC%
   INTEGER*1 STOCK.EOF%
   INTEGER*1 ITEM.COUNT%
   !INTEGER*4 OFFSET%
   !INTEGER*2 MODE%
   
   STRING NEW.DATE.LAST.REC$
   STRING ITEMS.FILE$
   STRING FUNCTION.FLAG$
   STRING PASSED.STRING$
   STRING FILE.OPERATION$
   STRING LINE.RECORD$
   STRING CMD$
   !STRING STOCK.RECORD$
   !STRING PATTERN$
   
%INCLUDE STOCKEXT.J86
%INCLUDE PSBF01E.J86

%INCLUDE PSBF20E.J86



ON ERROR GOTO ERROR.DETECTED

	GOSUB INITIALIZATION
	GOSUB MAIN.PROGRAM
	GOSUB TERMINATION

STOP

INITIALIZATION:

ITEMS.FILE$ = "C:/STOCKITM.DAT"
NEW.DATE.LAST.REC$ = ""

	 CALL STOCK.SET

	 FUNCTION.FLAG$ EQ "O" 

	 PASSED.INTEGER% EQ STOCK.REPORT.NUM% 
     PASSED.STRING$ EQ STOCK.FILE.NAME$
     GOSUB CALL.F20.SESS.NUM.UTILITY
     STOCK.SESS.NUM% EQ F20.INTEGER.FILE.NO%
	 
	 PASSED.INTEGER% EQ 456 
     PASSED.STRING$ EQ ITEMS.FILE$
     GOSUB CALL.F20.SESS.NUM.UTILITY
     ITEMS.FILE.SESS.NUM% EQ F20.INTEGER.FILE.NO%
	 
	 OPEN ITEMS.FILE$ AS ITEMS.FILE.SESS.NUM% 

RETURN

CALL.F20.SESS.NUM.UTILITY: 
        
         FILE.OPERATION$ = FUNCTION.FLAG$
         CURRENT.REPORT.NUM% = PASSED.INTEGER%
         RC% = SESS.NUM.UTILITY (FUNCTION.FLAG$, PASSED.INTEGER%,       \
                                 PASSED.STRING$)
         IF RC% <> 0 THEN GOTO ERROR.DETECTED

RETURN

MAIN.PROGRAM:

	IF END #STOCK.SESS.NUM% THEN NO.FILE
	OPEN STOCK.FILE.NAME$ KEYED RECL STOCK.RECL% AS STOCK.SESS.NUM% NODEL

	INPUT "ENTER THE NEW LAST DELIVERY DATE(YYMMDD)"; NEW.DATE.LAST.REC$
	WHILE NOT STOCK.EOF%

    IF END #ITEMS.FILE.SESS.NUM% THEN NO.FILE
    READ #ITEMS.FILE.SESS.NUM%;	LINE LINE.RECORD$
	
	CMD$ = LEFT$(LINE.RECORD$,7) 
	
	STOCK.BOOTS.CODE$ = PACK$("0" + CMD$)

	!PRINT  "ITEM NUMBER : " + STOCK.BOOTS.CODE$
	!INPUT "ENTER THE NEW LAST DELIVERY DATE(MMDDYYY)"; NEW.DATE.LAST.REC$
	
	RC% = READ.STOCK
	  
	  IF RC% = 0 THEN BEGIN		
	  
			PRINT "CURRENT LAST RECEIVED DATE : " + UNPACK$(STOCK.DATE.LAST.REC$)
		    
			STOCK.DATE.LAST.REC$ = PACK$(NEW.DATE.LAST.REC$)
			
			RC% = WRITE.STOCK
			
			IF RC% = 0 THEN BEGIN
			   !PRINT "DATE UPDATED SUCCESSFULLY"
			   ITEM.COUNT% = ITEM.COUNT% + 1
			ENDIF ELSE BEGIN
			   PRINT "UPDATE FAILED"
			ENDIF
			
			PRINT "UPDATED LAST RECEIVED DATE : " + UNPACK$(STOCK.DATE.LAST.REC$)


      ENDIF

	WEND

NO.FILE:

    STOCK.EOF% = 0
	!EOF1 = TRUE
	!EOF = TRUE

	GOTO TERMINATION

RETURN

TERMINATION:

    FUNCTION.FLAG$ EQ "C"
    PASSED.STRING$ EQ STOCK.FILE.NAME$
	PASSED.INTEGER% EQ STOCK.REPORT.NUM% 
    GOSUB CALL.F20.SESS.NUM.UTILITY
    STOCK.SESS.NUM% EQ F20.INTEGER.FILE.NO%
	
	CLOSE STOCK.SESS.NUM%

RETURN

ERROR.DETECTED:

PRINT   "An Error Occurred "   + ERR   + STR$(ERRF%)   + STR$(ERRL)

END