   1: 0000: \*******************************************************************************
   2: 0000: \*******************************************************************************
   3: 0000: \***
   4: 0000: \***
   5: 0000: \***            PROGRAM         :       PSB21
   6: 0000: \***            MODULE          :       PSB2101
   7: 0000: \***            AUTHOR          :       Charles Skadorwa / Mark Walker / Mark Goode
   8: 0000: \***            DATE WRITTEN    :       Sept 2011
   9: 0000: \***
  10: 0000: \*******************************************************************************
  11: 0000: \***
  12: 0000: \***    VERSION 1.0       Charles Skadorwa/Mark Walker/Mark Goode 30 SEP 2011
  13: 0000: \***    Initial version.
  14: 0000: \***
  15: 0000: \***    VERSION 1.1           Mark Goode
  16: 0000: \***    IEX update function is incorrect, never updates the last actual supplier
  17: 0000: \***    for current items.
  18: 0000: \***
  19: 0000: \***    VERSION 1.2           Tittoo Thomas
  20: 0000: \***    Defect 3361 - Fixed the IEX primary supplier number to be 4 UPD.
  21: 0000: \***
  22: 0000: \***    VERSION 1.3           Charles Skadorwa                  16 January 2012
  23: 0000: \***    Defect 3491: Manual processing of Legacy IUF is failed.
  24: 0000: \***                 BARCODE.PROCESSING modified to ensure that it continues if
  25: 0000: \***                 any problems are found with deleting the IEF chain.
  26: 0000: \***
  27: 0000: \***    CR EPOS5   : Change to IRF.INDICAT10% Return Route and Returnable bit
  28: 0000: \***                 flag settings.
  29: 0000: \***
  30: 0000: \***    VERSION 1.4.          Charles Skadorwa                  25 January 2012  ! 1.4 RC
  31: 0000: \***    Changes creating PSB21.286 Core Release 2 version 1.4.                   ! 1.4 RC
  32: 0000: \***    Changed module version comments from 1.3 to 1.4 to distinguish           ! 1.4 RC
  33: 0000: \***    Charlies latest fixes (below) from previous version of this module       ! 1.4 RC
  34: 0000: \***
  35: 0000: \***    Defect   19: IUF Earn Points flag has incorrect data transformation
  36: 0000: \***                 listed in DD.
  37: 0000: \***
  38: 0000: \***    Defect   21: IUF Discountable flag has incorrect data transformation
  39: 0000: \***                 listed in DD.
  40: 0000: \***
  41: 0000: \***    VERSION 1.5.                ROBERT COWEY.                07 FEB 2012.
  42: 0000: \***    Changes creating PSB21.286 Core Release 2 version 1.5.
  43: 0000: \***
  44: 0000: \***    Defect 21 - Commented 1.5 RC (21).                       07 FEB 2012.
  45: 0000: \***    Original fix (and associated comments) were incorrect as they were    ! 1.6 RC (21)
  46: 0000: \***    based on a mis-understanding of variable IUF.DISCOUNTABLE$.           ! 1.6 RC (21)
  47: 0000: \***    The fix has now been re-coded (commented 1.6 RC (21) ) and any        ! 1.6 RC (21)
  48: 0000: \***    potentially confusing comments also corrected or removed.             ! 1.6 RC (21)
  49: 0000: \***
  50: 0000: \***    Defect 51 - Commented 1.5 RC (51).
  51: 0000: \***    Retained setting of ISF.SEL.PRINTED.FLAG$ to "N" for new items but
  52: 0000: \***    now leave it unchanged for existing items (instead of set to "Y").
  53: 0000: \***
  54: 0000: \***    Various Defects/changes resulting from Code WPI's - Commented !1.5CSk(a)
  55: 0000: \***
  56: 0000: \***    VERSION 1.6.                ROBERT COWEY.                21 FEB 2012.
  57: 0000: \***    Changes creating PSB21.286 Core Release 2 version 1.6.
  58: 0000: \***
  59: 0000: \***    Defect 69 - Commented 1.6 RC (69).
  60: 0000: \***    Expanded the IF test that sets Directs A IDF.BIT.FLAGS.1% X'04' to
  61: 0000: \***    uss an ELSE statement to switch the bit OFF (thereby preventing it
  62: 0000: \***    becoming a once-ON-always-ON flag).
  63: 0000: \***
  64: 0000: \***    Defect 21 - Commented 1.6 RC (21).
  65: 0000: \***    Corrected setting of IRF Discount Exempt flag within UPDATE.IRF.
  66: 0000: \***
  67: 0000: \***    Defect 71 - Commented 1.6 RC (71).
  68: 0000: \***    Corrected setting of IRF Unrestricted Group Code flag for legacy IUF
  69: 0000: \***    by retaining any current IRF value for an existing item.
  70: 0000: \***
  71: 0000: \***    VERSION 1.7.                ROBERT COWEY.                28 FEB 2012.
  72: 0000: \***    Changes creating PSB21.286 Core Release 2 version 1.7.
  73: 0000: \***
  74: 0000: \***    Defect 53 - Commented 1.7 RC (53).
  75: 0000: \***    Set IRF.PRICE.MISMATCH$ flag to indicate increase or decrease for
  76: 0000: \***    use when generating emergency RPD's (within PSB2103).
  77: 0000: \***
  78: 0000: \***    VERSION 1.8.                ROBERT COWEY.                08 MAR 2012.
  79: 0000: \***    Changes creating PSB21.286 Core Release 2 version 1.8.
  80: 0000: \***    Removed IRF.PRICE.MISMATCH$ indicating price increase or decrease as
  81: 0000: \***    setting of PPFK.INC.DEC.FLAG$ is done by PSB23.
  82: 0000: \***
  83: 0000: \***    Defect 95 - Commented 1.8 RC (95)                        12 MAR 2012.
  84: 0000: \***    Re-defined NEW.ITEM as being the absence of IDF record (and removed
  85: 0000: \***    NEW.ITEM.OVERRIDE.FLAG made redundant).
  86: 0000: \***    Called UPDATE.IDF prior to UPDATE.IRF (instead of after it) but
  87: 0000: \***    retained BARCODE.PROCESSING at its original position (after both
  88: 0000: \***    IDF and IRF records populated from IUF).
  89: 0000: \***
  90: 0000: \***    VERSION 1.9.                ROBERT COWEY.                13 MAR 2012.
  91: 0000: \***    Changes creating PSB21.286 Core Release 2 version 1.9.
  92: 0000: \***    Commented setting of IRF.SALEPRIC$ to zeros when CURR.CURRENT.PRICE$
  93: 0000: \***    (taken from IUF) is missing as being to cause price entry.
  94: 0000: \***
  95: 0000: \***    Defect 106 - Commented 1.9 RC (106)                      13 MAR 2012.
  96: 0000: \***    Set IDF.FILLER$ to null for new item.
  97: 0000: \***
  98: 0000: \***    Defect 112 - Commented 1.9 RC (112)                      15 MAR 2012.
  99: 0000: \***    Set DRUG.FILLER$ to 8 bytes null.
 100: 0000: \***
 101: 0000: \***    Defect 102 - Commented 1.9 RC (95)+(102)                 15 MAR 2012.
 102: 0000: \***    Correction to previous fix 1.8 RC (95) to set NEW.ITEM = FALSE when
 103: 0000: \***    IDF record is present.
 104: 0000: \***
 105: 0000: \***    Defect 109 - Commented 1.9 RC (109)                      19 MAR 2012.
 106: 0000: \***    Made checking of IUF item price against head office price on LOCAL
 107: 0000: \***    and CIPPMR files dependant on appropriate IRF and IDF flags.
 108: 0000: \***    Corrected these flags if incorrect.
 109: 0000: \***
 110: 0000: \***    VERSION 1.10.               ROBERT COWEY.                27 MAR 2012.
 111: 0000: \***    Changes creating PSB21.286 Core Release 2 version 1.10.
 112: 0000: \***
 113: 0000: \***    Defect 113 - Commented 1.10 RC (113)
 114: 0000: \***    Modified UPDATE.CIPPM to update Reversals Price rather than Original
 115: 0000: \***    IRF price and also to call WRITE.IDF to correct IDF Markdown flag.
 116: 0000: \***
 117: 0000: \***    UPDATE.LOCAL procedure deleted.
 118: 0000: \***    Price changes for local priced items are treated as for other items.
 119: 0000: \***    PSB21 does not update LOCAL (which is done instead by PSB23).
 120: 0000: \***
 121: 0000: \***    Defect 142 - Commented 1.10 RC (142)
 122: 0000: \***    Modified procedure UPDATE.IEX to READ.IEX as part of the update
 123: 0000: \***    (defaulting IEX variables to null when the item is not found)
 124: 0000: \***    Also set IEX.FILLER$ is null instead of spaces to address the
 125: 0000: \***    specific defect raised.
 126: 0000: \***
 127: 0000: \***    VERSION 1.11.               ROBERT COWEY.                05 APR 2012.
 128: 0000: \***    Changes creating PSB21.286 Core Release 2 version 1.11.
 129: 0000: \***
 130: 0000: \***    Defect 172 - Commented 1.11 RC (172)
 131: 0000: \***    Corrected UPDATE.CIPPM to use passed item code as well as price.
 132: 0000: \***
 133: 0000: \***    VERSION 1.12.               ROBERT COWEY.                18 APR 2012.
 134: 0000: \***    Changes creating PSB21.286 Core Release 2 version 1.12.
 135: 0000: \***
 136: 0000: \***    Renamed IRF.PRICE.MISMATCH to PRICE.MISMATCH to more properly
 137: 0000: \***    reflect its wider usage.
 138: 0000: \***    Modified code to use this flag for all discrepancies between
 139: 0000: \***    definitive price on IUF item record and Head Office price
 140: 0000: \***    whether present on IRF, LOCAL, or on CIPPMR (as Reversals Price).
 141: 0000: \***
 142: 0000: \***    VERSION 1.13.               ROBERT COWEY.                23 APR 2012.
 143: 0000: \***    Changes creating PSB21.286 Core Release 2 version 1.13.
 144: 0000: \***
 145: 0000: \***    Defect 179 - Commented 1.13 RC (179)
 146: 0000: \***    Modified UPDATE.IRF and UPDATE.ISF to set SEL.NON.PRICE.CHANGE flag
 147: 0000: \***    when non-price-change SEL information changes requiring SEL printing.
 148: 0000: \***    Modified UPDATE.RICF to use this flag (and also PRICE.CHANGE.TODAY
 149: 0000: \***    flag to save reprocessing PPFK data) to control RICF updates.
 150: 0000: \***
 151: 0000: \***    VERSION 1.14.               ROBERT COWEY.                01 MAY 2012.
 152: 0000: \***    Changes creating PSB21.286 Core Release 2 version 1.15.
 153: 0000: \***    Comment corrected.
 154: 0000: \***
 155: 0000: \***    Defect 200 - Commented 1.14 RC (200)
 156: 0000: \***    Checked return code from PSBF19 function UPDATE.ALL.IRF.BAR.CODES
 157: 0000: \***    reporting any items for which barcodes not successfully updated
 158: 0000: \***    and setting JOBOK.FLAG$ to "Y"
 159: 0000: \***    Modified UPDATE.IRF to create the initial IRF record (for use by
 160: 0000: \***    PSBF41 during UPDATE.ALL.IRF.BAR.CODES) using the item code and
 161: 0000: \***    non-group-code prefix (as required for the initial PSBF41 IRF read).
 162: 0000: \***    Modified UPDATE.IRF to ensure IRF variables properly initialised
 163: 0000: \***    when READ.IRF fails because main item-barcode IRF record not found
 164: 0000: \***    (thereby preventing previous IUF items price being passed to currrent
 165: 0000: \***    IUF items when main item-barcode IRF record is missing).
 166: 0000: \***
 167: 0000: \***    VERSION 1.15.               ROBERT COWEY.                09 MAY 2012.
 168: 0000: \***    Changes creating PSB21.286 Core Release 2 version 1.16.
 169: 0000: \***
 170: 0000: \***    Defect 226 - Commented 1.15 RC (226)
 171: 0000: \***    Modified CHECK.FOR.PRICE.MISMATCH and UPDATE.CIPPM routines to
 172: 0000: \***    cater for stores not having a CIPPMR (eg, not on CIP markdown).
 173: 0000: \***
 174: 0000: \***    VERSION A                   CHARLES SKADORWA.             5 SEP 2013.
 175: 0000: \***    F261 Gift Card Mall IIN Range Extension Project - Commented ! ACSk
 176: 0000: \***    In SUB UPDATE.IRF, set BIT3 of IRF.INDICAT0% if the
 177: 0000: \***    IUF.RETURNABLE$ flag is set to "N".
 178: 0000: \***
 179: 0000: \***    VERSION B                   CHARLES SKADORWA.            18 FEB 2014.
 180: 0000: \***    F261 Gift Card Mall IIN Range Extension Project - Commented ! BCSk
 181: 0000: \***    Defect 495 - GCM: PSB21: 'Not Returnable' flag value is getting
 182: 0000: \***                              set to 1 for a non GCM item.
 183: 0000: \***    The IUF.RETURNABLE$ flag (initialised to "Y") gets set in the READ.IUF
 184: 0000: \***    function (IUFFUN.BAS) according to the value set against the Product
 185: 0000: \***    Group for the item (that's read into an internal table [REFPGF.RECORDS$]
 186: 0000: \***    from the REFPGF file). This value is used to determine the Return
 187: 0000: \***    Route. If the value is not set ie. zero, then the IUF.RETURNABLE$ flag
 188: 0000: \***    is set to "N". The current logic in UPDATE.IRF only UNsets the
 189: 0000: \***    Returnable bit flag (IRF.INDICAT0% Bit 3) if it is a new item (not on
 190: 0000: \***    IDF),otherwise the item retains its original setting.
 191: 0000: \***
 192: 0000: \***    My mistake was thinking that the IUF.RETURNABLE$ flag related to this
 193: 0000: \***    bit flag, however, it is used to set IRF.INDICAT10% Bit 6.
 194: 0000: \***
 195: 0000: \***    The fix is to set IRF.INDICAT0% Bit 3 directly in UPDATE.IRF if the
 196: 0000: \***    item is in one of the specified GCM product groups read from the BCF.
 197: 0000: \***    Release version left at vA as not released but date changed to
 198: 0000: \***    18-02-2014.
 199: 0000: \***
 200: 0000: \***    VERSION C                   CHARLES SKADORWA.            25 FEB 2014.
 201: 0000: \***    F261 Gift Card Mall IIN Range Extension Project - Commented ! CCSk
 202: 0000: \***    Defect 517 - GCM: PSB21: 'Not Returnable' flag value is NOT
 203: 0000: \***                              getting set to 1 for a new GCM item.
 204: 0000: \***    Change to UPDATE.IRF in PSB2101.BAS to reference CURR.PROD.GRP$
 205: 0000: \***    instead of IUF.PROD.GRP$.
 206: 0000: \***    Release version left at vA as not released but date changed to
 207: 0000: \***    25-02-2014.
 208: 0000: \***
 209: 0000: \***    VERSION D                   Mark Walker                 4th Mar 2014
 210: 0000: \***    F337 Centralised View of Stock
 211: 0000: \***    Update the STOCK file when the item status of an existing item
 212: 0000: \***    is updated. This is required to allow an item to be re-considered
 213: 0000: \***    for initial stock snapshot processing.
 214: 0000: \***
 215: 0000: \***    VERSION E                   Mark Walker                 6th May 2014
 216: 0000: \***    F337 Centralised View of Stock
 217: 0000: \***    QC607: Fix to item status update processing.
 218: 0000: \***
 219: 0000: \***    VERSION F                   Mark Walker                 8th Jul 2014
 220: 0000: \***    F353 Deal Limits Increase
 221: 0000: \***    Removed DINF and NIADF file processing.
 222: 0000: \***
 223: 0000: \***    VERSION G                   Rejiya Nair            13th May 2016
 224: 0000: \***    PRJ1452 Restricting Item Sales
 225: 0000: \***    - Set the "enforced quantity" bit (bit 7) in the IRF file;
 226: 0000: \***      if the item is a group restricted item (The variable;
 227: 0000: \***      CURR.RESTRICT.SALES.FLAG$ will be set to "Y").
 228: 0000: \***    - Reset bit 7 (if it is already set) if the item is not a group
 229: 0000: \***      restricted item (CURR.RESTRICT.SALES.FLAG$ will be set to "N")
 230: 0000: \***    - Removed the previously tagged commented out code.
 231: 0000: \***
 232: 0000: \***----------------------------------------------------------------------------
 233: 0000: \***  IMPORTANT: When you change PSB21, please search for the line containing
 234: 0000: \***------------        CALL DO.MESSAGE("PSB21 PROGRAM START
 235: 0000: \***             in Module PSB2100 and wind the date and version on.
 236: 0000: \***
 237: 0000: \*******************************************************************************
 238: 0000: \*******************************************************************************
 239: 0000: 
 240: 0000: \*******************************************************************************
 241: 0000: \*******************************************************************************
 242: 0000: \***
 243: 0000: \***    Module Overview
 244: 0000: \***    ----------------
 245: 0000: \***
 246: 0000: \***    This module updates all the associated data files for an item.
 247: 0000: \***
 248: 0000: \***
 249: 0000: \*******************************************************************************
 250: 0000: \*******************************************************************************
 251: 0000: 
 252: 0000: %INCLUDE BCFDEC.J86     ! BRCF File
 253: 0000: \*****************************************************************************
 254: 0000: \*****************************************************************************
 255: 0000: \***
 256: 0000: \***               %INCLUDE FOR BCF - FIELD DECLARATIONS
 257: 0000: \***                                  FILE REFERENCE PARAMETERS
 258: 0000: \***
 259: 0000: \***                      FILE TYPE    : SEQUENTIAL
 260: 0000: \***
 261: 0000: \***                      REFERENCE    : BCFDEC.J86
 262: 0000: \***
 263: 0000: \***      Version A             Steve Windsor          5th Jan 1993
 264: 0000: \***
 265: 0000: \***      Version B             Michael J. Kelsall    01st Dec 1993
 266: 0000: \***      Addition to file of CCMVT serial number as part of
 267: 0000: \***      RETURNS/AUTOMATIC CREDIT CLAIMING package.
 268: 0000: \***
 269: 0000: \***      Version C           Stuart William McConnachie 23rd Jan 1995
 270: 0000: \***      Addition of TXR serial number as part of the TRANSACTION RETRIEVAL
 271: 0000: \***      project.
 272: 0000: \***
 273: 0000: \***      Version D           Stuart William McConnachie  7th June 1995
 274: 0000: \***      Converted calls to enable more than 1 record on the BCF.
 275: 0000: \***      The second record is to be used for the No7 customer card trial.
 276: 0000: \***
 277: 0000: \***      Version E                 Stuart Highley        7th April 1999
 278: 0000: \***      Added new fields for cash accounting.
 279: 0000: \***
 280: 0000: \***      Version F                 Mark Goode            20th May 2000
 281: 0000: \***      Added new fields for Dentistry project.
 282: 0000: \***
 283: 0000: \***      Version G                 Mark Goode            18th July 2000
 284: 0000: \***      Added new fields for Well-Being project.
 285: 0000: \***
 286: 0000: \***      Version I                 Amy Hoggard           13th Oct 2000
 287: 0000: \***      Added new fields for ECO project.
 288: 0000: \***
 289: 0000: \***      Version K                 Brian Greenfield      1st May 2001
 290: 0000: \***      Added new field for Wellbeing Services record 13.
 291: 0000: \***
 292: 0000: \***      Version L                 Amy Hoggard           4th Jan 2002
 293: 0000: \***      Added new field for ETOPUP project.
 294: 0000: \***
 295: 0000: \***      Version M                 Julia Stones          22nd July 2002
 296: 0000: \***      Added new fields for Deals rewrite project record 14.
 297: 0000: \***
 298: 0000: \***    Revision 4.6            ROBERT COWEY.            19 MAY 2003.
 299: 0000: \***    Modifications for All Txn Data To CDAS project.
 300: 0000: \***    Removed redundant variables ...
 301: 0000: \***      BCF.CTSL1.SERIAL.NUM$, BCF.CTSL2,SERIAL.NUM$
 302: 0000: \***    Defined new variable ...
 303: 0000: \***      BCF.MTSLQ.DAYS$, BCF.FILLER67$
 304: 0000: \***
 305: 0000: \***    Revision 4.7           Julia Stones              9th July 2003.
 306: 0000: \***    Modifications for New Lines Report project.
 307: 0000: \***    Defined new variable
 308: 0000: \***    BCF.NEWLINES.WEEKS$
 309: 0000: \***
 310: 0000: \***    Revision 4.8           Julia Stones              3rd October 2003.
 311: 0000: \***    Modifications for New Lines Report project.
 312: 0000: \***    Defined new variable
 313: 0000: \***    BCF.NEWLINES.LINES$
 314: 0000: \***
 315: 0000: \***    Version N              Jamie Thorpe             27th June 2006
 316: 0000: \***    Added BCF.DVCHR.SERIAL.NUM$
 317: 0000: \***
 318: 0000: \***    Revision 4.10          Charles Skadorwa            4th July 2011
 319: 0000: \***    CORE Heritage Stores Release 2 (Outbound) Project.
 320: 0000: \***    New variables defined: BCF.ECC.DATETIMESTAMP$
 321: 0000: \***                           BCF.IUF.DATETIMESTAMP$
 322: 0000: \***
 323: 0000: \***    Revision 4.11          Arun Sudhakaran             10th April 2013
 324: 0000: \***    Added new variables for including Supplier Number lengths
 325: 0000: \***    as part of Automatic Booking In of Chilled Food ASNs project
 326: 0000: \***
 327: 0000: \***    Revision 4.12          Charles Skadorwa            5th Sept 2013
 328: 0000: \***    F261 Gift Card Mall IIN Range Extension Project - Commented !4.12 CSk
 329: 0000: \***    Defined new variables for GCM Product Group Number and Record 22
 330: 0000: \***    lengths.
 331: 0000: \***
 332: 0000: \***    Version O              Mark Walker                  3rd Feb 2014
 333: 0000: \***    F337 Centralised View of Stock
 334: 0000: \***    - Defined variables for record 23 (stock snapshot parameters).
 335: 0000: \***    - Minor formatting changes (uncommented).
 336: 0000: \***
 337: 0000: \***    Revision O             Charles Skadorwa             25th June 2014
 338: 0000: \***    F353 Deal Limits Increase Project.
 339: 0000: \***    Renamed 3 variables in function BCF.RECORD.14.W -
 340: 0000: \***        BCF.DINF.NUM.REC$ becomes BCF.ITMDL.NUM.REC$
 341: 0000: \***        BCF.DINF.KEY.LEN$ becomes BCF.ITMDL.KEY.LEN$
 342: 0000: \***        BCF.ECC.DATETIMESTAMP$ becomes BCF.FILLER.DATETIMESTAMP$
 343: 0000: \*****************************************************************************
 344: 0000: \*****************************************************************************
 345: 0000: 
 346: 0000:     STRING GLOBAL                                                       \
 347: 0000:         BCF.FILE.NAME$
 348: 0000: 
 349: 0000:     INTEGER*2 GLOBAL                                                    \
 350: 0000:         BCF.RECL%,                                                      \   !OMW
 351: 0000:         BCF.REPORT.NUM%,                                                \
 352: 0000:         BCF.SESS.NUM%
 353: 0000: 
 354: 0000:     STRING GLOBAL                                                       \
 355: 0000:     BCF.RECORD$,          \ 80 bytes
 356: 0000:     BCF.IUF.SERIAL.NO$,   \ 5 bytes, IUF serial number
 357: 0000:     BCF.OPEN.DATE$,       \ 6 bytes, Last store opening date (YYMMDD)
 358: 0000:     BCF.FILLER.DATE$,     \ 3 bytes, filler
 359: 0000:     BCF.LABEL.DATE$,      \ 6 bytes, label print date (YYMMDD)
 360: 0000:     BCF.SALES.SERIAL.NO$ ,\ 5 bytes, sales serial number
 361: 0000:     BCF.STMVB.SERIAL.NO$, \ 5 bytes, current serial number          \
 362: 0000:                               \     of Stock Movement Backup file       \
 363: 0000:     BCF.TOF.DAYS$,        \ 2 bytes, number of days' worth of sales to \
 364: 0000:                           \       be held on the TIF at re-build       \
 365: 0000:         BCF.EPS.BATCH$,       \ 2 bytes, highest batch number to have   \
 366: 0000:                               \     been reported upon by PSE31         \
 367: 0000:     BCF.NO.EPF.COPIES$,   \ 2 bytes, no. of copies of EPS payment file \
 368: 0000:     BCF.CCMVT.SERIAL.NUM$,\ 5 bytes ASC                                ! BMJK
 369: 0000:     BCF.TXR.SERIAL.NUM$,  \ 5 bytes transaction retrieval serial number!SWM
 370: 0000:     BCF.CUSTD.SERIAL.NUM$,\ 5 bytes customer data file serial number   !SWM
 371: 0000:     BCF.PSB58.DATE$,      \ 6 bytes date of last MTSL/CUSTW cut-off    !SWM
 372: 0000:     BCF.CTSL1.SERIAL.NUM$,\ 5 bytes serial number on first MTSLQ (and  ! 4.6 RC
 373: 0000:                           \         thereore CTSL1) batch header       ! 4.6 RC
 374: 0000:     BCF.MTSLQ.DAYS$,      \ 2 byte MTSLQ data retention period (PSB14) ! 4.6 RC
 375: 0000:     BCF.FILLER67$,        \ 8 bytes filler beginning at byte 67        ! 4.6 RC
 376: 0000:         BCF.NTIUF.SERIAL.NO$,                                           \   !FMG
 377: 0000:         BCF.DENTISTRY.PSAUDIT.SERIAL.NO$,                               \   !FMG
 378: 0000:         BCF.WELL.SERIAL.NO$,                                            \   !GMG
 379: 0000:         BCF.WELL.PSAUDIT.SERIAL.NO$,                                    \   !GMG
 380: 0000:     BCF.ACSAL.SERIAL.NUM$,\ 5 bytes serial number on ACSAL             !ESDH
 381: 0000:     BCF.DENTISTRY.PRODUCT.GROUP$,                                      \FMG
 382: 0000:     BCF.WELL.PRODUCT.GROUP$,                                           \GMG
 383: 0000:     BCF.FILLER$,         \! 1 byte, filler                             !BMJK
 384: 0000:     BCF.WELL.SERV.PRODUCT.GROUP$,                                      \KBG
 385: 0000:         BCF.ETOPUP.PROD.GRP$,                                           \   !LAH
 386: 0000:         BCF.END.FILLER$,                                                \   !LAH
 387: 0000:     BCF.TBAG.BATCH.NO$,                                                \IAH
 388: 0000:     BCF.TBAG.DAYS.KEPT$,                                               \IAH
 389: 0000:     BCF.NEWLINES.WEEKS$,                                               \4.7JAS
 390: 0000:     BCF.NEWLINES.LINES$,                                               \4.8JAS
 391: 0000:     BCF.TBAG.FILLER$,                                                  \ 79 Bytes filler !IAH 70 Bytes filler 4.7JAS ! 65 Bytes fille 4.8JAS
 392: 0000:     BCF.DEALDIR.SERIAL.NUM$, \ 4 bytes serial number                   !MJAS
 393: 0000:     BCF.DIDIR.SERIAL.NUM$,   \ 4 bytes serial number                   !MJAS
 394: 0000:     BCF.DEAL.NUM.REC$,       \ 6 bytes number of records in deal file  !MJAS
 395: 0000:     BCF.ITMDL.NUM.REC$,      \ 6 bytes number of records in ITMDL file !OCS
 396: 0000:     BCF.DEAL.KEY.LEN$,       \ 3 bytes key length of deal file         !MJAS
 397: 0000:     BCF.ITMDL.KEY.LEN$,      \ 3 bytes bytes ITMDL record key length   !OCS
 398: 0000:     BCF.DVCHR.SERIAL.NUM$,   \ 4 bytes serial numbr                    !NJT !4.10CSk
 399: 0000:     BCF.FILLER.DATETIMESTAMP$,\17 bytes filler for future use          !OCS
 400: 0000:     BCF.IUF.DATETIMESTAMP$, \ !17 bytes timestamp YYYYMMDDHHMMSSsss     !4.10CSk
 401: 0000:                             \ !   Last successfully processed IUF from SAP.
 402: 0000:         BCF.ITEM.STATUS$(1),     \1 byte array, item status             \   !OMW
 403: 0000:         BCF.NEGATIVE.STOCK.FLAG$(1), \1 byte array, Flag (Y/N) whether  \   !OMW
 404: 0000:                                  \   to include items with a negative   \   !OMW
 405: 0000:                                  \   stock figure in the initial stock  \   !OMW
 406: 0000:                                  \   snapshot messages.                 \   !OMW
 407: 0000:         BCF.POSITIVE.STOCK.FLAG$(1), \1 byte array, Flag (Y/N) whether  \   !OMW
 408: 0000:                                  \   to include items with a positive   \   !OMW
 409: 0000:                                  \   stock figure in the initial stock  \   !OMW
 410: 0000:                                  \   snapshot messages.                 \   !OMW
 411: 0000:         BCF.ZERO.STOCK.FLAG$(1)  !1 byte array, Flag (Y/N) whether to   \   !OMW
 412: 0000:                                  \   include items with a zero          \   !OMW
 413: 0000:                                  \   stock figure in the initial stock  \   !OMW
 414: 0000:                                  !   snapshot messages.                     !OMW
 415: 0000:                 
 416: 0000:     INTEGER*1                                                           \
 417: 0000:         BCF.NO.CPM.COPIES%
 418: 0000: 
 419: 0000:     INTEGER*2 GLOBAL                                                    \
 420: 0000:     BCF.CC.SERIAL.NO,        \ 1 byte UPD, CC serial number
 421: 0000:         BCF.MAX.STATUS.COUNT%,        \ Maximum number of item status   \   !OMW
 422: 0000:     BCF.REC21.REC.LEN%,      \ Total Supplier number length            !4.11 AS
 423: 0000:     BCF.REC21.SUPPLIER.LEN%, \ Length of the supplier number           !4.11 AS
 424: 0000:         BCF.MAX.STOCK.INIT.MESSAGES%, \ Maximum number of initial       \   !OMW
 425: 0000:                                       \ stock snapshot message to       \   !OMW
 426: 0000:                                       \ send per day.                   \   !OMW
 427: 0000:         BCF.MAX.STOCK.INIT.ITEMS%,    \ Maximum number of items to      \   !OMW
 428: 0000:                                       \ include in a single initial     \   !OMW
 429: 0000:                                       \ stock snapshot message.         \   !OMW
 430: 0000:         BCF.NEGATIVE.DAYS%(1),        \ Number of days' movements with  \   !OMW
 431: 0000:                                       \ a negative stock figure to      \   !OMW
 432: 0000:                                       \ include in the initial stock    \   !OMW
 433: 0000:                                       \ snapshot messages.              \   !OMW
 434: 0000:         BCF.POSITIVE.DAYS%(1),        \ Number of days' movements with  \   !OMW
 435: 0000:                                       \ a positive stock figure to      \   !OMW
 436: 0000:                                       \ include in the initial stock    \   !OMW
 437: 0000:                                       \ snapshot messages.              \   !OMW
 438: 0000:         BCF.REC22.REC.LEN%,           \                                 \   !4.12 CSk
 439: 0000:         BCF.REC22.PROD.GROUP.LEN%,    \ Length of GCM Product Group No  \   !4.12 CSk
 440: 0000:         BCF.ZERO.DAYS%(1)             \ Number of days' movements with  \   !OMW
 441: 0000:                                       \ a zero stock figure to include  \   !OMW
 442: 0000:                                       \ in the initial stock snapshot   \   !OMW
 443: 0000:                                       ! messages.                           !OMW
 444: 0000: 
 445: 0000: 
 446: 0000:     INTEGER*4 GLOBAL                                                    \
 447: 0000:         BCF.REC.NO%
 448: 0000: 
 449: 0000: %INCLUDE CIPPMDEC.J86   ! Markdown File
 450: 0000: \/******************************************************************/
 451: 0000: \/*                                                                */
 452: 0000: \/* CIPPM FILE GLOBAl VARIABLE DECLARATIONS                        */
 453: 0000: \/*                                                                */
 454: 0000: \/* REFERENCE   : CIPPMDEC.J86                                     */
 455: 0000: \/*                                                                */
 456: 0000: \/* VERSION A.          Neil Bennett.              16 APRIL 2007   */
 457: 0000: \/*                                                                */
 458: 0000: \/******************************************************************/
 459: 0000: 
 460: 0000:    STRING GLOBAL                \
 461: 0000:       CIPPM.BKUP.NAME$,         \
 462: 0000:       CIPPM.FILE.NAME$,         \
 463: 0000:                                 \
 464: 0000:       CIPPM.RCD$                !
 465: 0000: 
 466: 0000:    INTEGER*2 GLOBAL             \
 467: 0000:       CIPPM.REPORT.NUM%,        \
 468: 0000:       CIPPM.SESS.NUM%           !
 469: 0000: 
 470: 0000: \/******************************************************************/
 471: 0000: %INCLUDE DRUGDEC.J86    ! Drug File
 472: 0000: REM \
 473: 0000: \******************************************************************************
 474: 0000: \******************************************************************************
 475: 0000: \***
 476: 0000: \***         %INCLUDE FOR DRUG FILE - FIELD DECLARATIONS
 477: 0000: \***                                  FILE REFERENCE PARAMETERS
 478: 0000: \***
 479: 0000: \***                  FILE TYPE    : Keyed
 480: 0000: \***
 481: 0000: \***                  REFERENCE    : DRUGDEC.J86
 482: 0000: \***
 483: 0000: \***         VERSION A : Nalini Mathusoothanan     12 July 2011
 484: 0000: \***
 485: 0000: \***    Holds stock counting details for ethical lines.
 486: 0000: \*******************************************************************************
 487: 0000: \*******************************************************************************
 488: 0000: 
 489: 0000:   STRING GLOBAL           \
 490: 0000:     DRUG.FILE.NAME$,      \ DRUG file name - DRUG.BIN
 491: 0000:     DRUG.ITEM.CODE$,      \ 3  byte UPD Boots item code (excluding check digit)
 492: 0000:     DRUG.DESCRIPTION$,    \ 40 byte ASC Drug Description
 493: 0000:     DRUG.FILLER$          \ Filler - packed zeroes
 494: 0000: 
 495: 0000:   INTEGER*1 GLOBAL        \
 496: 0000:     DRUG.BIT.FLAGS.1%     \ 1 byte - bit values
 497: 0000:                           \ X"80"  - Active in store (load into POD)
 498: 0000:                           \ X"40"  - Reserved for future use
 499: 0000:                           \ X"20"  - Reserved for future use
 500: 0000:                           \ X"10"  - Reserved for future use
 501: 0000:                           \ X"08"  - Reserved for future use
 502: 0000:                           \ X"04"  - Reserved for future use
 503: 0000:                           \ X"02"  - Reserved for future use
 504: 0000:                           \ X"01"  - Reserved for future use
 505: 0000: 
 506: 0000:   INTEGER*2 GLOBAL        \
 507: 0000:     DRUG.RECL%,           \ Record Length - 56
 508: 0000:     DRUG.REPORT.NUM%,     \ Drug File session Report Number
 509: 0000:     DRUG.SESS.NUM%        \ Drug File Session Number
 510: 0000: 
 511: 0000:   INTEGER*4 GLOBAL        \
 512: 0000:     DRUG.PACK.SIZE%       ! The number of tablets, or the weight, or the volume
 513: 0000: %INCLUDE IDFDEC.J86     ! Item Data File
 514: 0000: REM \
 515: 0000: \******************************************************************************
 516: 0000: \******************************************************************************
 517: 0000: \***
 518: 0000: \***         %INCLUDE FOR ITEM DATA FILE - FIELD DECLARATIONS
 519: 0000: \***                                       FILE REFERENCE PARAMETERS
 520: 0000: \***
 521: 0000: \***                  FILE TYPE    : Keyed
 522: 0000: \***
 523: 0000: \***                  REFERENCE    : IDFDEC.J86
 524: 0000: \***
 525: 0000: \***         VERSION A : Andrew Wedgeworth  29th June 1992    
 526: 0000: \***
 527: 0000: \***    VERSION C.              Robert Cowey.                       25 AUG 1993.
 528: 0000: \***    Replaced un-used RANK$ with BSNS.CNTR$ and FILLER$.
 529: 0000: \***
 530: 0000: \***    VERSION D.              Andrew Wedgeworth               15th March 1995
 531: 0000: \***    Comments updated to reflect the fact that some bits on the file are
 532: 0000: \***    no longer used.
 533: 0000: \***
 534: 0000: \*******************************************************************************
 535: 0000: \*******************************************************************************
 536: 0000: 
 537: 0000:   STRING GLOBAL           \
 538: 0000:     IDF.FILE.NAME$,       \  
 539: 0000:     IDF.BOOTS.CODE$,      \ 4 byte UPD with check digit (key)
 540: 0000:     IDF.FIRST.BAR.CODE$,  \ 6 byte UPD without check digit
 541: 0000:     IDF.SECOND.BAR.CODE$, \ 6 byte UPD without check digit
 542: 0000:     IDF.NO.OF.BAR.CODES$, \ 2 byte UPD. Total number of bar codes for this item
 543: 0000:     IDF.PRODUCT.GRP$,     \ 3 byte UPD. The first two digits are the concept
 544: 0000:                           \ group and the last four the concept sequence
 545: 0000:     IDF.STNDRD.DESC$,     \ 24 bytes
 546: 0000:     IDF.STATUS.1$,        \ 1 byte, values B,C,D,P,X,Z and blank
 547: 0000:     IDF.INTRO.DATE$,      \ 3 byte UPD YYMMDD. Date first added to this file
 548: 0000:     IDF.BSNS.CNTR$,       \ 1 byte ASC. Business Centre ID letter      ! CRC
 549: 0000:     IDF.FILLER$,          \ 1 byte un-used                             ! CRC
 550: 0000:     IDF.PARENT.CODE$,     \ 4 byte UPD with check digit ; may be zero if no
 551: 0000:                           \ flashpacks, current IDF.BOOTS.CODE$ if parent line
 552: 0000:                           \ or Boots Code of parent line if a flashpack.
 553: 0000:     IDF.DATE.OF.LAST.SALE$! 3 byte UPD. Date of last sale.
 554: 0000: 
 555: 0000:   INTEGER*1 GLOBAL        \
 556: 0000:     IDF.BIT.FLAGS.1%,     \ 1 byte - bit values
 557: 0000:                           \ X"80"  - Group code flag
 558: 0000:                           \ X"40"  - Keylines flag
 559: 0000:                           \ X"20"  - Markdown flag
 560: 0000:                           \ X"10"  - Warehouse flag
 561: 0000:                           \ X"08"  - CSR flag
 562: 0000:                           \ X"04"  - Directs A flag
 563: 0000:                           \ X"02"  - Directs B flag
 564: 0000:                           \ X"01"  - Directs C flag
 565: 0000:     IDF.BIT.FLAGS.2%      \ 1 byte - bit values
 566: 0000:                           \ X"80"  - Own brand line flag
 567: 0000:                           \ X"40"  - Exclusive line flag
 568: 0000:                           \ X"20"  - Unused 
 569: 0000:                           \ X"10"  - Unused
 570: 0000:                           \ X"08"  - Stock system flag
 571: 0000:                           \ X"04"  - Pending count flag
 572: 0000:                           \ X"02"  - Reserved
 573: 0000:                           ! X"01"  - Reserved
 574: 0000: 
 575: 0000:   INTEGER*2 GLOBAL        \
 576: 0000:     IDF.RECL%,            \  
 577: 0000:     IDF.REPORT.NUM%,      \ 
 578: 0000:     IDF.SESS.NUM%
 579: 0000: %INCLUDE IEFDEC.J86     ! Item EAN File
 580: 0000: REM \
 581: 0000: \******************************************************************************
 582: 0000: \******************************************************************************
 583: 0000: \***
 584: 0000: \***         %INCLUDE FOR ITEM EAN CODES FILE - FIELD DECLARATIONS
 585: 0000: \***                                            FILE REFERENCE PARAMETERS
 586: 0000: \***
 587: 0000: \***               FILE TYPE    : Keyed
 588: 0000: \***
 589: 0000: \***               REFERENCE    : IEFDEC.J86
 590: 0000: \***
 591: 0000: \***    VERSION B.              ROBERT COWEY.                       21 OCT 1993.
 592: 0000: \***    No changes to this file.
 593: 0000: \***
 594: 0000: \*******************************************************************************
 595: 0000: \*******************************************************************************
 596: 0000: 
 597: 0000:   STRING GLOBAL                      \
 598: 0000:     IEF.FILE.NAME$,		     \
 599: 0000:     IEF.BOOTS.CODE.BAR.CODE$,        \ 9 byte UPD -                        BBAAS
 600: 0000:                                      \ 3 bytes UPD boots code              BBAAS   
 601: 0000:                                      \ + 6 UPD bar code,                   BBAAS
 602: 0000:                                      \ no check digits. (key)              BBAAS
 603: 0000:     IEF.NEXT.BAR.CODE$               ! 6 byte UPD without check digit
 604: 0000: 
 605: 0000:   INTEGER*2 GLOBAL        \
 606: 0000:     IEF.REPORT.NUM%,	  \
 607: 0000:     IEF.SESS.NUM%,	  \ 
 608: 0000:     IEF.RECL%
 609: 0000: %INCLUDE IEXDEC.J86     ! Item Extension File
 610: 0000: REM \
 611: 0000: \******************************************************************************
 612: 0000: \******************************************************************************
 613: 0000: \***
 614: 0000: \***         %INCLUDE FOR Item Extension FILE - FIELD DECLARATIONS
 615: 0000: \***                                            FILE REFERENCE PARAMETERS
 616: 0000: \***
 617: 0000: \***                  FILE TYPE    : Keyed
 618: 0000: \***
 619: 0000: \***                  REFERENCE    : DRUGDEC.J86
 620: 0000: \***
 621: 0000: \***         VERSION A :       Nalini Mathusoothanan                12 July 2011
 622: 0000: \***
 623: 0000: \***    Holds the Stock Supplier Number.
 624: 0000: \*******************************************************************************
 625: 0000: \*******************************************************************************
 626: 0000: 
 627: 0000:   STRING GLOBAL               \
 628: 0000:     IEX.FILE.NAME$,           \ IEX file name - IEX.BIN
 629: 0000:     IEX.ITEM.CODE$,           \ 3  byte UPD Boots Item Code (no check digit)
 630: 0000:     IEX.ACTUAL.SUPPLIER.NUM$, \ 4  byte UPD Actual Last Supplier Number
 631: 0000:     IEX.PRIMARY.SUPPLIER$,    \ 4  byte UPD Primary Supplier Number
 632: 0000:     IEX.FILLER$               \ 17 byte UPD Filler - packed zeroes
 633: 0000: 
 634: 0000:   INTEGER*2 GLOBAL        \
 635: 0000:     IEX.RECL%,            \ Record Length - 28
 636: 0000:     IEX.REPORT.NUM%,      \ Drug File session Report Number
 637: 0000:     IEX.SESS.NUM%         \ Drug File Session Number
 638: 0000: 
 639: 0000: 
 640: 0000: %INCLUDE IRFDEC.J86     ! Item Reference File
 641: 0000: 
 642: 0000: \**********************************************************************************
 643: 0000: \***
 644: 0000: \***       %INCLUDE FOR ITEM RECORD FILE - FIELD DECLARATIONS
 645: 0000: \***                                     - FILE REFERENCE PARAMETERS
 646: 0000: \***
 647: 0000: \***                      FILE TYPE    : Keyed
 648: 0000: \***
 649: 0000: \***                      REFERENCE    : IRFDEC.J86
 650: 0000: \***
 651: 0000: \***     Version A               Andrew Wedgeworth            29th June 1992
 652: 0000: \***
 653: 0000: \***     Version B               Andrew Wedgeworth        14th December 1992
 654: 0000: \***     Version letter incremented to match other IRF code.
 655: 0000: \***
 656: 0000: \***     Version C             Steve Windsor          12.02.93
 657: 0000: \***     Version letter incremented to match other IRF code.
 658: 0000: \***
 659: 0000: \***     Version D             Steve Windsor          12.05.93
 660: 0000: \***     Version letter incremented to match other IRF code.
 661: 0000: \***
 662: 0000: \***     Version E           Steve Perkins       20th September 1993
 663: 0000: \***     Deals project : Handling of Converted/Unconverted records
 664: 0000: \***     ++   Anything with 'Delete' after initials should be   ++
 665: 0000: \***     ++   deleted once the IRF has been converted in all    ++
 666: 0000: \***     ++   stores.                                           ++
 667: 0000: \***
 668: 0000: \***     Version F           Mark Walker            5th January 1994
 669: 0000: \***     Version letter incremented to match other IRF code.
 670: 0000: \***
 671: 0000: \***     Version 96A         Mark Walker               22nd May 1995
 672: 0000: \***     Definition for IRF.POINTS% added.
 673: 0000: \***
 674: 0000: \***                     Stuart McConnachie           12th June 1995
 675: 0000: \***     INDICAT3% comments added for discount/loyalty flags.
 676: 0000: \***
 677: 0000: \***     Version for 96C  Andrew Wedgeworth            22nd May 1996
 678: 0000: \***     Removed IRF.FILLER$ field, as this is now redundant.
 679: 0000: \***
 680: 0000: \***     Version G     Stuart William McConnachie      11th February 2000
 681: 0000: \***     Converted IRF.INDICAT2$ to integer flag byte.
 682: 0000: \***
 683: 0000: \***     REVISION 1.6.               ROBERT COWEY.               9 JUL 2002.
 684: 0000: \***     Major changes for 2002 Deals Rewrite project.
 685: 0000: \***     Incorporated up to date record layout to assist development work
 686: 0000: \***     (placed in the IRFDEC.J86 to make it visible from ...LST files).
 687: 0000: \***     Moved various comments against variables to record layout.
 688: 0000: \***     Relisted variables in alphabetical order.
 689: 0000: \***     Deleted redundant variables associated with the old deals system ...
 690: 0000: \***     DEAL.NUM$, DEAL.SAVING$
 691: 0000: \***     Retained variables that are otherwise redundant (to be set to null X'00'
 692: 0000: \***     within file functions) ...
 693: 0000: \***     INDICAT2%, INDICAT4%, SALEQUAN$, POINTS%
 694: 0000: \***     Defined variables to hold interpreted deals data for new deals system ...
 695: 0000: \***     DEAL.NUM$(n) and LIST.ID%(n) (where 'n' represents entry 0, 1 and 2).
 696: 0000: \***     These two variables are interpretations of DEAL.DATA% which is defined
 697: 0000: \***     locally within IRFFUN.BAS to keep underlying data invisible to programs.
 698: 0000: \***
 699: 0000: \***     REVISION 1.7                ROBERT COWEY.               5 AUG 2002.
 700: 0000: \***     Further changes for 2002 Deals Rewrite project (PSBF19 related).
 701: 0000: \***     Defined NEW.IRF.DATA$ as a global variable for use with new functions
 702: 0000: \***     CONCAT.NEW.IRF.DATA$ and SPLIT.NEW.IRF.DATA$.
 703: 0000: \***
 704: 0000: \***     REVISION 1.8                ROBERT COWEY.              15 JUL 2003.
 705: 0000: \***     Usage of INDICAT0% bit-3 X'08' changed to Item Contains Alcohol.
 706: 0000: \***     No changes to this file other than description.
 707: 0000: \***     No changes to IRF file functions.
 708: 0000: \***
 709: 0000: \***     REVISION 1.9.      STUART WILLIAM MCCONNACHIE           22 OCT 2003.
 710: 0000: \***     Changes to remove limit of 3 deals per item.
 711: 0000: \***     Declaration of new variables for IRF Deal Extension file (IRFDEX).
 712: 0000: \***
 713: 0000: \***     REVISION 2.0.            ALAN CARR                       9 FEB 2006.
 714: 0000: \***     Add new IRF.INDICAT8% 1 byte, amend IRF.UNUSED$ from 3 to 2 bytes.
 715: 0000: \***
 716: 0000: \***     REVISION 2.1              TITTOO THOMAS                  01 July 2011
 717: 0000: \***     The IRF.UNUSED field is disintegrated to 2 new indicator fields
 718: 0000: \***                      IRF.INDICAT9%   1 INT
 719: 0000: \***                      IRF.INDICAT10%  1 INT
 720: 0000: \***...............................................................................
 721: 0000: 
 722: 0000: 
 723: 0000: \**********************************************************************************
 724: 0000: \***
 725: 0000: \***    IRF RECORD LAYOUT - REVISION 1.7 - CORRECT FOR 2011 CORE Stores PROJECT
 726: 0000: \***
 727: 0000: \***     1 11  UPD  BAR.CODE$   Without check digit - File KEY
 728: 0000: \***    12  1  INT  INDICAT0%
 729: 0000: \***                    X"01" - Contains statins                           ! 2.2 TT
 730: 0000: \***                    X"02" - Item not priced (giveaway)
 731: 0000: \***                    X"04" - Item not returnable
 732: 0000: \***                    X"08" - Item contains alcohol
 733: 0000: \***                    X"10" - Blocked from sale                          ! 2.2 TT
 734: 0000: \***                    X"20" - Enforced price entry
 735: 0000: \***                    X"40" - Enforced quantity entry
 736: 0000: \***                    X"80" - Movement kept
 737: 0000: \***    13  1  INT  INDICAT1%
 738: 0000: \***                    X"01" - Asprin
 739: 0000: \***                    X"02" - Paracetamol
 740: 0000: \***                    X"04" - TPLU inclusion flag
 741: 0000: \***                    X"08" - Giftcard item                              ! 2.2 TT
 742: 0000: \***                    X"10" - Withdrawn Block from sale                  ! 2.2 TT
 743: 0000: \***                    X"20" - Non-solid dose painkiller                  ! 2.2 TT
 744: 0000: \***                    X"40" - Insurance policy item                      ! 2.2 TT
 745: 0000: \***                    X"80" - Ibuprofen
 746: 0000: \***    14  2  INT  DEAL.DATA%(0)   Interpreted into sub-variables ...
 747: 0000: \***                    X'3F' - into DEAL.NUM$(0) "0000" to "9999" (2 byte UPD)
 748: 0000: \***                    X'C0' - into LIST.ID%(0) X'00' X
 749: 0000: \***                                             X'01' A
 750: 0000: \***                                             X'10' B
 751: 0000: \***                                             X'11' C                   ! 1.9 RC
 752: 0000: \***    16  1  INT  INDICAT8%                                              ! 2.0 AJC
 753: 0000: \***                    X"01" - Chlamydia NHS test kit                     ! 2.2 TT
 754: 0000: \***                    X"02" - Chlamydia open sell test kit               ! 2.2 TT
 755: 0000: \***                    X"04" - Unrestricted group code                    ! 2.2 TT
 756: 0000: \***                    X"08" - Nightingale Till prompt                    ! 2.2 TT
 757: 0000: \***                    X"10" - Contains Ephedrine                         ! 2.2 TT
 758: 0000: \***                    X"60" -  X'00' - If also Blocked From Sale Recall, ! 2.2 TT
 759: 0000: \***                                        Emergency                      ! 2.2 TT
 760: 0000: \***                             X'00' - If NOT Blocked From Sale Recall,  ! 2.2 TT
 761: 0000: \***                                        No recall                      ! 2.2 TT
 762: 0000: \***                             X'20' 100% returns                        ! 2.2 TT
 763: 0000: \***                             X'40' Withdrawn recall                    ! 2.2 TT
 764: 0000: \***                             X'60' Reverse Logistics                   ! 2.2 TT
 765: 0000: \***                    X"80" - WEEE item flag                             ! 2.0 AJC
 766: 0000: \***    17  1  INT  INDICAT9%
 767: 0000: \***                    X'3F' - Disposal special instruction (0-63)
 768: 0000: \***                    X"40" - Resaleable Indicator
 769: 0000: \***                    X"80" - Boots.com Extended Indicator
 770: 0000: \***    18  1  INT  INDICAT10%
 771: 0000: \***                    X'07' - Age restrictions
 772: 0000: \***                             X'00' - No Age restriction
 773: 0000: \***                             X'01' - Age 12 or over
 774: 0000: \***                             X'02' - Age 15 or over
 775: 0000: \***                             X'03' - Age 16 or over
 776: 0000: \***                             X'04' - Age 18 or over
 777: 0000: \***                             X'05' - Age 21 or over
 778: 0000: \***                             X'06' - Reserved
 779: 0000: \***                             X'07' - Reserved
 780: 0000: \***                    X'38' - Ethical classification
 781: 0000: \***                             X'00' - No ethical classification
 782: 0000: \***                             X'08' - Pharmacy medicine (P)
 783: 0000: \***                             X'10' - General Sale License (GSL)
 784: 0000: \***                             X'18' - Prescription Only Medicine (POM)
 785: 0000: \***                             X'20' - Reserved
 786: 0000: \***                             X'28' - Reserved
 787: 0000: \***                             X'30' - Reserved
 788: 0000: \***                             X'38' - Reserved
 789: 0000: \***                    X'C0' - Returns route
 790: 0000: \***                             X'00' - Not Returnable (Destroy)
 791: 0000: \***                             X'40' - Returns & Recovery
 792: 0000: \***                             X'80' - Direct
 793: 0000: \***                             X'C0' - Semi-centralised
 794: 0000: \***    19  5  UPD  SALEPRIC$   Current price in pence
 795: 0000: \***    24  1  INT  INDICAT5%   Guarantee duration
 796: 0000: \***                    X'3F' - Lowest 6 bits indicate duration (1-63)
 797: 0000: \***                    X'40' - Contains Pseudoephedrine                   ! 2.2 TT
 798: 0000: \***                    X'80' - Guarantee Duration Type                    ! 2.2 TT
 799: 0000: \***                              (1 = Months, 0 = Years)                  ! 2.2 TT
 800: 0000: \***    25 18  ASC  ITEMNAME$   Description used by till
 801: 0000: \***    43  3  UPD  BOOTS.CODE$ Without check digit
 802: 0000: \***    46  2  INT  DEAL.DATA%(1)   Similar structure to DEAL.DATA%(0)
 803: 0000: \***    48  2  INT  DEAL.DATA%(2)   Similar structure to DEAL.DATA%(0)
 804: 0000: \***    50  1  INT  INDICAT3%
 805: 0000: \***                    X"01" - Discountexempt (item exempt from discount)
 806: 0000: \***                    X"02" - Boots brand item
 807: 0000: \***                    X"04" - Item redeemable for loyalty
 808: 0000: \***                    X"08" - Loyalty exempt (item exempt from loyalty)
 809: 0000: \***                    X"10" - **Redundant                                ! 2.2 TT
 810: 0000: \***                    X"20" - Local Price active
 811: 0000: \***                    X"40" - Stock system item
 812: 0000: \***                    X"80" - **Redundant                                ! 2.2 TT
 813: 0000: \***
 814: 0000: \***    Record Length 50
 815: 0000: \***
 816: 0000: \***
 817: 0000: \***    IRF DEAL EXTENSION RECORD LAYOUT ! 1.9 RC
 818: 0000: \***
 819: 0000: \***     1  3  UPD  BOOTS.CODE$
 820: 0000: \***     4  2  INT  IRF.DEAL.DATA%(3)   Similar structure to DEAL.DATA%(0)
 821: 0000: \***     6  2  INT  IRF.DEAL.DATA%(4)   Similar structure to DEAL.DATA%(0)
 822: 0000: \***     8  2  INT  IRF.DEAL.DATA%(5)   Similar structure to DEAL.DATA%(0)
 823: 0000: \***    10  2  INT  IRF.DEAL.DATA%(6)   Similar structure to DEAL.DATA%(0)
 824: 0000: \***    12  2  INT  IRF.DEAL.DATA%(7)   Similar structure to DEAL.DATA%(0)
 825: 0000: \***    14  2  INT  IRF.DEAL.DATA%(8)   Similar structure to DEAL.DATA%(0)
 826: 0000: \***    16  2  INT  IRF.DEAL.DATA%(9)   Similar structure to DEAL.DATA%(0)
 827: 0000: \***
 828: 0000: \***    Record Length 17
 829: 0000: \***
 830: 0000: \**********************************************************************************
 831: 0000: 
 832: 0000: 
 833: 0000:     STRING GLOBAL            \
 834: 0000:         IRF.ALT.FILE.NAME$,  \
 835: 0000:         IRF.BAR.CODE$,       \
 836: 0000:         IRF.BOOTS.CODE$,     \
 837: 0000:         IRF.DEAL.SAVING$,    \ 2 byte - deal saving amount (0 - 99.99) ! ESP
 838: 0000:         IRF.DEPARTME$,       \ 3 byte UPD. Department number          ! ESP Delete
 839: 0000:         IRF.FILE.NAME$,      \
 840: 0000:         IRF.HOLDING.PRICE$,  \ 4 byte UPD. Current H.O. price in pence if a local
 841: 0000:                              \ price is in effect, zero otherwise.     ! ESP Delete
 842: 0000:         IRF.ITEMNAME$,       \
 843: 0000: \       IRF.MPGROUP$,        \ Removed SBH 31/1/96
 844: 0000:         IRF.RECORD$,         \                                         ! ESP Delete
 845: 0000:         IRF.SALEPRIC$,       \
 846: 0000:         IRF.SALEQUAN$,       \ Redundant (set to null within functions)    ! 1.6 RC
 847: 0000:         IRF.UNUSED$,         \                                                        ! 1.6 RC
 848: 0000:         NEW.IRF.DATA$        !                                             ! 1.7 RC
 849: 0000: 
 850: 0000:     STRING GLOBAL            \                                             ! 1.6 RC
 851: 0000:         IRF.DEAL.NUM$(1)                                                   ! 1.6 RC
 852: 0000: 
 853: 0000:     INTEGER*1 GLOBAL         \
 854: 0000:         IRF.DD.SUB%,         \ IRF.DEAL.DATA% subscript                    ! 1.6 RC
 855: 0000:         IRF.INDICAT0%,       \
 856: 0000:         IRF.INDICAT1%,       \
 857: 0000:         IRF.INDICAT2%,       \ Redundant (set to null within functions)    ! 1.6 RC
 858: 0000:         IRF.INDICAT3%,       \
 859: 0000:         IRF.INDICAT4%,       \ Redundant (set to null within functions)    ! 1.6 RC
 860: 0000:         IRF.INDICAT5%,       \                                             ! 2.0 AJC
 861: 0000:         IRF.INDICAT8%,       \                                             ! 2.0 AJC
 862: 0000:         IRF.INDICAT9%,       \                                             ! 2.2 TT
 863: 0000:         IRF.INDICAT10%                                                     ! 2.2 TT
 864: 0000: 
 865: 0000:     INTEGER*1 GLOBAL         \                                             ! 1.6 RC
 866: 0000:         IRF.LIST.ID%(1)                                                    ! 1.6 RC
 867: 0000: 
 868: 0000:     INTEGER*2 GLOBAL         \
 869: 0000:         IRF.ALT.REPORT.NUM%, \
 870: 0000:         IRF.ALT.SESS.NUM%,   \
 871: 0000:         IRF.POINTS%,         \ Redundant (set to null within functions)    ! 1.6 RC
 872: 0000:         IRF.RECL%,           \
 873: 0000:         IRF.REPORT.NUM%,     \
 874: 0000:         IRF.SESS.NUM%,       \
 875: 0000:         IRF.MAX.DEALS%       !                                             ! 1.9 SM
 876: 0000: 
 877: 0000:     STRING GLOBAL IRFDEX.FILE.NAME$                                        ! 1.9 SM
 878: 0000: 
 879: 0000:     INTEGER*2 GLOBAL IRFDEX.SESS.NUM%                                      ! 1.9 SM
 880: 0000:     INTEGER*2 GLOBAL IRFDEX.REPORT.NUM%                                    ! 1.9 SM
 881: 0000:     INTEGER*2 GLOBAL IRFDEX.RECL%                                          ! 1.9 SM
 882: 0000: 
 883: 0000: 
 884: 0000: !   INTEGER*2 GLOBAL      \ IRF.DEAL.DATA%(n) variables are defined locally  1.6 RC
 885: 0000: !       IRF.DEAL.DATA%(1) \ within IRFFUN.BAS to keep invisible to programs  1.6 RC
 886: 0000: 
 887: 0000: %INCLUDE ISFDEC.J86     ! Item Shelf Edge Label Description File
 888: 0000: REM \
 889: 0000: \******************************************************************************
 890: 0000: \******************************************************************************
 891: 0000: \***
 892: 0000: \***         %INCLUDE FOR ITEM SHELF EDGE DESCRIPTION FILE 
 893: 0000: \***
 894: 0000: \***               - FILE REFERENCE PARAMETERS
 895: 0000: \***               - FIELD DECLARATIONS
 896: 0000: \***
 897: 0000: \***               FILE TYPE    : Keyed  
 898: 0000: \***
 899: 0000: \***               REFERENCE    : ISFDEC.J86
 900: 0000: \***
 901: 0000: \******************************************************************************
 902: 0000: \******************************************************************************
 903: 0000: 
 904: 0000:   INTEGER*4 GLOBAL        \
 905: 0000:     ISF.INTEGER.4%,       \ BRD
 906: 0000:     IUDF.FILE.SIZE%       ! BRD
 907: 0000:   
 908: 0000:   INTEGER*2 GLOBAL        \
 909: 0000:     ISF.SESS.NUM%,        \
 910: 0000:     ISF.REPORT.NUM%,      \ 
 911: 0000:     ISF.RECL%,            \
 912: 0000:     ISF.INTEGER.2%        ! BRD
 913: 0000:     
 914: 0000:   INTEGER*2               \ BRD
 915: 0000:     IUDF.REPORT.NUM%,     \ BRD
 916: 0000:     IUDF.SESS.NUM%,       \ BRD
 917: 0000:     IUDF.RECL%,           \ BRD
 918: 0000:     UNIT.NAME.COUNTER%,   \ BRD
 919: 0000:     IUDF.RECORD.POSITION%,\ BRD
 920: 0000:     PRINT.FLAG%           ! BRD
 921: 0000:     
 922: 0000:     
 923: 0000:   STRING GLOBAL           \
 924: 0000:     ISF.BOOTS.CODE$,      \ 4 byte UPD with check digit (key)
 925: 0000:     ISF.S.E.DESC$,        \ 45 bytes. Shelf edge description
 926: 0000:     ISF.ITEM.QTY$,        \ 4 byte UPD. Shelf Item Qty
 927: 0000:     ISF.UNIT.MEASUREMENT$,\ 2 byte UPD. Unit Measurement
 928: 0000:     ISF.UNIT.NAME$,       \ 10 bytes. Unit Name eg. 'ml'
 929: 0000:     ISF.SEL.PRINTED.FLAG$,\ 1 byte UPD. Last printed version
 930: 0000:     ISF.FILE.NAME$,       \
 931: 0000:     IUDF.RECORD$          ! CCS
 932: 0000:     
 933: 0000:   STRING                  \
 934: 0000:     RECORD.FORMAT$,       \ BRD
 935: 0000:     IUDF.FILE.NAME$ !,      \ BRD
 936: 0000:     ! IUDF.RECORD$          ! BRD
 937: 0000: 
 938: 0000: %INCLUDE IUFDEC.J86     ! Item Update File
 939: 0000: \REM
 940: 0000: \*******************************************************************************
 941: 0000: \*******************************************************************************
 942: 0000: \***
 943: 0000: \***    %INCLUDE FOR ITEM UPDATE FILES VARIABLE DECLARATIONS
 944: 0000: \***
 945: 0000: \***        REFERENCE   :   IUFDEC (J86)
 946: 0000: \***
 947: 0000: \***        FILE TYPE   :   Sequential
 948: 0000: \***
 949: 0000: \***    VERSION H.              ROBERT COWEY.                       24 AUG 1993.
 950: 0000: \***    Original version created by combining IUFFLDG and IUFNUMG.
 951: 0000: \***
 952: 0000: \***    VERSION I.              ROBERT COWEY.                       25 AUG 1993.
 953: 0000: \***    Added NEW.DEAL.COUNT$ and BC.LETTER$ to record type "001" (Item
 954: 0000: \***    reference).
 955: 0000: \***    Removed falconcraft detail variables (SALESPLAN.ID$, BUS.CENTRE$,
 956: 0000: \***    START.DATE$, END.DATE$, TICKET.TYPE$, GENOF.NUM$, GENOF.DESC$,
 957: 0000: \***    FOOTER.TYPE$) from record types "003" (Deal price) and "004" (Item
 958: 0000: \***    pending).
 959: 0000: \***    Defined record type "006" (Deals).
 960: 0000: \***
 961: 0000: \***    VERSION J.              Andrew Wedgeworth                13th March 1995
 962: 0000: \***    Focus flag, Price Pledge flag and ASCOTT/COMPASS flag replaced with
 963: 0000: \***    fields for the Staff Discount, Customer Loyalty and Give-away systems.
 964: 0000: \***
 965: 0000: \***    VERSION K               Rebecca Dakin                    28th June 1999
 966: 0000: \***
 967: 0000: \***    Version L        Andy Cotton & Amy Hoggard     29th Jan 2003
 968: 0000: \***    Change use and name of variable IUF.DEAL.PRICE.FLAG$ to IUF.KEYLINES.FLAG$
 969: 0000: \***
 970: 0000: \***    Version M               Brian Greenfield                 25th June 2004
 971: 0000: \***    Added new IUF.MARKDOWN$ tor use with SEL Markdown flagged items.
 972: 0000: \***
 973: 0000: \***    Version 1.6           Charles Skadorwa                 4th July 2011
 974: 0000: \***    CORE Heritage Stores Release 2 (Outbound) Project.
 975: 0000: \***    Added new globals.
 976: 0000: \***
 977: 0000: \***    VERSION 1.7.                ROBERT COWEY.                07 FEB 2012.
 978: 0000: \***    Changes creating PSB21.286 Core Release 2 version 1.5.
 979: 0000: \***
 980: 0000: \***    Defect 21 - Commented 1.9 RC (21).
 981: 0000: \***    Commented real meaning of IUF.DISCOUNTABLE$ as Discount Exempt.
 982: 0000: \***
 983: 0000: \***    VERSION 1.8.                ROBERT COWEY.                20 FEB 2012.
 984: 0000: \***    Changes creating PSB21.286 Core Release 2 version 1.6.
 985: 0000: \***    Correction relating to transformation of legacy IUF data to Core R2 format
 986: 0000: \***
 987: 0000: \***    Defect 44 - Commented 1.11 RC (44).
 988: 0000: \***    Replaced variables HEALTH.CONCEPT.GROUPS$ and HEALTH.GROUP$ with more
 989: 0000: \***    meaningfully named single variable INSURE.CONCEPT.GROUPS$.
 990: 0000: \***
 991: 0000: \***    VERSION B               Rejiya Nair             13th May 2016
 992: 0000: \***    PRJ1452 Restricting Item Sales
 993: 0000: \***    - Declaration of two new variables (version tagged as !BRN)
 994: 0000: \***    - Removed the commented out code
 995: 0000: \***
 996: 0000: \*******************************************************************************
 997: 0000: \*******************************************************************************
 998: 0000: 
 999: 0000: 
1000: 0000: \*******************************************************************************
1001: 0000: \*******************************************************************************
1002: 0000: \***
1003: 0000: \***    RECORD LAYOUTS
1004: 0000: \***
1005: 0000: \***    HEADER RECORD
1006: 0000: \***
1007: 0000: \***     1  7  ASC  BOOTS.CODE$
1008: 0000: \***     8  3  ASC  TRANS.TYPE$             "000" Header
1009: 0000: \***    11  4  ASC  IUF.BRANCH.NO$
1010: 0000: \***    15  5  ASC  IUF.SERIAL.NO$
1011: 0000: \***
1012: 0000: \***    ITEM REFERENCE RECORD
1013: 0000: \***
1014: 0000: \***     1  7  ASC  BOOTS.CODE$
1015: 0000: \***     8  3  ASC  TRANS.TYPE$             "001" Item reference
1016: 0000: \***    11  1  ASC  IUF.GRP.CODE.FLAG$
1017: 0000: \***    12 24  ASC  IUF.STNDRD.DESC$
1018: 0000: \***    36 18  ASC  IUF.TILL.DESC$
1019: 0000: \***    54 45  ASC  IUF.S.E.DESC$
1020: 0000: \***    99  1  ASC  IUF.SUPPLY.ROUTE$
1021: 0000: \***   100  1  ASC  IUF.GIVEAWAY$
1022: 0000: \***   101  5  ASC  IUF.PROD.GRP$
1023: 0000: \***   106  1  ASC  IUF.GUARANTEE.CAT$          ! SBH CHANGED FROM ENF.QTY 31/1/96
1024: 0000: \***   107  1  ASC  IUF.ENF.PRICE.ENTRY$
1025: 0000: \***   108  1  ASC  IUF.LOYALTY.FLAG$
1026: 0000: \***   109  1  ASC  IUF.DISCOUNT.CAT$
1027: 0000: \***   110  1  ASC  IUF.OWN.BRAND$
1028: 0000: \***   111  1  ASC  IUF.DIRECT.PROC$
1029: 0000: \***   112  1  ASC  IUF.STATUS.1$
1030: 0000: \***   113  1  ASC  IUF.EANS.CHANGED$
1031: 0000: \***   114  3  ASC  IUF.NO.OF.EANS$
1032: 0000: \***   117  8  ASC  IUF.CURRENT.PRICE$      Price in pence
1033: 0000: \***   125  1  ASC  IUF.NO.OF.RPD.PRICES$
1034: 0000: \***   126  2  ASC  IUF.NO.OF.FLASHPACKS$
1035: 0000: \***   128  7  ASC  IUF.ORIGIN.CODE$
1036: 0000: \***   135  1  ASC  IUF.DEAL.PRICE.FLAG$    !L CHANGED TO IUF.KEYLINES.FLAG$
1037: 0000: \***   136  1  ASC  IUF.STOCK.SYSTEM.FLAG$  "Y" Stock system item
1038: 0000: \***                                        "N" Non stock system item
1039: 0000: \***   137  2  ASC  NEW.DEAL.COUNT$         Number of type 6 records
1040: 0000: \***   139  1  ASC  BC.LETTER$              Business centre letter
1041: 0000: \***
1042: 0000: \***    FLASHPACK RECORD
1043: 0000: \***
1044: 0000: \***     1  7  ASC  BOOTS.CODE$
1045: 0000: \***     8  3  ASC  TRANS.TYPE$             "002" Flashpack
1046: 0000: \***    11  7  ASC  FLASH.PACK.CODE$
1047: 0000: \***    18  3  ASC  MULTIPLICATION.FACTOR$
1048: 0000: \***
1049: 0000: \***    DEAL PRICE RECORD
1050: 0000: \***
1051: 0000: \***     1  7  ASC  BOOTS.CODE$
1052: 0000: \***     8  3  ASC  TRANS.TYPE$             "003" Deal price
1053: 0000: \***    11  1  ASC  DEAL.TYPE$
1054: 0000: \***    12  2  ASC  DEAL.QUANTITY$
1055: 0000: \***    14  5  ASC  SPECIAL.PRICE$          Price in pence
1056: 0000: \***    19  2  ASC  M.P.GROUP$
1057: 0000: \***    21  6  ASC  FIRST.DATE$             YYMMDD format
1058: 0000: \***    27  6  ASC  LAST.DATE$              YYMMDD format
1059: 0000: \***
1060: 0000: \***    ITEM PENDING PRICE RECORD
1061: 0000: \***
1062: 0000: \***     1  7  ASC  BOOTS.CODE$
1063: 0000: \***     8  3  ASC  TRANS.TYPE$             "004" Item pending price
1064: 0000: \***    11  6  ASC  RPD.DATE$               YYMMDD format
1065: 0000: \***    17  8  ASC  NEW.PRICE$              Price in pance
1066: 0000: \***    25  5  ASC  RPD.NO$
1067: 0000: \***    30  1  ASC  MARKDOWN$               Markdown flag of "Y" or "N" !MBG
1068: 0000: \***
1069: 0000: \***    ITEM BARCODE RECORD
1070: 0000: \***
1071: 0000: \***     1  7  ASC  BOOTS.CODE$
1072: 0000: \***     8  3  ASC  TRANS.TYPE$             "005" Item barcode
1073: 0000: \***    11 12  ASC  BAR.CODE$
1074: 0000: \***
1075: 0000: \***    DEALS RECORD (MULTI-BUY FORMAT)     Sorted by ...
1076: 0000: \***                                          BOOTS.CODE$ then DEAL.NUMBER$
1077: 0000: \***
1078: 0000: \***     1  7  ASC  BOOTS.CODE$             Boots item code with check digit
1079: 0000: \***     8  3  ASC  TRANS.TYPE$             "006" Deals
1080: 0000: \***    11  6  ASC  START.DATE$             YYMMDD format
1081: 0000: \***    17  6  ASC  END.DATE$               YYMMDD format
1082: 0000: \***    23  1  ASC  DEAL.ID$                "M" Multi-Buy
1083: 0000: \***    24  1  ASC  PAIR.TRIPLET.FLAG$      " " (not used for Multi-Buy)
1084: 0000: \***    25  1  ASC  3FOR2.FLAG$             "T" Three-For-Two type Multi-Buy
1085: 0000: \***    26  2  ASC  DEAL.LIMIT$             2 to 15 Qualifying purchases
1086: 0000: \***    28  4  ASC  DEAL.NUMBER$            100 to 9999
1087: 0000: \***    32  4  ASC  SAVED.AMOUNT$           1 to 9999 if fixed saving
1088: 0000: \***                                        zero if highest price purchased
1089: 0000: \***
1090: 0000: \***    DEALS RECORD (LINK-SAVE FORMAT)     Sorted by ...
1091: 0000: \***                                          BOOTS.CODE$ then DEAL.NUMBER$
1092: 0000: \***
1093: 0000: \***     1  7  ASC  BOOTS.CODE$             Boots item code with check digit
1094: 0000: \***     8  3  ASC  TRANS.TYPE$             "006" Deals
1095: 0000: \***    11  6  ASC  START.DATE$             YYMMDD format
1096: 0000: \***    17  6  ASC  END.DATE$               YYMMDD format
1097: 0000: \***    23  1  ASC  DEAL.ID$                "A" "B" "X" Link-Save list ID
1098: 0000: \***    24  1  ASC  PAIR.TRIPLET.FLAG$      "P" Pair, "T" Triplet
1099: 0000: \***    25  1  ASC  3FOR2.FLAG$             " " (not used for Link-Save)
1100: 0000: \***    26  2  ASC  DEAL.LIMIT$             1 to 15 Qualifying (list) purchases
1101: 0000: \***    28  4  ASC  DEAL.NUMBER$            100 to 9999
1102: 0000: \***    32  4  ASC  SAVED.AMOUNT$           1 to 9999 if fixed saving
1103: 0000: \***                                        zero if highest price purchased
1104: 0000: \***    TRAILER RECORD
1105: 0000: \***
1106: 0000: \***     1  7  ASC  BOOTS.CODE$
1107: 0000: \***    ]8  3  ASC  TRANS.TYPE$             "999" Trailer
1108: 0000: \***    11  7  ASC  IUF.ITEM.COUNT$
1109: 0000: \***
1110: 0000: \*******************************************************************************
1111: 0000: \*******************************************************************************
1112: 0000: 
1113: 0000: 
1114: 0000:     STRING GLOBAL                                                       \
1115: 0000:         IUF.FILE.NAME$
1116: 0000: 
1117: 0000:     INTEGER*1 GLOBAL                                                    \ 1.6CSk
1118: 0000:         IUF.NEW.FORMAT                                                  ! 1.6CSk
1119: 0000: 
1120: 0000:     INTEGER*2 GLOBAL                                                    \
1121: 0000:         IUF.REPORT.NUM%,                                                \
1122: 0000:         IUF.SESS.NUM%,                                                  \ 1.6CSk
1123: 0000:         REFPGF.COUNT%,                                                  \ 1.6CSk
1124: 0000:         REFPGF.REPORT.NUM%,                                             \ 1.6CSk
1125: 0000:         REFPGF.SESS.NUM%                                                ! 1.6CSk
1126: 0000: 
1127: 0000:   STRING GLOBAL                                                         \
1128: 0000:         IUF.3FOR2.FLAG$,                                                \ IRC
1129: 0000:         IUF.BAR.CODE$,                                                  \
1130: 0000:         IUF.BC.LETTER$,                                                 \ IRC
1131: 0000:         IUF.BOOTS.CODE$,                                                \
1132: 0000:         IUF.BRANCH.NO$,                                                 \
1133: 0000:         IUF.CURRENT.PRICE$,                                             \
1134: 0000:         IUF.DEAL.ID$,                                                   \ IRC
1135: 0000:         IUF.DEAL.LIMIT$,                                                \ IRC
1136: 0000:         IUF.DEAL.NUMBER$,                                               \ IRC
1137: 0000:         IUF.KEYLINES.FLAG$,                                             \ LAC/AH
1138: 0000:         IUF.DEAL.QUANTITY$,                                             \
1139: 0000:         IUF.DEAL.TYPE$,                                                 \
1140: 0000:         IUF.DIRECT.PROC$,                                               \
1141: 0000:         IUF.DISCOUNT.CAT$,                                              \ JAW
1142: 0000:         IUF.EANS.CHANGED$,                                              \
1143: 0000:         IUF.END.DATE$,                                                  \
1144: 0000:         IUF.ENF.PRICE.ENTRY$,                                           \
1145: 0000:         IUF.GUARANTEE.CAT$,                                             \ SBH 31/1/96
1146: 0000:         IUF.FIRST.DATE$,                                                \
1147: 0000:         IUF.FLASH.PACK.CODE$,                                           \
1148: 0000:         IUF.GIVEAWAY$,                                                  \ JAW
1149: 0000:         IUF.GRP.NO$,                                                   \!BRN
1150: 0000:         IUF.GRP.CODE.FLAG$,                                             \
1151: 0000:         IUF.ITEM.COUNT$,                                                \
1152: 0000:         IUF.ITEM.QTY$,                                                  \ KRD
1153: 0000:         IUF.LAST.DATE$,                                                 \
1154: 0000:         IUF.LOYALTY.FLAG$,                                              \ JAW
1155: 0000:         IUF.M.P.GROUP$,                                                 \
1156: 0000:         IUF.MULTIPLICATION.FACTOR$,                                     \
1157: 0000:         IUF.NEW.DEAL.COUNT$,                                            \ IRC
1158: 0000:         IUF.NEW.PRICE$,                                                 \
1159: 0000:         IUF.NO.OF.EANS$,                                                \
1160: 0000:         IUF.NO.OF.RPD.PRICES$,                                          \
1161: 0000:         IUF.OWN.BRAND$,                                                 \
1162: 0000:         IUF.PAIR.TRIPLET.FLAG$,                                         \ IRC
1163: 0000:         IUF.PROD.GRP$,                                                  \
1164: 0000:         IUF.RECORD$,                                                    \
1165: 0000:         IUF.RESTRICT.SALES.FLAG$,                                      \!BRN
1166: 0000:         IUF.RPD.DATE$,                                                  \
1167: 0000:         IUF.RPD.NO$,                                                    \
1168: 0000:         IUF.S.E.DESC$,                                                  \
1169: 0000:         IUF.SAVED.AMOUNT$,                                              \ IRC
1170: 0000:         IUF.SERIAL.NO$,                                                 \
1171: 0000:         IUF.SPECIAL.PRICE$,                                             \
1172: 0000:         IUF.START.DATE$,                                                \ IRC
1173: 0000:         IUF.STATUS.1$,                                                  \
1174: 0000:         IUF.STNDRD.DESC$,                                               \
1175: 0000:         IUF.STOCK.SYSTEM.FLAG$,                                         \
1176: 0000:         IUF.SUPPLY.ROUTE$,                                              \
1177: 0000:         IUF.TILL.DESC$,                                                 \
1178: 0000:         IUF.TRANS.TYPE$,                                                \
1179: 0000:         IUF.UNIT.MEASUREMENT$,                                          \ KRD
1180: 0000:         IUF.UNIT.NAME$                                                  ! KRD
1181: 0000: 
1182: 0000:   STRING GLOBAL                                                         \ 1.6CSk
1183: 0000:         AGES$(1),                                                       \ 1.6CSk
1184: 0000:         GIFTBRCD.TABLE$(1),                                             \ 1.6CSk
1185: 0000:         IUF.MATRIX$(1),                                                 \ 1.6CSk
1186: 0000:         MEDICINES.TABLE$(1),                                            \ 1.6CSk
1187: 0000:         REFPGF.RECORDS$(1)                                              ! 1.6CSk
1188: 0000: 
1189: 0000:   STRING GLOBAL                                                         \ 1.6CSk
1190: 0000:         AGE$,                                                           \ 1.6CSk
1191: 0000:         AGE.RESTRICT$,                                                  \ 1.6CSk
1192: 0000:         ALCOHOL.PROD.GRP.LIST$,                                         \ 1.6CSk
1193: 0000:         ALL.MEDICINES$,                                                 \ 1.6CSk
1194: 0000:         ALREADY.IN.TABLE$,                                              \ 1.6CSk
1195: 0000:         ASPIRIN.RECORD$,                                                \ 1.6CSk
1196: 0000:         DOSAGE$,                                                        \ 1.6CSk
1197: 0000:         EPHED.TEMP$,                                                    \ 1.6CSk
1198: 0000:         GIFTRECORD$,                                                    \ 1.6CSk
1199: 0000:         INSURE.CONCEPT.GROUPS$, \ ! From BCF record 2                   \ 1.11 RC (44)
1200: 0000:         IBRUPROFEN.RECORD$,                                             \ 1.6CSk
1201: 0000:         IUF.AGE.RESTRICTION$,                                           \ 1.6CSk
1202: 0000:         IUF.BLOCKED.FROM.SALE$,                                         \ 1.6CSk
1203: 0000:         IUF.BOOTS.COM.EXTENDED$,                                        \ 1.6CSk
1204: 0000:         IUF.CONTAINS.ALCOHOL$,                                          \ 1.6CSk
1205: 0000:         IUF.CONTAINS.ASPIRIN$,                                          \ 1.6CSk
1206: 0000:         IUF.CONTAINS.EPHEDRINE$,                                        \ 1.6CSk
1207: 0000:         IUF.CONTAINS.IBUPROFEN$,                                        \ 1.6CSk
1208: 0000:         IUF.CONTAINS.NONSOLID.PAINKILLER$,                              \ 1.6CSk
1209: 0000:         IUF.CONTAINS.PARACETAMOL$,                                      \ 1.6CSk
1210: 0000:         IUF.CONTAINS.PSEUDOEPHEDRINE$,                                  \ 1.6CSk
1211: 0000:         IUF.DATE.SENSITIVE$,                                            \ 1.6CSk
1212: 0000:         IUF.DISCOUNTABLE$, \ ! Mis-leading variable name (should be Discount Exempt)  ! 1.9 RC (21)
1213: 0000:                            \ ! "Y" equates to IRF.INDICAT3% X'01' Discount Exempt ON  ! 1.9 RC (21)
1214: 0000:         IUF.EARN.POINTS$,                                               \ 1.6CSk
1215: 0000:         IUF.EFFERVESCENT$,                                              \ 1.6CSk
1216: 0000:         IUF.ETHICAL.ACTIVE$,                                            \ 1.6CSk
1217: 0000:         IUF.ETHICAL.CLASS$,                                             \ 1.6CSk
1218: 0000:         IUF.ETHICAL.DESCRIPTION$,                                       \ 1.6CSk
1219: 0000:         IUF.ETHICAL.PACK.SIZE$,                                         \ 1.6CSk
1220: 0000:         IUF.GIFTCARD$,                                                  \ 1.6CSk
1221: 0000:         IUF.GUARANTEE.LENGTH$,                                          \ 1.6CSk
1222: 0000:         IUF.INSURANCE$,                                                 \ 1.6CSk
1223: 0000:         IUF.INITIAL.LOAD$,                                              \ 1.6CSk
1224: 0000:         IUF.MARKDOWN$,                                                  \ 1.6CSk
1225: 0000:         IUF.PRIMARY.SUPPLIER$,                                          \ 1.6CSk
1226: 0000:         IUF.REC.COUNT$,                                                 \ 1.6CSk
1227: 0000:         IUF.REC.TYPE$,                                                  \ 1.6CSk
1228: 0000:         IUF.REDEEMABLE$,                                                \ 1.6CSk
1229: 0000:         IUF.RESALEABLE$,                                                \ 1.6CSk
1230: 0000:         IUF.RETURN.ROUTE$,                                              \ 1.6CSk
1231: 0000:         IUF.RETURNABLE$,                                                \ 1.6CSk
1232: 0000:         IUF.SPECIAL.INSTRUCTION$,                                       \ 1.6CSk
1233: 0000:         IUF.STORE.NUM$,                                                 \ 1.6CSk
1234: 0000:         IUF.TIME.STAMP$,                                                \ 1.6CSk
1235: 0000:         IUF.UNRESTRICTED.GROUP.CODE$,                                   \ 1.6CSk
1236: 0000:         PARACETAMOL.RECORD$,                                            \ 1.6CSk
1237: 0000:         PROD.GRP$                                                       ! 1.6CSk
1238: 0000: 
1239: 0000: 
1240: 0000: 
1241: 0000:   INTEGER*2 GLOBAL                                                      \ 1.6CSk
1242: 0000:         A%,                                                             \ 1.6CSk
1243: 0000:         J%,                                                             \ 1.6CSk
1244: 0000:         ADD.TO.TABLE%,                                                  \ 1.6CSk
1245: 0000:         AGE.POS%,                                                       \ 1.6CSk
1246: 0000:         GIFTBRCD.COUNT%,                                                \ 1.6CSk
1247: 0000:         HEALTH.INDEX%,                                                  \ 1.6CSk
1248: 0000:         MATCH.COMMA%,                                                   \ 1.6CSk
1249: 0000:         MATCH.POS1%,                                                    \ 1.6CSk
1250: 0000:         MATCH.POS2%,                                                    \ 1.6CSk
1251: 0000:         MEDICINES.IN.TABLE%,                                            \ 1.6CSk
1252: 0000:         NO.OF.AGES%,                                                    \ 1.6CSk
1253: 0000:         NO.OF.MEDICINES%,                                               \ 1.6CSk
1254: 0000:         PROD.GRP.NUM%,                                                  \ 1.6CSk
1255: 0000:         SPACE%                                                          ! 1.6CSk
1256: 0000: 
1257: 0000: %INCLUDE LOCALDEC.J86   ! Local File
1258: 0000: \***********************************************************************
1259: 0000: \***********************************************************************
1260: 0000: \***
1261: 0000: \***    DESCRIPTION: Local Price File
1262: 0000: \***                 Field Definitions
1263: 0000: \***
1264: 0000: \***    FILE TYPE : Keyed
1265: 0000: \***
1266: 0000: \***********************************************************************
1267: 0000: \***
1268: 0000: \***    Version A.          Paul Flanagan                1st Jul 1993
1269: 0000: \***    Initial version.
1270: 0000: \***
1271: 0000: \***    Version B.          Clive Norris                24th Nov 1993
1272: 0000: \***    AUTH.NUM$, STOCK.FIG$ and RETRIEVAL.FLAG$ replaced filler as
1273: 0000: \***    part of the RETURNS/AUTOMATIC CREDIT CLAIMING package.
1274: 0000: \***
1275: 0000: \***    Version C.          Mick Bayliss                 6th Dec 1994
1276: 0000: \***    Added missing field.
1277: 0000: \***
1278: 0000: \***    Version D.          Mark Walker                  1st Jul 2015
1279: 0000: \***    F392 Retail Stock 5
1280: 0000: \***    Added key length field.
1281: 0000: \***
1282: 0000: \***********************************************************************
1283: 0000: \***********************************************************************
1284: 0000: 
1285: 0000:     STRING GLOBAL             \
1286: 0000:         LOCAL.AUTH.NUM$,      \ 4 bytes UPD Auth'n number
1287: 0000:                               \             from Business Centre.
1288: 0000:         LOCAL.END.DATE$,      \ 3 bytes UPD yymmdd.
1289: 0000:         LOCAL.FILE.NAME$,     \
1290: 0000:         LOCAL.H.O.PRICE$,     \ 5 byte UPD.
1291: 0000:         LOCAL.HO.CHANGE$,     \ 3 bytes UPD. Date of HO price change
1292: 0000:                               \ (this will be zero if no change since
1293: 0000:                               \ local price was initiated).
1294: 0000:         LOCAL.ITEM.CODE$,     \ 4 bytes UPD (key) Boots code 
1295: 0000:                               \                   with check digit. 
1296: 0000:         LOCAL.OPERATOR$,      \ 4 bytes UPD operator id (when set up).
1297: 0000:         LOCAL.PRICE$,         \ 5 bytes UPD.
1298: 0000:         LOCAL.REASON$,        \ 4 byte ASCII 
1299: 0000:         LOCAL.RETRIEVAL.FLAG$,\ 1 byte ASC "Y" or "N"  
1300: 0000:         LOCAL.SPACE$,         \                                            !CMJB
1301: 0000:         LOCAL.START.DATE$,    \ 3 bytes UPD yymmdd. 
1302: 0000:         LOCAL.START.TIME$     ! 2 bytes UPD hhmm.
1303: 0000:         
1304: 0000:     INTEGER*2 GLOBAL          \
1305: 0000:         LOCAL.KEYL%,          \                                             !DMW
1306: 0000:         LOCAL.RECL%,          \
1307: 0000:         LOCAL.REPORT.NUM%,    \
1308: 0000:         LOCAL.SESS.NUM%,      \
1309: 0000:         LOCAL.STOCK.FIG%      !  No. of items authorised at the price.
1310: 0000: 
1311: 0000: %INCLUDE NLINEDEC.J86   ! New Lines File
1312: 0000: 
1313: 0000: \*****************************************************************************
1314: 0000: \*****************************************************************************
1315: 0000: \***
1316: 0000: \***        %INCLUDE FIELD DECLARATIONS AND FILE REFERENCE PARAMETERS
1317: 0000: \***
1318: 0000: \***                   FILE TYPE:  KEYED
1319: 0000: \***
1320: 0000: \***                   REFERENCE:  NLINEDEC.J86
1321: 0000: \***
1322: 0000: \***              DESCRIPTION:  NEWLINES - NEWLINES INFORMATION
1323: 0000: \***
1324: 0000: \***
1325: 0000: \***
1326: 0000: \***      VERSION 1 : Julia Stones             7th July 2003
1327: 0000: \***
1328: 0000: \***      Version 1.1   Julia Stones           6th October 2003
1329: 0000: \***      Added Newlines count to hold value of last number of existing new
1330: 0000: \***      lines added.
1331: 0000: \***
1332: 0000: \***    REVISION 1.2.                ROBERT COWEY.               05 DEC 2003.
1333: 0000: \***    Changed NLINE reporting number from 660 to 670.
1334: 0000: \***    No code changes to this file.
1335: 0000: \***
1336: 0000: \*****************************************************************************
1337: 0000: \*****************************************************************************
1338: 0000: 
1339: 0000: STRING GLOBAL   \
1340: 0000:    NEWLINES.FILE.NAME$,  \
1341: 0000:    NEWLINES.BOOTS.CODE$,     \  4 byte UPD;  Record key
1342: 0000:    NEWLINES.DATE.ADDED$,     \  4 byte UPD;  CCYYMMDD
1343: 0000:    NEWLINES.FILLER$          !  6 bytes
1344: 0000: 
1345: 0000: INTEGER*2 GLOBAL  \
1346: 0000:    NEWLINES.RECL%,   \
1347: 0000:    NEWLINES.REPORT.NUM%,  \
1348: 0000:    NEWLINES.COUNT%,       \
1349: 0000:    NEWLINES.SESS.NUM%   !
1350: 0000: 
1351: 0000: 
1352: 0000: 
1353: 0000: %INCLUDE PPFKDEC.J86    ! PPFK File
1354: 0000: \******************************************************************************
1355: 0000: \******************************************************************************
1356: 0000: \***
1357: 0000: \***    Pending Prices Keyed File (PPFK) variable definitions
1358: 0000: \***
1359: 0000: \******************************************************************************
1360: 0000: \***
1361: 0000: \***    Version 1.0             Mark Walker                 13th October 2011
1362: 0000: \***    Initial version.
1363: 0000: \***
1364: 0000: \***    VERSION 1.1.                ROBERT COWEY.                02 FEB 2012.
1365: 0000: \***    Changes creating PSB21.286 Core Release 2 version 1.5.
1366: 0000: \***    Defect 2678
1367: 0000: \***    Defined variable PPFK.PCR.COUNT.READ% to save total number of price 
1368: 0000: \***    changes for an item as found by READ.PPFK
1369: 0000: \***
1370: 0000: \***    VERSION 1.2.                ROBERT COWEY.                01 MAR 2012.
1371: 0000: \***    Changes creating PSB21.286 Core Release 2 version 1.7.
1372: 0000: \***    Defect 53.
1373: 0000: \***    Modified function DELETE.PPFK.
1374: 0000: \***    No code changes to this file.
1375: 0000: \***
1376: 0000: \******************************************************************************
1377: 0000: \******************************************************************************
1378: 0000: 
1379: 0000:     STRING GLOBAL                           \
1380: 0000:         PPFK.FILE.NAME$,                    \
1381: 0000:         PPFK.BOOTS.CODE$,                   \
1382: 0000:         PPFK.DATE.DUE$(1),                  \
1383: 0000:         PPFK.RPD.NO$(1),                    \
1384: 0000:         PPFK.STATUS.FLAG$(1),               \
1385: 0000:         PPFK.INC.DEC.FLAG$(1),              \        
1386: 0000:         PPFK.PRICE$(1),                     \
1387: 0000:         PPFK.MARKDOWN$(1),                  \
1388: 0000:         PPFK.READ.FORM$,                    \
1389: 0000:         PPFK.WRITE.FORM$,                   \
1390: 0000:         PPFK.PACK01$,                       \
1391: 0000:         PPFK.PACK03$,                       \
1392: 0000:         PPFK.PACK04$
1393: 0000:         
1394: 0000:     INTEGER*2 GLOBAL                        \
1395: 0000:         PPFK.SESS.NUM%,                     \
1396: 0000:         PPFK.REPORT.NUM%,                   \
1397: 0000:         PPFK.PCR.MAX%,                      \
1398: 0000:         PPFK.PCR.PER.RECORD%,               \
1399: 0000:         PPFK.PCR.RECL%,                     \
1400: 0000:         PPFK.PCR.COUNT%,                    \
1401: 0000:         PPFK.PCR.COUNT.READ%,               \ ! 1.1 RC
1402: 0000:         PPFK.RECL%,                         \
1403: 0000:         PPFK.KEYL%
1404: 0000:         
1405: 0000:     INTEGER*4 GLOBAL                        \
1406: 0000:         PPFK.MAXR%
1407: 0000: 
1408: 0000: %INCLUDE RICFDEC.J86    ! Redeem Items Change File
1409: 0000: \******************************************************************************
1410: 0000: \******************************************************************************
1411: 0000: \***
1412: 0000: \***                     REDEEM ITEMS CHANGE FILE    
1413: 0000: \***                                                                
1414: 0000: \***                      REFERENCE : RICFDEC.J86 
1415: 0000: \***                                                                
1416: 0000: \***                      FILE TYPE : Sequential                       
1417: 0000: \***                                                                
1418: 0000: \***                                                                
1419: 0000: \***   Version A.              Jamie Thorpe                  1st July 1997
1420: 0000: \***   Original version.                                                    
1421: 0000: \***                                                                         
1422: 0000: \***                                                                       
1423: 0000: \******************************************************************************
1424: 0000: \******************************************************************************
1425: 0000: 
1426: 0000:  
1427: 0000: STRING GLOBAL        RICF.FILE.NAME$,       \ 
1428: 0000:                      RICF.RECORD$,          \          
1429: 0000:                      RICF.ITEM.CODE$,       \
1430: 0000:                      RICF.DELIVERY.FLAG$,   \
1431: 0000:                      RICF.REDEEM.ITEM$,     \
1432: 0000:                   RICF.ITEM.DESCRIPTION$,   \
1433: 0000:                      RICF.PRICE$,           \
1434: 0000:                      RICF.FILLER$,          \ 
1435: 0000:                      RICF.REC.COUNT$,       \
1436: 0000:                      RICF.ITEM.QTY$,        \ BRD
1437: 0000:                      RICF.UNIT.MEASUREMENT$,\ BRD
1438: 0000:                      RICF.UNIT.NAME$,       \ BRD
1439: 0000:                      RICF.PRODUCT.GROUP$
1440: 0000:                    
1441: 0000:                     
1442: 0000:     
1443: 0000: 
1444: 0000:   INTEGER*2 GLOBAL   RICF.ALT.SESS.NUM%,  \
1445: 0000:                      RICF.REPORT.NUM%,    \ 
1446: 0000:                      RICF.ALT.REPORT.NUM%,\ 
1447: 0000:                      RICF.SESS.NUM%,      \
1448: 0000:                      RICF.RECL%,         \
1449: 0000:                      RICF.RECORD.NO%
1450: 0000:                      
1451: 0000: %INCLUDE SOFTSDEC.J86   ! Software Status File
1452: 0000: REM \
1453: 0000: \******************************************************************************
1454: 0000: \******************************************************************************
1455: 0000: \***
1456: 0000: \***                 %INCLUDE FOR THE SOFTWARE STATUS FILE
1457: 0000: \***   
1458: 0000: \***                      FILE TYPE  :   Direct
1459: 0000: \***
1460: 0000: \***                      REFERENCE  :   SOFTSDEC.J86
1461: 0000: \***
1462: 0000: \***	Version A	       Andrew Wedgeworth	      24th June 1992
1463: 0000: \***
1464: 0000: \******************************************************************************
1465: 0000: \*******************************************************************************
1466: 0000: 
1467: 0000:   STRING GLOBAL           \
1468: 0000:     SOFTS.RECORD$,        \           
1469: 0000:     SOFTS.SPACE$,         \           
1470: 0000:     SOFTS.FILE.NAME$    
1471: 0000:     
1472: 0000:   INTEGER*2 GLOBAL        \
1473: 0000:     SOFTS.RECL%,          \            
1474: 0000:     SOFTS.REPORT.NUM%,	  \      
1475: 0000:     SOFTS.SESS.NUM%
1476: 0000: 
1477: 0000:   INTEGER*4 GLOBAL        \
1478: 0000:     SOFTS.REC.NUM% 	         
1479: 0000: %INCLUDE STKMQDEC.J86   ! Stock Movement Queue File
1480: 0000: REM \
1481: 0000: \******************************************************************************
1482: 0000: \******************************************************************************
1483: 0000: \***
1484: 0000: \***      %INCLUDE FOR STOCK MOVEMENT QUEUE FILE FIELD DECLARATIONS
1485: 0000: \***                                             FILE REFERENCE PARAMETERS
1486: 0000: \***
1487: 0000: \***               FILE TYPE    : Sequential
1488: 0000: \***
1489: 0000: \***               REFERENCE    : STKMQDEC.J86
1490: 0000: \***
1491: 0000: \***      Version A.     L. Cook
1492: 0000: \***
1493: 0000: \***      Combined from STKMQNUE.J86 and STKMQFLE.J86
1494: 0000: \***
1495: 0000: \***      Version B.     S.P. Kelsey (CTG)            7th November
1496: 0000: \***      Include CSR Marker in the Type 1 and Type 18 transactions.
1497: 0000: \***
1498: 0000: \***      Version C.     S. Goulding                 8th March
1499: 0000: \***      Add fields for new tranctions types 21 & 23
1500: 0000: \***
1501: 0000: \***      Version D.     ???????????            ????????????
1502: 0000: \***      ????????????????????????????????????????????????????????
1503: 0000: \***
1504: 0000: \***      Version E.     Michael J. Kelsall           16th Dec 1993.
1505: 0000: \***      Addition of txn types, 24, 25, 26, 27 and 28. As part of the
1506: 0000: \***      RETURNS/AUTOMATIC CREDIT CLAIMING system.
1507: 0000: \***
1508: 0000: \***      Version 1.1    Michael J. Kelsall           10th Aug 1994.
1509: 0000: \***      Changes as part of R/ACC update to allow for zero price claim
1510: 0000: \***      processing. Addition of type 29 txn for this change.
1511: 0000: \***
1512: 0000: \***      Version 1.2    Nik Sen                       8th November 1994
1513: 0000: \***      Addition of transaction type 30 as oart of Epsom Life CSR Phase 2
1514: 0000: \***
1515: 0000: \***      Version 1.3    Neil Bennett                   2nd January 2007
1516: 0000: \***      Add ASN processing support. (Rec Type 17)
1517: 0000: \***
1518: 0000: \***      Version 1.4    Brian Greenfield               14th may 2007
1519: 0000: \***      Added STKMQ.RECALL.TYPE$ for use in A7C RECALLS - only type 26 records.
1520: 0000: \***
1521: 0000: \***      Version 1.5    Neil Bennett                  31st January 2008
1522: 0000: \***      Add STKMQ.FLAG$ for record type 11
1523: 0000: \***
1524: 0000: \***      Version 1.6    Dave Constable                5th September 2008
1525: 0000: \***      Add STKMQ.FLAG$ for record type 33
1526: 0000: \***
1527: 0000: \***      Version 1.7    Dave Constable                30th December 2008
1528: 0000: \***      Add STKMQ.RESCAN$ for record type 33
1529: 0000: \***
1530: 0000: \***      Version 1.8    Dave Constable                6th January 2009
1531: 0000: \***      Add Bookin date & time for record type 33
1532: 0000: \***
1533: 0000: \***      Version F      Mark Walker                      27th Mar 2014
1534: 0000: \***      F337 Centralised View of Stock
1535: 0000: \***      - Relocated STKMQ item processing variables to here.
1536: 0000: \***
1537: 0000: \******************************************************************************
1538: 0000: \*******************************************************************************
1539: 0000: \***
1540: 0000: \***  The length of the records on this file vary depending on the record
1541: 0000: \***  transaction type, but they all comprise combinations of the fields
1542: 0000: \***  defined below.
1543: 0000: \***
1544: 0000: \***  Transaction type 0 (Header record) - RECORD DELIMITER, TRANS TYPE,
1545: 0000: \***     FIELD DELIMITER, CREATION DATE, CREATION TIME, RECORD DELIMITER,
1546: 0000: \***     END OF RECORD MARKER.
1547: 0000: \***
1548: 0000: \***  Transaction type 1 - RECORD DELIMITER, TRANS TYPE, FIELD DELIMITER, DATE,
1549: 0000: \***     TIME, FSI, FOLIO YEAR, FOLIO MONTH, FOLIO NUMBER, STORE SUFFIX,
1550: 0000: \***     COUNT OF ITEMS, INVOICE DAY,(FIELD DELIMITER, BOOTS CODE,
1551: 0000: \***     FIELD DELIMITER, QUANTITY, FIELD DELIMITER, CSR MARKER),
1552: 0000: \***     RECORD DELIMITER, END OF RECORD MARKER.
1553: 0000: \***     The fields within brackets are repeated as many times as count of items.
1554: 0000: \***
1555: 0000: \***  Transaction type 2 - RECORD DELIMITER, TRANS TYPE, FIELD DELIMITER, DATE,
1556: 0000: \***     TIME, BOOTS CODE, FIELD DELIMITER, QUANTITY, RECORD DELIMITER,
1557: 0000: \***     END OF RECORD MARKER.
1558: 0000: \***
1559: 0000: \***  Transaction type 3 - RECORD DELIMITER, TRANS TYPE, FIELD DELIMITER, DATE,
1560: 0000: \***     TIME, BOOTS CODE, FIELD DELIMITER, QUANTITY, FIELD DELIMITER,
1561: 0000: \***     REASON CODE, STORE/RETURN CODE, RECORD DELIMITER, END OF RECORD MARKER
1562: 0000: \***
1563: 0000: \***  Transaction type 4 - RECORD DELIMITER, TRANS TYPE, FIELD DELIMITER, DATE,
1564: 0000: \***     TIME, BOOTS CODE, ON IDF FLAG, FIELD DELIMITER, QUANTITY,
1565: 0000: \***     RECORD DELIMITER, END OF RECORD MARKER
1566: 0000: \***
1567: 0000: \***  Transaction type 5 - RECORD DELIMITER, TRANS TYPE, FIELD DELIMITER, DATE,
1568: 0000: \***     TIME, BOOTS CODE, COUNT FLAG, STOCK MOVEMENT DATE, FIELD DELIMITER,
1569: 0000: \***     QUANTITY, RECORD DELIMITER, END OF RECORD MARKER
1570: 0000: \***
1571: 0000: \***  Transaction type 6 - RECORD DELIMITER, TRANS TYPE, FIELD DELIMITER, DATE,
1572: 0000: \***     TIME, BOOTS CODE, REASON (1 byte ASCII)
1573: 0000: \***     RECORD DELIMITER, END OF RECORD MARKER
1574: 0000: \***
1575: 0000: \***  Transaction type 7 - RECORD DELIMITER, TRANS TYPE, FIELD DELIMITER, DATE,
1576: 0000: \***     TIME, BOOTS CODE, CONCEPT SEQUENCE
1577: 0000: \***     RECORD DELIMITER, END OF RECORD MARKER
1578: 0000: \***
1579: 0000: \***  Transaction type 8 - RECORD DELIMITER, TRANS TYPE, FIELD DELIMITER, DATE,
1580: 0000: \***     TIME, PRODUCT GROUP, RECORD DELIMITER, END OF RECORD
1581: 0000: \***     MARKER
1582: 0000: \***
1583: 0000: \***  Transaction type 9 - RECORD DELIMITER, TRANS TYPE, FIELD DELIMITER, DATE,
1584: 0000: \***     TIME, LIST NUMBER, ITEM NUMBER, LIST TYPE,
1585: 0000: \***     COUNT.BY.DATE, RECORD DELIMITER, END OF RECORD MARKER
1586: 0000: \***
1587: 0000: \***  Transaction type 10- RECORD DELIMITER, TRANS TYPE, FIELD DELIMITER, DATE,
1588: 0000: \***     TIME, BOOTS CODE,
1589: 0000: \***     RECORD DELIMITER, END OF RECORD MARKER
1590: 0000: \***
1591: 0000: \***  Transaction type 11- RECORD DELIMITER, TRANS TYPE, FIELD DELIMITER, DATE,
1592: 0000: \***     TIME, BOOTS CODE, FIELD DELIMITER, COUNT QUANTITY, FIELD DELIMITER(opt),
1593: 0000: \***     SOURCE(opt), FLAG(opt), RECORD DELIMITER, END OF RECORD MARKER
1594: 0000: \***
1595: 0000: \***  Transaction type 12- RECORD DELIMITER, TRANS TYPE, FIELD DELIMITER, DATE,
1596: 0000: \***     TIME, BOOTS CODE,
1597: 0000: \***     RECORD DELIMITER, END OF RECORD MARKER
1598: 0000: \***
1599: 0000: \***  Transaction type 13- RECORD DELIMITER, TRANS TYPE, FIELD DELIMITER, DATE,
1600: 0000: \***     TIME, LIST NUMBER, ITEM NUMBER, ITEM STATUS,ITEM CODE,
1601: 0000: \***     COUNT DATE, COUNT TIME, PRICE, FIELD DELIMITER, SHOP FLOOR COUNT,
1602: 0000: \***     FIELD DELIMITER, BACKROOM COUNT, RECORD DELIMITER, END OF REC MARKER
1603: 0000: \***
1604: 0000: \***  Transaction type 14- RECORD DELIMITER, TRANS TYPE, FIELD DELIMITER, DATE,
1605: 0000: \***     TIME, LIST NUMBER, LIST STATUS, RECORD DELIMITER,
1606: 0000: \***     END OF RECORD MARKER
1607: 0000: \***
1608: 0000: \***  Transaction type 16- RECORD DELIMIER, TRANS TYPE, FIELD DELIMITER, DATE,
1609: 0000: \***     TIME, BC LETTER, FIELD DELIMITER, ORIGINAL RECOUNT
1610: 0000: \***     PERCENTAGE, FIELD DELIMITER, CHANGED RECOUNT PERCENTAGE,
1611: 0000: \***     RECORD DELIMITER, END OF RECORD DELIMITER
1612: 0000: \***
1613: 0000: \***  Transaction type 17- RECORD DELIMITER, TRANS TYPE, FIELD DELIMITER, DATE,
1614: 0000: \***     TIME, SOURCE, SUPPLIER NUMBER, ORDER NUMBER, ORDER SUFFIX, PAGE
1615: 0000: \***     NUMBER, ITEM COUNT,
1616: 0000: \***     CARTON NUMBER, CARTON FLAG,                                        ! 1.3NWB
1617: 0000: \***     FIELD DELIMITER, ITEM CODE, BAR CODE,
1618: 0000: \***     QUANTITY - GOOD, FIELD DELIMITER, QUANTITY - DAMAGED, FIELD DELIMITER,
1619: 0000: \***     QUANTITY - STOLEN (the last 8 fields repeat ITEM COUNT times),
1620: 0000: \***     RECORD DELIMITER, END OF RECORD DELIMITER
1621: 0000: \***
1622: 0000: \***  Transaction type 18- RECORD DELIMITER, TRANS TYPE, FIELD DELIMITER, DATE,
1623: 0000: \***     TIME, FOLIO IDENTIFIER, FOLIO YEAR, FOLIO MONTH, FOLIO NUMBER,
1624: 0000: \***     STORE SUFFIX, ITEM COUNT, INVOICE DAY, EXPECTED DATE OF DELIVERY,
1625: 0000: \***     DALLAS MARKER, FIELD DELIMITER, ITEM CODE, FIELD DELIMITER,
1626: 0000: \***     ORDER QUANTITY, FIELD DELIMITER, CSR MARKER,
1627: 0000: \***     (the last six fields repeat ITEM COUNT times),
1628: 0000: \***     RECORD DELIMITER, END OF RECORD DELIMITER
1629: 0000: \***
1630: 0000: \***  Transaction type 19- RECORD DELIMITER, TRANS TYPE, FIELD DELIMITER, DATE,
1631: 0000: \***     TIME, SUPPLIER NUMBER, ORDER NUMBER, ORDER SUFFIX, CONFIRM/AMEND FLAG,
1632: 0000: \***     START TIME, END TIME, NO SINGLES ADDED, NO ITEMS ADDED, NO ITEMS
1633: 0000: \***     BOOKED IN, RECORD DELIMITER, END OF RECORD DELIMITER
1634: 0000: \***
1635: 0000: \***  Transaction type 21 - RECORD DELIMITER, TRANS TYPE, FIELD DELIMITER, DATE,
1636: 0000: \***     TIME, DISTRIBUTION CENTRE, WAREHOUSE NUMBER, STORE NUMBER, UOD NUMBER,
1637: 0000: \***     STATUS, RECORD DELIMITER, END OF RECORD MARKER
1638: 0000: \***
1639: 0000: \***  Transaction type 23 - RECORD DELIMITER, TRANS TYPE, FIELD DELIMITER, DATE,
1640: 0000: \***     TIME, DISTRIBUTION CENTRE, WAREHOUSE NUMBER, STORE NUMBER, UOD NUMBER,
1641: 0000: \***     STATUS, BOOTS/BAR CODE, BOOTS/BAR CODE FLAG, QUANTITY, FIELD DELIMITER
1642: 0000: \***     FSI,FOLIO YEAR, FOLIO MONTH, STORE SUFFIX, FOLIO NO, CSR MARKER
1643: 0000: \***     RECORD DELIMITER, END OF RECORD MARKER
1644: 0000: \***
1645: 0000: \***
1646: 0000: \***  RETURNS/AUTOMATIC CREDIT CLAIMING RECORD TYPES;
1647: 0000: \***
1648: 0000: \***  Transaction type 24 - Whole or Part consignment record
1649: 0000: \***     RECORD DELIMITER, TRANS TYPE, FIELD DELIMITER, DATE, TIME,
1650: 0000: \***     CREDIT CLAIM NUM, BC LETTER, CLAIM TYPE, SUPPLIER NUM, INVOICE NUM,
1651: 0000: \***     FOLIO NUM, BATCH REF NUM, WHOLE/PART CONSIGNMENT, REPAIR CATEGORY,
1652: 0000: \***     REPAIR NUM, PLAN4 POLICY NUM, DDDA/DCDR NUM, DELIV NOTE NUM,
1653: 0000: \***     DELIV DATE, NUM OF CARTONS, ORDER NUM, COMMENT, NUM OF ITEMS,
1654: 0000: \***     ITEM/BAR CODE FLAG, BOOTS/BAR CODE, QTY, PRICE, RECORD DELIMITER,
1655: 0000: \***     END OF RECORD MARKER
1656: 0000: \***     (ITEM/BAR CODE FLAG to PRICE repeated NUM OF ITEMS times)
1657: 0000: \***
1658: 0000: \***  Transaction type 25 - Non-sales func 16 and Misc. txns from controller
1659: 0000: \***     RECORD DELIMITER, TRANS TYPE, FIELD DELIMITER, DATE, TIME,
1660: 0000: \***     CREDIT CLAIM NUM, NUM OF ITEMS, AUTH CODE/CONTACT,
1661: 0000: \***     ADJUST STOCK FIGURE FLAG, REASON, ITEM/BAR CODE FLAG, BOOTS/BAR CODE,
1662: 0000: \***     QTY, PRICE, RECORD DELIMITER, END OF RECORD MARKER
1663: 0000: \***     (ITEM/BAR CODE FLAG to PRICE repeated NUM OF ITEMS times)
1664: 0000: \***
1665: 0000: \***  Transaction type 26 - Data from LDT
1666: 0000: \***     RECORD DELIMITER, TRANS TYPE, FIELD DELIMITER, DATE, TIME, UOD NUM,
1667: 0000: \***     UOD STATUS, CREDIT CLAIM NUM, NUM OF ITEMS UPDATED, TOTAL QTY IN UOD,
1668: 0000: \***     ADJUST STOCK FIGURE FLAG, SUPPLY ROUTE, DISP LOCATION, BC LETTER,
1669: 0000: \***     RECALL NUM, AUTHORISATION, SUPPLIER, RETURN METHOD, CARRIER, BIRD NUM,
1670: 0000: \***     REASON, WAREHOUSE ROUTE, UOD TYPE, REASON FOR DAMAGE, RECEIVING STORE,
1671: 0000: \***     DESTINATION, DATE UOD OPENED, DATE UOD DESPATCHED, TIME UOD
1672: 0000: \***     DESPATCHED, RECALL TYPE$, ITEM.BAR CODE FLAG, BOOTS/BAR CODE, QTY,       ! 1.4BG
1673: 0000: \***     ITEM UPDATED FLAG, RECORD DELIMITER, END OF RECORD MARKER
1674: 0000: \***     (ITEM/BAR CODE FLAG to ITEM UPDATED FLAG repeated NUM OF ITEMS times)
1675: 0000: \***
1676: 0000: \***  Transaction type 27 - End of LDT session
1677: 0000: \***     RECORD DELIMITER, TRANS TYPE, FIELD DELIMITER, DATE, TIME,
1678: 0000: \***     DATE SESSION ENDED, TIME SESSION ENDED, RECORD DELIMITER,
1679: 0000: \***     END OF RECORD MARKER
1680: 0000: \***
1681: 0000: \***  Transaction type 28 - Cancelled Credit Claim
1682: 0000: \***     RECORD DELIMITER, TRANS TYPE, FIELD DELIMITER, DATE, TIME,
1683: 0000: \***     CLAIM NUMBER, UOD NUM, NEW STATUS FLAG, RECORD DELIMITER,
1684: 0000: \***     END OF RECORD MARKER
1685: 0000: \***
1686: 0000: \***  Transaction type 29 - Zero price update
1687: 0000: \***     RECORD DELIMITER, TRANS TYPE, FIELD DELIMITER, DATE, TIME,
1688: 0000: \***     CLAIM NUMBER, ITEM NUMBER, CLAIM VALUE, RECORD DELIMITER,
1689: 0000: \***     END OF RECORD MARKER
1690: 0000: \***
1691: 0000: \***  Transaction type 30 - CSR Issues
1692: 0000: \***     RECORD DELIMITER, TRANS TYPE, FIELD DELIMITER, DATE, TIME,
1693: 0000: \***     BOOTS CODE, FIELD DELIMITER, QUANTITY, FIELD DELIMITER
1694: 0000: \***     EXPECTED DELIVERY DATE, RECORD DELIMITER, END OF RECORD MARKER
1695: 0000: \***
1696: 0000: \***  Transaction type 31 - Quasi Count
1697: 0000: \***     RECORD DELIMITER, TRANS TYPE, FIELD DELIMITER, DATE,
1698: 0000: \***     TIME, LIST NUMBER, ITEM NUMBER, ITEM STATUS,ITEM CODE,
1699: 0000: \***     COUNT DATE, COUNT TIME, PRICE, FIELD DELIMITER, SHOP FLOOR COUNT,
1700: 0000: \***     FIELD DELIMITER, BACKROOM COUNT (PREV STOCK FIG), RECORD DELIMITER,
1701: 0000: \***      END OF REC MARKER
1702: 0000: \***
1703: 0000: \***  Transaction type 32 - Quasi Adjustment count
1704: 0000: \**      RECORD DELIMITER, TRANS TYPE, FIELD DELIMITER, DATE,
1705: 0000: \***     TIME, LIST NUMBER, ITEM NUMBER, ITEM STATUS,ITEM CODE,
1706: 0000: \***     COUNT DATE, COUNT TIME, PRICE, FIELD DELIMITER, SHOP FLOOR COUNT,
1707: 0000: \***     FIELD DELIMITER, BACKROOM COUNT (PREV STOCK FIG), RECORD DELIMITER,
1708: 0000: \***     END OF REC MARKER
1709: 0000: \***
1710: 0000: \***  Transaction type 33 - +UOD Receiving
1711: 0000: \**      RECORD DELIMITER, TRANS TYPE, FIELD DELIMITER, DATE,
1712: 0000: \***     TIME, UOD LICENCE PLATE, DESPATCH DATE, ACTION, ITEM COUNT,
1713: 0000: \***     for audit type+(ITEM CODE, BARCODE, DESPATCHED QTY, VARIANCE )
1714: 0000: \***     END OF REC MARKER
1715: 0000: \***
1716: 0000: \******************************************************************************
1717: 0000: 
1718: 0000:   STRING GLOBAL              \
1719: 0000:     STKMQ.FILE.NAME$,        \
1720: 0000:     STKMQ.RECORD$,           \ Used to store the whole record which is unstrung
1721: 0000:                              \ into the fields below
1722: 0000:     STKMQ.RECORD.DELIMITER$, \ 1 byte ASCII set to " (CHR$(34))
1723: 0000:     STKMQ.TRANS.TYPE$,       \ 1 byte UPD. 00 = Header record
1724: 0000:                              \             01 = W'house invoice delivery record
1725: 0000:                              \             02 = Delivery without invoice record
1726: 0000:                              \             03 = Stock out record
1727: 0000:                              \             04 = Stock count record
1728: 0000:                              \             17 = Delivery without confirmation
1729: 0000:                              \                  of Direct Order detail
1730: 0000:                              \             18 = Confirmed Dallas invoice record
1731: 0000:                              \             19 = Delivery without confirmation
1732: 0000:                              \                  of Direct Order header
1733: 0000:                              \             21 = UOD record
1734: 0000:                              \             23 = Item Level UOD record
1735: 0000:                              \             24 = Whole/Part consignment (R/ACC)
1736: 0000:                              \             25 = NS16 / Misc cont txn (R/ACC)
1737: 0000:                              \             26 = Data from LDT (R/ACC)
1738: 0000:                              \             27 = End of LDT session (R/ACC)
1739: 0000:                              \             28 = Canc. Credit Claim (R/ACC)
1740: 0000:                              \             29 = Zero price update (R/ACC)
1741: 0000:     STKMQ.FIELD.DELIMITER$,  \ 1 byte ASCII set to ; (CHR$(59))
1742: 0000:     STKMQ.CREATION.DATE$,    \ 3 byte UPD set to current date
1743: 0000:     STKMQ.CREATION.TIME$,    \ 3 byte UPD set to current time
1744: 0000:     STKMQ.CSR.MARKER$,       \ 1 byte ASCII. "Y" - This is a CSR Item      BSPK
1745: 0000:                              \               " " - This is not a CSR Item  BSPK
1746: 0000:     STKMQ.DATE$,             \ 3 byte UPD set to current date
1747: 0000:     STKMQ.TIME$,             \ 3 byte UPD set to current time
1748: 0000:     STKMQ.FSI$,              \ 1 byte ASCII
1749: 0000:     STKMQ.FOLIO.YEAR$,       \ 1 byte UPD
1750: 0000:     STKMQ.FOLIO.MONTH$,      \ 1 byte UPD
1751: 0000:     STKMQ.FOLIO.NUMBER$,     \ 2 bytes UPD
1752: 0000:     STKMQ.STORE.SUFFIX$,     \ 1 byte ASCII
1753: 0000:     STKMQ.ITEM.COUNT$,       \ 1 byte UPD between 1 and 17
1754: 0000:     STKMQ.BOOTS.CODE$,       \ 4 bytes UPD
1755: 0000:     STKMQ.ON.IDF.FLAG$,      \ 1 byte ASCII. Y = On IDF   N = Not on IDF
1756: 0000:     STKMQ.QUANTITY$,         \ variable length string equivalent to
1757: 0000:                              \ STR$(STKMQ.QUANTITY%)
1758: 0000:                              \ +ve indicates add to stock
1759: 0000:                              \ -ve indicates subtract from stock
1760: 0000:     STKMQ.REASON.CODE$,      \ 2 bytes UPD
1761: 0000:     STKMQ.STORE.RET.CODE$,   \ 2 bytes UPD
1762: 0000:     STKMQ.ENDREC.MARKER$,    \ 2 bytes ASCII set to XODOA
1763: 0000:     STKMQ.REASON$,           \ 1 byte ASCII. "I" = ineligible,
1764: 0000:                              \               "U" = unsuppliable,
1765: 0000:                              \               "Z" = deleted,
1766: 0000:                              \               " " = not removed.
1767: 0000:     STKMQ.CONCEPT.SEQUENCE$, \ 3 byte UPD. Concept group / sequence
1768: 0000:     STKMQ.INVOICE.DAY$,      \ 1 byte UPD
1769: 0000:     STKMQ.LIST.NUMBER$,      \ 4 byte ASCII
1770: 0000:     STKMQ.ITEM.NUMBER$,      \ 2 byte ASCII
1771: 0000:     STKMQ.ITEM.STATUS$,      \ 1 byte ASCII
1772: 0000:     STKMQ.COUNT.DATE$,       \ 3 byte UPD - YYMMDD
1773: 0000:     STKMQ.COUNT.TIME$,       \ 2 byte UPD - HHMM
1774: 0000:     STKMQ.PRICE$,            \ 5 byte UPD
1775: 0000:     STKMQ.SHOP.COUNT$,       \ variable ASCII
1776: 0000:     STKMQ.BKRM.COUNT$,       \ variable ASCII
1777: 0000:     STKMQ.LIST.STATUS$,      \ 1 byte ASCII
1778: 0000:     STKMQ.LEFT.TO.COUNT$,    \ variable ASCII
1779: 0000:     STKMQ.COUNT.BY.DATE$,    \ 3 bytes UPD
1780: 0000:     STKMQ.PRODUCT.GROUP$,    \ 3 bytes UPD
1781: 0000:     STKMQ.BC.LETTER$,        \ 1 byte ASCII
1782: 0000:     STKMQ.ORG.RECOUNT$,      \ VARIABLE ASCII
1783: 0000:     STKMQ.NEW.RECOUNT$,      \ VARIABLE ASCII
1784: 0000:     STKMQ.LIST.TYPE$,        \ 1 byte ASCII
1785: 0000:     STKMQ.COUNT.FLAG$,       \ 1 byte ASC from corrections file
1786: 0000:     STKMQ.STMVT.DATE$,       \ 3 bytes UPD
1787: 0000:     STKMQ.SUPPLIER.NO$,      \ 4 bytes UPD
1788: 0000:     STKMQ.ORDER.NO$,         \ 2 bytes UPD
1789: 0000:     STKMQ.ORDER.SFX$,        \ 1 byte ASCII
1790: 0000:     STKMQ.PAGE.NO$,          \ 1 byte UPD
1791: 0000:     STKMQ.ORDER.DATE$,       \ 3 bytes UPD
1792: 0000:     STKMQ.EXP.DELV.DATE$,    \ 3 bytes UPD
1793: 0000:     STKMQ.DALLAS.MKR$,       \ 1 byte ASCII DALLAS system marker
1794: 0000:                              \ 'Y' - invoice is from DALLAS system,
1795: 0000:                              \ 'N' - invoice is not from DALLAS system
1796: 0000:                              \ 'Q' - invoice contains quantity alterations
1797: 0000:     STKMQ.SOURCE$,           \ 1 byte ASCII Source flag
1798: 0000:                              \ 'S' - PSS65, 'P' - PDT, PSS57
1799: 0000:                              \ Transaction type 11 'S' - Stocktake else ' '
1800: 0000:     STKMQ.FLAG$,             \ Transaction type 11 'F' - First 'L' - Last or ' '
1801: 0000:     STKMQ.BAR.CODE$,         \ 6 bytes UPD
1802: 0000:     STKMQ.CODE.FLAG$,        \ 1 BYTE ASCII
1803: 0000:     STKMQ.QTY.GOOD$,         \ VARIABLE ASCII
1804: 0000:                              \ Quantity of singles booked in in good condition
1805: 0000:     STKMQ.QTY.BAD$,          \ VARIABLE ASCII
1806: 0000:                              \ Quantity of singles booked in in bad condition
1807: 0000:     STKMQ.QTY.STOLEN$,       \ VARIABLE ASCII
1808: 0000:                              \ Quantity of singles recognised as stolen
1809: 0000:     STKMQ.CONF.AMND.FLAG$,   \ 1 byte ASCII - Confirm/ Amend Flag
1810: 0000:                              \ 'C' - Order has been confirmed
1811: 0000:                              \ 'A' - Order has been amended
1812: 0000:                              \ ' ' - Nothing has been done to the order
1813: 0000:     STKMQ.START.TIME$,       \ 2 byte UPD (HHMM) time order started to be
1814: 0000:                              \ processed
1815: 0000:     STKMQ.END.TIME$,         \ 2 byte UPD (HHMM) time order was completed
1816: 0000:     STKMQ.SNGLS.ADDED$,      \ 2 byte UPD  Singles added to order
1817: 0000:     STKMQ.ITEMS.ADDED$,      \ 2 byte UPD  Items added to order
1818: 0000:     STKMQ.ITEMS.BOOKED$,     \ 2 byte UPD  Items booked in on the order
1819: 0000:     STKMQ.DIST.CENTRE$,      \ 1 byte UPD
1820: 0000:     STKMQ.WHSE.NUMBER$,      \ 1 byte UPD
1821: 0000:     STKMQ.STORE.NUMBER$,     \ 2 byte UPD
1822: 0000:     STKMQ.UOD.NUMBER$,       \ 3 byte UPD
1823: 0000:     STKMQ.STATUS$,           \ 1 byte ASCII
1824: 0000:                              \
1825: 0000:     STKMQ.CREDIT.CLAIM.NUM$, \ 4 byte UPD
1826: 0000:     STKMQ.CLAIM.TYPE$,       \ 1 byte ASC;  "M" = Missing,
1827: 0000:                              \              "E" = Excess,
1828: 0000:                              \              "R" = Repairs
1829: 0000:     STKMQ.SUPPLIER.NUM$,     \ 3 byte UPD
1830: 0000:     STKMQ.INVOICE.NUM$,      \*9 byte ASC
1831: 0000:     STKMQ.FOLIO.NUM$,        \ 3 byte UPD
1832: 0000:     STKMQ.BATCH.REF$,        \ 3 byte UPD
1833: 0000:     STKMQ.WHOLE.PART.CON$,   \ 1 byte ASC   "W" = Whole, "P" = Part
1834: 0000:     STKMQ.REPAIR.CATEGORY$,  \ 1 byte UPD;   1 = Plan4,
1835: 0000:                              \               2 = Estimate,
1836: 0000:                              \               3 = Boots guarantee,
1837: 0000:                              \               4 = Supplier guarantee,
1838: 0000:                              \               5 = Other guarantee,
1839: 0000:     STKMQ.REPAIR.NUM$,       \ 6 byte UPD
1840: 0000:     STKMQ.PLAN4.POLICY.NUM$, \ 6 byte UPD; (Only if repair cat is Plan4)
1841: 0000:     STKMQ.DDDA.DCDR.NUM$,    \ 4 byte UPD
1842: 0000:     STKMQ.DELIV.NOTE.NUM$,   \*9 byte ASC
1843: 0000:     STKMQ.NUM.CARTONS.RECEIV$,\1 byte UPD
1844: 0000:     STKMQ.ORDER.NUM$,        \*7 byte ASC
1845: 0000:     STKMQ.COMMENT$,          \*20 byte ASC
1846: 0000:     STKMQ.ITEM.BARCODE.FLAG$,\ 1 byte ASC;  "I" = Boots item code,
1847: 0000:                              \               "B" = Barcode.
1848: 0000:     STKMQ.ITEM.BARCODE$,     \ 7 byte UPD
1849: 0000:     STKMQ.ITEM.PRICE$,       \ 3 byte UPD;  Spaces.
1850: 0000:     STKMQ.AUTHORISATION$,    \ 15 byte ASC
1851: 0000:     STKMQ.ADJ.STOCK.FIGURE$, \ 1 byte ASC;  "Y" or "N"
1852: 0000:     STKMQ.RETURN.REASON$,    \ 1 byte UPD;  (See CCRSN file)
1853: 0000:     STKMQ.UOD.NUM$,          \ 7 byte UPD
1854: 0000:     STKMQ.UOD.STATUS$,       \ 1 byte ASC;  "O" = Open,
1855: 0000:                              \              "C" = Closed,
1856: 0000:                              \              "D" = Despatched
1857: 0000:     STKMQ.SUPPLY.ROUTE$,     \ 1 byte ASC
1858: 0000:     STKMQ.DISP.LOCATION$,    \ 1 byte ASC   "M" = MDS,
1859: 0000:                              \              "D" = Dispensary
1860: 0000:     STKMQ.RECALL.NUM$,       \ 8 byte ASC
1861: 0000:     STKMQ.SUPPLIER$,         \ 15 byte ASC
1862: 0000:     STKMQ.RETURN.METHOD$,    \ 1 byte UPD;   1 = Carrier,
1863: 0000:                              \               2 = BIRD,
1864: 0000:                              \               3 = Via D6,
1865: 0000:                              \               4 = Representative
1866: 0000:     STKMQ.CARRIER$,          \ 1 byte UPD;   1 = GPO,
1867: 0000:                              \               2 = Parcelforce,
1868: 0000:                              \               3 = Securicor,
1869: 0000:                              \               4 = Other
1870: 0000:     STKMQ.BIRD.NUM$,         \ 8 byte ASC
1871: 0000:     STKMQ.WAREHOUSE.ROUTE$,  \ 1 byte ASC   "R" = RDC,
1872: 0000:                              \              "C" = CSR
1873: 0000:     STKMQ.UOD.TYPE$,         \ 1 byte UPD;   1 = Travel Outer,
1874: 0000:                              \               2 = Town Tray,
1875: 0000:                              \               3 = Roll cage,
1876: 0000:                              \               4 = Other
1877: 0000:     STKMQ.DAMAGE.REASON$,    \ 1 byte UPD    1 = Bad packaging,
1878: 0000:                              \               2 = Poor handling
1879: 0000:     STKMQ.RECEIVING.STORE$,  \ 2 byte UPD
1880: 0000:     STKMQ.DESTINATION$,      \ 1 byte UPD    1 = Business Centre,
1881: 0000:                              \               2 = MTS,
1882: 0000:                              \               3 = Other
1883: 0000:     STKMQ.DATE.UOD.OPENED$,  \ 3 byte UPD
1884: 0000:     STKMQ.DATE.DESPATCHED$,  \ 3 byte UPD
1885: 0000:     STKMQ.TIME.DESPATCHED$,  \ 3 byte UPD
1886: 0000:     STKMQ.ITEM.UPDATED$,     \ 1 byte ASC
1887: 0000:     STKMQ.DATE.SESS.END$,    \ 3 byte UPD
1888: 0000:     STKMQ.TIME.SESS.END$,    \ 3 byte UPD
1889: 0000:     STKMQ.NEW.STATUS.FLAG$,  \ 1 byte ASC   "C" = Closed,
1890: 0000:                              \              "D" = Despatched,
1891: 0000:                              \              "X" = Cancelled
1892: 0000:     STKMQ.ITEM.NUM$,         \ 2 byte UPD   (CCITF key value)
1893: 0000:     STKMQ.CLAIM.VALUE$,      \ 3 byte UPD
1894: 0000:     STKMQ.CARTON.FLAG$,      \ 1 byte  ASCII - ' ' Old Process,             ! 1.3NWB
1895: 0000:                              \                 'N' Normal Book In           ! 1.3NWB
1896: 0000:                              \                 'A' Carton Audit Process     ! 1.3NWB
1897: 0000:                              \                 'E' Exception Process (nof)  ! 1.3NWB
1898: 0000:     STKMQ.CARTON.NO$,        \ 4 bytes UPD (0-9999)                         ! 1.3NWB
1899: 0000:     STKMQ.RECALL.TYPE$       ! 1 byte ASC   "B" = Batch Recall              ! 1.4BG
1900: 0000:                              !              "N" = Non-batch Recall          ! 1.4BG
1901: 0000:                              !              " " = Old Credit Claim          ! 1.4BG
1902: 0000: 
1903: 0000: !***********************************************************!* DC 1.6
1904: 0000: !* Added for +UOD Development                               !* DC 1.6
1905: 0000: !***********************************************************!* DC 1.6
1906: 0000:   STRING GLOBAL \                                           !* DC 1.6 
1907: 0000:     STKMQ.LICENCE.PLATE$, \                                 !* DC 1.6 
1908: 0000:     STKMQ.DESPATCH.DATE$, \                                 !* DC 1.6 
1909: 0000:     STKMQ.ACTION$, \                                        !* DC 1.6 
1910: 0000:     STKMQ.DELIVERY.DATE$, \                                 !* DC 1.6 
1911: 0000:     STKMQ.DELIVERY.TIME$, \                                 !* DC 1.6 
1912: 0000:     STKMQ.DRIVER.ID$, \                                     !* DC 1.6 
1913: 0000:     STKMQ.BOOKIN.DATE$, \                                   !* DC 1.8
1914: 0000:     STKMQ.BOOKIN.TIME$, \                                   !* DC 1.8 
1915: 0000:     STKMQ.OP.ID$, \                                         !* DC 1.6 
1916: 0000:     STKMQ.BOOKIN.METHOD$, \                                 !* DC 1.6 
1917: 0000:     STKMQ.BOOKIN.LEVEL$, \                                  !* DC 1.6 
1918: 0000:     STKMQ.GIT$, \                                           !* DC 1.6 
1919: 0000:     STKMQ.RESCAN$, \                                        !* DC 1.7
1920: 0000:     STKMQ.FILLER$                                           !* DC 1.6 
1921: 0000: 
1922: 0000:   INTEGER*2 GLOBAL           \                              !* DC 1.6 
1923: 0000:     STKMQ.SESS.NUM%,         \                              !* DC 1.6 
1924: 0000:     STKMQ.REPORT.NUM%                                       !* DC 1.6 
1925: 0000: !***********************************************************!* DC 1.6
1926: 0000: 
1927: 0000:     STRING GLOBAL                                                       \   !FMW
1928: 0000:         STKMQ.UOD.QTY$,         \                                       \   !FMW
1929: 0000:         STKMQ.CODE$(1),         \ Item Code                             \   !FMW
1930: 0000:         STKMQ.TYPE$(1),         \ Code type I = Item code               \   !FMW
1931: 0000:                                 \           B = Barcode                 \   !FMW
1932: 0000:         STKMQ.CSR.FLAG$(1),     \ CSR Flag                              \   !FMW
1933: 0000:         STKMQ.EAN.CODE$(1),     \ Barcode                               \   !FMW
1934: 0000:         STKMQ.QTY$(1),          \ Quantity                              \   !FMW
1935: 0000:         STKMQ.GOOD.QUAN$(1),    \ Good Quantity                         \   !FMW
1936: 0000:         STKMQ.DAM.QUAN$(1),     \ Damaged Quantity                      \   !FMW
1937: 0000:         STKMQ.STOL.QUAN$(1),    \ Stolen Quantity                       \   !FMW
1938: 0000:         STKMQ.PRICE.ARRAY$(1)   ! Retail Price                              !FMW
1939: 0000:                                                                             !FMW
1940: 0000:     INTEGER*2 GLOBAL                                                    \   !FMW
1941: 0000:         STKMQ.ITEM%             ! Count of items in a transaction           !FMW
1942: 0000: 
1943: 0000: %INCLUDE STOCKDEC.J86   ! Stock File
1944: 0000: \***********************************************************************
1945: 0000: \***********************************************************************
1946: 0000: \***
1947: 0000: \***    DESCRIPTION: Stock File
1948: 0000: \***                 Field Definitions         
1949: 0000: \***
1950: 0000: \***    FILE TYPE : Keyed
1951: 0000: \***
1952: 0000: \***********************************************************************
1953: 0000: \***
1954: 0000: \***    Version B.              Robert Cowey             21st Oct 1993
1955: 0000: \***    No changes to this file.
1956: 0000: \***
1957: 0000: \***    Version C.              Mark Walker              24th Jan 2014
1958: 0000: \***    F337 Centralised View of Stock
1959: 0000: \***    - Added sequence ID and item status fields.
1960: 0000: \***    - Minor formatting changes (uncommented).
1961: 0000: \***
1962: 0000: \***    Version D.              Mark Walker              15th Mar 2014
1963: 0000: \***    F337 Centralised View of Stock
1964: 0000: \***    Added next sequence ID field.
1965: 0000: \***
1966: 0000: \***    Version E.              Mark Walker               7th May 2014
1967: 0000: \***    F337 Centralised View of Stock
1968: 0000: \***    Added new 'stock flags' field for future use.
1969: 0000: \***
1970: 0000: \***********************************************************************
1971: 0000: \***********************************************************************
1972: 0000: 
1973: 0000: \***********************************************************************
1974: 0000: \***********************************************************************
1975: 0000: \***
1976: 0000: \***    File Record Layout
1977: 0000: \***
1978: 0000: \***    STOCK.BOOTS.CODE$            4 UPD  Item Code (Key)
1979: 0000: \***    STOCK.STOCK.FIG%             2 INT  Stock Figure
1980: 0000: \***    STOCK.LAST.COUNT%            2 INT  Last Count Quantity
1981: 0000: \***    STOCK.DATE.LAST.COUNT$       3 UPD  Date of Last Count
1982: 0000: \***    STOCK.DATE.LAST.MOVE$        3 UPD  Date of Last Movement
1983: 0000: \***    STOCK.LAST.REC%              2 INT  Last Receipt Quantity
1984: 0000: \***    STOCK.DATE.LAST.REC$         3 UPD  Date of Last Receipt
1985: 0000: \***    STOCK.DATE.LAST.GAP$         3 UPD  Date of Last Gap
1986: 0000: \***    STOCK.SID%                   4 INT  Sequence ID                     !CMW
1987: 0000: \***    STOCK.STATUS.1$              1 ASC  Item Status                     !CMW
1988: 0000: \***    STOCK.FLAGS%                 1 INT  Stock flags                     !EMW
1989: 0000: \***    STOCK.FILLER$                2 UPD  Filler                          !EMW
1990: 0000: \***
1991: 0000: \***********************************************************************
1992: 0000: \***********************************************************************
1993: 0000: 
1994: 0000:     INTEGER*1 GLOBAL                                                    \
1995: 0000:         STOCK.FLAGS%,                                                   \   !EMW
1996: 0000:         STOCK.RECL%
1997: 0000: 
1998: 0000:     INTEGER*2 GLOBAL                                                    \
1999: 0000:         STOCK.LAST.COUNT%,                                              \
2000: 0000:         STOCK.LAST.REC%,                                                \
2001: 0000:         STOCK.REPORT.NUM%,                                              \
2002: 0000:         STOCK.SESS.NUM%,                                                \
2003: 0000:         STOCK.STOCK.FIG%
2004: 0000: 
2005: 0000:     INTEGER*4 GLOBAL                                                    \   !CMW
2006: 0000:         STOCK.NEXT.SID%,                                                \   !DMW
2007: 0000:         STOCK.SID%                                                          !CMW
2008: 0000: 
2009: 0000:     STRING GLOBAL                                                       \
2010: 0000:         STOCK.BOOTS.CODE$,                                              \
2011: 0000:         STOCK.DATE.LAST.COUNT$,                                         \
2012: 0000:         STOCK.DATE.LAST.GAP$,                                           \
2013: 0000:         STOCK.DATE.LAST.MOVE$,                                          \
2014: 0000:         STOCK.DATE.LAST.REC$,                                           \
2015: 0000:         STOCK.FILE.NAME$,                                               \
2016: 0000:         STOCK.FILLER$,                                                  \
2017: 0000:         STOCK.STATUS.1$                                                     !CMW
2018: 0000: 
2019: 0000: 
2020: 0000: %INCLUDE PSBF19G.J86    ! UPDATE IRF GLOBALS
2021: 0000: REM \
2022: 0000: \*******************************************************************************
2023: 0000: \*******************************************************************************
2024: 0000: \***
2025: 0000: \***
2026: 0000: \***            INCLUDE       : UPDATE IRF globals
2027: 0000: \***
2028: 0000: \***            REFERENCE     : PSBF19G.J86
2029: 0000: \***
2030: 0000: \***      Version A              Richard Hopkinson            16th March 1988
2031: 0000: \***
2032: 0000: \***      Version B              Janet Lawrence               12th April 1989
2033: 0000: \***      Version letter incremented to match that of external defintion of 
2034: 0000: \***      function 19.  
2035: 0000: \***
2036: 0000: \***      Version C              Andrew Wedgeworth             21st July 1992
2037: 0000: \***      Return code field removed as no longer used.
2038: 0000: \***
2039: 0000: \***      Version F              Steve Perkins                 20th October 1993
2040: 0000: \***      Version letter updated to keep in line with PSBF19.BAS
2041: 0000: \***
2042: 0000: \***    REVISION 1.9.                ROBERT COWEY.                08 DEC 2003.
2043: 0000: \***    Changes for Deal Limit removal project.
2044: 0000: \***    Revision number updated to keep in step with PSBF19.BAS.
2045: 0000: \***    Declared variables for IRFDEX and F19.NODE.FILE...
2046: 0000: \***
2047: 0000: \*******************************************************************************
2048: 0000: \*******************************************************************************
2049: 0000: 
2050: 0000:       STRING   F19.RETURNED.STRING                                     ! CAW
2051: 0000:       STRING   F19.NODE.FILE.NAME$                                         ! 1.9 RC
2052: 0000: 
2053: 0000:       STRING   GLOBAL NODE.ID$
2054: 0000:       STRING   GLOBAL TIF.FULL$
2055: 0000:       STRING   GLOBAL TIF.OPEN.FLAG$
2056: 0000:       STRING   GLOBAL TMCF.FULL$
2057: 0000:       STRING   GLOBAL TMCF.OPEN.FLAG$
2058: 0000:       
2059: 0000:       INTEGER*2 GLOBAL F19.IRFDEX.SESS.NUM%                                ! 1.9 RC
2060: 0000:       
2061: 0000:       INTEGER*2 F19.NODE.REPORT.NUM%                                       ! 1.9 RC
2062: 0000:       INTEGER*2 F19.NODE.SESS.NUM%                                         ! 1.9 RC
2063: 0000: %INCLUDE PSBF41G.J86    ! IRF UPDATE FUNCTION
2064: 0000: !******************************************************************************
2065: 0000: !******************************************************************************
2066: 0000: !***
2067: 0000: !***            PROGRAM         :       PSBF41G.J86
2068: 0000: !***
2069: 0000: !***            DESCRIPTION     :       Update all IRF barcodes function
2070: 0000: !***
2071: 0000: !***            AUTHOR          :       Brian Greenfield
2072: 0000: !***            DATE WRITTEN    :       July 2002
2073: 0000: !***
2074: 0000: !***        Pass in the Boots Item Code (7 digits) in the UPDATE.ITEM.CODE$
2075: 0000: !***        variable and this function updates every single record linked to 
2076: 0000: !***        that item code on the IRF.
2077: 0000: !***        You MUST have the IRF, IDF, & IEF open when calling this function.
2078: 0000: !***
2079: 0000: !***        There are no globals for this function
2080: 0000: !***
2081: 0000: !******************************************************************************
2082: 0000: !******************************************************************************
2083: 0000:     
2084: 0000: !******************************************************************************
2085: 0000: 
2086: 0000: 
2087: 0000: 
2088: 0000:     INTEGER*1 GLOBAL                        \
2089: 0000:         CIPPM.PRESENT,                      \                        ! 1.16 RC (226)
2090: 0000:         FALSE,                              \
2091: 0000:         PRICE.MISMATCH,                     \                        ! 1.12 RC
2092: 0000:         ITEM.ON.WEEE.TABLE,                 \
2093: 0000:         ITEM.STATUS.CHANGED,                \                               !DMW
2094: 0000:         NEW.ITEM,                           \
2095: 0000:         PRICE.CHANGE.TODAY,                 \                        ! 1.13 RC (179)
2096: 0000:         SAV.IRF.INDICAT3%,                  \                        ! 1.13 RC (179)
2097: 0000:         SEL.NON.PRICE.CHANGE,               \                        ! 1.13 RC (179)
2098: 0000:         TRUE                                !
2099: 0000: 
2100: 0000: 
2101: 0000:     INTEGER*2 GLOBAL                        \
2102: 0000:         BARCODE.COUNT%,                     \
2103: 0000:         CURR.PCR.COUNT%,                    \
2104: 0000:         CURR.SESS.NUM%,                     \
2105: 0000:         GOOD.CHAIN.COUNT%,                  \
2106: 0000:         I%,                                 \
2107: 0000:         K%,                                 \
2108: 0000:         MAX.BARCODES%,                      \
2109: 0000:         MAX.PRICE.CHANGES%,                 \
2110: 0000:         NO.OF.BC%,                          \
2111: 0000:         NO.OF.STATINS%,                     \                                   !1.5CSk(a)
2112: 0000:         WEEE.ITEM.COUNT%,                   \
2113: 0000:         WIX%                                !
2114: 0000: 
2115: 0000:     INTEGER*4 GLOBAL                        \
2116: 0000:         COUNT.RECORDS.IUF%,                 \
2117: 0000:         RC%                                 !
2118: 0000: 
2119: 0000:     STRING GLOBAL                           \
2120: 0000:         BARCODE.TABLE$(1),                  \
2121: 0000:         CHLAMYDIA.ID$(1),                   \                                   !1.5CSk(a)
2122: 0000:         DELETION.TABLE(1),                  \
2123: 0000:         GCM.PG.LIST$,                       \  List of Gift Card mall     ! BCSk
2124: 0000:                                             \  Product Groups read in     ! BCSk
2125: 0000:                                             \  from BCF Rec: 22           ! BCSk
2126: 0000:         JOBSOK.FLAG$,                       \                                   ! 1.14 RC (200)
2127: 0000:         STATINS$(1),                        \                                   !1.5CSk(a)
2128: 0000:         WEEEUF.TABLE$(1)                    !
2129: 0000: 
2130: 0000:     STRING GLOBAL                           \
2131: 0000:         CURR.AGE.RESTRICTION$,              \
2132: 0000:         CURR.BC.LETTER$,                    \
2133: 0000:         CURR.BLOCKED.FROM.SALE$,            \
2134: 0000:         CURR.BOOTS.CODE$,                   \
2135: 0000:         CURR.BOOTS.COM.EXTENDED$,           \
2136: 0000:         CURR.CONTAINS.ALCOHOL$,             \
2137: 0000:         CURR.CONTAINS.ASPIRIN$,             \
2138: 0000:         CURR.CONTAINS.EPHEDRINE$,           \
2139: 0000:         CURR.CONTAINS.IBUPROFEN$,           \
2140: 0000:         CURR.CONTAINS.NONSOLID.PAINKILLER$, \
2141: 0000:         CURR.CONTAINS.PARACETAMOL$,         \
2142: 0000:         CURR.CONTAINS.PSEUDOEPHEDRINE$,     \
2143: 0000:         CURR.CURRENT.PRICE$,                \
2144: 0000:         CURR.DATE.SENSITIVE$,               \
2145: 0000:         CURR.DISCOUNTABLE$,                 \ ! Reinstated original variable name ! 1.6 RC (21)
2146: 0000:         CURR.EARN.POINTS$,                  \
2147: 0000:         CURR.ENF.PRICE.ENTRY$,              \
2148: 0000:         CURR.ETHICAL.ACTIVE$,               \
2149: 0000:         CURR.ETHICAL.CLASS$,                \
2150: 0000:         CURR.ETHICAL.DESCRIPTION$,          \
2151: 0000:         CURR.ETHICAL.PACK.SIZE$,            \
2152: 0000:         CURR.GIFTCARD$,                     \
2153: 0000:         CURR.GIVEAWAY$,                     \
2154: 0000:         CURR.GRP.CODE.FLAG$,                \
2155: 0000:         CURR.GUARANTEE.LENGTH$,             \
2156: 0000:         CURR.INSURANCE$,                    \
2157: 0000:         CURR.ITEM.QTY$,                     \
2158: 0000:         CURR.OWN.BRAND$,                    \
2159: 0000:         CURR.PRIMARY.SUPPLIER$,             \
2160: 0000:         CURR.PROD.GRP$,                     \
2161: 0000:         CURR.REDEEMABLE$,                   \
2162: 0000:         CURR.RESALEABLE$,                   \
2163: 0000:         CURR.RETURN.ROUTE$,                 \
2164: 0000:         CURR.RETURNABLE$,                   \
2165: 0000:         CURR.S.E.DESC$,                     \
2166: 0000:         CURR.SPECIAL.INSTRUCTION$,          \
2167: 0000:         CURR.STATUS.1$,                     \
2168: 0000:         CURR.STNDRD.DESC$,                  \
2169: 0000:         CURR.STOCK.SYSTEM.FLAG$,            \
2170: 0000:         CURR.SUPPLY.ROUTE$,                 \
2171: 0000:         CURR.TILL.DESC$,                    \
2172: 0000:         CURR.UNIT.MEASUREMENT$,             \
2173: 0000:         CURR.UNIT.NAME$,                    \
2174: 0000:         CURR.UNRESTRICTED.GROUP.CODE$,      \
2175: 0000:         MODULE.NUMBER$,                     \                                   !1.5CSk(a)
2176: 0000:         PACKED.BC$,                         \
2177: 0000: \       PRICE.CHANGE.DUE$,                  \                                   ! 1.13 RC (179)
2178: 0000:         PROCESSING.DATE$,                   \
2179: 0000:         READ.ISF.ITEM.QTY$,                 \                                   ! 1.13 RC (179)
2180: 0000:         READ.ISF.S.E.DESC$,                 \                                   ! 1.13 RC (179)
2181: 0000:         READ.ISF.UNIT.MEASUREMENT$,         \                                   ! 1.13 RC (179)
2182: 0000:         READ.ISF.UNIT.NAME$,                \                                   ! 1.13 RC (179)
2183: 0000: \       REDEEM.STATUS.CHANGED$,             \                                   ! 1.13 RC (179)
2184: 0000:         SOFTS.REC.62$                       !
2185: 0000: 
2186: 0000: 
2187: 0000:     STRING GLOBAL                           \
2188: 0000:         CURR.DATE.DUE$(1),                  \
2189: 0000:         CURR.INC.DEC.FLAG$(1),              \
2190: 0000:         CURR.MARKDOWN$(1),                  \
2191: 0000:         CURR.PRICE$(1),                     \
2192: 0000:         CURR.RPD.NO$(1),                    \
2193: 0000:         CURR.STATUS.FLAG$(1)                !
2194: 0000: 
2195: 0000:     STRING GLOBAL                           \
2196: 0000:         ACD.FLAG$,                          \
2197: 0000:         IRF.LOCKED.FLAG$                    !
2198: 0000: 
2199: 0000:     STRING GLOBAL                           \                           !GRN
2200: 0000:         CURR.GRP.NO$,                       \                           !GRN
2201: 0000:         CURR.RESTRICT.SALES.FLAG$           !                           !GRN
2202: 0000: 
2203: 0000: %INCLUDE BCFEXT.J86     ! BRCF File
2204: 0000: \*****************************************************************************
2205: 0000: \*****************************************************************************
2206: 0000: \***
2207: 0000: \***         FUNCTION DEFINITIONS FOR BOOTS CONTROL FILE
2208: 0000: \***
2209: 0000: \***                    REFERENCE : BCFEXTA.J86
2210: 0000: \***
2211: 0000: \***    Version A           Steve Windsor          5th Jan 1993
2212: 0000: \***
2213: 0000: \***    Version B           Michael J. Kelsall    14th Sep 1993
2214: 0000: \***    Code incremented to maintain consistency with other included code
2215: 0000: \***    for RETURNS/AUTOMATIC CREDIT CLAIMING system.
2216: 0000: \***
2217: 0000: \***    Version C           Stuart William McConnachie 23rd Jan 1995
2218: 0000: \***    Addition of TXR serial number as part of the TRANSACTION RETRIEVAL
2219: 0000: \***    project.
2220: 0000: \***
2221: 0000: \***    Version D           Stuart William McConnachie  7th June 1995
2222: 0000: \***    Converted calls to enable more than 1 record on the BCF.
2223: 0000: \***    The second record is to be used for the No7 customer card trial.
2224: 0000: \***
2225: 0000: \***    Revision 4.6            ROBERT COWEY.            19 MAY 2003.
2226: 0000: \***    Modifications for All Txn Data To CDAS project.
2227: 0000: \***    No changes to this file.
2228: 0000: \***
2229: 0000: \***    Revision 4.7            Julia Stones              9th July 2003
2230: 0000: \***    Modifications for New Lines Report project.
2231: 0000: \***    No changes to this file.
2232: 0000: \***
2233: 0000: \*****************************************************************************
2234: 0000: \*****************************************************************************
2235: 0000: 
2236: 0000:    FUNCTION BCF.SET EXTERNAL
2237: 0000:    END FUNCTION
2238: 0000: 
2239: 0000:   FUNCTION READ.BCF EXTERNAL
2240: 0000:    INTEGER*2 READ.BCF
2241: 0000:   END FUNCTION
2242: 0000: 
2243: 0000:   FUNCTION READ.BCF.LOCK EXTERNAL
2244: 0000:    INTEGER*2 READ.BCF.LOCK
2245: 0000:   END FUNCTION
2246: 0000: 
2247: 0000:   FUNCTION WRITE.BCF EXTERNAL
2248: 0000:    INTEGER*2 WRITE.BCF
2249: 0000:   END FUNCTION
2250: 0000: 
2251: 0000:   FUNCTION WRITE.BCF.UNLOCK EXTERNAL
2252: 0000:    INTEGER*2 WRITE.BCF.UNLOCK
2253: 0000:   END FUNCTION
2254: 0000: 
2255: 0000:   FUNCTION WRITE.HOLD.BCF.UNLOCK EXTERNAL
2256: 0000:    INTEGER*2 WRITE.HOLD.BCF.UNLOCK
2257: 0000:   END FUNCTION
2258: 0000: 
2259: 0000: %INCLUDE CIPPMEXT.J86   ! Markdown File
2260: 0000: \/******************************************************************/
2261: 0000: \/*                                                                */
2262: 0000: \/* CIPPM FILE EXTERNAL FUNCTION DEFNS                             */
2263: 0000: \/*                                                                */
2264: 0000: \/* REFERENCE   : CIPPMEXT.J86                                     */
2265: 0000: \/*                                                                */
2266: 0000: \/* VERSION A.          Neil Bennett.              16 APRIL 2007   */
2267: 0000: \/*                                                                */
2268: 0000: \/******************************************************************/
2269: 0000: 
2270: 0000:    FUNCTION CIPPM.SET EXTERNAL
2271: 0000:       INTEGER*1 CIPPM.SET
2272: 0000:    END FUNCTION
2273: 0000: 
2274: 0000:    FUNCTION READ.CIPPM EXTERNAL
2275: 0000:       INTEGER*2 READ.CIPPM
2276: 0000:    END FUNCTION
2277: 0000: 
2278: 0000:    FUNCTION WRITE.CIPPM EXTERNAL
2279: 0000:       INTEGER*2 WRITE.CIPPM
2280: 0000:    END FUNCTION
2281: 0000: 
2282: 0000: \/******************************************************************/
2283: 0000: %INCLUDE DRUGEXT.J86
2284: 0000: \*******************************************************************************
2285: 0000: \***                                                                         ***
2286: 0000: \***      EXTERNAL FUNCTION DEFINITIONS FOR THE DRUG FILE                    ***
2287: 0000: \***                                                                         ***
2288: 0000: \***                       REFERENCE : DRUGEXT.J86                           ***
2289: 0000: \***                                                                         ***
2290: 0000: \***      Version A      Nalini Mathusoothanan                               ***
2291: 0000: \***                                                                         ***
2292: 0000: \*******************************************************************************
2293: 0000: 
2294: 0000:        FUNCTION DRUG.SET EXTERNAL
2295: 0000:        END FUNCTION
2296: 0000: 
2297: 0000:        FUNCTION READ.DRUG EXTERNAL
2298: 0000:           INTEGER*2 READ.DRUG
2299: 0000:        END FUNCTION
2300: 0000: 
2301: 0000: 
2302: 0000:        FUNCTION READ.DRUG.LOCK EXTERNAL
2303: 0000:           INTEGER*2 READ.DRUG.LOCK
2304: 0000:        END FUNCTION
2305: 0000: 
2306: 0000:        FUNCTION WRITE.DRUG EXTERNAL
2307: 0000:           INTEGER*2 WRITE.DRUG
2308: 0000:        END FUNCTION
2309: 0000: 
2310: 0000:        FUNCTION WRITE.DRUG.HOLD EXTERNAL
2311: 0000:           INTEGER*2 WRITE.DRUG.HOLD
2312: 0000:        END FUNCTION
2313: 0000: 
2314: 0000:        FUNCTION WRITE.DRUG.UNLOCK EXTERNAL
2315: 0000:           INTEGER*2 WRITE.DRUG.UNLOCK
2316: 0000:        END FUNCTION
2317: 0000: %INCLUDE IDFEXT.J86
2318: 0000: \*******************************************************************************
2319: 0000: \***                                                                         ***
2320: 0000: \***      EXTERNAL FUNCTION DEFINITIONS FOR THE ITEM DESCRIPTION FILE        ***
2321: 0000: \***                                                                         ***
2322: 0000: \***                       REFERENCE : IDFEXT.J86                            ***
2323: 0000: \***                                                                         ***
2324: 0000: \***      Version A           Andrew Wedgeworth         9th July 1992        ***
2325: 0000: \***
2326: 0000: \***    VERSION C.              Robert Cowey.                       25 AUG 1993.
2327: 0000: \***    No changes to this file.
2328: 0000: \***
2329: 0000: \***   VERSION D               Nik Sen                 22nd December 1994
2330: 0000: \***   WRITE.IDF.HOLD added
2331: 0000: \***
2332: 0000: \*******************************************************************************
2333: 0000: 
2334: 0000:        FUNCTION IDF.SET EXTERNAL                                      
2335: 0000:        END FUNCTION                                                   
2336: 0000: 
2337: 0000: 
2338: 0000:        FUNCTION READ.IDF EXTERNAL                                     
2339: 0000:           INTEGER*2 READ.IDF                                          
2340: 0000:        END FUNCTION                                                   
2341: 0000: 
2342: 0000: 
2343: 0000:        FUNCTION READ.IDF.LOCK EXTERNAL                                
2344: 0000:           INTEGER*2 READ.IDF.LOCK                                     
2345: 0000:        END FUNCTION                                                   
2346: 0000: 
2347: 0000:        FUNCTION WRITE.IDF EXTERNAL
2348: 0000:           INTEGER*2 WRITE.IDF
2349: 0000:        END FUNCTION	       
2350: 0000: 
2351: 0000:        FUNCTION WRITE.IDF.HOLD EXTERNAL
2352: 0000:           INTEGER*2 WRITE.IDF.HOLD
2353: 0000:        END FUNCTION
2354: 0000: 
2355: 0000:        FUNCTION WRITE.IDF.UNLOCK EXTERNAL                                  
2356: 0000:           INTEGER*2 WRITE.IDF.UNLOCK                                      
2357: 0000:        END FUNCTION                                                   
2358: 0000: %INCLUDE IEFEXT.J86
2359: 0000: \*****************************************************************************
2360: 0000: \*****************************************************************************
2361: 0000: \***
2362: 0000: \***         EXTERNAL FUNCTION DEFINITIONS FOR IEF
2363: 0000: \***
2364: 0000: \***         REFERENCE: IEFEXT.J86
2365: 0000: \***
2366: 0000: \***    VERSION B.              ROBERT COWEY.                       21 OCT 1993.
2367: 0000: \***    No changes to this file.
2368: 0000: \***
2369: 0000: \*******************************************************************************
2370: 0000: \*******************************************************************************
2371: 0000: 
2372: 0000:    FUNCTION IEF.SET EXTERNAL
2373: 0000:    END FUNCTION
2374: 0000:    
2375: 0000:    FUNCTION READ.IEF EXTERNAL
2376: 0000:       INTEGER*2 READ.IEF
2377: 0000:    END FUNCTION
2378: 0000:    
2379: 0000:    FUNCTION WRITE.IEF EXTERNAL
2380: 0000:       INTEGER*2 WRITE.IEF
2381: 0000:    END FUNCTION
2382: 0000:    
2383: 0000:    
2384: 0000: %INCLUDE IEXEXT.J86
2385: 0000: \*******************************************************************************
2386: 0000: \***                                                                         ***
2387: 0000: \***      EXTERNAL FUNCTION DEFINITIONS FOR THE IEX FILE                     ***
2388: 0000: \***                                                                         ***
2389: 0000: \***                       REFERENCE : IEXEXT.J86                            ***
2390: 0000: \***                                                                         ***
2391: 0000: \***      Version A      Nalini Mathusoothanan                               ***
2392: 0000: \***                                                                         ***
2393: 0000: \*******************************************************************************
2394: 0000: 
2395: 0000:        FUNCTION IEX.SET EXTERNAL
2396: 0000:        END FUNCTION
2397: 0000: 
2398: 0000:        FUNCTION READ.IEX EXTERNAL
2399: 0000:           INTEGER*2 READ.IEX
2400: 0000:        END FUNCTION
2401: 0000: 
2402: 0000:        FUNCTION READ.IEX.LOCK EXTERNAL
2403: 0000:           INTEGER*2 READ.IEX.LOCK
2404: 0000:        END FUNCTION
2405: 0000: 
2406: 0000:        FUNCTION WRITE.IEX EXTERNAL
2407: 0000:           INTEGER*2 WRITE.IEX
2408: 0000:        END FUNCTION
2409: 0000: 
2410: 0000:        FUNCTION WRITE.IEX.HOLD EXTERNAL
2411: 0000:           INTEGER*2 WRITE.IEX.HOLD
2412: 0000:        END FUNCTION
2413: 0000: 
2414: 0000:        FUNCTION WRITE.IEX.UNLOCK EXTERNAL
2415: 0000:           INTEGER*2 WRITE.IEX.UNLOCK
2416: 0000:        END FUNCTION
2417: 0000: %INCLUDE IRFEXT.J86
2418: 0000: \*********************************************************************************
2419: 0000: \***
2420: 0000: \***      EXTERNAL FUNCTION DEFINITIONS FOR THE ITEM REFERENCE FILE
2421: 0000: \***
2422: 0000: \***                    REFERENCE : IRFEXT.J86
2423: 0000: \***
2424: 0000: \***      Version A          Andrew Wedgeworth        9th July 1992
2425: 0000: \***
2426: 0000: \***      Version B          Andrew Wedgeworth        14th December 1992
2427: 0000: \***      Version letter incremented to match other IRF code.
2428: 0000: \***
2429: 0000: \***      Version C           Steve Windsor        12.02.93
2430: 0000: \***      Added external reference to read the alternate IRF.
2431: 0000: \***
2432: 0000: \***      Version D           Steve Windsor        12.05.93
2433: 0000: \***      Added all external references that wre in the original FNS.
2434: 0000: \***
2435: 0000: \***      Version E           Steve Perkins        21.09.93
2436: 0000: \***      Deals project: Fields changed for new deals project
2437: 0000: \*** 
2438: 0000: \***      Version F           Mark Walker          5th January 1994
2439: 0000: \***      Version letter incremented to match other IRF code.           
2440: 0000: \***                                                                    
2441: 0000: \***      Version G     Stuart William McConnachie      11th February 2000
2442: 0000: \***      Converted IRF.INDICAT2$ to integer flag byte.
2443: 0000: \***
2444: 0000: \***      REVISION 1.6.               ROBERT COWEY.               9 JUL 2002.
2445: 0000: \***      Major changes to IRF layout for 2002 Deals Rewrite project.
2446: 0000: \***      No changes to this particular file for this revision.
2447: 0000: \***
2448: 0000: \***      REVISION 1.7.               ROBERT COWEY.               5 AUG 2002.
2449: 0000: \***      Further changes for 2002 Deals Rewrite project (PSBF19 related).
2450: 0000: \***      Defined new functions CONCAT.NEW.IRF.DATA$ and SPLIT.NEW.IRF.DATA$.
2451: 0000: \***
2452: 0000: \***      REVISION 1.8                ROBERT COWEY.              15 JUL 2003.
2453: 0000: \***      Usage of INDICAT0% bit-3 X'08' changed to Item Contains Alcohol.
2454: 0000: \***      No changes to this file other than description.
2455: 0000: \***      No changes to IRF file functions.
2456: 0000: \***
2457: 0000: \***      REVISION 1.9.      STUART WILLIAM MCCONNACHIE           22 OCT 2003.
2458: 0000: \***      Changes to remove limit of 3 deals per item.
2459: 0000: \***      No changes to this file.
2460: 0000: \***
2461: 0000: \***      REVISION 2.0.             ALAN CARR                      9 FEB 2006.
2462: 0000: \***      Add new IRF.INDICAT8% 1 byte, amend IRF.UNUSED$ from 3 to 2 bytes.
2463: 0000: \***      No changes to this file.
2464: 0000: \***
2465: 0000: \***..............................................................................
2466: 0000:    
2467: 0000:    FUNCTION IRF.SET EXTERNAL
2468: 0000:    END FUNCTION
2469: 0000: 
2470: 0000:   FUNCTION CONCAT.NEW.IRF.DATA$ EXTERNAL                                  ! 1.7 RC
2471: 0000:   END FUNCTION                                                            ! 1.7 RC
2472: 0000: 
2473: 0000:   FUNCTION SPLIT.NEW.IRF.DATA$ EXTERNAL                                   ! 1.7 RC
2474: 0000:   END FUNCTION                                                            ! 1.7 RC
2475: 0000:   
2476: 0000:   FUNCTION READ.IRF EXTERNAL
2477: 0000:    INTEGER*2 READ.IRF
2478: 0000:   END FUNCTION
2479: 0000: 
2480: 0000:   FUNCTION READ.IRF.ALT EXTERNAL
2481: 0000:    INTEGER*2 READ.IRF.ALT
2482: 0000:   END FUNCTION
2483: 0000: 
2484: 0000:   FUNCTION READ.IRF.LOCK EXTERNAL
2485: 0000:    INTEGER*2 READ.IRF.LOCK
2486: 0000:   END FUNCTION
2487: 0000: 
2488: 0000:   FUNCTION WRITE.IRF EXTERNAL
2489: 0000:    INTEGER*2 WRITE.IRF
2490: 0000:   END FUNCTION
2491: 0000: 
2492: 0000:   FUNCTION WRITE.IRF.UNLOCK EXTERNAL
2493: 0000:    INTEGER*2 WRITE.IRF.UNLOCK
2494: 0000:   END FUNCTION
2495: 0000: 
2496: 0000:   FUNCTION WRITE.IRF.HOLD EXTERNAL
2497: 0000:    INTEGER*2 WRITE.IRF.HOLD
2498: 0000:   END FUNCTION
2499: 0000: 
2500: 0000:   FUNCTION WRITE.IRF.HOLD.UNLOCK EXTERNAL
2501: 0000:    INTEGER*2 WRITE.IRF.HOLD.UNLOCK
2502: 0000:   END FUNCTION
2503: 0000: 
2504: 0000:   
2505: 0000: %INCLUDE ISFEXT.J86
2506: 0000: \*******************************************************************************
2507: 0000: \***                                                                         ***
2508: 0000: \***             EXTERNAL FUNCTION DEFINITIONS FOR THE ISF                   ***
2509: 0000: \***                                                                         ***
2510: 0000: \***                       REFERENCE : ISFEXT.J86                            ***
2511: 0000: \***                                                                         ***
2512: 0000: \***        Version A         Andrew Wedgeworth     9th July 1992            ***
2513: 0000: \***                                                                         ***
2514: 0000: \***        Version B         Rebecca Dakin         8th August 1999          ***
2515: 0000: \***        Declare ISF.SET as external in line with changes to ISFFUN.BAS   ***
2516: 0000: \***                                                                         ***
2517: 0000: \*******************************************************************************
2518: 0000: 
2519: 0000:        FUNCTION ISF.SET EXTERNAL                                     
2520: 0000:           INTEGER*2 ISF.SET                                             ! BRD
2521: 0000:        END FUNCTION                                                   
2522: 0000: 
2523: 0000: 
2524: 0000:        FUNCTION READ.ISF EXTERNAL                                     
2525: 0000:           INTEGER*2 READ.ISF                                          
2526: 0000:        END FUNCTION                                                   
2527: 0000: 
2528: 0000: 
2529: 0000:        FUNCTION WRITE.ISF EXTERNAL                                     
2530: 0000:           INTEGER*2 WRITE.ISF                                          
2531: 0000:        END FUNCTION                                                   
2532: 0000: 
2533: 0000: 
2534: 0000: %INCLUDE LOCALEXT.J86
2535: 0000: \***********************************************************************
2536: 0000: \***********************************************************************
2537: 0000: \***
2538: 0000: \***    DESCRIPTION: Local Price File
2539: 0000: \***                 External File Function Definitions
2540: 0000: \***
2541: 0000: \***    FILE TYPE : Keyed
2542: 0000: \***
2543: 0000: \***********************************************************************
2544: 0000: \***
2545: 0000: \***    Version A.              Paul Flanagan            1st Jul 1993
2546: 0000: \***    Initial version.
2547: 0000: \***
2548: 0000: \***    Version B.              Clive Norris            30th Nov 1993
2549: 0000: \***    Renamed to keep the versions in line.
2550: 0000: \***
2551: 0000: \***    Version C.              Mark Walker             29th Jun 2015
2552: 0000: \***    F392 Retail Stock 5
2553: 0000: \***    Added function WRITE.LOCAL.UNLOCK.HOLD
2554: 0000: \***
2555: 0000: \***********************************************************************
2556: 0000: \***********************************************************************
2557: 0000: 
2558: 0000: FUNCTION LOCAL.SET EXTERNAL
2559: 0000: END FUNCTION
2560: 0000: 
2561: 0000: FUNCTION READ.LOCAL EXTERNAL
2562: 0000:     INTEGER*2 READ.LOCAL
2563: 0000: END FUNCTION
2564: 0000: 
2565: 0000: FUNCTION READ.LOCAL.LOCK EXTERNAL
2566: 0000:     INTEGER*2 READ.LOCAL.LOCK
2567: 0000: END FUNCTION
2568: 0000: 
2569: 0000: FUNCTION WRITE.LOCAL EXTERNAL
2570: 0000:     INTEGER*2 WRITE.LOCAL
2571: 0000: END FUNCTION
2572: 0000: 
2573: 0000: FUNCTION WRITE.LOCAL.UNLOCK EXTERNAL
2574: 0000:     INTEGER*2 WRITE.LOCAL.UNLOCK
2575: 0000: END FUNCTION
2576: 0000: 
2577: 0000: FUNCTION WRITE.LOCAL.UNLOCK.HOLD EXTERNAL                                   !CMW
2578: 0000:     INTEGER*2 WRITE.LOCAL.UNLOCK.HOLD                                       !CMW
2579: 0000: END FUNCTION                                                                !CMW
2580: 0000: 
2581: 0000: %INCLUDE NLINEEXT.J86
2582: 0000: 
2583: 0000: \*****************************************************************************
2584: 0000: \*****************************************************************************
2585: 0000: \***
2586: 0000: \***        %INCLUDE FOR FILE HANDLING FUNCTIONS EXTERNAL DEFINITIONS
2587: 0000: \***
2588: 0000: \***                   FILE TYPE:  KEYED
2589: 0000: \***
2590: 0000: \***                   REFERENCE:  NLINEEXT.J86
2591: 0000: \***
2592: 0000: \***               DESCRIPTION:  NEWLINES - NEWLINES REPORT INFORMATION
2593: 0000: \***
2594: 0000: \***
2595: 0000: \***
2596: 0000: \***      VERSION 1 : Julia Stones             7th July 2003
2597: 0000: \***
2598: 0000: \***    REVISION 1.2.                ROBERT COWEY.               05 DEC 2003.
2599: 0000: \***    Changed NLINE reporting number from 660 to 670.
2600: 0000: \***    No code changes to this file.
2601: 0000: \***
2602: 0000: \*****************************************************************************
2603: 0000: \*****************************************************************************
2604: 0000: 
2605: 0000: 
2606: 0000:   FUNCTION NEWLINES.SET EXTERNAL
2607: 0000:      INTEGER*2 NEWLINES.SET
2608: 0000:   END FUNCTION
2609: 0000: 
2610: 0000: 
2611: 0000:   FUNCTION READ.NEWLINES EXTERNAL
2612: 0000:     INTEGER*2 READ.NEWLINES
2613: 0000:   END FUNCTION
2614: 0000: 
2615: 0000:   FUNCTION WRITE.NEWLINES EXTERNAL
2616: 0000:     INTEGER*2 WRITE.NEWLINES
2617: 0000:   END FUNCTION
2618: 0000: 
2619: 0000: %INCLUDE RICFEXT.J86
2620: 0000: \******************************************************************************
2621: 0000: \******************************************************************************
2622: 0000: \***
2623: 0000: \***                     REDEEM ITEMS CHANGE FILE    
2624: 0000: \***                                                                
2625: 0000: \***                      REFERENCE : RICFEXT.J86 
2626: 0000: \***                                                                
2627: 0000: \***                      FILE TYPE : Direct               
2628: 0000: \***                                                                
2629: 0000: \***                                                                
2630: 0000: \***   Version A.              Jamie Thorpe                  1st July 1997
2631: 0000: \***   Original version.                                                    
2632: 0000: \***                                                                         
2633: 0000: \***                                                                       
2634: 0000: \******************************************************************************
2635: 0000: \******************************************************************************
2636: 0000: 
2637: 0000:   
2638: 0000: 
2639: 0000: FUNCTION RICF.SET EXTERNAL
2640: 0000: 
2641: 0000:     INTEGER*2 RICF.SET
2642: 0000:     
2643: 0000: END FUNCTION
2644: 0000: 
2645: 0000: 
2646: 0000: FUNCTION READ.RICF EXTERNAL
2647: 0000: 
2648: 0000:     INTEGER*2 READ.RICF
2649: 0000:     
2650: 0000: END FUNCTION                
2651: 0000: 
2652: 0000: FUNCTION WRITE.RICF EXTERNAL
2653: 0000:        
2654: 0000:      INTEGER*2 WRITE.RICF
2655: 0000: 
2656: 0000: END FUNCTION
2657: 0000: 
2658: 0000: 
2659: 0000: %INCLUDE SOFTSEXT.J86
2660: 0000: \*******************************************************************************
2661: 0000: \***                                                                         ***
2662: 0000: \***      EXTERNAL FUNCTION DEFINITIONS FOR THE SOFTWARE STATUS FILE         ***
2663: 0000: \***                                                                         ***
2664: 0000: \***                     REFERENCE : SOFTSEXT.J86                            ***
2665: 0000: \***                                                                         ***
2666: 0000: \***      Version A         Andrew Wedgeworth          1st July 1992         ***
2667: 0000: \***
2668: 0000: \***   Version B
2669: 0000: \***                                                                      ***
2670: 0000: \***      Version C         Steve Wright               3rd May 1996          ***
2671: 0000: \***      Synchronise with function source.                                  ***
2672: 0000: \*******************************************************************************
2673: 0000: 
2674: 0000:       FUNCTION SOFTS.SET EXTERNAL 
2675: 0000:       END FUNCTION
2676: 0000:       
2677: 0000:       FUNCTION READ.SOFTS EXTERNAL
2678: 0000:           INTEGER*2 I%, READ.SOFTS
2679: 0000:       END FUNCTION	                   
2680: 0000: 
2681: 0000:       FUNCTION WRITE.SOFTS EXTERNAL
2682: 0000:           INTEGER*2 I%, WRITE.SOFTS
2683: 0000:       END FUNCTION
2684: 0000: 
2685: 0000: 
2686: 0000: %INCLUDE STKMQEXT.J86
2687: 0000: \*****************************************************************************
2688: 0000: \*****************************************************************************
2689: 0000: \***
2690: 0000: \***      EXTERNAL FUNCTION DEFINITIONS FOR STOCK MOVEMENT QUEUE FILE
2691: 0000: \***
2692: 0000: \***                      REFERENCE: STKMQEXT.J86
2693: 0000: \***
2694: 0000: \***       Version A            Les Cook                     8/9/92
2695: 0000: \***
2696: 0000: \***    VERSION F.              ROBERT COWEY.                       21 OCT 1993.
2697: 0000: \***    No changes to this file.
2698: 0000: \***
2699: 0000: \*******************************************************************************
2700: 0000: \*******************************************************************************
2701: 0000: 
2702: 0000:      FUNCTION STKMQ.SET EXTERNAL
2703: 0000:      END FUNCTION
2704: 0000:      
2705: 0000:      FUNCTION READ.STKMQ EXTERNAL
2706: 0000:         INTEGER*2 READ.STKMQ
2707: 0000:      END FUNCTION
2708: 0000:      
2709: 0000:      FUNCTION WRITE.STKMQ EXTERNAL
2710: 0000:         INTEGER*2 WRITE.STKMQ
2711: 0000:      END FUNCTION
2712: 0000:      
2713: 0000:      FUNCTION WRITE.HOLD.STKMQ EXTERNAL
2714: 0000:         INTEGER*2 WRITE.HOLD.STKMQ
2715: 0000:      END FUNCTION
2716: 0000:      
2717: 0000:      
2718: 0000:      
2719: 0000: %INCLUDE STOCKEXT.J86
2720: 0000: \***********************************************************************
2721: 0000: \***********************************************************************
2722: 0000: \***
2723: 0000: \***    DESCRIPTION: Stock File
2724: 0000: \***                 External File Function Definitions
2725: 0000: \***
2726: 0000: \***    FILE TYPE : Keyed
2727: 0000: \***
2728: 0000: \***********************************************************************
2729: 0000: \***
2730: 0000: \***    Version A.          Les Cook                     21st Aug 1992
2731: 0000: \***    Initial version.
2732: 0000: \***
2733: 0000: \***    Version B.          Robert Cowey                 21st Oct 1993
2734: 0000: \***    No changes to this file.
2735: 0000: \***
2736: 0000: \***    Version C.          Nik Sen                      22nd Dec 1994
2737: 0000: \***    WRITE.STOCK.HOLD added.
2738: 0000: \***
2739: 0000: \***    Version D.          Mark Walker                  23rd Jan 2014
2740: 0000: \***    F337 Centralised View of Stock
2741: 0000: \***    - Minor formatting changes (uncommented).
2742: 0000: \***
2743: 0000: \***********************************************************************
2744: 0000: \***********************************************************************
2745: 0000: 
2746: 0000: FUNCTION STOCK.SET EXTERNAL
2747: 0000: END FUNCTION
2748: 0000:    
2749: 0000: FUNCTION READ.STOCK EXTERNAL
2750: 0000:     INTEGER*2 READ.STOCK
2751: 0000: END FUNCTION
2752: 0000:    
2753: 0000: FUNCTION WRITE.STOCK EXTERNAL
2754: 0000:     INTEGER*2 WRITE.STOCK
2755: 0000: END FUNCTION
2756: 0000:    
2757: 0000: FUNCTION WRITE.STOCK.HOLD EXTERNAL
2758: 0000:     INTEGER*2 WRITE.STOCK.HOLD
2759: 0000: END FUNCTION
2760: 0000: 
2761: 0000: FUNCTION READ.STOCK.LOCK EXTERNAL
2762: 0000:     INTEGER*2 READ.STOCK.LOCK
2763: 0000: END FUNCTION
2764: 0000:    
2765: 0000: FUNCTION WRITE.STOCK.UNLOCK EXTERNAL
2766: 0000:     INTEGER*2 WRITE.STOCK.UNLOCK
2767: 0000: END FUNCTION
2768: 0000:    
2769: 0000: FUNCTION WRITE.STOCK.UNLOCK.HOLD EXTERNAL
2770: 0000:     INTEGER*2 WRITE.STOCK.UNLOCK.HOLD
2771: 0000: END FUNCTION
2772: 0000: 
2773: 0000: 
2774: 0000: %INCLUDE PSBF19E.J86    ! UPDATE IRF EXTERNALS
2775: 0000: \*******************************************************************************! GCSk
2776: 0000: \*******************************************************************************! GCSk
2777: 0000: \***                                                                            ! GCSk
2778: 0000: \*** IMPORTANT                                                                  ! GCSk
2779: 0000: \*** =========                                                                  ! GCSk
2780: 0000: \***    All references to UPDT.IRF.UPDT have been commented out and replaced    ! GCSk
2781: 0000: \***    with UPDT.IRF.TIF.UPDT due to the following issue found post MCF:       ! GCSk
2782: 0000: \***                                                                            ! GCSk
2783: 0000: \***    Node ID check removed as it is preventing the TIF from being updated in ! GCSk
2784: 0000: \***    Single MCF controller stores ie. MCF has changed the single DE nodes    ! GCSk
2785: 0000: \***    to CE. This change should have been done as part of the MCF project,    ! GCSk
2786: 0000: \***    however, the Business were not willing to pay for the relinking and     ! GCSk
2787: 0000: \***    testing of some 200+ programs. There is a slight processing overhead    ! GCSk
2788: 0000: \***    in dual-MCF stores, since the TIF will now be updated in them as well,  ! GCSk
2789: 0000: \***    however the impact is small and TOF does not run in this environment.   ! GCSk
2790: 0000: \***                                                                            ! GCSk
2791: 0000: \***    If you wish to use the old UPDT.IRF.UPDT function then you will need to ! GCSk
2792: 0000: \***    either:                                                                 ! GCSk
2793: 0000: \***                                                                            ! GCSk
2794: 0000: \***          1. Check out the previous OBJs, PSBF19e.J86 and update the .INP   ! GCSk
2795: 0000: \***             and .MAK to include the functions PSBF19, PSBF41 & PSBF42      ! GCSk
2796: 0000: \***       or                                                                   ! GCSk
2797: 0000: \***          2. Check out the previous PSBF19e.J86 and function library:       ! GCSk
2798: 0000: \***             FUNLIB.L86                                                     ! GCSk
2799: 0000: \***                                                                            ! GCSk
2800: 0000: \*******************************************************************************! GCSk
2801: 0000: \*******************************************************************************! GCSk
2802: 0000: 
2803: 0000: REM \
2804: 0000: \*******************************************************************************
2805: 0000: \*******************************************************************************
2806: 0000: \***
2807: 0000: \***
2808: 0000: \***            INCLUDE       : IRF.UPDATE external definition
2809: 0000: \***
2810: 0000: \***            REFERENCE     : PSBF19E.J86
2811: 0000: \***
2812: 0000: \***      Version A      Richard Hopkinson                  16th March 1988
2813: 0000: \***
2814: 0000: \***      Version B      Janet Lawrence                     12th April 1989
2815: 0000: \***      Add extra parameter, IRF.LOCKED.FLAG$, to each function definition.
2816: 0000: \***
2817: 0000: \***      Version C      Andrew Wedgeworth                   21st July 1992
2818: 0000: \***      Redundant parameters removed (ie. BATCH.SCREEN.FLAG$,
2819: 0000: \***      MODULE.NUMBER$ and OPERATOR.NUMBER$).  Function names defined as
2820: 0000: \***      variables to hold the return code.
2821: 0000: \***
2822: 0000: \***      Version F     Steve Perkins                      20th October 1993
2823: 0000: \***      Version letter updated to keep in line with PSBF19.BAS
2824: 0000: \***
2825: 0000: \***    REVISION 1.9.                ROBERT COWEY.                08 DEC 2003.
2826: 0000: \***    Changes for Deal Limit removal project.
2827: 0000: \***    Revision number updated to keep in step with PSBF19.BAS.
2828: 0000: \***    No actual coding changes to this file.
2829: 0000: \***
2830: 0000: \***    Version G       Charles Skadorwa                   25th September 2013
2831: 0000: \***    F261 Gift Card Mall IIN Range Extension Project - Commented ! GCSk
2832: 0000: \***
2833: 0000: \*******************************************************************************
2834: 0000: \*******************************************************************************
2835: 0000: 
2836: 0000:    FUNCTION OPEN.IRF.UPDT (NEW.IRF.DATA$,                                  \
2837: 0000:                            ACD.FLAG$)                                      \
2838: 0000:    EXTERNAL
2839: 0000: 
2840: 0000:       STRING    ACD.FLAG$,                                                 \
2841: 0000:                 NEW.IRF.DATA$
2842: 0000: 
2843: 0000:       INTEGER*2 OPEN.IRF.UPDT                                          ! CAW
2844: 0000: 
2845: 0000:    END FUNCTION
2846: 0000: 
2847: 0000: 
2848: 0000:   !FUNCTION UPDT.IRF.UPDT (NEW.IRF.DATA$,                              ! GCSk
2849: 0000:    FUNCTION UPDT.IRF.TIF.UPDT (NEW.IRF.DATA$,                          \ ! GCSk
2850: 0000:                            ACD.FLAG$,                                  \
2851: 0000:                            IRF.LOCKED.FLAG$)                           \ BJAL
2852: 0000:    EXTERNAL
2853: 0000: 
2854: 0000:       STRING    ACD.FLAG$,                                             \
2855: 0000:                 IRF.LOCKED.FLAG$,                                      \ BJAL
2856: 0000:                 NEW.IRF.DATA$
2857: 0000: 
2858: 0000:      !INTEGER*2 UPDT.IRF.UPDT                                          ! CAW ! GCSk
2859: 0000:       INTEGER*2 UPDT.IRF.TIF.UPDT                                      ! GCSk
2860: 0000: 
2861: 0000:    END FUNCTION
2862: 0000: 
2863: 0000: 
2864: 0000:    FUNCTION CLOSE.IRF.UPDT (NEW.IRF.DATA$,                                 \
2865: 0000:                             ACD.FLAG$)                                     \
2866: 0000:    EXTERNAL
2867: 0000: 
2868: 0000:       STRING    ACD.FLAG$,                                                 \
2869: 0000:                 NEW.IRF.DATA$
2870: 0000: 
2871: 0000:       INTEGER*2 CLOSE.IRF.UPDT                                         ! CAW
2872: 0000: 
2873: 0000:    END FUNCTION
2874: 0000: 
2875: 0000: %INCLUDE PSBF41E.J86    ! IRF UPDATE FUNCTION
2876: 0000: !******************************************************************************
2877: 0000: !******************************************************************************
2878: 0000: !***
2879: 0000: !***            PROGRAM         :       PSBF41E.J86
2880: 0000: !***
2881: 0000: !***            DESCRIPTION     :       Update all IRF barcodes function
2882: 0000: !***
2883: 0000: !***            AUTHOR          :       Brian Greenfield
2884: 0000: !***            DATE WRITTEN    :       July 2002
2885: 0000: !***
2886: 0000: !***        Pass in the Boots Item Code (7 digits) in the UPDATE.ITEM.CODE$
2887: 0000: !***        variable and this function updates every single record linked to 
2888: 0000: !***        that item code on the IRF.
2889: 0000: !***        You MUST have the IRF, IDF, & IEF open when calling this function.
2890: 0000: !***
2891: 0000: !******************************************************************************
2892: 0000: !******************************************************************************
2893: 0000:     
2894: 0000: FUNCTION UPDATE.ALL.IRF.BAR.CODES(UPDATE.ITEM.CODE$) EXTERNAL
2895: 0000: 
2896: 0000:     STRING UPDATE.ITEM.CODE$
2897: 0000:     INTEGER*1 UPDATE.ALL.IRF.BAR.CODES
2898: 0000:     
2899: 0000: END FUNCTION
2900: 0000: 
2901: 0000: %INCLUDE CMPDATE.J86
2902: 0000: !********************************************************************
2903: 0000: !***
2904: 0000: !***    INCLUDED CODE:  CMPDATE.J86
2905: 0000: !***    AUTHOR:         Stuart William McConnachie
2906: 0000: !***    DATE:           27th January 1997
2907: 0000: !***
2908: 0000: !********************************************************************
2909: 0000: !***   
2910: 0000: !***    Version B            Nik Sen                 30th March 1998
2911: 0000: !***    Changes to cope with a date of '000000' by replacing it with
2912: 0000: !***    '850101' before comparison. An all zero's date is valid in 
2913: 0000: !***    certain date fields and CMPDATE was returning the wrong result
2914: 0000: !***    when comparing with an actual date. Also change to cope with
2915: 0000: !***    dates of '999999' as some date fields are initialised to this
2916: 0000: !***    as a high value.
2917: 0000: !***
2918: 0000: !***    Version C    Stuart William McConnachie   20th December 1999
2919: 0000: !***    Improved function efficiency by changing tests for high and
2920: 0000: !***    low values, added above, to integers (rather than strings).
2921: 0000: !***    Also, using 850101 as a replacement for 000000, will not give
2922: 0000: !***    valid results after 350101 because of the 50 year wrap, so
2923: 0000: !***    corrected this.
2924: 0000: !***
2925: 0000: !***    Version D.  Stuart William McConnachie    26th February 2006
2926: 0000: !***    Place this code in it's own module in FUNLIB.  Make all
2927: 0000: !***    the functions herein EXTERNAL accordingly.
2928: 0000: !***
2929: 0000: !********************************************************************
2930: 0000: !***    
2931: 0000: !***    The following functions compare dates, checking for
2932: 0000: !***    century boundries.  Dates in the 50 years prior to the
2933: 0000: !***    compared date are less than the compared date, dates in
2934: 0000: !***    50 years after the compared date are greater than the
2935: 0000: !***    compared date.
2936: 0000: !***    Can handle dates in both packed and unpacked formats, or
2937: 0000: !***    a mixture of both.
2938: 0000: !***    In the case of a error, for example IH after detecting
2939: 0000: !***    illegal characters in VAL, the functions default to
2940: 0000: !***    comparing strings without testing for a change of century.
2941: 0000: !***
2942: 0000: !***    DATE.GT(DATE1$, DATE2$)  same as  DATE1$ >  DATE2$
2943: 0000: !***    DATE.GE(DATE1$, DATE2$)  same as  DATE1$ >= DATE2$
2944: 0000: !***    DATE.LT(DATE1$, DATE2$)  same as  DATE1$ <  DATE2$
2945: 0000: !***    DATE.LE(DATE1$, DATE2$)  same as  DATE1$ <= DATE2$
2946: 0000: !***
2947: 0000: !********************************************************************
2948: 0000: 
2949: 0000: FUNCTION DATE.GT(DATE1$, DATE2$) EXTERNAL                               !DSWM
2950: 0000:     STRING    DATE1$, DATE2$
2951: 0000:     INTEGER*1 DATE.GT
2952: 0000: END FUNCTION
2953: 0000: 
2954: 0000: 
2955: 0000: FUNCTION DATE.GE(DATE1$, DATE2$) EXTERNAL                               !DSWM
2956: 0000:     STRING    DATE1$, DATE2$
2957: 0000:     INTEGER*1 DATE.GE
2958: 0000: END FUNCTION
2959: 0000: 
2960: 0000: 
2961: 0000: FUNCTION DATE.LT(DATE1$, DATE2$) EXTERNAL                               !DSWM
2962: 0000:     STRING    DATE1$, DATE2$
2963: 0000:     INTEGER*1 DATE.LT
2964: 0000: END FUNCTION
2965: 0000: 
2966: 0000: 
2967: 0000: FUNCTION DATE.LE(DATE1$, DATE2$) EXTERNAL                               !DSWM
2968: 0000:     STRING    DATE1$, DATE2$
2969: 0000:     INTEGER*1 DATE.LE
2970: 0000: END FUNCTION
2971: 0000: 
2972: 0000: 
2973: 0000: 
2974: 0000: SUB DO.MESSAGE(MSG$, LOG%) EXTERNAL
2975: 0000: END SUB
2976: 0000: 
2977: 0000: SUB LOG.EVENT(EVENT.NO%) EXTERNAL
2978: 0000: END SUB
2979: 0000: 
2980: 0000: SUB PROCESS.PPFK.ITEM EXTERNAL
2981: 0000: END SUB
2982: 0000: 
2983: 0000: \******************************************************************************
2984: 0000: \***
2985: 0000: \*** WRITE.STKMQ.6.RECORD
2986: 0000: \***
2987: 0000: \***
2988: 0000: \******************************************************************************
2989: 0000: 
2990: 0000: SUB WRITE.STKMQ.6.RECORD
2991: 0024: 
2992: 0024:     CURR.SESS.NUM% = STKMQ.SESS.NUM%
2993: 003a:     IF END# STKMQ.SESS.NUM% THEN STKMQ.FILE.ERROR
2994: 0056:     OPEN STKMQ.FILE.NAME$ AS STKMQ.SESS.NUM% BUFFSIZE 155 READONLY NODEL APPEND
2995: 007f: 
2996: 007f:     STKMQ.RECORD.DELIMITER$ = CHR$(34)
2997: 0099:     STKMQ.FIELD.DELIMITER$  = CHR$(59)
2998: 00b3:     STKMQ.ENDREC.MARKER$    = CHR$(0Dh) + CHR$(0Ah)
2999: 00e2: 
3000: 00e2:     STKMQ.DATE$ = PACK$(DATE$)
3001: 00ff:     STKMQ.TIME$ = PACK$(TIME$)
3002: 011c: 
3003: 011c:     STKMQ.TRANS.TYPE$ = PACK$("06")
3004: 0138:     STKMQ.BOOTS.CODE$ = STOCK.BOOTS.CODE$
3005: 0156:     STKMQ.REASON$ = "I"
3006: 016d: 
3007: 016d:     STKMQ.RECORD$ = STKMQ.RECORD.DELIMITER$  \
3008: 01e6:                   + STKMQ.TRANS.TYPE$        \
3009: 01e6:                   + STKMQ.FIELD.DELIMITER$   \
3010: 01e6:                   + STKMQ.DATE$              \
3011: 01e6:                   + STKMQ.TIME$              \
3012: 01e6:                   + STKMQ.BOOTS.CODE$        \
3013: 01e6:                   + STKMQ.REASON$            \
3014: 01e6:                   + STKMQ.RECORD.DELIMITER$  \
3015: 01e6:                   + STKMQ.ENDREC.MARKER$
3016: 01e6: 
3017: 01e6:     RC% = WRITE.STKMQ
3018: 0201:     CLOSE STKMQ.SESS.NUM%
3019: 0215: 
3020: 0215:     IF RC% = 0 THEN BEGIN
3021: 0234:         EXIT SUB
3022: 023f:     ENDIF
3023: 0247: 
3024: 0247:  STKMQ.FILE.ERROR:
3025: 0257:     CALL DO.MESSAGE("PSB21 *** ERROR WRITE.STKMQ.6.RECORD: [" + STKMQ.RECORD$ +"]", FALSE)
3026: 02a8:     CALL LOG.EVENT(106)
3027: 02ce: 
3028: 02ce: 
3029: 02ce: END SUB
3030: 02e2: 
3031: 02e2: 
3032: 02e2: \******************************************************************************
3033: 02e2: \***
3034: 02e2: \***  BARCODE.PROCESSING
3035: 02e2: \***
3036: 02e2: \******************************************************************************
3037: 02e2: \***  Setup IDF/IRF barcodes and add associated barcodes to IEF.
3038: 02e2: \***
3039: 02e2: \***  Firstly, we need to delete all chains from IEF for existing items. The
3040: 02e2: \***  chain is read into an array and the deletion is performed in reverse so
3041: 02e2: \***  that if a delete fails then the first part of the chain remains intact.
3042: 02e2: \***  This routine also caters for situations where the barcode count is
3043: 02e2: \***  incorrect due to broken chains.
3044: 02e2: \***
3045: 02e2: \***  In all the scenarios below, the 1st IDF Barcode ALWAYS defaults to the
3046: 02e2: \***  Boots Item Code (less the check digit).
3047: 02e2: \***
3048: 02e2: \***  Scenario 1: No IUF barcode records are present for an item.
3049: 02e2: \***              Ans: 2nd barcode defaults to 0's. Set No. of barcodes to 1.
3050: 02e2: \***
3051: 02e2: \***  Scenario 2: one IUF barcode record present for an item.
3052: 02e2: \***              Ans: If the IUF barcode matches the Boots Item Code then set up
3053: 02e2: \***                   the barcodes as for Scenario 1 else set the 2nd IDF barcode
3054: 02e2: \***                   to the IUF barcode. Set No. of barcodes to 2.
3055: 02e2: \***
3056: 02e2: \***  Scenario 3: two or more IUF barcode records present for an item.
3057: 02e2: \***              Ans: scan through barcodes and ignore the one that matches the 1st
3058: 02e2: \***                   barcode. Set the 2nd barcode to one of the IUF barcodes.
3059: 02e2: \***                   Set No. of barcodes to correct value.
3060: 02e2: \***
3061: 02e2: \***  If there are more than 2 barcodes (exluding Boots Item Code one), then write
3062: 02e2: \***  these out to the IEF.
3063: 02e2: \***
3064: 02e2: \******************************************************************************
3065: 02e2: SUB BARCODE.PROCESSING
3066: 0306: 
3067: 0306:     INTEGER*1 DELETING.IEF.CHAIN     ! Used to determine where to continue when error
3068: 0306: 
3069: 0306:     STRING BCREF$
3070: 0306: 
3071: 0306:     ON ERROR GOTO BARCODE.ERROR
3072: 031b: 
3073: 031b:     DELETING.IEF.CHAIN = FALSE
3074: 032d: 
3075: 032d:     GOOD.CHAIN.COUNT% = 0
3076: 033e: 
3077: 033e:     IF NOT NEW.ITEM THEN BEGIN ! Only delete existing item barcode chains
3078: 0353: 
3079: 0353:         DELETING.IEF.CHAIN = TRUE
3080: 0365: 
3081: 0365:         NO.OF.BC% = VAL(UNPACK$(IDF.NO.OF.BAR.CODES$))
3082: 038e: 
3083: 038e:         IF NO.OF.BC% > 2 AND \
3084: 03db:             IDF.SECOND.BAR.CODE$ <> PACK$("000000000000") THEN BEGIN
3085: 03db: 
3086: 03db:             DIM DELETION.TABLE(1000)
3087: 040b: 
3088: 040b:             PACKED.BC$ = PACK$(LEFT$(CURR.BOOTS.CODE$,6))
3089: 0437: 
3090: 0437:             ! Build current barcode chain
3091: 0437:             FOR I% = 1 TO (NO.OF.BC% - 1)
3092: 044b:                 IF I% = 1 THEN BEGIN
3093: 0460:                     IEF.BOOTS.CODE.BAR.CODE$ = PACKED.BC$ + IDF.SECOND.BAR.CODE$
3094: 048c:                     RC% = READ.IEF
3095: 04a7:                     IF RC% = 0 THEN BEGIN
3096: 04c6:                         DELETION.TABLE(I%) = IEF.BOOTS.CODE.BAR.CODE$
3097: 04f5:                         GOOD.CHAIN.COUNT% = GOOD.CHAIN.COUNT% + 1
3098: 0507:                     ENDIF ELSE BEGIN
3099: 050f:                         CALL DO.MESSAGE("PSB21 *** WARNING missing barcode chain on IEF", FALSE)
3100: 054e:                         CALL DO.MESSAGE("PSB21 *** WARNING BARCODE.PROCESSING at IUF Record: " + \
3101: 05a0:                             STR$(COUNT.RECORDS.IUF%), FALSE)
3102: 05a0:                         CALL DO.MESSAGE("PSB21 *** IEF.BOOTS.CODE.BAR.CODE$ [" + \
3103: 0601:                             UNPACK$(IEF.BOOTS.CODE.BAR.CODE$) + "]", FALSE)
3104: 0601:                     ENDIF
3105: 060c:                 ENDIF ELSE BEGIN
3106: 0614:                     IEF.BOOTS.CODE.BAR.CODE$ = PACKED.BC$ + IEF.NEXT.BAR.CODE$
3107: 0640:                     RC% = READ.IEF
3108: 065b:                     IF RC% = 0 THEN BEGIN
3109: 067a:                         DELETION.TABLE(I%) = IEF.BOOTS.CODE.BAR.CODE$
3110: 06a9:                         GOOD.CHAIN.COUNT% = GOOD.CHAIN.COUNT% + 1
3111: 06bb:                     ENDIF ELSE BEGIN
3112: 06c3:                         CALL DO.MESSAGE("PSB21 *** WARNING missing barcode chain on IEF", FALSE)
3113: 0702:                         CALL DO.MESSAGE("PSB21 *** WARNING BARCODE.PROCESSING at IUF Record: " + \
3114: 0754:                             STR$(COUNT.RECORDS.IUF%), FALSE)
3115: 0754:                         CALL DO.MESSAGE("PSB21 *** IEF.BOOTS.CODE.BAR.CODE$ [" + \
3116: 07b5:                             UNPACK$(IEF.BOOTS.CODE.BAR.CODE$) + "]", FALSE)
3117: 07b5:                     ENDIF
3118: 07bd:                 ENDIF
3119: 07c5:             NEXT I%
3120: 07f0: 
3121: 07f0:             FOR I% = GOOD.CHAIN.COUNT% TO 1 STEP -1
3122: 0808: 
3123: 0808:                 IEF.BOOTS.CODE.BAR.CODE$ = DELETION.TABLE(I%)
3124: 0837: 
3125: 0837:                 DELREC IEF.SESS.NUM%; IEF.BOOTS.CODE.BAR.CODE$
3126: 0856:             NEXT I%
3127: 0879:         ENDIF
3128: 0881:     ENDIF
3129: 0889: 
3130: 0889:  ADD.BARCODES:
3131: 0899: 
3132: 0899:     ! 1st barcode always defaults to Boots Code
3133: 0899:     IDF.FIRST.BAR.CODE$  = PACK$("000000" + LEFT$(CURR.BOOTS.CODE$,6))    ! 6 UPD
3134: 08d1:     IDF.SECOND.BAR.CODE$ = PACK$("000000000000")                          ! 6 UPD
3135: 08ed: 
3136: 08ed:     IF BARCODE.COUNT% > 0 THEN BEGIN
3137: 08ff:         IDF.SECOND.BAR.CODE$ = PACK$(BARCODE.TABLE$(1))
3138: 092e:     ENDIF
3139: 0936: 
3140: 0936:     ! Setup remaining barcodes if any
3141: 0936:     IF BARCODE.COUNT% > 1 THEN BEGIN
3142: 094b: 
3143: 094b:         !---------------------------------------------------
3144: 094b:         ! Write remaining records to the Item EAN File (IEF)
3145: 094b:         !---------------------------------------------------
3146: 094b:         FOR I% = 2 TO BARCODE.COUNT%
3147: 095f: 
3148: 095f:             IF I% = 2 THEN BEGIN
3149: 0971:                 BCREF$ = IDF.SECOND.BAR.CODE$
3150: 098f:             ENDIF ELSE BEGIN
3151: 0997:                 BCREF$ = IEF.NEXT.BAR.CODE$
3152: 09b3:             ENDIF
3153: 09bb: 
3154: 09bb: 
3155: 09bb:             IEF.BOOTS.CODE.BAR.CODE$ = PACK$(LEFT$(CURR.BOOTS.CODE$, 6)) + \
3156: 0a08:                                        BCREF$
3157: 0a08: 
3158: 0a08:             IEF.NEXT.BAR.CODE$ = PACK$(BARCODE.TABLE$(I%))
3159: 0a3c: 
3160: 0a3c:             RC% = WRITE.IEF
3161: 0a57: 
3162: 0a57:             IF RC% <> 0 THEN BEGIN
3163: 0a76:                 CALL LOG.EVENT(106)
3164: 0a9c:             ENDIF
3165: 0aa4: 
3166: 0aa4:         NEXT I%
3167: 0ace: 
3168: 0ace:         IEF.BOOTS.CODE.BAR.CODE$ = PACK$(LEFT$(CURR.BOOTS.CODE$, 6)) + \
3169: 0b36:                                    PACK$(BARCODE.TABLE$(I%-1))
3170: 0b36:         IEF.NEXT.BAR.CODE$ = PACK$("000000000000") ! Mark last barcode
3171: 0b52: 
3172: 0b52:         RC% = WRITE.IEF
3173: 0b6d: 
3174: 0b6d:         IF RC% <> 0 THEN BEGIN
3175: 0b8c:             CALL LOG.EVENT(106)
3176: 0bb2:         ENDIF
3177: 0bba:     ENDIF
3178: 0bc2: 
3179: 0bc2:     ! The barcode table excludes barcodes that match the item
3180: 0bc2:     ! code, therefore we need to add 1 to the barcode table count.
3181: 0bc2:     IDF.NO.OF.BAR.CODES$ = PACK$(RIGHT$("0000" + STR$(BARCODE.COUNT%+1),4))
3182: 0c12: 
3183: 0c12:     RC% = WRITE.IDF
3184: 0c2d:     IF RC% <> 0 THEN BEGIN
3185: 0c4c:         CALL LOG.EVENT(106)
3186: 0c72:     ENDIF
3187: 0c7a: 
3188: 0c7a:     ! IF the item status has changed                                        !DMW
3189: 0c7a:     IF ITEM.STATUS.CHANGED THEN BEGIN                                       !DMW
3190: 0c8f:                                                                             !DMW
3191: 0c8f:         STOCK.BOOTS.CODE$ = IDF.BOOTS.CODE$                                 !DMW
3192: 0cad:                                                                             !DMW
3193: 0cad:         RC% = READ.STOCK.LOCK                                               !DMW
3194: 0cc8:                                                                             !DMW
3195: 0cc8:         ! IF the STOCK read was successful                                  !DMW
3196: 0cc8:         IF RC% = 0 THEN BEGIN                                               !DMW
3197: 0cea:                                                                             !DMW
3198: 0cea:             ! Update the item status on the STOCK file                      !DMW
3199: 0cea:             STOCK.STATUS.1$ = CURR.STATUS.1$                                !DMW
3200: 0d08:                                                                             !DMW
3201: 0d08:             RC% = WRITE.STOCK.UNLOCK                                        !DMW
3202: 0d23:                                                                             !DMW
3203: 0d23:             ! IF the STOCK update failed                                    !DMW
3204: 0d23:             IF RC% <> 0 THEN BEGIN                                          !DMW
3205: 0d42:                 CALL DO.MESSAGE("PSB21 *** WARNING unable to update " + \   !DMW
3206: 0d93:                                 "STOCK item status for item: " +        \   !DMW
3207: 0d93:                                 CURR.BOOTS.CODE$,FALSE)                     !DMW
3208: 0d93:                 CALL LOG.EVENT(106)                                         !DMW
3209: 0db9:             ENDIF                                                           !DMW
3210: 0dc1:                                                                             !DMW
3211: 0dc1:         ENDIF                                                               !DMW
3212: 0dc9:                                                                             !DMW
3213: 0dc9:     ENDIF                                                                   !DMW
3214: 0dd1: 
3215: 0dd1:     RC% = UPDATE.ALL.IRF.BAR.CODES(CURR.BOOTS.CODE$)
3216: 0dfe: 
3217: 0dfe:     IF RC% <> 0 THEN BEGIN                                     ! 1.14 RC (200)
3218: 0e1d:         CALL DO.MESSAGE("PSB21 *** ERROR in PSBF41 " + \       ! 1.14 RC (200)
3219: 0e6e:                         "updating IRF barcodes for item: " + \ ! 1.14 RC (200)
3220: 0e6e:                          CURR.BOOTS.CODE$, FALSE)              ! 1.14 RC (200)
3221: 0e6e:         JOBSOK.FLAG$ = "Y"                                     ! 1.14 RC (200)
3222: 0e85:         EXIT SUB                                               ! 1.14 RC (200)
3223: 0e90:     ENDIF                                                      ! 1.14 RC (200)
3224: 0e98: 
3225: 0e98:     EXIT SUB
3226: 0ea3: 
3227: 0ea3:  BARCODE.ERROR:
3228: 0eb3: 
3229: 0eb3:     IF DELETING.IEF.CHAIN THEN BEGIN
3230: 0ec5:         CALL DO.MESSAGE("PSB21 *** WARNING skipping IEF barcode chain deletion", FALSE)
3231: 0f04:         CALL DO.MESSAGE("PSB21 *** WARNING adding new barcodes for item", FALSE)
3232: 0f43:         RESUME ADD.BARCODES
3233: 0f5c:     ENDIF ELSE BEGIN
3234: 0f64:         CALL DO.MESSAGE("PSB21 *** ERROR unable to update IDF/IEF barcode chain for item: " + \
3235: 0fb1:                          CURR.BOOTS.CODE$, FALSE)
3236: 0fb1:         EXIT SUB
3237: 0fbb:     ENDIF
3238: 0fc3: 
3239: 0fc3: END SUB
3240: 0fd7: 
3241: 0fd7: 
3242: 0fd7: \******************************************************************************
3243: 0fd7: \***
3244: 0fd7: \***    CHECK.FOR.PRICE.MISMATCH
3245: 0fd7: \***
3246: 0fd7: \******************************************************************************
3247: 0fd7: 
3248: 0fd7: FUNCTION CHECK.FOR.PRICE.MISMATCH PUBLIC ! Entire function new for Rv 1.12 RC
3249: 0ffb: 
3250: 0ffb:     INTEGER*1 CHECK.FOR.PRICE.MISMATCH
3251: 0ffb: 
3252: 0ffb:     INTEGER*1 CIPPM.ITEM.FOUND
3253: 0ffb: 
3254: 0ffb: 
3255: 0ffb:     CHECK.FOR.PRICE.MISMATCH = FALSE
3256: 100d: 
3257: 100d: 
3258: 100d: !   If IRF Local Price flag ON check LOCAL for price mis-match with IUF
3259: 100d:     IF (IRF.INDICAT3% AND 20h) = 20h THEN BEGIN ! Local Price ON
3260: 1025: 
3261: 1025:         LOCAL.ITEM.CODE$ = PACK$(RIGHT$("00000000" + CURR.BOOTS.CODE$, 8))
3262: 1065: 
3263: 1065:         IF READ.LOCAL = 0 THEN BEGIN ! Item found
3264: 1077: 
3265: 1077:             IF VAL(UNPACK$(LOCAL.H.O.PRICE$)) <> VAL(CURR.CURRENT.PRICE$) THEN BEGIN
3266: 10c3:                 CHECK.FOR.PRICE.MISMATCH = TRUE
3267: 10d5:             ENDIF
3268: 10dd: 
3269: 10dd:             EXIT FUNCTION
3270: 10ea: 
3271: 10ea:         ENDIF ELSE BEGIN ! Item not found
3272: 10f2: 
3273: 10f2: !           If item not on LOCAL file then correct IRF flag
3274: 10f2: !           (ahead of WRITE.IRF within BARCODE.PROCESSING)
3275: 10f2: !           and allow remaining price checks to be done
3276: 10f2:             IRF.INDICAT3% = IRF.INDICAT3% AND 11011111B ! Set bit X'20' OFF
3277: 110a: 
3278: 110a:         ENDIF
3279: 1112: 
3280: 1112:     ENDIF
3281: 111a: 
3282: 111a: 
3283: 111a: !   If IDF Markdown flag ON then check CIPPM for price mis-match with IUF
3284: 111a:     IF (IDF.BIT.FLAGS.1% AND 20h) = 20h THEN BEGIN ! Markdown ON
3285: 1132: 
3286: 1132:         CIPPM.ITEM.FOUND = FALSE
3287: 1144: 
3288: 1144:         IF CIPPM.PRESENT THEN BEGIN                            ! 1.15 RC (226)
3289: 1159: 
3290: 1159:             WHILE NOT CIPPM.ITEM.FOUND
3291: 1164: 
3292: 1164:                 IF END # CIPPM.SESS.NUM% THEN IF.END.CIPPM
3293: 1180:                 READ # CIPPM.SESS.NUM%; LINE CIPPM.RCD$
3294: 11a1: 
3295: 11a1:                 IF LEFT$(CIPPM.RCD$,8) = "R" + RIGHT$(CURR.BOOTS.CODE$, 7) THEN BEGIN
3296: 11f0:                     CIPPM.ITEM.FOUND = TRUE
3297: 1202:                 ENDIF
3298: 120a: 
3299: 120a:             WEND
3300: 121c: 
3301: 121c: IF.END.CIPPM:
3302: 122c: 
3303: 122c: !           Reset file pointer to start of file for future usage
3304: 122c:             POINT CIPPM.SESS.NUM%; 0
3305: 1248: 
3306: 1248:         ENDIF                                                  ! 1.15 RC (226)
3307: 1250: 
3308: 1250:         IF CIPPM.ITEM.FOUND THEN BEGIN
3309: 1262: 
3310: 1262:             IF VAL(MID$(CIPPM.RCD$, 17, 8)) <> VAL(CURR.CURRENT.PRICE$) THEN BEGIN
3311: 12b2:                 CHECK.FOR.PRICE.MISMATCH = TRUE
3312: 12c4:             ENDIF
3313: 12cc: 
3314: 12cc:             EXIT FUNCTION
3315: 12d9: 
3316: 12d9:         ENDIF ELSE BEGIN
3317: 12e1: 
3318: 12e1: !           If item not on CIPPM file then correct the IDF flag
3319: 12e1: !           (ahead of WRITE.IDF within BARCODE.PROCESSING)
3320: 12e1: !           and allow remaining price check to be done
3321: 12e1: !           IDF flag is also corrected when CIPPM file is      ! 1.15 RC (226)
3322: 12e1: !           not present (eg, store not on CIP markdown)        ! 1.15 RC (226)
3323: 12e1:             IDF.BIT.FLAGS.1% = IDF.BIT.FLAGS.1% AND 11011111b ! Markdown X'20' OFF
3324: 12f9: 
3325: 12f9:         ENDIF
3326: 1301: 
3327: 1301:     ENDIF
3328: 1309: 
3329: 1309: 
3330: 1309: !   If item not on LOCAL or CIP Markdown check IRF for price mis-match with IUF
3331: 1309: 
3332: 1309:     IF VAL(UNPACK$(IRF.SALEPRIC$)) <> VAL(CURR.CURRENT.PRICE$) THEN BEGIN
3333: 1355:         CHECK.FOR.PRICE.MISMATCH = TRUE
3334: 1367:     ENDIF
3335: 136f: 
3336: 136f: 
3337: 136f: END FUNCTION
3338: 1386: 
3339: 1386: 
3340: 1386: \******************************************************************************
3341: 1386: \***
3342: 1386: \***    UPDATE.ISF
3343: 1386: \***
3344: 1386: \******************************************************************************
3345: 1386: \***
3346: 1386: \***    Updates ISF - Item Shelf Edge Label File for the specified item
3347: 1386: \***
3348: 1386: \******************************************************************************
3349: 1386: SUB UPDATE.ISF
3350: 13aa: 
3351: 13aa:     ISF.BOOTS.CODE$ = PACK$("0" + CURR.BOOTS.CODE$) !4-bytes UPD
3352: 13d9: 
3353: 13d9:     RC% = READ.ISF ! Sets ISF.SEL.PRINTED.FLAG$ from current value            ! 1.5 RC (51)
3354: 13f4: 
3355: 13f4:     IF RC% <> 0 THEN BEGIN ! Existing item with no ISF record                 ! 1.5 RC (51)
3356: 1413:                            ! or completely new item                           ! 1.5 RC (51)
3357: 1413:         ISF.SEL.PRINTED.FLAG$ = "N"                                           ! 1.5 RC (51)
3358: 142a: !       No event 106 logged since new ISF record is being created             ! 1.5 RC (51)
3359: 142a:     ENDIF                                                                     ! 1.5 RC (51)
3360: 1432: 
3361: 1432: !   Save data from READ.ISF (even if null or blank)            ! 1.13 RC (179)
3362: 1432:     READ.ISF.S.E.DESC$         = ISF.S.E.DESC$                 ! 1.13 RC (179)
3363: 1450:     READ.ISF.ITEM.QTY$         = ISF.ITEM.QTY$                 ! 1.13 RC (179)
3364: 146e:     READ.ISF.UNIT.MEASUREMENT$ = ISF.UNIT.MEASUREMENT$         ! 1.13 RC (179)
3365: 148c:     READ.ISF.UNIT.NAME$        = ISF.UNIT.NAME$                ! 1.13 RC (179)
3366: 14aa: 
3367: 14aa:     ISF.S.E.DESC$   = LEFT$(CURR.S.E.DESC$ + STRING$(45, " "),45)
3368: 14f9: 
3369: 14f9:     ITEM.ON.WEEE.TABLE = FALSE
3370: 150f: 
3371: 150f:     IF WEEE.ITEM.COUNT% > 0 THEN BEGIN  ! Check if item is present on the WEEE table
3372: 1524: 
3373: 1524:         FOR I% = 1 TO WEEE.ITEM.COUNT%
3374: 1538: 
3375: 1538:             IF CURR.BOOTS.CODE$ = LEFT$(WEEEUF.TABLE$(I%),7) THEN BEGIN
3376: 157a:                 ITEM.ON.WEEE.TABLE = TRUE
3377: 1590:                 WIX% = I%
3378: 15a6:             ENDIF
3379: 15ae: 
3380: 15ae:             ! Jump out if found Nb. WEEE Table in ascending item code order
3381: 15ae:             IF ITEM.ON.WEEE.TABLE = TRUE OR \
3382: 1612:               CURR.BOOTS.CODE$ < LEFT$(WEEEUF.TABLE$(I%),7) THEN BEGIN
3383: 1612:                 I% = WEEE.ITEM.COUNT% + 1
3384: 1629:             ENDIF
3385: 1631: 
3386: 1631:         NEXT I%
3387: 165b: 
3388: 165b:     ENDIF
3389: 1663: 
3390: 1663:     IF ITEM.ON.WEEE.TABLE THEN BEGIN
3391: 1678: 
3392: 1678:         IRF.INDICAT8% = IRF.INDICAT8%  OR 10000000B  !Set   bit 8 WEEE Item
3393: 1690:         !-----------------------
3394: 1690:         !    ISF WEEE Setup
3395: 1690:         !-----------------------
3396: 1690:         ISF.UNIT.NAME$        = "WEEE      "                                                 ! 10-bytes
3397: 16a7:         ISF.ITEM.QTY$         = PACK$(RIGHT$("00000000" + RIGHT$(WEEEUF.TABLE$(WIX%),4), 8)) ! 4-bytes UPD
3398: 170a:         ISF.UNIT.MEASUREMENT$ = PACK$("0000")                                                ! 2-bytes UPD
3399: 1729: 
3400: 1729:     ENDIF ELSE BEGIN
3401: 1731:         IRF.INDICAT8% = IRF.INDICAT8% AND 01111111B  !Clear bit 8  Non-WEEE Item
3402: 1749: 
3403: 1749:         ISF.ITEM.QTY$         = PACK$(RIGHT$("00000000" + CURR.ITEM.QTY$, 8))    ! 4-bytes UPD
3404: 1789:         ISF.UNIT.MEASUREMENT$ = PACK$(RIGHT$("0000" + CURR.UNIT.MEASUREMENT$,4)) ! 2-bytes UPD
3405: 17c9:         ISF.UNIT.NAME$        = LEFT$(CURR.UNIT.NAME$ + STRING$(10," "),10)      ! 10-bytes
3406: 1818: 
3407: 1818:     ENDIF
3408: 1820: 
3409: 1820: !   Set SEL.NON.PRICE.CHANGE flag if non-price-change requires SEL printing      ! 1.13 RC (179)
3410: 1820: !   (note that this flag is not checked/used when item is new)                   ! 1.13 RC (179)
3411: 1820:     IF   ISF.S.E.DESC$         <> READ.ISF.S.E.DESC$ \                           ! 1.13 RC (179)
3412: 18de:       OR ISF.ITEM.QTY$         <> READ.ISF.ITEM.QTY$ \                           ! 1.13 RC (179)
3413: 18de:       OR ISF.UNIT.MEASUREMENT$ <> READ.ISF.UNIT.MEASUREMENT$ \                   ! 1.13 RC (179)
3414: 18de:       OR ISF.UNIT.NAME$        <> READ.ISF.UNIT.NAME$ THEN BEGIN                 ! 1.13 RC (179)
3415: 18de:         SEL.NON.PRICE.CHANGE = TRUE                                              ! 1.13 RC (179)
3416: 18f4:     ENDIF                                                                        ! 1.13 RC (179)
3417: 18fc: 
3418: 18fc: !   ISF.SEL.PRINTED.FLAG$ now set earlier in procedure                           ! 1.5 RC (51)
3419: 18fc: 
3420: 18fc:     RC% = WRITE.ISF
3421: 1917:     IF RC% <> 0 THEN BEGIN
3422: 1936:         CALL LOG.EVENT(106)
3423: 195c:     ENDIF
3424: 1964: 
3425: 1964: END SUB
3426: 1978: 
3427: 1978: 
3428: 1978: !   SUB UPDATE.LOCAL deleted                                    ! 1.7 RC (113)
3429: 1978: 
3430: 1978: 
3431: 1978: \******************************************************************************
3432: 1978: \***
3433: 1978: \***    UPDATE.CIPPM
3434: 1978: \***
3435: 1978: \******************************************************************************
3436: 1978: 
3437: 1978: FUNCTION UPDATE.CIPPM(CIP.ITEM$, REV.PRICE$) PUBLIC             ! 1.11 RC (172)
3438: 19a6: 
3439: 19a6:     INTEGER*1 COMPLETE
3440: 19a6:     INTEGER*1 UPDATE.CIPPM
3441: 19a6:     INTEGER*2 L%
3442: 19a6:     INTEGER*4 POINTER%
3443: 19a6:     INTEGER*4 POS%
3444: 19a6:     STRING    CIPPM.DATA$
3445: 19a6:     STRING    CIP.ITEM$                                         ! 1.11 RC (172)
3446: 19a6:     STRING    REV.PRICE$                                        ! 1.10 RC (113)
3447: 19a6: 
3448: 19a6:     ON ERROR GOTO FUNCTION.ERROR
3449: 19bb: 
3450: 19bb:     UPDATE.CIPPM = 1                       ! Line re-positioned ! 1.15 RC (226)
3451: 19c7: 
3452: 19c7: !   Cater for stores with no CIPPMR (eg, not on CIP markdown)   ! 1.15 RC (226)
3453: 19c7:     IF NOT CIPPM.PRESENT THEN BEGIN                             ! 1.15 RC (226)
3454: 19d9: !       If CIPPMR not present then correct the IDF flag         ! 1.15 RC (226)
3455: 19d9: !       Set IDF Markdown flag OFF and update IDF                ! 1.15 RC (226)
3456: 19d9:         IDF.BIT.FLAGS.1% = \                                    ! 1.15 RC (226)
3457: 19f1:           IDF.BIT.FLAGS.1% AND 11011111b ! Markdown X'20' OFF   ! 1.15 RC (226)
3458: 19f1: !       IDF will have been read from PROCESS.BTREE.RECORD$      ! 1.15 RC (226)
3459: 19f1: !       prior to call UPDATE.CIPPM so write unlikely to fail    ! 1.15 RC (226)
3460: 19f1: !       IF write does fail do not abend program as next run     ! 1.15 RC (226)
3461: 19f1: !       will re-attempt correction                              ! 1.15 RC (226)
3462: 19f1:         CALL WRITE.IDF                                          ! 1.15 RC (226)
3463: 19fe:         EXIT FUNCTION                                           ! 1.15 RC (226)
3464: 1a09:     ENDIF                                                       ! 1.15 RC (226)
3465: 1a11: 
3466: 1a11:       COMPLETE = FALSE                      ! Line re-positoned ! 1.15 RC (226)
3467: 1a23: 
3468: 1a23:       WHILE NOT COMPLETE
3469: 1a2e:            IF END # CIPPM.SESS.NUM% THEN NO.CIPPM.RECORD
3470: 1a4a:            READ #CIPPM.SESS.NUM%; LINE CIPPM.RCD$
3471: 1a6b:            POINTER% = PTRRTN !Start of record pointer saved to use in direct write
3472: 1a85:            IF LEFT$(CIPPM.RCD$,8) = "R" + CIP.ITEM$ THEN BEGIN  ! 1.11 RC (172)
3473: 1acb:                  CLOSE CIPPM.SESS.NUM%
3474: 1adf:                  OPEN CIPPM.FILE.NAME$ DIRECT RECL 1 AS CIPPM.SESS.NUM% LOCKED
3475: 1b06: !                Update CIPPMR Reversals Price                                                 ! 1.10 RC (113)
3476: 1b06:                  FOR L% = 1 TO 8
3477: 1b16:                       WRITE FORM "C1"; #CIPPM.SESS.NUM%, POINTER%+16+L%; MID$(REV.PRICE$,L%,1) ! 1.10 RC (113)
3478: 1b6a:                  NEXT L%
3479: 1b80:                  COMPLETE        = TRUE
3480: 1b92:                  UPDATE.CIPPM    = 0
3481: 1b9e:            ENDIF
3482: 1ba6:       WEND
3483: 1bb8: 
3484: 1bb8: LEAVE.HERE:
3485: 1bc8: NO.CIPPM.RECORD:
3486: 1bd8: 
3487: 1bd8:             IF NOT COMPLETE THEN BEGIN
3488: 1be7:                 POINT CIPPM.SESS.NUM%;0
3489: 1c03: !               Item not on CIPPMR so Markdown flag wrong              ! 1.9 RC (109)
3490: 1c03: !               Set IDF Markdown flag OFF and update IDF               ! 1.9 RC (109) ! 1.15 RC
3491: 1c03:                 IDF.BIT.FLAGS.1% = \                                   ! 1.9 RC (109)
3492: 1c1b:                   IDF.BIT.FLAGS.1% AND 11011111b ! Markdown X'20' OFF  ! 1.9 RC (109)
3493: 1c1b: !               IDF will have been read from PROCESS.BTREE.RECORD$     ! 1.1O RC (113)
3494: 1c1b: !               prior to call UPDATE.CIPPM so write unlikely to fail   ! 1.1O RC (113)
3495: 1c1b: !               IF write does fail do not abend program as next run    ! 1.1O RC (113)
3496: 1c1b: !               will re-attempt correction                             ! 1.10 RC (113)
3497: 1c1b:                 CALL WRITE.IDF                                         ! 1.10 RC (113)
3498: 1c2a:             ENDIF ELSE BEGIN
3499: 1c32:                 CLOSE CIPPM.SESS.NUM%
3500: 1c46:                 OPEN CIPPM.FILE.NAME$ AS CIPPM.SESS.NUM% LOCKED
3501: 1c6d:             ENDIF
3502: 1c75:             EXIT FUNCTION
3503: 1c80: 
3504: 1c80: FUNCTION.ERROR:
3505: 1c90: 
3506: 1c90:     ! LOG EVENT THEN LEAVE.
3507: 1c90:     CALL DO.MESSAGE("PSB21 *** ERROR processing CIPPM file", FALSE)
3508: 1ccf:     CALL LOG.EVENT(106)
3509: 1cf5:     RESUME LEAVE.HERE
3510: 1d0c: 
3511: 1d0c: END FUNCTION
3512: 1d2d: 
3513: 1d2d: 
3514: 1d2d: \******************************************************************************
3515: 1d2d: \***
3516: 1d2d: \***    UPDATE.IRF
3517: 1d2d: \***
3518: 1d2d: \******************************************************************************
3519: 1d2d: \***
3520: 1d2d: \***    Updates IRF - Item Reference File for the specified item
3521: 1d2d: \***
3522: 1d2d: \******************************************************************************
3523: 1d2d: SUB UPDATE.IRF
3524: 1d51: 
3525: 1d51:     INTEGER*2 COMMA.OFFSET%
3526: 1d51:     INTEGER*2 RB.OFF%
3527: 1d51:     STRING    BCF.MARKER$
3528: 1d51: 
3529: 1d51: !   UPDATE.IRF populates IRF variables and updates IRF with an initial record      ! 1.14 RC (200)
3530: 1d51: !   This IRF record is read later by PSBF41 during UPDATE.ALL.IRF.BAR.CODES.       ! 1.14 RC (200)
3531: 1d51: !   PSBF41 sets IRF.BAR.CODE$ from the item code and non-group-code prefix ...     ! 1.14 RC (200)
3532: 1d51: !     IRF.BAR.CODE$ = PACK$(STRING$(16,"0")) + PACK$(LEFT$(UPDATE.ITEM.CODE$,6))   ! 1.14 RC (200)
3533: 1d51: !   Therefore UPDATE.IRF must use this barcode on the IRF record it creates.       ! 1.14 RC (200)
3534: 1d51: !   Note that UPDATE.IRF calls WRITE.IRF as opposed to PSBF19 UPDT.IRF because     ! 1.14 RC (200)
3535: 1d51: !   the latter is called by PSBF41 and re-updates the initial IRF record.          ! 1.14 RC (200)
3536: 1d51: 
3537: 1d51: !   IF CURR.GRP.CODE.FLAG$ = "N" THEN BEGIN                                        ! 1.14 RC (200)
3538: 1d51:         IRF.BAR.CODE$ = PACK$(STRING$(16, "0") + LEFT$(CURR.BOOTS.CODE$, 6))
3539: 1d9b: !   ENDIF ELSE BEGIN                                                               ! 1.14 RC (200)
3540: 1d9b: !       IRF.BAR.CODE$ = PACK$("2" + STRING$(15, "0") + LEFT$(CURR.BOOTS.CODE$, 6)) ! 1.14 RC (200)
3541: 1d9b: !   ENDIF                                                                          ! 1.14 RC (200)
3542: 1d9b: 
3543: 1d9b:     RC% = READ.IRF
3544: 1db6:     IF RC% <> 0 THEN BEGIN
3545: 1dd8: !       Main item-barcode IRF record does not exist                           ! 1.14 RC (200)
3546: 1dd8: !       Debugger investigation indicates a previous items data may sometimes  ! 1.14 RC (200)
3547: 1dd8: !       be retained within the IRF variables when the IRF READ fails          ! 1.14 RC (200)
3548: 1dd8: !       In this case initialise all IRF variables unless specifically set     ! 1.14 RC (200)
3549: 1dd8: !       later within UPDATE.IRF                                               ! 1.14 RC (200)
3550: 1dd8: 
3551: 1dd8: !       IRF.BAR.CODE$         ! Set prior to READ.IRF                         ! 1.14 RC (200)
3552: 1dd8:         IRF.INDICAT0%     = 0                                                 ! 1.14 RC (200)
3553: 1de8:         IRF.INDICAT1%     = 0                                                 ! 1.14 RC (200)
3554: 1df8: !       IRF.DEAL.DATA(0)  = 0 ! Set via IRF.DEAL.NUM% and IRF.LIST.ID%        ! 1.14 RC (200)
3555: 1df8:         IRF.INDICAT8%     = 0                                                 ! 1.14 RC (200)
3556: 1e08:         IRF.INDICAT9%     = 0                                                 ! 1.14 RC (200)
3557: 1e18:         IRF.INDICAT10%    = 0                                                 ! 1.14 RC (200)
3558: 1e28:         IRF.SALEPRIC$ = PACK$(RIGHT$("0000000000" + CURR.CURRENT.PRICE$, 10)) ! 1.14 RC (200)
3559: 1e68:         IRF.INDICAT5%     = 0                                                 ! 1.14 RC (200)
3560: 1e78: !       IRF.ITEMNAME$         ! Set later within UPDATE.IRF                   ! 1.14 RC (200)
3561: 1e78: !       IRF.BOOTS.CODE$       ! Set later within UPDATE.IRF                   ! 1.14 RC (200)
3562: 1e78: !       IRF.DEAL.DATA%(1) = 0 ! Set via IRF.DEAL.NUM% and IRF.LIST.ID%        ! 1.14 RC (200)
3563: 1e78: !       IRF.DEAL.DATA%(2) = 0 ! Set via IRF.DEAL.NUM% and IRF.LIST.ID%        ! 1.14 RC (200)
3564: 1e78:         IRF.INDICAT3%     = 0                                                 ! 1.14 RC (200)
3565: 1e88: 
3566: 1e88:         FOR K% = 0 TO IRF.MAX.DEALS% - 1                                      ! 1.14 RC (200)
3567: 1e9b:             IRF.DEAL.NUM$(K%) = PACK$("0000")                                 ! 1.14 RC (200)
3568: 1ec8:             IRF.LIST.ID%(K%)  = 0                                             ! 1.14 RC (200)
3569: 1ee9:         NEXT K%                                                               ! 1.14 RC (200)
3570: 1f11: 
3571: 1f11: !       Set Item Movement flag ON as is done for completely new item          ! 1.14 RC (200)
3572: 1f11:         IRF.INDICAT0% = IRF.INDICAT0%  OR 10000000B ! Item movement ON        ! 1.14 RC (200)
3573: 1f2b: 
3574: 1f2b:     ENDIF ELSE BEGIN
3575: 1f33: !       Redundant line removed                                                ! 1.14 RC (200)
3576: 1f33:         IF NOT IUF.NEW.FORMAT THEN BEGIN ! Legacy IUF                         ! 1.6 RC (71)
3577: 1f45: !           For legacy IUF ...                                                ! 1.6 RC (71)
3578: 1f45: !           READ.IUF sets IUF.UNRESTRICTED.GROUP.CODE$ to default value "N"   ! 1.6 RC (71)
3579: 1f45: !           This is fine for a new item but for an existing item set the      ! 1.6 RC (71)
3580: 1f45: !           value to "Y" if so set on the IRF record (ie, retain IRF value)   ! 1.6 RC (71)
3581: 1f45:             IF (IRF.INDICAT8% AND 00000100B) = 00000100B THEN BEGIN           ! 1.6 RC (71)
3582: 1f5a:                 CURR.UNRESTRICTED.GROUP.CODE$ = "Y"                           ! 1.6 RC (71)
3583: 1f71:             ENDIF                                                             ! 1.6 RC (71)
3584: 1f79:         ENDIF                                                                 ! 1.6 RC (71)
3585: 1f81:     ENDIF
3586: 1f89: 
3587: 1f89:     !--------------------------------------------------
3588: 1f89:     !                     INDICAT 0
3589: 1f89:     !--------------------------------------------------
3590: 1f89:     IF NEW.ITEM THEN BEGIN
3591: 1f9b:         IRF.INDICAT0% = IRF.INDICAT0%  OR 10000000B  !Set   bit 8 Item movement kept
3592: 1fb3:         IRF.INDICAT0% = IRF.INDICAT0% AND 10111111B  !Clear bit 7 Enforced Price entry
3593: 1fcb:     ENDIF
3594: 1fd3: 
3595: 1fd3:     !Set bit 7 (Enforced quantity entry flag) for group restricted items!GRN
3596: 1fd3: 
3597: 1fd3:     IF CURR.RESTRICT.SALES.FLAG$ = "Y" THEN BEGIN                       !GRN
3598: 1ff1:         IRF.INDICAT0% = IRF.INDICAT0% OR 01000000B                      !GRN
3599: 200b: 
3600: 200b:     ENDIF ELSE BEGIN                                                    !GRN
3601: 2013: 
3602: 2013:         !If the bit 7 is already set then reset this flag; as the item  !GRN
3603: 2013:         !is now configured as an unrestricted item.                     !GRN
3604: 2013: 
3605: 2013:         IF IRF.INDICAT0% AND 01000000B THEN BEGIN                       !GRN
3606: 2026:             IRF.INDICAT0% = IRF.INDICAT0% AND 10111111B                 !GRN
3607: 203e:         ENDIF                                                           !GRN
3608: 2046:     ENDIF                                                               !GRN
3609: 204e: 
3610: 204e:     IF CURR.ENF.PRICE.ENTRY$ = "Y" THEN BEGIN
3611: 206c:         IRF.INDICAT0% = IRF.INDICAT0%  OR 00100000B  !Set   bit 6 Enforced Item entry
3612: 2086:     ENDIF ELSE BEGIN
3613: 208e:         IRF.INDICAT0% = IRF.INDICAT0% AND 11011111B  !Clear bit 6
3614: 20a6:     ENDIF
3615: 20ae: 
3616: 20ae:     IF MATCH("RECALL IS ACTIVE",SOFTS.REC.62$,1) THEN BEGIN !NB. Rec 62 contains >1 ACTIVE/line
3617: 20d3:         IF CURR.BLOCKED.FROM.SALE$ = "R" AND IUF.NEW.FORMAT THEN BEGIN      !On RECALL
3618: 2104:             IRF.INDICAT0% = IRF.INDICAT0%  OR 00010000B  !Set   bit 5 Blocked from sale due to recall
3619: 211e:         ENDIF ELSE BEGIN
3620: 2126:             IRF.INDICAT0% = IRF.INDICAT0% AND 11101111B  !Clear bit 5
3621: 213e:         ENDIF
3622: 2148:     ENDIF ELSE BEGIN
3623: 2150:         IF NEW.ITEM THEN BEGIN
3624: 2162:             IRF.INDICAT0% = IRF.INDICAT0% AND 11101111B  !Clear bit 5
3625: 217a:         ENDIF
3626: 2182:     ENDIF
3627: 218a: 
3628: 218a:     IF CURR.CONTAINS.ALCOHOL$ = "Y" THEN BEGIN
3629: 21a8:         IRF.INDICAT0% = IRF.INDICAT0%  OR 00001000B  !Set   bit 4 Alcohol flag
3630: 21c2:     ENDIF ELSE BEGIN
3631: 21ca:         IRF.INDICAT0% = IRF.INDICAT0% AND 11110111B  !Clear bit 4
3632: 21e2:     ENDIF
3633: 21ea: 
3634: 21ea:     IF NEW.ITEM THEN BEGIN
3635: 21fc:         IRF.INDICAT0% = IRF.INDICAT0% AND 11111011B  !Clear bit 3 Returnable
3636: 2214:     ENDIF
3637: 221c: 
3638: 221c:     !IF CURR.RETURNABLE$ = "N" THEN BEGIN                                 ! BCSk
3639: 221c:     !    IRF.INDICAT0% = IRF.INDICAT0%  OR 00000100B  !Set   bit 3 Not    ! BCSk
3640: 221c:     !                                                 ! returnable        ! BCSk
3641: 221c:     !ENDIF                                                                ! BCSk
3642: 221c: 
3643: 221c:     !-----------------------------------------------------                ! BCSk
3644: 221c:     ! If the item's product group is in the list of Gift                  ! BCSk
3645: 221c:     ! Card Mall product groups, then override the settings                ! BCSk
3646: 221c:     !-----------------------------------------------------                ! BCSk
3647: 221c:     IF MATCH(CURR.PROD.GRP$, GCM.PG.LIST$, 1) <> 0 THEN BEGIN             ! CCSk
3648: 2246:         CURR.GIFTCARD$   = "Y"                                            ! BCSk
3649: 225d:         IRF.INDICAT0% = IRF.INDICAT0%  OR 00000100B  !Set   bit 3 Not     ! BCSk
3650: 2275:                                                      ! returnable         ! BCSk
3651: 2275:     ENDIF                                                                 ! BCSk
3652: 227d: 
3653: 227d: 
3654: 227d:     IF CURR.GIVEAWAY$ = "Y" THEN BEGIN
3655: 229b:         IRF.INDICAT0% = IRF.INDICAT0%  OR 00000010B  !Set   bit 2 Giveaway flag
3656: 22b5:     ENDIF ELSE BEGIN
3657: 22bd:         IRF.INDICAT0% = IRF.INDICAT0% AND 11111101B  !Clear bit 2
3658: 22d5:     ENDIF
3659: 22dd: 
3660: 22dd: 
3661: 22dd:     IRF.INDICAT0% = IRF.INDICAT0% AND 11111110B  !Clear bit 1 Statins flag       !1.5CSk(a)
3662: 22f5:     IF NO.OF.STATINS% > 0 THEN BEGIN                                             !1.5CSk(a)
3663: 230a:         FOR J% = 1 TO NO.OF.STATINS%                                             !1.5CSk(a)
3664: 231d:             IF MATCH(STATINS$(J%),CURR.STNDRD.DESC$,1) THEN BEGIN                !1.5CSk(a)
3665: 2357:                 !Set bit 1 Statins flag                                          !1.5CSk(a)
3666: 2357:                 IRF.INDICAT0% = IRF.INDICAT0%  OR 00000001B                      !1.5CSk(a)
3667: 236f:             ENDIF                                                                !1.5CSk(a)
3668: 2377:         NEXT J%                                                                  !1.5CSk(a)
3669: 23a1:     ENDIF                                                                        !1.5CSk(a)
3670: 23a9: 
3671: 23a9:     !--------------------------------------------------
3672: 23a9:     !                     INDICAT 1
3673: 23a9:     !--------------------------------------------------
3674: 23a9:     IF CURR.CONTAINS.IBUPROFEN$ = "Y" THEN BEGIN
3675: 23c7:         IRF.INDICAT1% = IRF.INDICAT1%  OR 10000000B  !Set   bit 8 Ibuprofen flag
3676: 23e1:     ENDIF ELSE BEGIN
3677: 23e9:         IRF.INDICAT1% = IRF.INDICAT1% AND 01111111B  !Clear bit 8
3678: 2401:     ENDIF
3679: 2409: 
3680: 2409:     IF CURR.INSURANCE$ = "Y" THEN BEGIN
3681: 2427:         IRF.INDICAT1% = IRF.INDICAT1%  OR 01000000B  !Set   bit 7 Insurance flag
3682: 2441:     ENDIF ELSE BEGIN
3683: 2449:         IRF.INDICAT1% = IRF.INDICAT1% AND 10111111B  !Clear bit 7
3684: 2461:     ENDIF
3685: 2469: 
3686: 2469:     IF CURR.CONTAINS.NONSOLID.PAINKILLER$ = "Y" THEN BEGIN
3687: 2487:         IRF.INDICAT1% = IRF.INDICAT1%  OR 00100000B  !Set   bit 6 Non-solid painkiller flag
3688: 24a1:     ENDIF ELSE BEGIN
3689: 24a9:         IRF.INDICAT1% = IRF.INDICAT1% AND 11011111B  !Clear bit 6
3690: 24c1:     ENDIF
3691: 24c9: 
3692: 24c9:     !Use data from previous SOFTS read
3693: 24c9:     IF MATCH("WITHDRAWN IS ACTIVE",SOFTS.REC.62$,1) THEN BEGIN !NB. Rec 62 contains >1 ACTIVE/line
3694: 24ee:         IF CURR.BLOCKED.FROM.SALE$ = "W" AND IUF.NEW.FORMAT THEN BEGIN      ! Withdrawn
3695: 251f:             IRF.INDICAT1% = IRF.INDICAT1%  OR 00010000B  !Set   bit 5 Item withdrawn from sale
3696: 2539:         ENDIF ELSE BEGIN
3697: 2541:             IRF.INDICAT1% = IRF.INDICAT1% AND 11101111B  !Clear bit 5
3698: 2559:         ENDIF
3699: 2563:     ENDIF ELSE BEGIN
3700: 256b:         IF NEW.ITEM THEN BEGIN
3701: 257d:             IRF.INDICAT1% = IRF.INDICAT1% AND 11101111B  !Clear bit 5
3702: 2595:         ENDIF
3703: 259d:     ENDIF
3704: 25a5: 
3705: 25a5:     IF CURR.GIFTCARD$ = "Y" THEN BEGIN
3706: 25c3:         IRF.INDICAT1% = IRF.INDICAT1%  OR 00001000B  !Set   bit 4 Giftcard flag
3707: 25dd:     ENDIF ELSE BEGIN
3708: 25e5:         IRF.INDICAT1% = IRF.INDICAT1% AND 11110111B  !Clear bit 4
3709: 25fd:     ENDIF
3710: 2605: 
3711: 2605:     IF NEW.ITEM THEN BEGIN
3712: 2617:         IRF.INDICAT1% = IRF.INDICAT1%  AND 11111011B  !Clear bit 3 TPLU inclusion
3713: 262f:     ENDIF
3714: 2637: 
3715: 2637:     IF CURR.CONTAINS.PARACETAMOL$ = "Y" THEN BEGIN
3716: 2655:         IRF.INDICAT1% = IRF.INDICAT1%  OR 00000010B  !Set   bit 2 Paracetamol flag
3717: 266f:     ENDIF ELSE BEGIN
3718: 2677:         IRF.INDICAT1% = IRF.INDICAT1% AND 11111101B  !Clear bit 2
3719: 268f:     ENDIF
3720: 2697: 
3721: 2697:     IF CURR.CONTAINS.ASPIRIN$ = "Y" THEN BEGIN
3722: 26b5:         IRF.INDICAT1% = IRF.INDICAT1%  OR 00000001B  !Set   bit 1 Aspirin flag
3723: 26cf:     ENDIF ELSE BEGIN
3724: 26d7:         IRF.INDICAT1% = IRF.INDICAT1% AND 11111110B  !Clear bit 1
3725: 26ef:     ENDIF
3726: 26f7: 
3727: 26f7:     IF NEW.ITEM THEN BEGIN  !Initialise Deals Data
3728: 270c:          FOR K% = 0 TO IRF.MAX.DEALS% - 1
3729: 271f:              IRF.DEAL.NUM$(K%) = PACK$("0000")
3730: 274c:              IRF.LIST.ID%(K%)  = 0
3731: 276d:          NEXT K%
3732: 2795:     ENDIF
3733: 279d: 
3734: 279d:     !--------------------------------------------------
3735: 279d:     !                 IRF INDICAT 8
3736: 279d:     !--------------------------------------------------
3737: 279d: 
3738: 279d:     CALL UPDATE.ISF ! Set bit 8 WEEE Item
3739: 27a9:                     ! Also sets SEL.NON.PRICE.CHANGE to TRUE if needed  ! 1.13 RC (179)
3740: 27a9: 
3741: 27a9:     IF NEW.ITEM THEN BEGIN
3742: 27bb:         IRF.INDICAT8% = IRF.INDICAT8% AND 10011111B  !Clear bits 6 & 7
3743: 27d3:     ENDIF
3744: 27db: 
3745: 27db:     IF MATCH("RECALL IS ACTIVE",SOFTS.REC.62$,1) THEN BEGIN !NB. Rec 62 contains >1 ACTIVE/line
3746: 27fd: 
3747: 27fd:         IF CURR.BLOCKED.FROM.SALE$ = "R" THEN BEGIN         ! RECALL
3748: 281b: 
3749: 281b:             IRF.INDICAT8% = IRF.INDICAT8% AND 10011111B    !Clear bits 6 & 7 Item blocked from sale
3750: 2833: 
3751: 2833:         ENDIF
3752: 283b:     ENDIF
3753: 2843: 
3754: 2843:     IF CURR.CONTAINS.EPHEDRINE$ = "Y" THEN BEGIN
3755: 2861:         IRF.INDICAT8% = IRF.INDICAT8%  OR 00010000B  !Set   bit 5 contains Ephedrine flag
3756: 287b:     ENDIF ELSE BEGIN
3757: 2883:         IRF.INDICAT8% = IRF.INDICAT8% AND 11101111B  !Clear bit 5
3758: 289b:     ENDIF
3759: 28a3: 
3760: 28a3:     IF NEW.ITEM THEN BEGIN
3761: 28b5:         IRF.INDICAT8% = IRF.INDICAT8% AND 11110111B  !Clear bit 4 Till prompt required
3762: 28cd:     ENDIF
3763: 28d5: 
3764: 28d5:     IF CURR.UNRESTRICTED.GROUP.CODE$ = "Y" THEN BEGIN
3765: 28f3:         IRF.INDICAT8% = IRF.INDICAT8%  OR 00000100B  !Set   bit 3 unrestricted group flag
3766: 290d:     ENDIF ELSE BEGIN
3767: 2915:         IRF.INDICAT8% = IRF.INDICAT8% AND 11111011B  !Clear bit 3
3768: 292d:     ENDIF
3769: 2935: 
3770: 2935:     ! Chlamydia Test Kits
3771: 2935:     IRF.INDICAT8% = IRF.INDICAT8% AND 11111100B              !Clear bits 1 & 2                !1.5CSk(a)
3772: 294d:     !Check against field one                                                                  !1.5CSk(a)
3773: 294d:     IF MATCH(CHLAMYDIA.ID$(1),CURR.STNDRD.DESC$,1) THEN BEGIN!IDF Description                 !1.5CSk(a)
3774: 2982:         IRF.INDICAT8% = IRF.INDICAT8%  OR 00000001B          !Set bit 1 (CN) NHS Test Kit     !1.5CSk(a)
3775: 299a:     ENDIF                                                                                     !1.5CSk(a)
3776: 29a2:     !Check against field two                                                                  !1.5CSk(a)
3777: 29a2:     IF MATCH(CHLAMYDIA.ID$(2),CURR.STNDRD.DESC$,1) THEN BEGIN!IDF Description                 !1.5CSk(a)
3778: 29d7:         IRF.INDICAT8% = IRF.INDICAT8%  OR 00000010B          !Set bit 2 (CO) Private Test Kit !1.5CSk(a)
3779: 29ef:     ENDIF                                                                                     !1.5CSk(a)
3780: 29f7: 
3781: 29f7:     !--------------------------------------------------
3782: 29f7:     !                 IRF INDICAT 9
3783: 29f7:     !--------------------------------------------------
3784: 29f7:     IF CURR.RESALEABLE$ = "Y" THEN BEGIN
3785: 2a15:         IRF.INDICAT9% = IRF.INDICAT9%  OR 01000000B  !Set   bit 7 item resaleable flag
3786: 2a2f:     ENDIF ELSE BEGIN
3787: 2a37:         IRF.INDICAT9% = IRF.INDICAT9% AND 10111111B  !Clear bit 7
3788: 2a4f:     ENDIF
3789: 2a57: 
3790: 2a57:     IF CURR.BOOTS.COM.EXTENDED$ = "Y" THEN BEGIN
3791: 2a75:         IRF.INDICAT9% = IRF.INDICAT9%  OR 10000000B  !Set   bit 8  .COM Extended flag
3792: 2a8f:     ENDIF ELSE BEGIN
3793: 2a97:         IRF.INDICAT9% = IRF.INDICAT9% AND 01111111B  !Clear bit 8
3794: 2aaf:     ENDIF
3795: 2ab7: 
3796: 2ab7:     !Special Instructions - set bits 1-6 (value range 0-63)
3797: 2ab7:     IRF.INDICAT9% = (IRF.INDICAT9% AND 11000000B) + VAL(CURR.SPECIAL.INSTRUCTION$)
3798: 2afd: 
3799: 2afd:     !--------------------------------------------------
3800: 2afd:     !                 IRF INDICAT 10
3801: 2afd:     !--------------------------------------------------
3802: 2afd:     IRF.INDICAT10% = IRF.INDICAT10% AND 00011111B !Clear bits 6, 7 & 8 (Ret Route blank)
3803: 2b15: 
3804: 2b15:     IF CURR.RETURNABLE$ = "Y" THEN BEGIN
3805: 2b36:         IRF.INDICAT10% = IRF.INDICAT10% OR 00100000B !Set bit 6 Is Returnable
3806: 2b4e: 
3807: 2b4e:         IF CURR.RETURN.ROUTE$ = "R" THEN BEGIN
3808: 2b6c:             IRF.INDICAT10% = IRF.INDICAT10% OR  01000000B    !set   bit 7
3809: 2b86:         ENDIF ELSE IF CURR.RETURN.ROUTE$ = "D" THEN BEGIN
3810: 2ba4:             IRF.INDICAT10% = IRF.INDICAT10% OR  10000000B    !set   bit 8
3811: 2bbe:         ENDIF ELSE IF CURR.RETURN.ROUTE$ = "S" THEN BEGIN
3812: 2bdc:             IRF.INDICAT10% = IRF.INDICAT10% OR 11000000B     !set bits 7 & 8
3813: 2bf4:         ENDIF
3814: 2bfc:     ENDIF
3815: 2c04: 
3816: 2c04:     IRF.INDICAT10% = IRF.INDICAT10% AND 11100111B !clear bits 4 & 5
3817: 2c1c:     IF CURR.ETHICAL.CLASS$ = "P" THEN BEGIN
3818: 2c3a:         IRF.INDICAT10% = IRF.INDICAT10%  OR 00001000B       !set bit 4
3819: 2c54:     ENDIF ELSE IF CURR.ETHICAL.CLASS$ = "G" THEN BEGIN
3820: 2c72:         IRF.INDICAT10% = IRF.INDICAT10%  OR 00010000B       !set bit 5
3821: 2c8c:     ENDIF ELSE IF CURR.ETHICAL.CLASS$ = "M" THEN BEGIN
3822: 2caa:         IRF.INDICAT10% = IRF.INDICAT10%  OR 00011000B       !set bit 4 & 5
3823: 2cc2:     ENDIF
3824: 2cca: 
3825: 2cca: 
3826: 2cca:     IRF.INDICAT10% = IRF.INDICAT10% AND 11111000B !clear bits 1, 2 & 3
3827: 2ce2: 
3828: 2ce2:     IF CURR.AGE.RESTRICTION$ = "12" THEN BEGIN
3829: 2d00:         IRF.INDICAT10% = IRF.INDICAT10%  OR 00000001B !set   bit 1
3830: 2d1b:     ENDIF ELSE IF CURR.AGE.RESTRICTION$ = "15" THEN BEGIN
3831: 2d39:         IRF.INDICAT10% = IRF.INDICAT10%  OR 00000010B !set   bit 2
3832: 2d54:     ENDIF ELSE IF CURR.AGE.RESTRICTION$ = "16" THEN BEGIN
3833: 2d72:         IRF.INDICAT10% = IRF.INDICAT10%  OR 00000011B !set   bits 1 & 2
3834: 2d8c:     ENDIF ELSE IF CURR.AGE.RESTRICTION$ = "18" THEN BEGIN
3835: 2daa:         IRF.INDICAT10% = IRF.INDICAT10%  OR 00000100B !set   bit 3
3836: 2dc4:     ENDIF ELSE IF CURR.AGE.RESTRICTION$ = "21" THEN BEGIN
3837: 2de2:         IRF.INDICAT10% = IRF.INDICAT10%  OR 00000101B !set   bits 1 & 3
3838: 2dfa:     ENDIF
3839: 2e02: 
3840: 2e02: !   Line deleted                                                                       ! 1.12 RC
3841: 2e02: 
3842: 2e02:     IF CURR.CURRENT.PRICE$ = "" THEN BEGIN
3843: 2e20:         IRF.SALEPRIC$ = PACK$("0000000000") ! Zero rather than 1p to cause price entry ! 1.9 RC
3844: 2e3f:     ENDIF ELSE BEGIN ! Set whether new item or not
3845: 2e47:         IF NEW.ITEM THEN BEGIN
3846: 2e59:             IRF.SALEPRIC$ = PACK$(RIGHT$("0000000000" + CURR.CURRENT.PRICE$, 10))
3847: 2e9b:         ENDIF ELSE BEGIN
3848: 2ea3:             PRICE.MISMATCH = CHECK.FOR.PRICE.MISMATCH                                  ! 1.12 RC
3849: 2eb6:         ENDIF
3850: 2ebe:     ENDIF
3851: 2ec6: 
3852: 2ec6:     !--------------------------------------------------
3853: 2ec6:     !                 IRF INDICAT 5
3854: 2ec6:     !--------------------------------------------------
3855: 2ec6:     MATCH.POS1% = MATCH("M", CURR.GUARANTEE.LENGTH$,1) !may contain letter M to signify Months
3856: 2eeb:     IF MATCH.POS1% > 0 THEN BEGIN
3857: 2f00:         IRF.INDICAT5% = IRF.INDICAT5%  OR 10000000B !set   bit 8
3858: 2f18:         IRF.INDICAT5% = (IRF.INDICAT5% AND 11000000B) + \  bits 1 -6
3859: 2f7e:             VAL(LEFT$(CURR.GUARANTEE.LENGTH$, MATCH.POS1%-1))
3860: 2f7e:     ENDIF ELSE BEGIN
3861: 2f86:         IRF.INDICAT5% = IRF.INDICAT5% AND 01111111B !clear bit 8
3862: 2f9e:         IRF.INDICAT5% = (IRF.INDICAT5% AND 11000000B) + VAL(CURR.GUARANTEE.LENGTH$)
3863: 2fe4:     ENDIF
3864: 2fec: 
3865: 2fec:     IF CURR.CONTAINS.PSEUDOEPHEDRINE$ = "Y" THEN BEGIN
3866: 300a:          IRF.INDICAT5% = IRF.INDICAT5%  OR 01000000B !set   bit 7
3867: 3024:     ENDIF ELSE BEGIN
3868: 302c:          IRF.INDICAT5% = IRF.INDICAT5% AND 10111111B !clear bit 7
3869: 3044:     ENDIF
3870: 304c: 
3871: 304c:     IRF.ITEMNAME$ = RIGHT$(STRING$(18," ") + CURR.TILL.DESC$, 18)
3872: 3099: 
3873: 3099:     IRF.BOOTS.CODE$ = PACK$(LEFT$(CURR.BOOTS.CODE$, 6))
3874: 30c5: 
3875: 30c5: 
3876: 30c5:     !--------------------------------------------------
3877: 30c5:     !                 IRF INDICAT 3
3878: 30c5:     !--------------------------------------------------
3879: 30c5:     IF NEW.ITEM THEN BEGIN
3880: 30d7:         IRF.INDICAT3% = IRF.INDICAT3% AND 01001111B  !clear bits 5 Well-being services item (redundant)
3881: 30ef:                                                      !           6  Locally priced
3882: 30ef:                                                      !           8  CSR item (redundant)
3883: 30ef:     ENDIF
3884: 30f7: 
3885: 30f7:     IF CURR.STOCK.SYSTEM.FLAG$ = "Y" THEN BEGIN
3886: 3115:          IRF.INDICAT3% = IRF.INDICAT3%  OR 01000000B !set   bit 7
3887: 312f:     ENDIF ELSE BEGIN
3888: 3137:          IRF.INDICAT3% = IRF.INDICAT3% AND 10111111B !clear bit 7
3889: 314f:     ENDIF
3890: 3157: 
3891: 3157:     IF CURR.EARN.POINTS$ = "Y" THEN BEGIN
3892: 3175:          IRF.INDICAT3% = IRF.INDICAT3% AND 11110111B !clear bit 4         !1.4CSk
3893: 318f:     ENDIF ELSE BEGIN
3894: 3197:          IRF.INDICAT3% = IRF.INDICAT3%  OR 00001000B !set   bit 4         !1.4CSk
3895: 31af:     ENDIF
3896: 31b7: 
3897: 31b7: !   Save IRF.INDICAT3%                                                       ! 1.13 RC (179)
3898: 31b7:     SAV.IRF.INDICAT3% = IRF.INDICAT3%                                        ! 1.13 RC (179)
3899: 31cd: 
3900: 31cd:     IF CURR.REDEEMABLE$ = "Y" THEN BEGIN
3901: 31eb:          IRF.INDICAT3% = IRF.INDICAT3%  OR 00000100B !set   bit 3
3902: 3205:     ENDIF ELSE BEGIN
3903: 320d:          IRF.INDICAT3% = IRF.INDICAT3% AND 11111011B !clear bit 3
3904: 3225:     ENDIF
3905: 322d: 
3906: 322d: !   Set SEL.NON.PRICE.CHANGE flag if non-price-change requires SEL printing  ! 1.13 RC (179)
3907: 322d: !   (note that this flag is not checked/used when item is new)               ! 1.13 RC (179)
3908: 322d:     IF   (    IRF.INDICAT3% AND 00000100B) \                                 ! 1.13 RC (179)
3909: 324c:       <> (SAV.IRF.INDICAT3% AND 00000100B) THEN BEGIN                        ! 1.13 RC (179)
3910: 324c:         SEL.NON.PRICE.CHANGE = TRUE                                          ! 1.13 RC (179)
3911: 3262:     ENDIF                                                                    ! 1.13 RC (179)
3912: 326a: 
3913: 326a:     IF CURR.OWN.BRAND$ = "Y" THEN BEGIN
3914: 3288:          IRF.INDICAT3% = IRF.INDICAT3%  OR 00000010B !set   bit 2
3915: 32a2:     ENDIF ELSE BEGIN
3916: 32aa:          IRF.INDICAT3% = IRF.INDICAT3% AND 11111101B !clear bit 2
3917: 32c2:     ENDIF
3918: 32ca: 
3919: 32ca: !   READ.IUF code ensures IUF.DISCOUNTABLE$ (and hence CURR.DISCOUNTABLE$)
3920: 32ca: !   only contains "Y" or "N"
3921: 32ca: 
3922: 32ca:     IF CURR.DISCOUNTABLE$ = "N" THEN BEGIN ! No discount given                ! 1.6 RC (21)
3923: 32e8: !        Set IRF Discount exempt flag ON                                      ! 1.6 RC (21)
3924: 32e8:          IRF.INDICAT3% = IRF.INDICAT3%  OR 00000001B !set   bit 1    !1.4CSk  ! 1.5 RC (21)
3925: 3302:     ENDIF ELSE BEGIN ! else "Y" - Discount given                              ! 1.6 RC (21)
3926: 330a: !        Set IRF Discount Exempt flag OFF                                     ! 1.6 RC (21)
3927: 330a:          IRF.INDICAT3% = IRF.INDICAT3% AND 11111110B !clear bit 1    !1.4CSk  ! 1.5 RC (21)
3928: 3322:     ENDIF
3929: 332a: 
3930: 332a: !   Lines deleted - UPDATE.CIPPM moved to PROCESS.BTREE.RECORD to ensure ALL  ! 1.10 RC (113)
3931: 332a: !                   PPFK items checked for update and not just those on IUF   ! 1.10 RC (113)
3932: 332a: 
3933: 332a:     RC% = WRITE.IRF
3934: 3345:     IF RC% <> 0 THEN BEGIN
3935: 3364:         CALL LOG.EVENT(106)
3936: 338a:     ENDIF
3937: 3392: 
3938: 3392: END SUB
3939: 33a6: 
3940: 33a6: 
3941: 33a6: \******************************************************************************
3942: 33a6: \***
3943: 33a6: \***    UPDATE.IDF
3944: 33a6: \***
3945: 33a6: \******************************************************************************
3946: 33a6: \***
3947: 33a6: \***    Updates IDF - Item Data File for the specified item
3948: 33a6: \***
3949: 33a6: \******************************************************************************
3950: 33a6: SUB UPDATE.IDF
3951: 33ca: 
3952: 33ca: !   Removed OVERRIDE.NEW.ITEM.FLAG now redundant                 ! 1.8 RC (95)
3953: 33ca: 
3954: 33ca:     IDF.BOOTS.CODE$ = PACK$("0" + CURR.BOOTS.CODE$)
3955: 33f9: 
3956: 33f9: !   UPDATE.IDF is now called prior to UPDATE.IRF                 ! 1.8 RC (95)
3957: 33f9: !   NEW.ITEM flag now set when IDF record not present (not IRF)  ! 1.8 RC (95)
3958: 33f9:     RC% = READ.IDF
3959: 3414:     IF RC% <> 0 THEN BEGIN                                       ! 1.8 RC (95)
3960: 3433:         NEW.ITEM = TRUE                                          ! 1.8 RC (95)
3961: 344b:     ENDIF ELSE BEGIN                                             ! 1.9 RC (95)+(102)
3962: 3453:         NEW.ITEM = FALSE                                         ! 1.9 RC (95)+(102)
3963: 3469:     ENDIF                                                        ! 1.9 RC (95)+(102)
3964: 3471: 
3965: 3471:     IDF.PRODUCT.GRP$ = PACK$(LEFT$(CURR.PROD.GRP$,2) + "0" + RIGHT$(CURR.PROD.GRP$,3))
3966: 34c6:     IDF.STNDRD.DESC$ = CURR.STNDRD.DESC$
3967: 34e4: 
3968: 34e4:     IF NEW.ITEM THEN BEGIN                                       ! 1.8 RC (95)
3969: 34f6:         IDF.INTRO.DATE$ = PACK$(PROCESSING.DATE$)  !passed from PSB20
3970: 3519:         IDF.FILLER$     = PACK$("00") ! Null                     ! 1.9 RC (106)
3971: 3535:     ENDIF
3972: 353d: 
3973: 353d:     IF CURR.BC.LETTER$ = "" THEN BEGIN
3974: 355b:         IDF.BSNS.CNTR$ = " "
3975: 3574:     ENDIF ELSE BEGIN
3976: 357c:         IDF.BSNS.CNTR$ = CURR.BC.LETTER$
3977: 359a:     ENDIF
3978: 35a2: 
3979: 35a2:     !--------------------------------------------------
3980: 35a2:     !                IDF BIT FLAGS 1
3981: 35a2:     !--------------------------------------------------
3982: 35a2:     IF CURR.GRP.CODE.FLAG$ = "Y" THEN BEGIN
3983: 35c0:          IDF.BIT.FLAGS.1% = IDF.BIT.FLAGS.1%  OR 10000000B !set   bit 8  Group Code Flag
3984: 35da:     ENDIF ELSE BEGIN
3985: 35e2:          IDF.BIT.FLAGS.1% = IDF.BIT.FLAGS.1% AND 01111111B !clear bit 8
3986: 35fa:     ENDIF
3987: 3602: 
3988: 3602:     IF NEW.ITEM THEN BEGIN                                            ! 1.8 RC (95)
3989: 3614:          IDF.BIT.FLAGS.1% = IDF.BIT.FLAGS.1%  AND 10010111B !clear bits 4 CSR item (redundant)
3990: 362c:                                                             !           6 Markdown
3991: 362c:                                                             !           7 Keyline  (redundant)
3992: 362c:     ENDIF
3993: 3634: 
3994: 3634:     IF CURR.SUPPLY.ROUTE$ = "B" OR CURR.SUPPLY.ROUTE$ = "W" THEN BEGIN
3995: 3686:          IDF.BIT.FLAGS.1% = IDF.BIT.FLAGS.1%  OR 00010000B !set   bit 5  Supply Route B/D/W
3996: 36a0:     ENDIF ELSE BEGIN
3997: 36a8:          IDF.BIT.FLAGS.1% = IDF.BIT.FLAGS.1% AND 11101111B !clear bit 5
3998: 36c0:     ENDIF
3999: 36c8: 
4000: 36c8:     IF CURR.SUPPLY.ROUTE$ = "B" OR CURR.SUPPLY.ROUTE$ = "D" THEN BEGIN
4001: 371a:          IDF.BIT.FLAGS.1% = IDF.BIT.FLAGS.1%  OR 00000100B !set   bit 3     Directs
4002: 3734:     !    IDF.BIT.FLAGS.1% = IDF.BIT.FLAGS.1% AND 11111100B !clear bits 1 & 2 (redundant)
4003: 3734:     ENDIF ELSE BEGIN                                                                      ! 1.6 RC (69)
4004: 373c:          IDF.BIT.FLAGS.1% = IDF.BIT.FLAGS.1% AND 11111011B ! Clear bit 3   Directs A off  ! 1.6 RC (69)
4005: 3754:     ENDIF
4006: 375c: 
4007: 375c:     !--------------------------------------------------
4008: 375c:     !                IDF BIT FLAGS 2
4009: 375c:     !--------------------------------------------------
4010: 375c: 
4011: 375c:     IF NEW.ITEM THEN BEGIN                                       ! 1.8 RC (95)
4012: 376e:          IDF.BIT.FLAGS.2% = IDF.BIT.FLAGS.2% AND 10101000B !clear bits 1 Reserved
4013: 3786:          !                                                             2 Reserved
4014: 3786:          !                                                             3 Pending Count
4015: 3786:          !                                                             5 Unused
4016: 3786:          !                                                             7 Exclusive Line Flag
4017: 3786:          IDF.PARENT.CODE$       = PACK$("00000000")  !redundant
4018: 37a2:          IDF.DATE.OF.LAST.SALE$ = PACK$("000000")
4019: 37be:     ENDIF
4020: 37c6: 
4021: 37c6:     IF CURR.DATE.SENSITIVE$ = "Y" THEN BEGIN
4022: 37e4:          IDF.BIT.FLAGS.2% = IDF.BIT.FLAGS.2%  OR 00100000B !set   bit 6  Date sensitive Flag (previously unused)
4023: 37fe:     ENDIF ELSE BEGIN
4024: 3806:          IDF.BIT.FLAGS.2% = IDF.BIT.FLAGS.2% AND 11011111B !clear bit 6
4025: 381e:     ENDIF
4026: 3826: 
4027: 3826:     ITEM.STATUS.CHANGED = FALSE                                             !DMW
4028: 383c: 
4029: 383c:     IF CURR.STOCK.SYSTEM.FLAG$ = "Y" THEN BEGIN
4030: 385d:         IDF.BIT.FLAGS.2% = IDF.BIT.FLAGS.2%  OR 00001000B !set   bit 4  Stock System Flag
4031: 3875: 
4032: 3875:         ! IF this is an existing item                                       !DMW
4033: 3875:         IF NOT NEW.ITEM THEN BEGIN                                          !DMW
4034: 3887:                                                                             !DMW
4035: 3887:             ! IF the item status has changed                                !DMW
4036: 3887:             IF IDF.STATUS.1$ <> CURR.STATUS.1$ THEN BEGIN                   !DMW
4037: 38ac:                 ITEM.STATUS.CHANGED = TRUE                                  !DMW
4038: 38c2:             ENDIF                                                           !DMW
4039: 38ca:                                                                             !DMW
4040: 38ca:         ENDIF                                                               !DMW
4041: 38d5: 
4042: 38d5:     ENDIF ELSE BEGIN
4043: 38dd:         IDF.BIT.FLAGS.2% = IDF.BIT.FLAGS.2% AND 11110111B !clear bit 4
4044: 38f5:         !---------------------------------------------------------------------------------------
4045: 38f5:         ! If the item was previously a stock item, but is changing to non-stock, write a type 6
4046: 38f5:         ! record to the STKMQ with the reason set to "I" in order to reset the stock figure.
4047: 38f5:         !---------------------------------------------------------------------------------------
4048: 38f5:         STOCK.BOOTS.CODE$ = PACK$("0" + CURR.BOOTS.CODE$)
4049: 3924: 
4050: 3924:         IF READ.STOCK = 0 THEN BEGIN
4051: 3936:             CALL WRITE.STKMQ.6.RECORD
4052: 3942:         ENDIF
4053: 394a:     ENDIF
4054: 3952: 
4055: 3952:     IF CURR.STATUS.1$ = "" THEN BEGIN                                       !EMW
4056: 3970:         IDF.STATUS.1$ = " "                                                 !EMW
4057: 3989:     ENDIF ELSE BEGIN                                                        !EMW
4058: 3991:         IDF.STATUS.1$ = CURR.STATUS.1$                                      !EMW
4059: 39af:     ENDIF                                                                   !EMW
4060: 39b7: 
4061: 39b7: !   CALL BARCODE.PROCESSING                                      ! 1.8 RC (95)
4062: 39b7: 
4063: 39b7: END SUB
4064: 39cb: 
4065: 39cb: 
4066: 39cb: 
4067: 39cb: \******************************************************************************
4068: 39cb: \***
4069: 39cb: \***    UPDATE.IEX
4070: 39cb: \***
4071: 39cb: \******************************************************************************
4072: 39cb: \***
4073: 39cb: \***    Updates IEX - Item Extension File for the specified item
4074: 39cb: \***
4075: 39cb: \***    IEX records are only written for Supply Route 'D' items in order to
4076: 39cb: \***    minimise the time taken to update items.
4077: 39cb: \***
4078: 39cb: \******************************************************************************
4079: 39cb: 
4080: 39cb: SUB UPDATE.IEX
4081: 39ef: 
4082: 39ef:     IF CURR.SUPPLY.ROUTE$ = "D" THEN BEGIN
4083: 3a10: 
4084: 3a10: !       Read IEX - If item not found set IEX variables to null          ! 1.10 RC (142)
4085: 3a10:         IEX.ITEM.CODE$ = PACK$(LEFT$(CURR.BOOTS.CODE$, 6)) !            ! 1.10 RC (142)
4086: 3a3c: 
4087: 3a3c:         RC% = READ.IEX                                                  ! 1.10 RC (142)
4088: 3a57: 
4089: 3a57:         IF RC% <> 0 THEN BEGIN                                          ! 1.10 RC (142)
4090: 3a76:             IEX.ACTUAL.SUPPLIER.NUM$ = STRING$( 4, PACK$("00"))         ! 1.10 RC (142)
4091: 3a99:             IEX.PRIMARY.SUPPLIER$    = STRING$( 4, PACK$("00"))         ! 1.10 RC (142)
4092: 3abc:             IEX.FILLER$              = STRING$(17, PACK$("00"))         ! 1.10 RC (142)
4093: 3adf:         ENDIF                                                           ! 1.10 RC (142)
4094: 3ae7: 
4095: 3ae7:         IF NEW.ITEM THEN BEGIN
4096: 3af9: !           IEX.ACTUAL.SUPPLIER$ = PACK$("00000000")                    ! 1.2 TT
4097: 3af9:             IEX.ACTUAL.SUPPLIER.NUM$ = PACK$("00000000")                ! 1.2 TT
4098: 3b15:             IEX.FILLER$              = STRING$(17, PACK$("00"))         ! 1.10 RC (142)
4099: 3b3a:         ENDIF ELSE BEGIN
4100: 3b42: !           IEX.ACTUAL.SUPPLIER$ = IEX.PRIMARY.SUPPLIER$                ! 1.2 TT
4101: 3b42:             IEX.ACTUAL.SUPPLIER.NUM$ = IEX.PRIMARY.SUPPLIER$            ! 1.2 TT
4102: 3b60:         ENDIF
4103: 3b68: 
4104: 3b68: !       IEX.ITEM.CODE$ = PACK$(LEFT$(CURR.BOOTS.CODE$, 6)) !            ! 1.10 RC (142)
4105: 3b68: !       IEX.PRIMARY.SUPPLIER$ = PACK$("0000" + CURR.PRIMARY.SUPPLIER$)  ! 1.2 TT
4106: 3b68:         IEX.PRIMARY.SUPPLIER$ = PACK$( RIGHT$("00000000" + \            ! 1.2 TT
4107: 3ba8:                                        CURR.PRIMARY.SUPPLIER$, 8))      ! 1.2 TT
4108: 3ba8:         RC% = WRITE.IEX
4109: 3bc3:         IF RC% <> 0 THEN BEGIN
4110: 3be2:             CALL LOG.EVENT(106)
4111: 3c08:         ENDIF
4112: 3c10:     ENDIF
4113: 3c18: 
4114: 3c18: END SUB
4115: 3c2c: 
4116: 3c2c: 
4117: 3c2c: \******************************************************************************
4118: 3c2c: \***
4119: 3c2c: \***    UPDATE.DRUG
4120: 3c2c: \***
4121: 3c2c: \******************************************************************************
4122: 3c2c: \***
4123: 3c2c: \***    Updates DRUG -  DRUG File for the specified item
4124: 3c2c: \***
4125: 3c2c: \******************************************************************************
4126: 3c2c: SUB UPDATE.DRUG
4127: 3c50: 
4128: 3c50:     IF CURR.ETHICAL.CLASS$ <> "" AND \
4129: 3ca5:        CURR.ETHICAL.CLASS$ <> " " THEN BEGIN
4130: 3ca5: 
4131: 3ca5:         DRUG.ITEM.CODE$   = PACK$(LEFT$(CURR.BOOTS.CODE$, 6))
4132: 3cd1:         DRUG.DESCRIPTION$ = CURR.ETHICAL.DESCRIPTION$
4133: 3cef: 
4134: 3cef:         IF CURR.ETHICAL.ACTIVE$ = "Y" THEN BEGIN
4135: 3d0d:              DRUG.BIT.FLAGS.1% = DRUG.BIT.FLAGS.1%  OR 00000001B !set   bit 1
4136: 3d27:         ENDIF ELSE BEGIN
4137: 3d2f:              DRUG.BIT.FLAGS.1% = DRUG.BIT.FLAGS.1% AND 11111110B !clear bit 1
4138: 3d47:         ENDIF
4139: 3d4f: 
4140: 3d4f:         DRUG.PACK.SIZE% = VAL(CURR.ETHICAL.PACK.SIZE$)
4141: 3d76:         DRUG.FILLER$    = PACK$("0000000000000000")             ! 1.9 RC (112)
4142: 3d92: 
4143: 3d92:         RC% = WRITE.DRUG
4144: 3dad:         IF RC% <> 0 THEN BEGIN
4145: 3dcc:             CALL LOG.EVENT(106)
4146: 3df2:         ENDIF
4147: 3dfa:     ENDIF
4148: 3e02: 
4149: 3e02: END SUB
4150: 3e16: 
4151: 3e16: 
4152: 3e16: \******************************************************************************
4153: 3e16: \***
4154: 3e16: \***    UPDATE.NEWLINES
4155: 3e16: \***
4156: 3e16: \******************************************************************************
4157: 3e16: \***
4158: 3e16: \***    Updates NEWLINES -  NEWLINES File for the specified item
4159: 3e16: \***
4160: 3e16: \******************************************************************************
4161: 3e16: SUB UPDATE.NEWLINES
4162: 3e3a: 
4163: 3e3a:     NEWLINES.BOOTS.CODE$ = PACK$("0" + CURR.BOOTS.CODE$)
4164: 3e69:     NEWLINES.DATE.ADDED$ = PACK$("20"+ PROCESSING.DATE$)
4165: 3e98:     NEWLINES.COUNT%      = 0
4166: 3ea9:     NEWLINES.FILLER$     = "      "
4167: 3ec0: 
4168: 3ec0:     RC% = WRITE.NEWLINES
4169: 3edb:     IF RC% <> 0 THEN BEGIN
4170: 3efa:         CALL LOG.EVENT(106)
4171: 3f20:     ENDIF
4172: 3f28: 
4173: 3f28: END SUB
4174: 3f3c: 
4175: 3f3c: \******************************************************************************
4176: 3f3c: \***
4177: 3f3c: \***    UPDATE.RICF
4178: 3f3c: \***
4179: 3f3c: \******************************************************************************
4180: 3f3c: \***
4181: 3f3c: \***    Updates RICF -  Redeem Item Change File for the specified item
4182: 3f3c: \***
4183: 3f3c: \***    If non-price modifications to an item cause changes to SEL details,
4184: 3f3c: \***    and there are no prices changes due (today or sooner) for the item,
4185: 3f3c: \***    and the item has previously been sold, then add records to the RICF
4186: 3f3c: \***    in order to force a label to be printed.
4187: 3f3c: \***
4188: 3f3c: \******************************************************************************
4189: 3f3c: SUB UPDATE.RICF
4190: 3f60: 
4191: 3f60: !   Lines deleted - Made use of PRICE.CHANGE.TODAY flag        ! 1.13 RC (179)
4192: 3f60: !   instead of reprocessing PPFK data                          ! 1.13 RC (179)
4193: 3f60: 
4194: 3f60: !   Exit this subroutine when ...                              ! 1.13 RC (179)
4195: 3f60: !     Item never sold (as it is unlikely to be stocked)        ! 1.13 RC (179)
4196: 3f60: !     Price change today (as this will produce a SEL)          ! 1.13 RC (179)
4197: 3f60: !     No non-price change to SEL (so no SEL needed via RICF)   ! 1.13 RC (179)
4198: 3f60:     IF IDF.DATE.OF.LAST.SALE$ = PACK$("000000") \              ! 1.13 RC (179)
4199: 3faf:       OR PRICE.CHANGE.TODAY \                                  ! 1.13 RC (179)
4200: 3faf:       OR SEL.NON.PRICE.CHANGE = FALSE THEN BEGIN               ! 1.13 RC (179)
4201: 3faf:         EXIT SUB                                               ! 1.13 RC (179)
4202: 3fba:     ENDIF                                                      ! 1.13 RC (179)
4203: 3fc2: 
4204: 3fc2: !   Prepare RICF record and write to file                      ! 1.13 RC (179)
4205: 3fc2: 
4206: 3fc2:     RICF.ITEM.CODE$ = IDF.BOOTS.CODE$
4207: 3fe0: 
4208: 3fe0:     IF CURR.SUPPLY.ROUTE$ = "W" OR   \
4209: 405a:        CURR.SUPPLY.ROUTE$ = "D" OR   \
4210: 405a:        CURR.SUPPLY.ROUTE$ = "B" THEN BEGIN
4211: 405a:         RICF.DELIVERY.FLAG$ = "E"
4212: 4073:     ENDIF ELSE BEGIN
4213: 407b:         RICF.DELIVERY.FLAG$ = " "
4214: 4092:     ENDIF
4215: 409a: 
4216: 409a:     IF CURR.REDEEMABLE$ = "Y" THEN BEGIN
4217: 40b8:         RICF.REDEEM.ITEM$ = "Y"
4218: 40d1:     ENDIF ELSE BEGIN
4219: 40d9:        RICF.REDEEM.ITEM$ = "N"
4220: 40f0:     ENDIF
4221: 40f8: 
4222: 40f8:     RICF.ITEM.DESCRIPTION$ = CURR.S.E.DESC$
4223: 4116:     RICF.PRICE$            = RIGHT$(IRF.SALEPRIC$,4)
4224: 413b:     RICF.PRODUCT.GROUP$    = PACK$(LEFT$(CURR.PROD.GRP$,2) + \
4225: 4190:                              "0" + RIGHT$(CURR.PROD.GRP$,3))
4226: 4190:     RICF.ITEM.QTY$         = PACK$(RIGHT$("00000000" + CURR.ITEM.QTY$, 8))     ! 1.13 RC (179)
4227: 41d0:     RICF.UNIT.MEASUREMENT$ = PACK$(RIGHT$("0000" + CURR.UNIT.MEASUREMENT$, 4)) ! 1.13 RC (179)
4228: 4210:     RICF.UNIT.NAME$        = CURR.UNIT.NAME$
4229: 422e:     RICF.FILLER$           = PACK$("000000000000")
4230: 424a: 
4231: 424a: !   Increment record number prior to write                     ! 1.13 RC (179)
4232: 424a: !   File was opened with CREATE so always empty at first       ! 1.13 RC (179)
4233: 424a:     RICF.RECORD.NO% = RICF.RECORD.NO% + 1                      ! 1.13 RC (179)
4234: 4259: 
4235: 4259:     RC% = WRITE.RICF
4236: 4274: 
4237: 4274:     IF RC% <> 0 THEN BEGIN                                     ! 1.13 RC (179)
4238: 4293:         CALL LOG.EVENT(106)
4239: 42b9:     ENDIF
4240: 42c1: 
4241: 42c1: END SUB
4242: 42d5: 
4243: 42d5: 
4244: 42d5: \******************************************************************************
4245: 42d5: \***
4246: 42d5: \***    PROCESS.IUF.ITEM
4247: 42d5: \***
4248: 42d5: \******************************************************************************
4249: 42d5: \***
4250: 42d5: \***    Updates all item reference files for the specified item
4251: 42d5: \***
4252: 42d5: \******************************************************************************
4253: 42d5: SUB PROCESS.IUF.ITEM PUBLIC
4254: 42f9: 
4255: 42f9:     MODULE.NUMBER$ = "1"                                                        !1.5CSk(a)
4256: 4310: 
4257: 4310:     CALL UPDATE.IDF ! Prepares IDF data but does not update IDF  ! 1.9 RC (109)
4258: 431c: 
4259: 431c:     CALL UPDATE.IRF ! Prepares IRF data                          ! 1.9 RC (109)  1.14 RC
4260: 4328:                     ! Calls UPDATE.ISF                           !               1.14 RC
4261: 4328:                     ! Calls WRITE.IRF for initial barcode        ! 1.9 RC (109)
4262: 4328: 
4263: 4328:     CALL BARCODE.PROCESSING ! Called after IDF and IRF prepared  ! 1.8 RC (95)
4264: 4334:                             ! Calls WRITE.IDF                    ! 1.9 RC (109)
4265: 4334:                             ! Calls WRITE.IRF for other barcodes ! 1.9 RC (109)
4266: 4334:     CALL UPDATE.IEX
4267: 4340: 
4268: 4340:     CALL UPDATE.DRUG
4269: 434c: 
4270: 434c: !   Calls to UPDATE.LOCAL and UPDATE.CIPPM moved into UPDATE.IRF ! 1.9 RC (109)
4271: 434c: 
4272: 434c:     IF IUF.INITIAL.LOAD$ = "N" AND NEW.ITEM THEN BEGIN
4273: 437d: 
4274: 437d:         CALL UPDATE.NEWLINES
4275: 4389: 
4276: 4389:     ENDIF
4277: 4391: 
4278: 4391: !   Merge new IUF price changes on CURR tables                  ! 1.13 RC
4279: 4391: !   into existing PPFI price changes on PPFK table              ! 1.13 RC
4280: 4391:     CALL PROCESS.PPFK.ITEM
4281: 439e: 
4282: 439e:     IF NOT NEW.ITEM THEN BEGIN
4283: 43b0: 
4284: 43b0:         CALL UPDATE.RICF
4285: 43bc: 
4286: 43bc:     ENDIF
4287: 43c4: 
4288: 43c4: !   Reset flags as no longer needed for this item              ! 1.13 RC (179)
4289: 43c4:     PRICE.CHANGE.TODAY   = FALSE                               ! 1.13 RC (179)
4290: 43da:     SEL.NON.PRICE.CHANGE = FALSE                               ! 1.13 RC (179)
4291: 43f0: 
4292: 43f0: END SUB
4293: 4404: 
4294: 4404: 
4295: 4404: End of Compilation
