   1: 0000: \*******************************************************************************! DCSk
   2: 0000: \***                                                                            ! DCSk
   3: 0000: \*** IMPORTANT                                                                  ! DCSk
   4: 0000: \*** =========                                                                  ! DCSk
   5: 0000: \***    All references to UPDT.IRF.UPDT have been commented out and replaced    ! DCSk
   6: 0000: \***    with UPDT.IRF.TIF.UPDT due to the following issue found post MCF:       ! DCSk
   7: 0000: \***                                                                            ! DCSk
   8: 0000: \***    Node ID check removed as it is preventing the TIF from being updated in ! DCSk
   9: 0000: \***    Single MCF controller stores ie. MCF has changed the single DE nodes    ! DCSk
  10: 0000: \***    to CE. This change should have been done as part of the MCF project,    ! DCSk
  11: 0000: \***    however, the Business were not willing to pay for the relinking and     ! DCSk
  12: 0000: \***    testing of some 200+ programs. There is a slight processing overhead    ! DCSk
  13: 0000: \***    in dual-MCF stores, since the TIF will now be updated in them as well,  ! DCSk
  14: 0000: \***    however the impact is small and TOF does not run in this environment.   ! DCSk
  15: 0000: \***                                                                            ! DCSk
  16: 0000: \***    If you wish to use the old UPDT.IRF.UPDT function then you will need to ! DCSk
  17: 0000: \***    either:                                                                 ! DCSk
  18: 0000: \***                                                                            ! DCSk
  19: 0000: \***          1. Check out the previous OBJs, PSBF19e.J86 and update the .INP   ! DCSk
  20: 0000: \***             and .MAK to include the functions PSBF19, PSBF41 & PSBF42      ! DCSk
  21: 0000: \***       or                                                                   ! DCSk
  22: 0000: \***          2. Check out the previous PSBF19e.J86 and function library:       ! DCSk
  23: 0000: \***             FUNLIB.L86                                                     ! DCSk
  24: 0000: \***                                                                            ! DCSk
  25: 0000: \*******************************************************************************! DCSk
  26: 0000: \*******************************************************************************! DCSk
  27: 0000: 
  28: 0000: 
  29: 0000: !******************************************************************************
  30: 0000: !******************************************************************************
  31: 0000: !***
  32: 0000: !***            PROGRAM         :       PSBF42.BAS
  33: 0000: !***
  34: 0000: !***            DESCRIPTION     :       Update deal information for an item
  35: 0000: !***
  36: 0000: !***            AUTHOR          :       Brian Greenfield
  37: 0000: !***            DATE WRITTEN    :       July 2002
  38: 0000: !***
  39: 0000: !***        Pass in the PACKED item code (3 bytes) in the PACKED.CODE$
  40: 0000: !***        variable and this function ensures that the deal data for that
  41: 0000: !***        item contains only active deals and lists.
  42: 0000: !***        Pass in the processing date for the active deal test (in the
  43: 0000: !***        DATE$ format.)
  44: 0000: !***        The function then calls the UPDATE.IRF function in PSBF41.
  45: 0000: !***        You MUST have the DEAL, DINF, IDF, & IEF open when calling this
  46: 0000: !***        function.
  47: 0000: !***        You MUST have the IRF open using the OPEN.IRF.UPDT function call.
  48: 0000: !***
  49: 0000: !***        The Item Code should be passed as a packed 3 byte string.
  50: 0000: !***
  51: 0000: !***        WARNING! This function reloads deal data, save your values!
  52: 0000: !***
  53: 0000: !******************************************************************************
  54: 0000: !***
  55: 0000: !***        VERSION B           STUART WILLIAM MCCONNACHIE          OCT 2003
  56: 0000: !***
  57: 0000: !***        Used buffered read of DEAL file to increase performance.
  58: 0000: !***        Added save of DINF values using new DINF functionality.
  59: 0000: !***        Added save of DEAL values using new DEAL functionality.
  60: 0000: !***        This allows this function to be called from code which is itself
  61: 0000: !***        reading items on the DINF chains (to find all items in a deal
  62: 0000: !***        for example.
  63: 0000: !***
  64: 0000: !***        VERSION C           STUART WILLIAM MCCONNACHIE          FEB 2004
  65: 0000: !***
  66: 0000: !***        The loop reading the DINF would get stuck if it encountered a
  67: 0000: !***        deal on the DINF but could not read that deals details from the
  68: 0000: !***        DEAL file.  This was due to a faulty NOT operator on a non-
  69: 0000: !***        boolean value (If ERROR.FLAG = 01H then NOT ERROR.FLAG = 0FEH).
  70: 0000: !***        Fixed this, and just moved to the next deal on the DINF in this
  71: 0000: !***        situation.  Not having a deal on the DEAL file is not such a
  72: 0000: !***        serious error that we should abort adding all the other deals
  73: 0000: !***        for that item!
  74: 0000: !***
  75: 0000: !***        VERSION D           Charles Skadorwa                    SEP 2013
  76: 0000: \***        F261 Gift Card Mall IIN Range Extension Project - Commented ! DCSk
  77: 0000: !***
  78: 0000: !***        VERSION E             Muthu Mariappan             13/07/2014
  79: 0000: !***        FOD353 - Deal Limit Increase
  80: 0000: !***        Make the following changes to UPDATE.ITEM.DEAL.INFO
  81: 0000: !***        -  Replace DINF file functions by ITMDL file functions
  82: 0000: !***        -  Rename any remaining variables prefixed DINF  with ITMDL
  83: 0000: !***        -  Replace DINF Open-Close file handling with new code to
  84: 0000: !***           handle ITMDL.
  85: 0000: !***        -  LOCAL.PRICE% flag becomes redundant and should be removed
  86: 0000: !***
  87: 0000: !******************************************************************************
  88: 0000: !******************************************************************************
  89: 0000: 
  90: 0000: %INCLUDE PSBF42G.J86
  91: 0000: !******************************************************************************
  92: 0000: !******************************************************************************
  93: 0000: !***
  94: 0000: !***            PROGRAM         :       PSBF42G.J86
  95: 0000: !***
  96: 0000: !***            DESCRIPTION     :       Update deal information for an item
  97: 0000: !***
  98: 0000: !***            AUTHOR          :       Brian Greenfield
  99: 0000: !***            DATE WRITTEN    :       July 2002
 100: 0000: !***
 101: 0000: !***        Pass in the PACKED item code (3 bytes) in the PACKED.CODE$
 102: 0000: !***        variable and this function ensures that the deal data for that 
 103: 0000: !***        item contains only active deals and lists.
 104: 0000: !***        Pass in the processing date for the active deal test (in the
 105: 0000: !***        DATE$ format.)
 106: 0000: !***        The function then calls the UPDATE.IRF function in PSBF41.
 107: 0000: !***        You MUST have the DEAL, DINF, IRF, IDF, & IEF open when calling 
 108: 0000: !***        this function.
 109: 0000: !***
 110: 0000: !***        The Item Code should be passed as a packed 3 byte string.
 111: 0000: !***
 112: 0000: !***        WARNING! This function reloads deal data, save your values!
 113: 0000: !***
 114: 0000: !******************************************************************************
 115: 0000: !******************************************************************************
 116: 0000: 
 117: 0000: 
 118: 0000: !******************************************************************************
 119: 0000: 
 120: 0000: STRING ACD.FLAG$
 121: 0000: STRING IRF.LOCKED.FLAG$
 122: 0000: 
 123: 0000: INTEGER*1 ERROR.FLAG
 124: 0000: INTEGER*1 DONE.INIT                                                         !BSWM
 125: 0000: STRING SORT.ARRAY$(1)                                                       !BSWM
 126: 0000: 
 127: 0000: !******************************************************************************
 128: 0000: 
 129: 0000: %INCLUDE DEALDEC.J86    !DEAL FUNCTIONS
 130: 0000: !****************************************************************************
 131: 0000: !
 132: 0000: !       MODULE:         DEAL FILE FUNCTIONS
 133: 0000: !
 134: 0000: !       AUTHOR:         STUART WILLIAM MCCONNACHIE
 135: 0000: !
 136: 0000: !       DATE:           AUGUST 2002
 137: 0000: !
 138: 0000: !****************************************************************************
 139: 0000: !
 140: 0000: !       VERSION A           STUART WILLIAM MCCONNACHIE          AUG 2002
 141: 0000: !
 142: 0000: !       Functions for adding and removing deals from the new format DEAL
 143: 0000: !       file for the flexible deals project.
 144: 0000: !       Note the deal file is a double linked list of all deals on the
 145: 0000: !       system, so must not be updated directly without using the function.
 146: 0000: !
 147: 0000: !       VERSION B           STUART WILLIAM MCCONNACHIE          AUG 2005
 148: 0000: !
 149: 0000: !       Addition of DEAL MODEL file.
 150: 0000: !
 151: 0000: !****************************************************************************
 152: 0000: 
 153: 0000:     STRING GLOBAL       DEAL.FILE.NAME$
 154: 0000:     STRING GLOBAL       DEAL.MODEL.FILE.NAME$                               !BSWM
 155: 0000:     STRING GLOBAL       DEAL.DEAL.NUM$
 156: 0000:     STRING GLOBAL       DEAL.RECORD$
 157: 0000: 
 158: 0000:     INTEGER*2 GLOBAL    DEAL.SESS.NUM%
 159: 0000:     INTEGER*2 GLOBAL    DEAL.MODEL.SESS.NUM%                                !BSWM
 160: 0000:     INTEGER*2 GLOBAL    DEAL.REPORT.NUM%
 161: 0000:     INTEGER*2 GLOBAL    DEAL.MODEL.REPORT.NUM%                              !BSWM
 162: 0000:     INTEGER*2 GLOBAL    DEAL.RECL%
 163: 0000:     INTEGER*2 GLOBAL    DEAL.MODEL.RECL%                                    !BSWM
 164: 0000: 
 165: 0000:     INTEGER*1 GLOBAL    DEAL.NUM.LISTS%
 166: 0000:     INTEGER*1 GLOBAL    DEAL.RUN.DAY%
 167: 0000:     INTEGER*1 GLOBAL    DEAL.PRIORITY%
 168: 0000:     INTEGER*1 GLOBAL    DEAL.FLAGS1%
 169: 0000:     INTEGER*1 GLOBAL    DEAL.FLAGS2%
 170: 0000:     INTEGER*1 GLOBAL    DEAL.SALES.PROMPT%
 171: 0000:     INTEGER*1 GLOBAL    DEAL.EXCLUSION.MSG%
 172: 0000:     INTEGER*2 GLOBAL    DEAL.EXEMPT.TILLS%
 173: 0000:     INTEGER*2 GLOBAL    DEAL.MAX.QLFY%(1)
 174: 0000:     INTEGER*2 GLOBAL    DEAL.NUM.REWARD.QLFY%(1)
 175: 0000:     INTEGER*2 GLOBAL    DEAL.START.TIME%
 176: 0000:     INTEGER*2 GLOBAL    DEAL.END.TIME%
 177: 0000: 
 178: 0000:     INTEGER*1 GLOBAL    DEAL.QLFY.FLAG%(1)
 179: 0000:     INTEGER*1 GLOBAL    DEAL.QLFY.CODE%(1)
 180: 0000:     INTEGER*4 GLOBAL    DEAL.QLFY.AMNT%(1)
 181: 0000:     INTEGER*1 GLOBAL    DEAL.QLFY.LIST%(1)
 182: 0000: 
 183: 0000:     INTEGER*1 GLOBAL    DEAL.REWARD.FLAG%(1)
 184: 0000:     INTEGER*1 GLOBAL    DEAL.REWARD.CODE%(1)
 185: 0000:     INTEGER*1 GLOBAL    DEAL.REWARD.QTY%(1)
 186: 0000:     INTEGER*4 GLOBAL    DEAL.REWARD.AMNT%(1)
 187: 0000:     INTEGER*1 GLOBAL    DEAL.REWARD.LIST%(1)
 188: 0000:     INTEGER*1 GLOBAL    DEAL.QLFY.MSG%(1)
 189: 0000:     INTEGER*1 GLOBAL    DEAL.REWARD.MSG%(1)
 190: 0000: 
 191: 0000:     STRING GLOBAL       DEAL.TILL.DATA$
 192: 0000:     STRING GLOBAL       DEAL.DATA$
 193: 0000:     STRING GLOBAL       DEAL.ACTIVE.FLAGS$
 194: 0000:     STRING GLOBAL       DEAL.ACTIVE.FLAG$
 195: 0000:     STRING GLOBAL       DEAL.BUSINESS.CENTRE$
 196: 0000:     STRING GLOBAL       DEAL.DEAL.DESC$
 197: 0000:     STRING GLOBAL       DEAL.DEAL.MODEL$
 198: 0000:     STRING GLOBAL       DEAL.START.DATE$
 199: 0000:     STRING GLOBAL       DEAL.END.DATE$
 200: 0000:     STRING GLOBAL       DEAL.START.TIME$
 201: 0000:     STRING GLOBAL       DEAL.END.TIME$
 202: 0000:     STRING GLOBAL       DEAL.QLFY.MSG.RCPT$(1)
 203: 0000:     STRING GLOBAL       DEAL.QLFY.MSG.DISP$(1)
 204: 0000:     STRING GLOBAL       DEAL.REWARD.MSG.RCPT$(1)
 205: 0000:     STRING GLOBAL       DEAL.FILLER$
 206: 0000: 
 207: 0000:     INTEGER*1 GLOBAL    DEAL.NUM.QLFNS%
 208: 0000:     INTEGER*1 GLOBAL    DEAL.NUM.REWARDS%
 209: 0000: 
 210: 0000: !****************************************************************************
 211: 0000: 
 212: 0000: !%INCLUDE DINFDEC.J86   !DINF FUNCTION                                  !EMM
 213: 0000: %INCLUDE ITMDLDEC.J86   !ITMDL FUNCTION                                 !EMM
 214: 0000: \*******************************************************************************
 215: 0000: \*******************************************************************************
 216: 0000: \***
 217: 0000: \***    %INCLUDE FOR ITEM-DEALS FILE VARIABLE DECLARATIONS
 218: 0000: \***
 219: 0000: \***        REFERENCE   :   ITMDLDEC.J86
 220: 0000: \***        FILE TYPE   :   Keyed
 221: 0000: \***        AUTHOR      :   Sandhya Pillai
 222: 0000: \***        DATE        :   09/06/2014
 223: 0000: \***
 224: 0000: \***    Version B               Mark Walker                           11/07/2014
 225: 0000: \***    Added variable for ITMDL.DEAL.NUM$ an individual deal number.
 226: 0000: \***
 227: 0000: \***    Version C               Sandhya Pillai                        17/07/2014
 228: 0000: \***    Added variable ITMDL.MAXDEALS.PER.ITEM% for use by other modules
 229: 0000: \***
 230: 0000: \***    Version D               Mark Walker                           24/07/2014
 231: 0000: \***    Includes the following enhancements:
 232: 0000: \***    - Changed local variables ITMDL.DEAL.MAX% and ITMDL.DEALID.START.POS%
 233: 0000: \***      to global to allow them to be referenced by calling programs.
 234: 0000: \***    - Added global variable ITMDL.MAX.ITEMS.PER.DEAL% for use by
 235: 0000: \***      calling programs.
 236: 0000: \***
 237: 0000: \***********************************************************************
 238: 0000: \***********************************************************************
 239: 0000: \*
 240: 0000: \*    ITMDL RECORD LAYOUT
 241: 0000: \*
 242: 0000: \*    St Ln  Typ   Variable Name        Description
 243: 0000: \*                 excl prefix ITMDL.
 244: 0000: \*
 245: 0000: \*    1  4  UPD   ITEM.REC.KEY$          Record key - Combination of
 246: 0000: \*                                        item code and record number
 247: 0000: \*    1  3  UPD   ITEM.CODE$             Six digit Boots item code
 248: 0000: \*    4  1  UPD   REC.NUM$                From 1-99 records per item
 249: 0000: \*                                        (giving max 1980 deals per
 250: 0000: \*                                        items)
 251: 0000: \*    5  1  ASC   EXCLUSION$              "L" Local priced item excluded
 252: 0000: \*                                        from deal (or blank X'20')
 253: 0000: \*    6  7  ASC   RESERVED$               Null - Reserved for future use
 254: 0000: \*   13  *  60    ITMDL.DEAL.NUM.LID.20$  Deal number List ID array
 255: 0000: \*    *  3  UPD   DEAL.NUM.LID$(n)        Occurs up to 20 times per
 256: 0000: \*                                        record with unused entries
 257: 0000: \*                                        set to null
 258: 0000: \*    *  2  UPD   DEAL.NUM$(n)            Four digit deal number
 259: 0000: \*    *  1  UPD   LIST.ID$(n)             List ID is INT (on DINF) but
 260: 0000: \*                                        only holds values 0-3 so will
 261: 0000: \*                                        be read as UPD
 262: 0000: \***********************************************************************
 263: 0000: 
 264: 0000:     STRING GLOBAL                                                       \
 265: 0000:         ITMDL.ALL.DEAL.NUM.LIST.ID$,                                    \
 266: 0000:         ITMDL.DEAL.NUM$,                                                \   !BMW
 267: 0000:         ITMDL.EXCLUSION$,                                               \
 268: 0000:         ITMDL.FILE.NAME$,                                               \
 269: 0000:         ITMDL.ITEM.CODE$,                                               \
 270: 0000:         ITMDL.REC.NUM$
 271: 0000: 
 272: 0000:     INTEGER*1 GLOBAL                                                    \
 273: 0000:         ITMDL.DEALID.START.POS%,                                        \   !DMW
 274: 0000:         ITMDL.DEALNUM.LID.LEN%,                                         \
 275: 0000:         ITMDL.RECL%
 276: 0000: 
 277: 0000:     INTEGER*2 GLOBAL                                                    \
 278: 0000:         ITMDL.DEAL.COUNT%,                                              \
 279: 0000:         ITMDL.DEAL.MAX%,                                                \   !DMW
 280: 0000:         ITMDL.MAXDEALS.PER.ITEM%,                                       \   !CSP
 281: 0000:         ITMDL.MAX.ITEMS.PER.DEAL%,                                      \   !DMW
 282: 0000:         ITMDL.REPORT.NUM%,                                              \
 283: 0000:         ITMDL.SESS.NUM%
 284: 0000: 
 285: 0000: %INCLUDE PSBF41G.J86    !UPDATE IRF FUNCTION
 286: 0000: !******************************************************************************
 287: 0000: !******************************************************************************
 288: 0000: !***
 289: 0000: !***            PROGRAM         :       PSBF41G.J86
 290: 0000: !***
 291: 0000: !***            DESCRIPTION     :       Update all IRF barcodes function
 292: 0000: !***
 293: 0000: !***            AUTHOR          :       Brian Greenfield
 294: 0000: !***            DATE WRITTEN    :       July 2002
 295: 0000: !***
 296: 0000: !***        Pass in the Boots Item Code (7 digits) in the UPDATE.ITEM.CODE$
 297: 0000: !***        variable and this function updates every single record linked to 
 298: 0000: !***        that item code on the IRF.
 299: 0000: !***        You MUST have the IRF, IDF, & IEF open when calling this function.
 300: 0000: !***
 301: 0000: !***        There are no globals for this function
 302: 0000: !***
 303: 0000: !******************************************************************************
 304: 0000: !******************************************************************************
 305: 0000:     
 306: 0000: !******************************************************************************
 307: 0000: 
 308: 0000: %INCLUDE IRFDEC.J86     !IRF FUNCTIONS
 309: 0000: 
 310: 0000: \**********************************************************************************
 311: 0000: \***
 312: 0000: \***       %INCLUDE FOR ITEM RECORD FILE - FIELD DECLARATIONS
 313: 0000: \***                                     - FILE REFERENCE PARAMETERS
 314: 0000: \***
 315: 0000: \***                      FILE TYPE    : Keyed
 316: 0000: \***
 317: 0000: \***                      REFERENCE    : IRFDEC.J86
 318: 0000: \***
 319: 0000: \***     Version A               Andrew Wedgeworth            29th June 1992
 320: 0000: \***
 321: 0000: \***     Version B               Andrew Wedgeworth        14th December 1992
 322: 0000: \***     Version letter incremented to match other IRF code.
 323: 0000: \***
 324: 0000: \***     Version C             Steve Windsor          12.02.93
 325: 0000: \***     Version letter incremented to match other IRF code.
 326: 0000: \***
 327: 0000: \***     Version D             Steve Windsor          12.05.93
 328: 0000: \***     Version letter incremented to match other IRF code.
 329: 0000: \***
 330: 0000: \***     Version E           Steve Perkins       20th September 1993
 331: 0000: \***     Deals project : Handling of Converted/Unconverted records
 332: 0000: \***     ++   Anything with 'Delete' after initials should be   ++
 333: 0000: \***     ++   deleted once the IRF has been converted in all    ++
 334: 0000: \***     ++   stores.                                           ++
 335: 0000: \***
 336: 0000: \***     Version F           Mark Walker            5th January 1994
 337: 0000: \***     Version letter incremented to match other IRF code.
 338: 0000: \***
 339: 0000: \***     Version 96A         Mark Walker               22nd May 1995
 340: 0000: \***     Definition for IRF.POINTS% added.
 341: 0000: \***
 342: 0000: \***                     Stuart McConnachie           12th June 1995
 343: 0000: \***     INDICAT3% comments added for discount/loyalty flags.
 344: 0000: \***
 345: 0000: \***     Version for 96C  Andrew Wedgeworth            22nd May 1996
 346: 0000: \***     Removed IRF.FILLER$ field, as this is now redundant.
 347: 0000: \***
 348: 0000: \***     Version G     Stuart William McConnachie      11th February 2000
 349: 0000: \***     Converted IRF.INDICAT2$ to integer flag byte.
 350: 0000: \***
 351: 0000: \***     REVISION 1.6.               ROBERT COWEY.               9 JUL 2002.
 352: 0000: \***     Major changes for 2002 Deals Rewrite project.
 353: 0000: \***     Incorporated up to date record layout to assist development work
 354: 0000: \***     (placed in the IRFDEC.J86 to make it visible from ...LST files).
 355: 0000: \***     Moved various comments against variables to record layout.
 356: 0000: \***     Relisted variables in alphabetical order.
 357: 0000: \***     Deleted redundant variables associated with the old deals system ...
 358: 0000: \***     DEAL.NUM$, DEAL.SAVING$
 359: 0000: \***     Retained variables that are otherwise redundant (to be set to null X'00'
 360: 0000: \***     within file functions) ...
 361: 0000: \***     INDICAT2%, INDICAT4%, SALEQUAN$, POINTS%
 362: 0000: \***     Defined variables to hold interpreted deals data for new deals system ...
 363: 0000: \***     DEAL.NUM$(n) and LIST.ID%(n) (where 'n' represents entry 0, 1 and 2).
 364: 0000: \***     These two variables are interpretations of DEAL.DATA% which is defined
 365: 0000: \***     locally within IRFFUN.BAS to keep underlying data invisible to programs.
 366: 0000: \***
 367: 0000: \***     REVISION 1.7                ROBERT COWEY.               5 AUG 2002.
 368: 0000: \***     Further changes for 2002 Deals Rewrite project (PSBF19 related).
 369: 0000: \***     Defined NEW.IRF.DATA$ as a global variable for use with new functions
 370: 0000: \***     CONCAT.NEW.IRF.DATA$ and SPLIT.NEW.IRF.DATA$.
 371: 0000: \***
 372: 0000: \***     REVISION 1.8                ROBERT COWEY.              15 JUL 2003.
 373: 0000: \***     Usage of INDICAT0% bit-3 X'08' changed to Item Contains Alcohol.
 374: 0000: \***     No changes to this file other than description.
 375: 0000: \***     No changes to IRF file functions.
 376: 0000: \***
 377: 0000: \***     REVISION 1.9.      STUART WILLIAM MCCONNACHIE           22 OCT 2003.
 378: 0000: \***     Changes to remove limit of 3 deals per item.
 379: 0000: \***     Declaration of new variables for IRF Deal Extension file (IRFDEX).
 380: 0000: \***
 381: 0000: \***     REVISION 2.0.            ALAN CARR                       9 FEB 2006.
 382: 0000: \***     Add new IRF.INDICAT8% 1 byte, amend IRF.UNUSED$ from 3 to 2 bytes.
 383: 0000: \***
 384: 0000: \***     REVISION 2.1              TITTOO THOMAS                  01 July 2011
 385: 0000: \***     The IRF.UNUSED field is disintegrated to 2 new indicator fields
 386: 0000: \***                      IRF.INDICAT9%   1 INT
 387: 0000: \***                      IRF.INDICAT10%  1 INT
 388: 0000: \***...............................................................................
 389: 0000: 
 390: 0000: 
 391: 0000: \**********************************************************************************
 392: 0000: \***
 393: 0000: \***    IRF RECORD LAYOUT - REVISION 1.7 - CORRECT FOR 2011 CORE Stores PROJECT
 394: 0000: \***
 395: 0000: \***     1 11  UPD  BAR.CODE$   Without check digit - File KEY
 396: 0000: \***    12  1  INT  INDICAT0%
 397: 0000: \***                    X"01" - Contains statins                           ! 2.2 TT
 398: 0000: \***                    X"02" - Item not priced (giveaway)
 399: 0000: \***                    X"04" - Item not returnable
 400: 0000: \***                    X"08" - Item contains alcohol
 401: 0000: \***                    X"10" - Blocked from sale                          ! 2.2 TT
 402: 0000: \***                    X"20" - Enforced price entry
 403: 0000: \***                    X"40" - Enforced quantity entry
 404: 0000: \***                    X"80" - Movement kept
 405: 0000: \***    13  1  INT  INDICAT1%
 406: 0000: \***                    X"01" - Asprin
 407: 0000: \***                    X"02" - Paracetamol
 408: 0000: \***                    X"04" - TPLU inclusion flag
 409: 0000: \***                    X"08" - Giftcard item                              ! 2.2 TT
 410: 0000: \***                    X"10" - Withdrawn Block from sale                  ! 2.2 TT
 411: 0000: \***                    X"20" - Non-solid dose painkiller                  ! 2.2 TT
 412: 0000: \***                    X"40" - Insurance policy item                      ! 2.2 TT
 413: 0000: \***                    X"80" - Ibuprofen
 414: 0000: \***    14  2  INT  DEAL.DATA%(0)   Interpreted into sub-variables ...
 415: 0000: \***                    X'3F' - into DEAL.NUM$(0) "0000" to "9999" (2 byte UPD)
 416: 0000: \***                    X'C0' - into LIST.ID%(0) X'00' X
 417: 0000: \***                                             X'01' A
 418: 0000: \***                                             X'10' B
 419: 0000: \***                                             X'11' C                   ! 1.9 RC
 420: 0000: \***    16  1  INT  INDICAT8%                                              ! 2.0 AJC
 421: 0000: \***                    X"01" - Chlamydia NHS test kit                     ! 2.2 TT
 422: 0000: \***                    X"02" - Chlamydia open sell test kit               ! 2.2 TT
 423: 0000: \***                    X"04" - Unrestricted group code                    ! 2.2 TT
 424: 0000: \***                    X"08" - Nightingale Till prompt                    ! 2.2 TT
 425: 0000: \***                    X"10" - Contains Ephedrine                         ! 2.2 TT
 426: 0000: \***                    X"60" -  X'00' - If also Blocked From Sale Recall, ! 2.2 TT
 427: 0000: \***                                        Emergency                      ! 2.2 TT
 428: 0000: \***                             X'00' - If NOT Blocked From Sale Recall,  ! 2.2 TT
 429: 0000: \***                                        No recall                      ! 2.2 TT
 430: 0000: \***                             X'20' 100% returns                        ! 2.2 TT
 431: 0000: \***                             X'40' Withdrawn recall                    ! 2.2 TT
 432: 0000: \***                             X'60' Reverse Logistics                   ! 2.2 TT
 433: 0000: \***                    X"80" - WEEE item flag                             ! 2.0 AJC
 434: 0000: \***    17  1  INT  INDICAT9%
 435: 0000: \***                    X'3F' - Disposal special instruction (0-63)
 436: 0000: \***                    X"40" - Resaleable Indicator
 437: 0000: \***                    X"80" - Boots.com Extended Indicator
 438: 0000: \***    18  1  INT  INDICAT10%
 439: 0000: \***                    X'07' - Age restrictions
 440: 0000: \***                             X'00' - No Age restriction
 441: 0000: \***                             X'01' - Age 12 or over
 442: 0000: \***                             X'02' - Age 15 or over
 443: 0000: \***                             X'03' - Age 16 or over
 444: 0000: \***                             X'04' - Age 18 or over
 445: 0000: \***                             X'05' - Age 21 or over
 446: 0000: \***                             X'06' - Reserved
 447: 0000: \***                             X'07' - Reserved
 448: 0000: \***                    X'38' - Ethical classification
 449: 0000: \***                             X'00' - No ethical classification
 450: 0000: \***                             X'08' - Pharmacy medicine (P)
 451: 0000: \***                             X'10' - General Sale License (GSL)
 452: 0000: \***                             X'18' - Prescription Only Medicine (POM)
 453: 0000: \***                             X'20' - Reserved
 454: 0000: \***                             X'28' - Reserved
 455: 0000: \***                             X'30' - Reserved
 456: 0000: \***                             X'38' - Reserved
 457: 0000: \***                    X'C0' - Returns route
 458: 0000: \***                             X'00' - Not Returnable (Destroy)
 459: 0000: \***                             X'40' - Returns & Recovery
 460: 0000: \***                             X'80' - Direct
 461: 0000: \***                             X'C0' - Semi-centralised
 462: 0000: \***    19  5  UPD  SALEPRIC$   Current price in pence
 463: 0000: \***    24  1  INT  INDICAT5%   Guarantee duration
 464: 0000: \***                    X'3F' - Lowest 6 bits indicate duration (1-63)
 465: 0000: \***                    X'40' - Contains Pseudoephedrine                   ! 2.2 TT
 466: 0000: \***                    X'80' - Guarantee Duration Type                    ! 2.2 TT
 467: 0000: \***                              (1 = Months, 0 = Years)                  ! 2.2 TT
 468: 0000: \***    25 18  ASC  ITEMNAME$   Description used by till
 469: 0000: \***    43  3  UPD  BOOTS.CODE$ Without check digit
 470: 0000: \***    46  2  INT  DEAL.DATA%(1)   Similar structure to DEAL.DATA%(0)
 471: 0000: \***    48  2  INT  DEAL.DATA%(2)   Similar structure to DEAL.DATA%(0)
 472: 0000: \***    50  1  INT  INDICAT3%
 473: 0000: \***                    X"01" - Discountexempt (item exempt from discount)
 474: 0000: \***                    X"02" - Boots brand item
 475: 0000: \***                    X"04" - Item redeemable for loyalty
 476: 0000: \***                    X"08" - Loyalty exempt (item exempt from loyalty)
 477: 0000: \***                    X"10" - **Redundant                                ! 2.2 TT
 478: 0000: \***                    X"20" - Local Price active
 479: 0000: \***                    X"40" - Stock system item
 480: 0000: \***                    X"80" - **Redundant                                ! 2.2 TT
 481: 0000: \***
 482: 0000: \***    Record Length 50
 483: 0000: \***
 484: 0000: \***
 485: 0000: \***    IRF DEAL EXTENSION RECORD LAYOUT ! 1.9 RC
 486: 0000: \***
 487: 0000: \***     1  3  UPD  BOOTS.CODE$
 488: 0000: \***     4  2  INT  IRF.DEAL.DATA%(3)   Similar structure to DEAL.DATA%(0)
 489: 0000: \***     6  2  INT  IRF.DEAL.DATA%(4)   Similar structure to DEAL.DATA%(0)
 490: 0000: \***     8  2  INT  IRF.DEAL.DATA%(5)   Similar structure to DEAL.DATA%(0)
 491: 0000: \***    10  2  INT  IRF.DEAL.DATA%(6)   Similar structure to DEAL.DATA%(0)
 492: 0000: \***    12  2  INT  IRF.DEAL.DATA%(7)   Similar structure to DEAL.DATA%(0)
 493: 0000: \***    14  2  INT  IRF.DEAL.DATA%(8)   Similar structure to DEAL.DATA%(0)
 494: 0000: \***    16  2  INT  IRF.DEAL.DATA%(9)   Similar structure to DEAL.DATA%(0)
 495: 0000: \***
 496: 0000: \***    Record Length 17
 497: 0000: \***
 498: 0000: \**********************************************************************************
 499: 0000: 
 500: 0000: 
 501: 0000:     STRING GLOBAL            \
 502: 0000:         IRF.ALT.FILE.NAME$,  \
 503: 0000:         IRF.BAR.CODE$,       \
 504: 0000:         IRF.BOOTS.CODE$,     \
 505: 0000:         IRF.DEAL.SAVING$,    \ 2 byte - deal saving amount (0 - œ99.99) ! ESP
 506: 0000:         IRF.DEPARTME$,       \ 3 byte UPD. Department number          ! ESP Delete
 507: 0000:         IRF.FILE.NAME$,      \
 508: 0000:         IRF.HOLDING.PRICE$,  \ 4 byte UPD. Current H.O. price in pence if a local
 509: 0000:                              \ price is in effect, zero otherwise.     ! ESP Delete
 510: 0000:         IRF.ITEMNAME$,       \
 511: 0000: \       IRF.MPGROUP$,        \ Removed SBH 31/1/96
 512: 0000:         IRF.RECORD$,         \                                         ! ESP Delete
 513: 0000:         IRF.SALEPRIC$,       \
 514: 0000:         IRF.SALEQUAN$,       \ Redundant (set to null within functions)    ! 1.6 RC
 515: 0000:         IRF.UNUSED$,         \                                                        ! 1.6 RC
 516: 0000:         NEW.IRF.DATA$        !                                             ! 1.7 RC
 517: 0000: 
 518: 0000:     STRING GLOBAL            \                                             ! 1.6 RC
 519: 0000:         IRF.DEAL.NUM$(1)                                                   ! 1.6 RC
 520: 0000: 
 521: 0000:     INTEGER*1 GLOBAL         \
 522: 0000:         IRF.DD.SUB%,         \ IRF.DEAL.DATA% subscript                    ! 1.6 RC
 523: 0000:         IRF.INDICAT0%,       \
 524: 0000:         IRF.INDICAT1%,       \
 525: 0000:         IRF.INDICAT2%,       \ Redundant (set to null within functions)    ! 1.6 RC
 526: 0000:         IRF.INDICAT3%,       \
 527: 0000:         IRF.INDICAT4%,       \ Redundant (set to null within functions)    ! 1.6 RC
 528: 0000:         IRF.INDICAT5%,       \                                             ! 2.0 AJC
 529: 0000:         IRF.INDICAT8%,       \                                             ! 2.0 AJC
 530: 0000:         IRF.INDICAT9%,       \                                             ! 2.2 TT
 531: 0000:         IRF.INDICAT10%                                                     ! 2.2 TT
 532: 0000: 
 533: 0000:     INTEGER*1 GLOBAL         \                                             ! 1.6 RC
 534: 0000:         IRF.LIST.ID%(1)                                                    ! 1.6 RC
 535: 0000: 
 536: 0000:     INTEGER*2 GLOBAL         \
 537: 0000:         IRF.ALT.REPORT.NUM%, \
 538: 0000:         IRF.ALT.SESS.NUM%,   \
 539: 0000:         IRF.POINTS%,         \ Redundant (set to null within functions)    ! 1.6 RC
 540: 0000:         IRF.RECL%,           \
 541: 0000:         IRF.REPORT.NUM%,     \
 542: 0000:         IRF.SESS.NUM%,       \
 543: 0000:         IRF.MAX.DEALS%       !                                             ! 1.9 SM
 544: 0000: 
 545: 0000:     STRING GLOBAL IRFDEX.FILE.NAME$                                        ! 1.9 SM
 546: 0000: 
 547: 0000:     INTEGER*2 GLOBAL IRFDEX.SESS.NUM%                                      ! 1.9 SM
 548: 0000:     INTEGER*2 GLOBAL IRFDEX.REPORT.NUM%                                    ! 1.9 SM
 549: 0000:     INTEGER*2 GLOBAL IRFDEX.RECL%                                          ! 1.9 SM
 550: 0000: 
 551: 0000: 
 552: 0000: !   INTEGER*2 GLOBAL      \ IRF.DEAL.DATA%(n) variables are defined locally  1.6 RC
 553: 0000: !       IRF.DEAL.DATA%(1) \ within IRFFUN.BAS to keep invisible to programs  1.6 RC
 554: 0000: 
 555: 0000: %INCLUDE PSBF18G.J86    !CALCULATE BOOTS CHECK DIGIT
 556: 0000: REM\
 557: 0000: \*******************************************************************************
 558: 0000: \*******************************************************************************
 559: 0000: \***
 560: 0000: \***        INCLUDE       : CALC.BOOTS.CODE.CHECK.DIGIT globals
 561: 0000: \***
 562: 0000: \***        REFERENCE     : PSBF18G.J86
 563: 0000: \***
 564: 0000: \***        Version A     Stephen Kelsey                  23rd March 1987
 565: 0000: \***
 566: 0000: \***        Version B     Andrew Wedgeworth                 7th July 1992
 567: 0000: \***        Removal of return code field which no longer required.
 568: 0000: \***
 569: 0000: \*******************************************************************************
 570: 0000: \*******************************************************************************
 571: 0000: 
 572: 0000:       STRING   GLOBAL F18.CHECK.DIGIT$
 573: 0000:     
 574: 0000:       ! 1 line deleted from here                                       ! BAW    
 575: 0000: 
 576: 0000: %INCLUDE PSBF19G.J86    !UPDATE IRF GLOBALS
 577: 0000: REM \
 578: 0000: \*******************************************************************************
 579: 0000: \*******************************************************************************
 580: 0000: \***
 581: 0000: \***
 582: 0000: \***            INCLUDE       : UPDATE IRF globals
 583: 0000: \***
 584: 0000: \***            REFERENCE     : PSBF19G.J86
 585: 0000: \***
 586: 0000: \***      Version A              Richard Hopkinson            16th March 1988
 587: 0000: \***
 588: 0000: \***      Version B              Janet Lawrence               12th April 1989
 589: 0000: \***      Version letter incremented to match that of external defintion of 
 590: 0000: \***      function 19.  
 591: 0000: \***
 592: 0000: \***      Version C              Andrew Wedgeworth             21st July 1992
 593: 0000: \***      Return code field removed as no longer used.
 594: 0000: \***
 595: 0000: \***      Version F              Steve Perkins                 20th October 1993
 596: 0000: \***      Version letter updated to keep in line with PSBF19.BAS
 597: 0000: \***
 598: 0000: \***    REVISION 1.9.                ROBERT COWEY.                08 DEC 2003.
 599: 0000: \***    Changes for Deal Limit removal project.
 600: 0000: \***    Revision number updated to keep in step with PSBF19.BAS.
 601: 0000: \***    Declared variables for IRFDEX and F19.NODE.FILE...
 602: 0000: \***
 603: 0000: \*******************************************************************************
 604: 0000: \*******************************************************************************
 605: 0000: 
 606: 0000:       STRING   F19.RETURNED.STRING                                     ! CAW
 607: 0000:       STRING   F19.NODE.FILE.NAME$                                         ! 1.9 RC
 608: 0000: 
 609: 0000:       STRING   GLOBAL NODE.ID$
 610: 0000:       STRING   GLOBAL TIF.FULL$
 611: 0000:       STRING   GLOBAL TIF.OPEN.FLAG$
 612: 0000:       STRING   GLOBAL TMCF.FULL$
 613: 0000:       STRING   GLOBAL TMCF.OPEN.FLAG$
 614: 0000:       
 615: 0000:       INTEGER*2 GLOBAL F19.IRFDEX.SESS.NUM%                                ! 1.9 RC
 616: 0000:       
 617: 0000:       INTEGER*2 F19.NODE.REPORT.NUM%                                       ! 1.9 RC
 618: 0000:       INTEGER*2 F19.NODE.SESS.NUM%                                         ! 1.9 RC
 619: 0000: 
 620: 0000: !******************************************************************************
 621: 0000: 
 622: 0000: %INCLUDE DEALEXT.J86    !DEAL EXTERNALS
 623: 0000: !****************************************************************************
 624: 0000: !
 625: 0000: !       MODULE:         DEAL FILE FUNCTIONS
 626: 0000: !
 627: 0000: !       AUTHOR:         STUART WILLIAM MCCONNACHIE
 628: 0000: !
 629: 0000: !       DATE:           AUGUST 2002
 630: 0000: !
 631: 0000: !****************************************************************************
 632: 0000: !
 633: 0000: !       VERSION A           STUART WILLIAM MCCONNACHIE          AUG 2002
 634: 0000: !
 635: 0000: !       Functions for adding and removing deals from the new format DEAL
 636: 0000: !       file for the flexible deals project.
 637: 0000: !       Note the deal file is a double linked list of all deals on the
 638: 0000: !       system, so must not be updated directly without using the function.
 639: 0000: !
 640: 0000: !       VERSION B           STUART WILLIAM MCCONNACHIE          OCT 2003
 641: 0000: !
 642: 0000: !       Added buffering of DEAL file for reads via READ.DEAL.BUFFER.
 643: 0000: !       Speeds up operation of PSBF42 when used there.
 644: 0000: !       
 645: 0000: !       VERSION C           STUART WILLIAM MCCONNACHIE          AUG 2005
 646: 0000: !
 647: 0000: !       Addition of DEAL MODEL file.
 648: 0000: !       
 649: 0000: !****************************************************************************
 650: 0000: 
 651: 0000:     FUNCTION DEAL.SET EXTERNAL
 652: 0000:         INTEGER*1   DEAL.SET
 653: 0000:     END FUNCTION
 654: 0000: 
 655: 0000: !****************************************************************************
 656: 0000: 
 657: 0000:     FUNCTION READ.DEAL EXTERNAL
 658: 0000:         INTEGER*1   READ.DEAL
 659: 0000:     END FUNCTION
 660: 0000: 
 661: 0000: !****************************************************************************
 662: 0000: 
 663: 0000:     FUNCTION READ.DEAL.MODEL EXTERNAL                                       !CSWM
 664: 0000:         INTEGER*1   READ.DEAL.MODEL                                         !CSWM
 665: 0000:     END FUNCTION                                                            !CSWM
 666: 0000: 
 667: 0000: !****************************************************************************
 668: 0000: 
 669: 0000:     FUNCTION READ.DEAL.BUFFER EXTERNAL                                      !BSWM
 670: 0000:         INTEGER*1   READ.DEAL.BUFFER                                        !BSWM
 671: 0000:     END FUNCTION                                                            !BSWM
 672: 0000:     
 673: 0000: !****************************************************************************
 674: 0000: 
 675: 0000:     SUB DEAL.SPLIT.RECORD EXTERNAL
 676: 0000:     END SUB
 677: 0000: 
 678: 0000: !****************************************************************************
 679: 0000: 
 680: 0000:     SUB DEAL.CONCAT.RECORD EXTERNAL
 681: 0000:     END SUB
 682: 0000: 
 683: 0000: !****************************************************************************
 684: 0000: 
 685: 0000:     SUB DEAL.SAVE (SAVE$) EXTERNAL                                          !BSWM
 686: 0000:         STRING      SAVE$                                                   !BSWM
 687: 0000:     END SUB                                                                 !BSWM
 688: 0000:     
 689: 0000: !****************************************************************************
 690: 0000: 
 691: 0000:     SUB DEAL.RESTORE (RESTORE$) EXTERNAL                                    !BSWM
 692: 0000:         STRING      RESTORE$                                                !BSWM
 693: 0000:     END SUB                                                                 !BSWM
 694: 0000:         
 695: 0000: !****************************************************************************
 696: 0000:     
 697: 0000:     FUNCTION ADD.OR.UPDATE.DEAL (DEAL.NUM$, RECORD$) EXTERNAL
 698: 0000:         INTEGER*1   ADD.OR.UPDATE.DEAL
 699: 0000:         STRING      DEAL.NUM$
 700: 0000:         STRING      RECORD$
 701: 0000:     END FUNCTION
 702: 0000: 
 703: 0000: !****************************************************************************
 704: 0000:     
 705: 0000:     FUNCTION ADD.OR.UPDATE.DEAL.MODEL (DEAL.NUM$, RECORD$) EXTERNAL         !CSWM
 706: 0000:         INTEGER*1   ADD.OR.UPDATE.DEAL.MODEL                                !CSWM
 707: 0000:         STRING      DEAL.NUM$                                               !CSWM
 708: 0000:         STRING      RECORD$                                                 !CSWM
 709: 0000:     END FUNCTION                                                            !CSWM
 710: 0000: 
 711: 0000: !****************************************************************************
 712: 0000: 
 713: 0000:     FUNCTION REMOVE.DEAL (DEAL.NUM$) EXTERNAL
 714: 0000:         INTEGER*1   REMOVE.DEAL
 715: 0000:         STRING      DEAL.NUM$
 716: 0000:     END FUNCTION
 717: 0000: 
 718: 0000: !****************************************************************************
 719: 0000: 
 720: 0000:     FUNCTION REMOVE.DEAL.MODEL (DEAL.NUM$) EXTERNAL                         !CSWM
 721: 0000:         INTEGER*1   REMOVE.DEAL.MODEL                                       !CSWM
 722: 0000:         STRING      DEAL.NUM$                                               !CSWM
 723: 0000:     END FUNCTION                                                            !CSWM
 724: 0000: 
 725: 0000: !****************************************************************************
 726: 0000: 
 727: 0000:     FUNCTION GET.NEXT.DEAL (DEAL.NUM$) EXTERNAL
 728: 0000:         INTEGER*1   GET.NEXT.DEAL
 729: 0000:         STRING      DEAL.NUM$
 730: 0000:      END FUNCTION
 731: 0000: 
 732: 0000: !****************************************************************************
 733: 0000: 
 734: 0000:     FUNCTION GET.NEXT.DEAL.MODEL (DEAL.NUM$) EXTERNAL                       !CSWM
 735: 0000:         INTEGER*1   GET.NEXT.DEAL.MODEL                                     !CSWM
 736: 0000:         STRING      DEAL.NUM$                                               !CSWM
 737: 0000:      END FUNCTION                                                           !CSWM
 738: 0000: 
 739: 0000: !****************************************************************************
 740: 0000: 
 741: 0000:     FUNCTION GET.FIRST.DEAL EXTERNAL
 742: 0000:         INTEGER*1   GET.FIRST.DEAL
 743: 0000:     END FUNCTION
 744: 0000: 
 745: 0000: !****************************************************************************
 746: 0000: 
 747: 0000:     FUNCTION GET.FIRST.DEAL.MODEL EXTERNAL                                  !CSWM
 748: 0000:         INTEGER*1   GET.FIRST.DEAL.MODEL                                    !CSWM
 749: 0000:     END FUNCTION                                                            !CSWM
 750: 0000: 
 751: 0000: !****************************************************************************
 752: 0000: 
 753: 0000:     SUB FLUSH.DEAL.BUFFER EXTERNAL                                          !BSWM
 754: 0000:     END SUB                                                                 !BSWM
 755: 0000: 
 756: 0000: !****************************************************************************
 757: 0000: 
 758: 0000: !%INCLUDE DINFEXT.J86   !DINF EXTERNALS                                 !EMM
 759: 0000: %INCLUDE ITMDLEXT.J86   !ITMDL EXTERNALS                                !EMM
 760: 0000: \*******************************************************************************
 761: 0000: \*******************************************************************************
 762: 0000: \***
 763: 0000: \***    %INCLUDE FOR ITEM-DEALS FILE EXTERNAL FUNCTION DECLARATIONS
 764: 0000: \***
 765: 0000: \***        REFERENCE   :   ITMDLEXT.J86
 766: 0000: \***        FILE TYPE   :   Keyed
 767: 0000: \***        AUTHOR      :   Sandhya Pillai
 768: 0000: \***        DATE        :   09/06/2014
 769: 0000: \***
 770: 0000: \***
 771: 0000: \***    Version B               Mark Walker                           11/07/2014
 772: 0000: \***    Added functions for adding and removing individual items.
 773: 0000: \***
 774: 0000: \***    Version C               Mark Walker                           15/07/2014
 775: 0000: \***    Added local pricing support.
 776: 0000: \***
 777: 0000: \***    Version D               Mark Walker                           14/08/2014
 778: 0000: \***    Added file function for opening the ITMDL file.
 779: 0000: \***
 780: 0000: \*******************************************************************************
 781: 0000: \*******************************************************************************
 782: 0000: 
 783: 0000: FUNCTION ITMDL.SET EXTERNAL
 784: 0000:     INTEGER*1 ITMDL.SET
 785: 0000: END FUNCTION
 786: 0000: 
 787: 0000: FUNCTION READ.ITMDL EXTERNAL
 788: 0000:     INTEGER*1 READ.ITMDL
 789: 0000: END FUNCTION
 790: 0000: 
 791: 0000: FUNCTION WRITE.ITMDL EXTERNAL
 792: 0000:     INTEGER*1 WRITE.ITMDL
 793: 0000: END FUNCTION
 794: 0000: 
 795: 0000: FUNCTION SPLIT.READ.ITMDL.DIRECT(ITMDL.RECORD$) EXTERNAL
 796: 0000:     INTEGER*1 SPLIT.READ.ITMDL.DIRECT
 797: 0000:     STRING ITMDL.RECORD$                                                    !BMW
 798: 0000: END FUNCTION
 799: 0000: 
 800: 0000: SUB ITMDL.SAVE(SAVE$) EXTERNAL
 801: 0000:     STRING SAVE$                                                            !BMW
 802: 0000: END SUB
 803: 0000: 
 804: 0000: SUB ITMDL.RESTORE(RESTORE$) EXTERNAL
 805: 0000:     STRING RESTORE$                                                         !BMW
 806: 0000: END SUB
 807: 0000: 
 808: 0000: FUNCTION ITMDL.ADD.DEAL.ITEM(DEAL.NUMBER$,                              \   !BMW
 809: 0000:                              LIST.NUMBER%,                              \   !BMW
 810: 0000:                              ITEM.CODE$,                                \   !CMW
 811: 0000:                              EXCLUSION.FLAG%) EXTERNAL                      !CMW
 812: 0000:     INTEGER*1 ITMDL.ADD.DEAL.ITEM                                           !BMW
 813: 0000:     STRING DEAL.NUMBER$                                                     !BMW
 814: 0000:     STRING ITEM.CODE$                                                       !BMW
 815: 0000:     STRING LIST.ID$                                                         !BMW
 816: 0000:     INTEGER*1 EXCLUSION.FLAG%                                               !CMW
 817: 0000: END FUNCTION                                                                !BMW
 818: 0000: 
 819: 0000: FUNCTION ITMDL.REMOVE.DEAL.ITEM(DEAL.NUMBER$,                           \   !BMW
 820: 0000:                                 ITEM.CODE$) EXTERNAL                        !BMW
 821: 0000:     INTEGER*1 ITMDL.REMOVE.DEAL.ITEM                                        !BMW
 822: 0000:     STRING DEAL.NUMBER$                                                     !BMW
 823: 0000:     STRING ITEM.CODE$                                                       !BMW
 824: 0000: END FUNCTION                                                                !BMW
 825: 0000: 
 826: 0000: FUNCTION OPEN.ITMDL EXTERNAL                                                !DMW
 827: 0000:     INTEGER*1 OPEN.ITMDL                                                    !DMW
 828: 0000: END FUNCTION                                                                !DMW
 829: 0000: 
 830: 0000: %INCLUDE PSBF41E.J86    !UPDATE IRF EXTERNALS
 831: 0000: !******************************************************************************
 832: 0000: !******************************************************************************
 833: 0000: !***
 834: 0000: !***            PROGRAM         :       PSBF41E.J86
 835: 0000: !***
 836: 0000: !***            DESCRIPTION     :       Update all IRF barcodes function
 837: 0000: !***
 838: 0000: !***            AUTHOR          :       Brian Greenfield
 839: 0000: !***            DATE WRITTEN    :       July 2002
 840: 0000: !***
 841: 0000: !***        Pass in the Boots Item Code (7 digits) in the UPDATE.ITEM.CODE$
 842: 0000: !***        variable and this function updates every single record linked to 
 843: 0000: !***        that item code on the IRF.
 844: 0000: !***        You MUST have the IRF, IDF, & IEF open when calling this function.
 845: 0000: !***
 846: 0000: !******************************************************************************
 847: 0000: !******************************************************************************
 848: 0000:     
 849: 0000: FUNCTION UPDATE.ALL.IRF.BAR.CODES(UPDATE.ITEM.CODE$) EXTERNAL
 850: 0000: 
 851: 0000:     STRING UPDATE.ITEM.CODE$
 852: 0000:     INTEGER*1 UPDATE.ALL.IRF.BAR.CODES
 853: 0000:     
 854: 0000: END FUNCTION
 855: 0000: %INCLUDE IRFEXT.J86     !IRF EXTERNALS
 856: 0000: \*********************************************************************************
 857: 0000: \***
 858: 0000: \***      EXTERNAL FUNCTION DEFINITIONS FOR THE ITEM REFERENCE FILE
 859: 0000: \***
 860: 0000: \***                    REFERENCE : IRFEXT.J86
 861: 0000: \***
 862: 0000: \***      Version A          Andrew Wedgeworth        9th July 1992
 863: 0000: \***
 864: 0000: \***      Version B          Andrew Wedgeworth        14th December 1992
 865: 0000: \***      Version letter incremented to match other IRF code.
 866: 0000: \***
 867: 0000: \***      Version C           Steve Windsor        12.02.93
 868: 0000: \***      Added external reference to read the alternate IRF.
 869: 0000: \***
 870: 0000: \***      Version D           Steve Windsor        12.05.93
 871: 0000: \***      Added all external references that wre in the original FNS.
 872: 0000: \***
 873: 0000: \***      Version E           Steve Perkins        21.09.93
 874: 0000: \***      Deals project: Fields changed for new deals project
 875: 0000: \*** 
 876: 0000: \***      Version F           Mark Walker          5th January 1994
 877: 0000: \***      Version letter incremented to match other IRF code.           
 878: 0000: \***                                                                    
 879: 0000: \***      Version G     Stuart William McConnachie      11th February 2000
 880: 0000: \***      Converted IRF.INDICAT2$ to integer flag byte.
 881: 0000: \***
 882: 0000: \***      REVISION 1.6.               ROBERT COWEY.               9 JUL 2002.
 883: 0000: \***      Major changes to IRF layout for 2002 Deals Rewrite project.
 884: 0000: \***      No changes to this particular file for this revision.
 885: 0000: \***
 886: 0000: \***      REVISION 1.7.               ROBERT COWEY.               5 AUG 2002.
 887: 0000: \***      Further changes for 2002 Deals Rewrite project (PSBF19 related).
 888: 0000: \***      Defined new functions CONCAT.NEW.IRF.DATA$ and SPLIT.NEW.IRF.DATA$.
 889: 0000: \***
 890: 0000: \***      REVISION 1.8                ROBERT COWEY.              15 JUL 2003.
 891: 0000: \***      Usage of INDICAT0% bit-3 X'08' changed to Item Contains Alcohol.
 892: 0000: \***      No changes to this file other than description.
 893: 0000: \***      No changes to IRF file functions.
 894: 0000: \***
 895: 0000: \***      REVISION 1.9.      STUART WILLIAM MCCONNACHIE           22 OCT 2003.
 896: 0000: \***      Changes to remove limit of 3 deals per item.
 897: 0000: \***      No changes to this file.
 898: 0000: \***
 899: 0000: \***      REVISION 2.0.             ALAN CARR                      9 FEB 2006.
 900: 0000: \***      Add new IRF.INDICAT8% 1 byte, amend IRF.UNUSED$ from 3 to 2 bytes.
 901: 0000: \***      No changes to this file.
 902: 0000: \***
 903: 0000: \***..............................................................................
 904: 0000:    
 905: 0000:    FUNCTION IRF.SET EXTERNAL
 906: 0000:    END FUNCTION
 907: 0000: 
 908: 0000:   FUNCTION CONCAT.NEW.IRF.DATA$ EXTERNAL                                  ! 1.7 RC
 909: 0000:   END FUNCTION                                                            ! 1.7 RC
 910: 0000: 
 911: 0000:   FUNCTION SPLIT.NEW.IRF.DATA$ EXTERNAL                                   ! 1.7 RC
 912: 0000:   END FUNCTION                                                            ! 1.7 RC
 913: 0000:   
 914: 0000:   FUNCTION READ.IRF EXTERNAL
 915: 0000:    INTEGER*2 READ.IRF
 916: 0000:   END FUNCTION
 917: 0000: 
 918: 0000:   FUNCTION READ.IRF.ALT EXTERNAL
 919: 0000:    INTEGER*2 READ.IRF.ALT
 920: 0000:   END FUNCTION
 921: 0000: 
 922: 0000:   FUNCTION READ.IRF.LOCK EXTERNAL
 923: 0000:    INTEGER*2 READ.IRF.LOCK
 924: 0000:   END FUNCTION
 925: 0000: 
 926: 0000:   FUNCTION WRITE.IRF EXTERNAL
 927: 0000:    INTEGER*2 WRITE.IRF
 928: 0000:   END FUNCTION
 929: 0000: 
 930: 0000:   FUNCTION WRITE.IRF.UNLOCK EXTERNAL
 931: 0000:    INTEGER*2 WRITE.IRF.UNLOCK
 932: 0000:   END FUNCTION
 933: 0000: 
 934: 0000:   FUNCTION WRITE.IRF.HOLD EXTERNAL
 935: 0000:    INTEGER*2 WRITE.IRF.HOLD
 936: 0000:   END FUNCTION
 937: 0000: 
 938: 0000:   FUNCTION WRITE.IRF.HOLD.UNLOCK EXTERNAL
 939: 0000:    INTEGER*2 WRITE.IRF.HOLD.UNLOCK
 940: 0000:   END FUNCTION
 941: 0000: 
 942: 0000:   
 943: 0000: %INCLUDE PSBF18E.J86    !CALCULATE BOOTS CHECK DIGIT
 944: 0000: REM\
 945: 0000: \*******************************************************************************
 946: 0000: \*******************************************************************************
 947: 0000: \***
 948: 0000: \***        INCLUDE       : CALC.BOOTS.CODE.CHECK.DIGIT external definition
 949: 0000: \***
 950: 0000: \***        REFERENCE     : PSBF18E.J86
 951: 0000: \***
 952: 0000: \***        Version A      Stephen Kelsey                   23rd March 1987 
 953: 0000: \***
 954: 0000: \***        Version B      Andrew Wedgeworth                  7th July 1992 
 955: 0000: \***        Removal of redundant parameters, and inclusion of function's 
 956: 0000: \***        name as a variable to hold the return code.
 957: 0000: \***
 958: 0000: \*******************************************************************************
 959: 0000: \*******************************************************************************
 960: 0000: 
 961: 0000:    FUNCTION CALC.BOOTS.CODE.CHECK.DIGIT (BOOTS.CODE.6.DIGIT$)          \ 
 962: 0000:    EXTERNAL
 963: 0000:    ! 3 parameters removed from here                                    ! BAW
 964: 0000: 
 965: 0000:    STRING BOOTS.CODE.6.DIGIT$
 966: 0000:    ! 3 variables deleted from here                                     ! BAW
 967: 0000:    
 968: 0000:    INTEGER* 2 CALC.BOOTS.CODE.CHECK.DIGIT                              ! BAW
 969: 0000:    
 970: 0000:    END FUNCTION
 971: 0000: 
 972: 0000: %INCLUDE PSBF19E.J86    !UPDATE IRF EXTERNALS
 973: 0000: \*******************************************************************************! GCSk
 974: 0000: \*******************************************************************************! GCSk
 975: 0000: \***                                                                            ! GCSk
 976: 0000: \*** IMPORTANT                                                                  ! GCSk
 977: 0000: \*** =========                                                                  ! GCSk
 978: 0000: \***    All references to UPDT.IRF.UPDT have been commented out and replaced    ! GCSk
 979: 0000: \***    with UPDT.IRF.TIF.UPDT due to the following issue found post MCF:       ! GCSk
 980: 0000: \***                                                                            ! GCSk
 981: 0000: \***    Node ID check removed as it is preventing the TIF from being updated in ! GCSk
 982: 0000: \***    Single MCF controller stores ie. MCF has changed the single DE nodes    ! GCSk
 983: 0000: \***    to CE. This change should have been done as part of the MCF project,    ! GCSk
 984: 0000: \***    however, the Business were not willing to pay for the relinking and     ! GCSk
 985: 0000: \***    testing of some 200+ programs. There is a slight processing overhead    ! GCSk
 986: 0000: \***    in dual-MCF stores, since the TIF will now be updated in them as well,  ! GCSk
 987: 0000: \***    however the impact is small and TOF does not run in this environment.   ! GCSk
 988: 0000: \***                                                                            ! GCSk
 989: 0000: \***    If you wish to use the old UPDT.IRF.UPDT function then you will need to ! GCSk
 990: 0000: \***    either:                                                                 ! GCSk
 991: 0000: \***                                                                            ! GCSk
 992: 0000: \***          1. Check out the previous OBJs, PSBF19e.J86 and update the .INP   ! GCSk
 993: 0000: \***             and .MAK to include the functions PSBF19, PSBF41 & PSBF42      ! GCSk
 994: 0000: \***       or                                                                   ! GCSk
 995: 0000: \***          2. Check out the previous PSBF19e.J86 and function library:       ! GCSk
 996: 0000: \***             FUNLIB.L86                                                     ! GCSk
 997: 0000: \***                                                                            ! GCSk
 998: 0000: \*******************************************************************************! GCSk
 999: 0000: \*******************************************************************************! GCSk
1000: 0000: 
1001: 0000: REM \
1002: 0000: \*******************************************************************************
1003: 0000: \*******************************************************************************
1004: 0000: \***
1005: 0000: \***
1006: 0000: \***            INCLUDE       : IRF.UPDATE external definition
1007: 0000: \***
1008: 0000: \***            REFERENCE     : PSBF19E.J86
1009: 0000: \***
1010: 0000: \***      Version A      Richard Hopkinson                  16th March 1988
1011: 0000: \***
1012: 0000: \***      Version B      Janet Lawrence                     12th April 1989
1013: 0000: \***      Add extra parameter, IRF.LOCKED.FLAG$, to each function definition.
1014: 0000: \***
1015: 0000: \***      Version C      Andrew Wedgeworth                   21st July 1992
1016: 0000: \***      Redundant parameters removed (ie. BATCH.SCREEN.FLAG$,
1017: 0000: \***      MODULE.NUMBER$ and OPERATOR.NUMBER$).  Function names defined as
1018: 0000: \***      variables to hold the return code.
1019: 0000: \***
1020: 0000: \***      Version F     Steve Perkins                      20th October 1993
1021: 0000: \***      Version letter updated to keep in line with PSBF19.BAS
1022: 0000: \***
1023: 0000: \***    REVISION 1.9.                ROBERT COWEY.                08 DEC 2003.
1024: 0000: \***    Changes for Deal Limit removal project.
1025: 0000: \***    Revision number updated to keep in step with PSBF19.BAS.
1026: 0000: \***    No actual coding changes to this file.
1027: 0000: \***
1028: 0000: \***    Version G       Charles Skadorwa                   25th September 2013
1029: 0000: \***    F261 Gift Card Mall IIN Range Extension Project - Commented ! GCSk
1030: 0000: \***
1031: 0000: \*******************************************************************************
1032: 0000: \*******************************************************************************
1033: 0000: 
1034: 0000:    FUNCTION OPEN.IRF.UPDT (NEW.IRF.DATA$,                                  \
1035: 0000:                            ACD.FLAG$)                                      \
1036: 0000:    EXTERNAL
1037: 0000: 
1038: 0000:       STRING    ACD.FLAG$,                                                 \
1039: 0000:                 NEW.IRF.DATA$
1040: 0000: 
1041: 0000:       INTEGER*2 OPEN.IRF.UPDT                                          ! CAW
1042: 0000: 
1043: 0000:    END FUNCTION
1044: 0000: 
1045: 0000: 
1046: 0000:   !FUNCTION UPDT.IRF.UPDT (NEW.IRF.DATA$,                              ! GCSk
1047: 0000:    FUNCTION UPDT.IRF.TIF.UPDT (NEW.IRF.DATA$,                          \ ! GCSk
1048: 0000:                            ACD.FLAG$,                                  \
1049: 0000:                            IRF.LOCKED.FLAG$)                           \ BJAL
1050: 0000:    EXTERNAL
1051: 0000: 
1052: 0000:       STRING    ACD.FLAG$,                                             \
1053: 0000:                 IRF.LOCKED.FLAG$,                                      \ BJAL
1054: 0000:                 NEW.IRF.DATA$
1055: 0000: 
1056: 0000:      !INTEGER*2 UPDT.IRF.UPDT                                          ! CAW ! GCSk
1057: 0000:       INTEGER*2 UPDT.IRF.TIF.UPDT                                      ! GCSk
1058: 0000: 
1059: 0000:    END FUNCTION
1060: 0000: 
1061: 0000: 
1062: 0000:    FUNCTION CLOSE.IRF.UPDT (NEW.IRF.DATA$,                                 \
1063: 0000:                             ACD.FLAG$)                                     \
1064: 0000:    EXTERNAL
1065: 0000: 
1066: 0000:       STRING    ACD.FLAG$,                                                 \
1067: 0000:                 NEW.IRF.DATA$
1068: 0000: 
1069: 0000:       INTEGER*2 CLOSE.IRF.UPDT                                         ! CAW
1070: 0000: 
1071: 0000:    END FUNCTION
1072: 0000: 
1073: 0000: %INCLUDE CSORTDEF.J86   !CSORT ROUTINE                                      !BSWM
1074: 0000: FUNCTION CSORT(ARPTR%, ELEMENTS%) EXTERNAL
1075: 0000:     INTEGER*4 ARPTR%, ELEMENTS%, CSORT
1076: 0000: END FUNCTION
1077: 0000: 
1078: 0000: 
1079: 0000: !******************************************************************************
1080: 0000: 
1081: 0000: FUNCTION UPDATE.ITEM.DEAL.INFO(PACKED.CODE$, PROCESSING.DATE$) PUBLIC
1082: 001e: 
1083: 001e:     STRING PACKED.CODE$
1084: 001e:     STRING PROCESSING.DATE$
1085: 001e:     STRING DEAL.SAVED.STATE$
1086: 001e:     STRING ITMDL.SAVED.STATE$                                           !EMM
1087: 001e:     STRING DEAL.ITMDL.NUM$                                              !EMM
1088: 001e: 
1089: 001e:     INTEGER*2 NUMBER.FOUND                                                  !BSWM
1090: 001e:     INTEGER*2 LOOP                                                          !BSWM
1091: 001e:     INTEGER*2 DEAL.INDEX%                                               !EMM
1092: 001e: 
1093: 001e:     INTEGER*1 DEAL.ITMDL.LIST.ID%                                       !EMM
1094: 001e:     INTEGER*1 RC
1095: 001e:     INTEGER*1 UPDATE.ITEM.DEAL.INFO
1096: 001e: 
1097: 001e:     DEAL.INDEX%  = 1                                                    !EMM
1098: 0024:     ERROR.FLAG = 0
1099: 0029:     NUMBER.FOUND = 0
1100: 002f: 
1101: 002f:     IF NOT DONE.INIT THEN BEGIN                                             !BSWM
1102: 0036:         CALL IRF.SET                                                        !BSWM
1103: 0049:         DIM SORT.ARRAY$(IRF.MAX.DEALS%+1)                                   !BSWM acrc
1104: 0071:         DONE.INIT = -1                                                      !BSWM
1105: 0076:     ENDIF                                                                   !BSWM
1106: 0076: 
1107: 0076:     CALL ITMDL.SAVE(ITMDL.SAVED.STATE$)                                 !EMM BSWM
1108: 0082:     CALL DEAL.SAVE(DEAL.SAVED.STATE$)                                       !BSWM
1109: 008e: 
1110: 008e: !    RC = DINF.GET.FIRST.DEAL.ITEM (PACKED.CODE$, 0) !ONLY GET NON-LOCAL PRICE ITEMS !EMM
1111: 008e: 
1112: 008e:     ITMDL.ITEM.CODE$ = PACKED.CODE$                                     !EMM
1113: 009f: 
1114: 009f:     RC = READ.ITMDL                                                     !EMM
1115: 00a7: 
1116: 00a7:     !FIND AND SORT THE DEALS FOR THIS ITEM
1117: 00a7:     IF RC = 0 THEN BEGIN                                                !EMM CSWM
1118: 00b1: 
1119: 00b1:         ! It Checks for Non-Local price items                           !EMM
1120: 00b1:         IF ITMDL.EXCLUSION$ = " " THEN BEGIN                            !EMM
1121: 00ca:             ! Each Iteration DEAL.ITMDL.NUM$ gets Deal number and
1122: 00ca:             ! DEAL.ITMDL.LIST.ID% gets List ID for that Item code
1123: 00ca:             WHILE DEAL.INDEX% <= ITMDL.DEAL.COUNT%                      !EMM
1124: 00cd: 
1125: 00cd:                 DEAL.ITMDL.NUM$ = MID$(ITMDL.ALL.DEAL.NUM.LIST.ID$,    \!EMM
1126: 00f5:                                       (1 + ((DEAL.INDEX% - 1) * 3)),2)  !EMM
1127: 00f5:                 DEAL.ITMDL.LIST.ID% =                                  \!EMM
1128: 011f:                         VAL(UNPACK$(MID$(ITMDL.ALL.DEAL.NUM.LIST.ID$,  \!EMM
1129: 011f:                         (DEAL.INDEX% * 3),1)))                          !EMM
1130: 011f: 
1131: 011f:                 DEAL.DEAL.NUM$ = DEAL.ITMDL.NUM$                        !EMM
1132: 0132:         IF READ.DEAL.BUFFER = 0 THEN BEGIN
1133: 013e: 
1134: 013e:             CALL DEAL.SPLIT.RECORD
1135: 0143: 
1136: 0143:             !TEST FOR ACTIVE DEAL
1137: 0143:             IF ((DEAL.START.DATE$ <= PACK$("20" + PROCESSING.DATE$)) AND    \BSWM
1138: 01b6:                 (DEAL.END.DATE$ >= PACK$("20" + PROCESSING.DATE$))) THEN BEGIN !BSWM
1139: 01b6: 
1140: 01b6: !                        CALL DINF.SPLIT.RECORD                         !EMM
1141: 01b6: 
1142: 01b6:                 SORT.ARRAY$(NUMBER.FOUND +1 ) =  \
1143: 01ed:                                        DEAL.START.DATE$ +            \  !BSWM acrc
1144: 01ed:                                        DEAL.ITMDL.NUM$  +            \  !EMM BSWM
1145: 01ed:                                        CHR$(DEAL.ITMDL.LIST.ID%)        !EMM BSWM
1146: 01ed: 
1147: 01ed:                 IF NUMBER.FOUND < IRF.MAX.DEALS% THEN BEGIN                 !BSWM
1148: 01fa:                     NUMBER.FOUND = NUMBER.FOUND + 1                         !BSWM
1149: 01fe:                 ENDIF                                                       !BSWM
1150: 01fe:                         ! Replaced by a single sort after the WHILE loop
1151: 01fe: !                        CALL CSORT (VARPTR(SORT.ARRAY$(0)), NUMBER.FOUND) !EMM BSWM
1152: 01fe: 
1153: 01fe:             ENDIF
1154: 01fe: 
1155: 01fe:         ENDIF                                                               !CSWM
1156: 01fe:                 DEAL.INDEX% = DEAL.INDEX% + 1                           !EMM
1157: 0202:             WEND
1158: 0212:         ENDIF                                                           !EMM
1159: 0212:         !---------------------------------------!
1160: 0212:         ! Sorting the array only if the number  !
1161: 0212:         ! of values are greater then one        !
1162: 0212:         !---------------------------------------!
1163: 0212:         IF NUMBER.FOUND > 1 THEN BEGIN                                  !DMM
1164: 0219:             CALL CSORT (VARPTR(SORT.ARRAY$(0)), NUMBER.FOUND)           !DMM
1165: 023a:         ENDIF                                                           !DMM
1166: 023a: !        RC = DINF.GET.NEXT.DEAL                                        !EMM CSWM
1167: 023a: 
1168: 023a:     ENDIF                                                               !EMM
1169: 023a: !    WEND                                                               !EMM
1170: 023a: 
1171: 023a:     !NOW UPDATE ITEM ON IRF REGARDLESS OF ARRAY CONTENT
1172: 023a:     IRF.BAR.CODE$ = PACK$(STRING$(16,"0")) + PACKED.CODE$
1173: 0274:     IF READ.IRF.LOCK = 0 THEN BEGIN
1174: 0281: 
1175: 0281:         FOR LOOP = 0 TO IRF.MAX.DEALS% - 1                                  !BSWM
1176: 028a:             IF LOOP < NUMBER.FOUND THEN BEGIN                               !BSWM
1177: 0293:                 IRF.DEAL.NUM$(LOOP) = MID$(SORT.ARRAY$(LOOP+1),5,2)         !BSWM acrc
1178: 02cc:                 IRF.LIST.ID%(LOOP) = ASC(MID$(SORT.ARRAY$(LOOP+1),7,1))     !BSWM acrc
1179: 0311:             ENDIF ELSE BEGIN                                                !BSWM
1180: 0311:                 IRF.DEAL.NUM$(LOOP) = PACK$("0000")                         !BSWM
1181: 0333:                 IRF.LIST.ID%(LOOP) = 0                                      !BSWM
1182: 0349:             ENDIF                                                           !BSWM
1183: 0349:         NEXT LOOP
1184: 0361: 
1185: 0361:         CALL CONCAT.NEW.IRF.DATA$
1186: 0366:         ACD.FLAG$ = "CHANGE"
1187: 0373:         IRF.LOCKED.FLAG$ = "Y"
1188: 0380:         ! call changed - ref PSBF19
1189: 0380:         IF UPDT.IRF.TIF.UPDT (NEW.IRF.DATA$, ACD.FLAG$, IRF.LOCKED.FLAG$) = 0 THEN BEGIN
1190: 03a8:             !POPULATE ALL IRF BARCODES
1191: 03a8:             CALL CALC.BOOTS.CODE.CHECK.DIGIT (UNPACK$(PACKED.CODE$))
1192: 03be:             CALL UPDATE.ALL.IRF.BAR.CODES(UNPACK$(PACKED.CODE$) + F18.CHECK.DIGIT$)
1193: 03f4:         ENDIF ELSE BEGIN
1194: 03f4:             ERROR.FLAG = 1
1195: 03f9:         ENDIF
1196: 03fb: 
1197: 03fb:     ENDIF ELSE BEGIN
1198: 03fb:         ERROR.FLAG = 1
1199: 0400:     ENDIF
1200: 0400: 
1201: 0400:     CALL ITMDL.RESTORE(ITMDL.SAVED.STATE$)                              !EMM BSWM
1202: 040c:     CALL DEAL.RESTORE(DEAL.SAVED.STATE$)                                    !BSWM
1203: 0418: 
1204: 0418:     UPDATE.ITEM.DEAL.INFO = ERROR.FLAG
1205: 041e: 
1206: 041e: END FUNCTION
1207: 0437: 
1208: 0437: 
1209: 0437: End of Compilation
