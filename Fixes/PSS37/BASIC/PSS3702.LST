   1: 0000: \******************************************************************************
   2: 0000: \******************************************************************************
   3: 0000: \***
   4: 0000: \***   $Workfile:   PSS3702.bas  $
   5: 0000: \***
   6: 0000: \***   $Revision:   1.8  $
   7: 0000: \***
   8: 0000: \******************************************************************************
   9: 0000: \******************************************************************************
  10: 0000: \***
  11: 0000: \***   $Log:   V:/Archive/Basarch/PSS3702.bav  $
  12: 0000: \***   
  13: 0000: \***      Rev 1.8   16 Mar 2007 13:29:30   steve.perkins
  14: 0000: \***   Defect 75 - Changes to type 17 STKMQ record
  15: 0000: \***
  16: 0000: \***      Rev 1.6   01 Mar 2005 11:33:52   dev07ps
  17: 0000: \***   Upwards TSF Fix.
  18: 0000: \***   Fix to Report & Session numbers.
  19: 0000: \***   Relinked with latest PLLOL object.
  20: 0000: \***   Removal of LSS specific code.
  21: 0000: \***   Fix to Stock Counting - moved to new program PDTSC.286 to solve PDT timeout when > 40 counts.
  22: 0000: \***
  23: 0000: \***
  24: 0000: \***      Rev 1.5   30 Jul 2003 14:28:08   dev88ps
  25: 0000: \***   Changes made to accomodate new Stock
  26: 0000: \***   Count facility on the PDT. New module
  27: 0000: \***   PSS3705 created.
  28: 0000: \***
  29: 0000: \***      Rev 1.4   17 Jul 2003 10:04:12   dev38ps
  30: 0000: \***   Commented out new reference to function 18 as this is already in external includer code
  31: 0000: \***
  32: 0000: \***      Rev 1.3   29 Oct 2002 09:09:38   dev88ps
  33: 0000: \***   Changes to accomodate live stock counting
  34: 0000: \***   in the LSS only (store 2999.) Changes are
  35: 0000: \***   not visible in any other store.
  36: 0000: \***
  37: 0000: \***      Rev 1.2   17 Oct 1997 15:11:14   DEV20PS
  38: 0000: \***   GRBI changes.
  39: 0000: \***
  40: 0000: \***      Rev 1.1   07 Oct 1994 15:51:30   DEVSPPS
  41: 0000: \***   Fixed PDT Support hang
  42: 0000: \***
  43: 0000: \******************************************************************************
  44: 0000: \******************************************************************************
  45: 0000: 
  46: 0000: \REM
  47: 0000: \******************************************************************************
  48: 0000: \******************************************************************************
  49: 0000: \***                                                                        ***
  50: 0000: \***                                                                        ***
  51: 0000: \***           PROGRAM  :  PSS3702                                          ***
  52: 0000: \***                                                                        ***
  53: 0000: \***           AUTHOR   :  David Smallwood (Pseudocode / BASIC code)        ***
  54: 0000: \***                                                                        ***
  55: 0000: \***           DATE     :  16th April 1992                                  ***
  56: 0000: \***                                                                        ***
  57: 0000: \***                                                                        ***
  58: 0000: \***           Current version letter : G                                   ***
  59: 0000: \***                                                                        ***
  60: 0000: \***           Date of last update:  17th May 1994.  Michael J. Kelsall     ***
  61: 0000: \***                                                                        ***
  62: 0000: \***                                                                        ***
  63: 0000: \******************************************************************************
  64: 0000: \******************************************************************************
  65: 0000: 
  66: 0000: \******************************************************************************
  67: 0000: \******************************************************************************
  68: 0000: \***                                                                        ***
  69: 0000: \***   O V E R V I E W                                                      ***
  70: 0000: \***                                                                        ***
  71: 0000: \***                                                                        ***
  72: 0000: \***   PSS37 - P.D.T Support Program.                                       ***
  73: 0000: \***                                                                        ***
  74: 0000: \***                                                                        ***
  75: 0000: \***   PSS37 is designed to run concurrently with PSS38. PSS38 handles      ***
  76: 0000: \***   all asyncronous communications with a connected PDT. All data        ***
  77: 0000: \***   sent by the PDT is passed to PSS37 via PSS38 by means of a 'pipe'.   ***
  78: 0000: \***   PSS37 validates the data sent to ensure the data has been sent in    ***
  79: 0000: \***   the correct sequence, has a valid format and is meaningful.          ***
  80: 0000: \***   the correct sequence, has a valid format and is meaningful.          ***
  81: 0000: \***   There are basically two processes PSS37 performs ;                   ***
  82: 0000: \***   i)  takes counts from a PDT and puts them in the stock movement,     ***
  83: 0000: \***   ii) creates a file of lists requested by a PDT.                      ***
  84: 0000: \***                                                                        ***
  85: 0000: \***   This module was created to contain the bulk of the processing for    ***
  86: 0000: \***   a new PDT application for Directs Receiving.  This application will  ***
  87: 0000: \***   use a new piece of hardware, the Laser Data Terminal (LDT).  When    ***
  88: 0000: \***   orders are requested from the LDT PSS37 will process new data files  ***
  89: 0000: \***   to format the order information for transmitting back to the LDT.    ***
  90: 0000: \***   The new data files are the Direct Supplier File (DIRSUP) which holds ***
  91: 0000: \***   information on direct suppliers which is required in the LDT and the ***
  92: 0000: \***   Direct Orders File (DIRORD) which holds information on each direct   ***
  93: 0000: \***   order on the system.  When receipts are passed back to the controller***
  94: 0000: \***   PSS37 will write receipts information to the Stock Movement Queue    ***
  95: 0000: \***   for processing by Stock Support.                                     ***
  96: 0000: \***                                                                        ***
  97: 0000: \******************************************************************************
  98: 0000: \******************************************************************************
  99: 0000: 
 100: 0000: 
 101: 0000: \******************************************************************************
 102: 0000: \******************************************************************************
 103: 0000: \***                                                                        ***
 104: 0000: \***   A M E N D M E N T S                                                  ***
 105: 0000: \***                                                                        ***
 106: 0000: \***   Version B.  Les Cook                               October 1992      ***
 107: 0000: \***   Program streamlined according to new Programming Guidelines.         ***
 108: 0000: \***                                                                        ***
 109: 0000: \***   Version C.  Les Cook                            5th November 1992    ***
 110: 0000: \***   Program now creates LDTBF which is used by PSS78 to provide a report ***
 111: 0000: \***   showing damaged and stolen goods booked in by the LDT.  PSS37 kicks  ***
 112: 0000: \***   off PSS78 (using ADXSTART) on the background screen if there is any  ***
 113: 0000: \***   data to process.                                                     ***
 114: 0000: \***                                                                        ***
 115: 0000: \***   Version D.  Les Cook                            13th January 1993    ***
 116: 0000: \***   Interim version to fix problem whereby STKMQ is being corrupted.     ***
 117: 0000: \***   STKMQ is now opened READONLY and with BUFFSIZE of 512.               ***
 118: 0000: \***                                                                        ***
 119: 0000: \***   Version E.  Les Cook                                  February 1993  ***
 120: 0000: \***   To handle processing for UOD Receiving                               ***
 121: 0000: \***   Note that there are new data states associated with UOD which use    ***
 122: 0000: \***   LOWER CASE LETTERS a - f.  !!!!!!!!!!!                               ***
 123: 0000: \***                                                                        ***
 124: 0000: \***   Version F.  Michael J. Kelsall                     12th October 1993 ***
 125: 0000: \***   Fix to clear problem where UOD's with a status of 'I' appear as      ***
 126: 0000: \***   the first record has 'I' and any others are 'O'.                     ***
 127: 0000: \***   Addition of LDTAF processing in all applications.                    ***
 128: 0000: \***                                                                        ***
 129: 0000: \***   Version F. (Supplemental)  David Smallwood         7th January 1994  ***
 130: 0000: \***   Hardcode LDTPF file name for logging file size to LDTAF.             ***
 131: 0000: \***                                                                        ***
 132: 0000: \***   Version G. Michael J. Kelsall                       23rd March 1994  ***
 133: 0000: \***   Change LDTAF duration time from minutes to seconds.                  ***
 134: 0000: \***   Alteration to code to suppress STKMQ (UODTF) type 21 txn production  ***
 135: 0000: \***   for null UODs other than Emergency booked in UODs.                   ***
 136: 0000: \***   Transfer of LDTAF link type initialisation to clear problem where    ***
 137: 0000: \***   LDTAF SIZE error handling does not ignore DRSMQ not being present.   ***
 138: 0000: \***                                                                        ***
 139: 0000: \***   Version G (Supplemental)  Michael J. Kelsall         20th July 1994  ***
 140: 0000: \***   Change to remove holding and subsequent release of LDT during        ***
 141: 0000: \***   transfer of data from LDT to STKMQ. Change made in an attempt to     ***
 142: 0000: \***   prevent corruption of subsequent transmission if store enter UOD     ***
 143: 0000: \***   application before the CR+LR are stopped.                            ***
 144: 0000: \***                                                                        ***
 145: 0000: \***   Version G (Supplemental)  Michael J. Kelsall         1st August 1994 ***
 146: 0000: \***   Change to allow training UOD's to be entered into system and         ***
 147: 0000: \***   ignored by PSS37 (not transfered to STKMQ). These will be identified ***
 148: 0000: \***   by the dist centre / whse number both being set to all nines.        ***
 149: 0000: \***                                                                        ***
 150: 0000: \***   REVISION 1.1     ROBERT COWEY / STEVE WRIGHT       6TH OCTOBER 1994  ***
 151: 0000: \***   Removed version letters from included code (not commented).          ***
 152: 0000: \***                                                                        ***
 153: 0000: \***   Version 1.2          Stuart Highley           12th September 1997    ***
 154: 0000: \***   Changes for GRBI.  Added new fields to LDTBF and start PSS79         ***
 155: 0000: \***   instead of PSS78.                                                    ***
 156: 0000: \***                                                                        ***
 157: 0000: \***   Version 1.3          Brian Greenfield         17th October 2002      ***
 158: 0000: \***   Changes to allow the LSS (store 2999) to perform live stock counts   ***
 159: 0000: \***   that change the stock figure to a counted figure.                    ***
 160: 0000: \***   LSS stock counts hijack the Directs No Order Number structure.       ***
 161: 0000: \***   This code will only ever be executed in store 2999.                  ***
 162: 0000: \***                                                                        ***
 163: 0000: \***   Version 1.4          Brian Greenfield         18th July 2003         ***
 164: 0000: \***                                                                        ***
 165: 0000: \***   REVISION 1.5    Charles Skadorwa             4th February 2005       ***
 166: 0000: \***   Removed LSS 2999 processing as redundant now.                        ***
 167: 0000: \***                                                                        ***
 168: 0000: \***   REVISION 1.6     Neil Bennett                 2nd January 2007       ***
 169: 0000: \***   Add ASN processing support.                                          ***
 170: 0000: \***                                                                        ***
 171: 0000: \******************************************************************************
 172: 0000: \******************************************************************************
 173: 0000: 
 174: 0000: \******************************************************************************
 175: 0000: \******************************************************************************
 176: 0000: \***                                                                        ***
 177: 0000: \***   I N C L U D E S   A N D   V A R I A B L E S                          ***
 178: 0000: \***                                                                        ***
 179: 0000: \******************************************************************************
 180: 0000: \******************************************************************************
 181: 0000: 
 182: 0000: 
 183: 0000: !  %INCLUDE PSBF18G.J86                                                 !1.3BG
 184: 0000:    %INCLUDE PSS37G.J86                                                  ! GMJK
 185: 0000: \*****************************************************************************
 186: 0000: \*****************************************************************************
 187: 0000: \***                                                                       ***
 188: 0000: \***      G L O B A L   D E F I N I T I O N S   F O R   P S S 3 7          ***
 189: 0000: \***                                                                       ***
 190: 0000: \***           REFERENCE : PSS37G                                          ***
 191: 0000: \***                                                                       ***
 192: 0000: \***           VERSION E                                                   ***
 193: 0000: \***           5th November 1992                                           ***
 194: 0000: \***           Ver D.  Add support for ADXSERCL routine.                   ***
 195: 0000: \***           Ver E.  Add support for LDTBF                               ***
 196: 0000: \***                                                                       ***
 197: 0000: \***                                                                       ***
 198: 0000: \***           Version G                                                   ***
 199: 0000: \***           Add support for Returns/Automatic credit claiming           ***
 200: 0000: \***                                                                       ***
 201: 0000: \***           Version H  Michael J. Kelsall    24th March 1994.           ***
 202: 0000: \***           Add support for CCUPF                                       ***
 203: 0000: \***
 204: 0000: \***           REVISION 1.1  ROBERT COWEY / STEVE WRIGHT  6TH OCTOBER 1994
 205: 0000: \***           Removed version letters from included code (not commented).
 206: 0000: \***
 207: 0000: \***           REVISION 1.2  David Smallwood    26th May 1995
 208: 0000: \***           Add global variable ALLOW.CSR.PROCESSING.
 209: 0000: \***
 210: 0000: \***           REVISION 1.3  Stuart Highly      April 1996
 211: 0000: \***           Gap monitor changes
 212: 0000: \***
 213: 0000: \***           REVISION 1.4  David Smallwood    21st May 1996
 214: 0000: \***           Change global variable "NUM.OF.UODS%" to
 215: 0000: \***           "NUM.STATUS.O.C.X.UODS%".  Add variables "NUM.OF.CANCELLED.UODS%"
 216: 0000: \***           "NUM.OF.DESPATCHED.UODS%".  Add global variables for CCLAM.
 217: 0000: \***
 218: 0000: \***           REVISION 1.5  Nik Sen            30th June 1997
 219: 0000: \***           Add variables for SXTMP STKTK and STKBUF for stocktaking.
 220: 0000: \***
 221: 0000: \***           REVISION 1.6  David Artiss       23rd January 2001
 222: 0000: \***           Add new audit file STLDT
 223: 0000: \***
 224: 0000: \***           REVISION 1.7  Brian Greenfield   17th October 2002
 225: 0000: \***           Added LSSST and IMSTC for LSS stock counts.
 226: 0000: \***
 227: 0000: \***           REVISION 1.8  David Artiss       7th March 2003
 228: 0000: \***           Lots of file and field definitions added for BOL
 229: 0000: \***           stocktake changes.
 230: 0000: \***
 231: 0000: \***           REVISION 1.9  Brian Greenfield   18th July 2003
 232: 0000: \***           New file additions for Store Stock Counts
 233: 0000: \***
 234: 0000: \***           REVISION 2.0  Julia Stones      22nd October 2003
 235: 0000: \***           New file additions for SmartScript Pharmacy Stock system
 236: 0000: \***
 237: 0000: \***           REVISION 2.1  Julia Stones      12th November 2003
 238: 0000: \***           New file additions for Simplification of the credit claim system
 239: 0000: \***
 240: 0000: \***           REVISION 2.2 Julia Stones       12th March 2004
 241: 0000: \***           New file addition for Credit Claim rejection information
 242: 0000: \***
 243: 0000: \***           REVISION 2.3 Charles Skadorwa   10th November 2004
 244: 0000: \***           Shelf Monitor Project: add declarations for PLLOL & PLLDB files
 245: 0000: \***
 246: 0000: \***           REVISION 2.4 Brian Greenfield   11th January 2005
 247: 0000: \***           Fixes to allow old record type P and new record type P to both work.
 248: 0000: \***           The old record type P can be removed next time this module is
 249: 0000: \***           altered.
 250: 0000: \***
 251: 0000: \***           REVISION 2.5    Neil Bennett    22nd December 2006
 252: 0000: \***           Add ASN processing support.
 253: 0000: \***           Remove CSR processing support.
 254: 0000: \***
 255: 0000: \***           REVISION 2.6    Brian Greenfield 11th may 2007
 256: 0000: \***           Added recalls processing for A7C.
 257: 0000: \***
 258: 0000: \*****************************************************************************
 259: 0000: \*****************************************************************************
 260: 0000: 
 261: 0000: \*****************************************************************************
 262: 0000: \***   include global definitions for the following functions and procedures
 263: 0000: \***
 264: 0000: \***     APPLICATION.LOG              01
 265: 0000: \***     READ.NEXT.IEF                11
 266: 0000: \***     SORT.TABLE                   14
 267: 0000: \***     CONV.TO.HEX                  16
 268: 0000: \***     CONV.TO.STRING               17
 269: 0000: \***     SESS.NUM.UTILITY             20
 270: 0000: \***     CIMF
 271: 0000: \***     CITEM
 272: 0000: \***     CSR
 273: 0000: \***     CSRWF
 274: 0000: \***     CSRBF
 275: 0000: \***     FPF
 276: 0000: \***     IDF
 277: 0000: \***     IDSOF
 278: 0000: \***     INVOK
 279: 0000: \***     ONORD
 280: 0000: \***     PCHK
 281: 0000: \***     PIPEI
 282: 0000: \***     UNITS
 283: 0000: \***     STKMQ
 284: 0000: \***     BCSMF
 285: 0000: \***     IEF
 286: 0000: \***     DIRORD
 287: 0000: \***     DIRSUP
 288: 0000: \***     DIRWF
 289: 0000: \***     DIR
 290: 0000: \***     LDTBF
 291: 0000: \***     LDTCF
 292: 0000: \***     UOD
 293: 0000: \***     UODBF
 294: 0000: \***     UODTF
 295: 0000: \***     STKBF
 296: 0000: \***     SXTMP
 297: 0000: \***     STKTK
 298: 0000: \***     SSPSC
 299: 0000: \***     BTCS
 300: 0000: \***     PRINT
 301: 0000: \***     SOPTS
 302: 0000: \***     TSF
 303: 0000: \***     LOCAL
 304: 0000: \***
 305: 0000: \*****************************************************************************
 306: 0000: 
 307: 0000:  %INCLUDE PSBF01G.J86                     ! FLC
 308: 0000: REM \
 309: 0000: \*******************************************************************************
 310: 0000: \*******************************************************************************
 311: 0000: \***
 312: 0000: \***       %INCLUDE FOR GLOBAL DEFINITIONS FOR FUNCTION APPLICATION.LOG
 313: 0000: \***
 314: 0000: \***                FUNCTION NUMBER    : PSBF01
 315: 0000: \***
 316: 0000: \***                REFERENCE          : PSBF01G.J86
 317: 0000: \***
 318: 0000: \***                DATE OF LAST AMENDMENT  - 27/2/86
 319: 0000: \***
 320: 0000: \***
 321: 0000: \*******************************************************************************
 322: 0000: 
 323: 0000:       INTEGER GLOBAL  F01.RETURN.CODE%
 324: 0000: 
 325: 0000: 
 326: 0000:  %INCLUDE PSBF05G.J86                     ! 1.9BG
 327: 0000: REM\
 328: 0000: \*******************************************************************************
 329: 0000: \*******************************************************************************
 330: 0000: \***
 331: 0000: \***        INCLUDE       : CHECK.BOOTS.CODE globals
 332: 0000: \***
 333: 0000: \***        REFERENCE     : PSBF05G.J86
 334: 0000: \***
 335: 0000: \***        Version A      Bruce Scriver              25th February 1986
 336: 0000: \*** 
 337: 0000: \***        Version B      Andrew Wedgeworth              15th July 1992
 338: 0000: \***        Removal of return code field which no longer required.
 339: 0000: \***
 340: 0000: \*******************************************************************************
 341: 0000: \*******************************************************************************
 342: 0000: 
 343: 0000:       STRING   GLOBAL F05.VALID.CODE$
 344: 0000: 
 345: 0000: 
 346: 0000: !%INCLUDE PSBF06G.J86                     ! FLC
 347: 0000:  %INCLUDE PSBF11G.J86                     ! DLC
 348: 0000: REM \
 349: 0000: \*******************************************************************************
 350: 0000: \*******************************************************************************
 351: 0000: \***
 352: 0000: \***    %INCLUDE FOR GLOBALS DEFINITIONS FOR FUNCTION READ.NEXT.IEF
 353: 0000: \***
 354: 0000: \***            FUNCTION NUMBER    : PSBF11
 355: 0000: \***
 356: 0000: \***            REFERENCE          : PSBF11G.J86
 357: 0000: \***
 358: 0000: \***    Version B            Bruce Scriver             11th December 1986 
 359: 0000: \***
 360: 0000: \***    Version C            Andrew Wedgeworth             15th July 1992
 361: 0000: \***    Redundant return code field removed.
 362: 0000: \***
 363: 0000: \*******************************************************************************
 364: 0000: \*******************************************************************************
 365: 0000: 
 366: 0000:       STRING    GLOBAL  F11.ERROR.FLAG$,                               \ BBAAS
 367: 0000:                         F11.NEXT.BAR.CODE$                             ! BBAAS
 368: 0000: 
 369: 0000:       INTEGER*2 GLOBAL  F11.CURRENT.COUNT%
 370: 0000: 
 371: 0000: 
 372: 0000:  %INCLUDE PSBF14G.J86                     ! DLC
 373: 0000: REM\
 374: 0000: \*******************************************************************************
 375: 0000: \*******************************************************************************
 376: 0000: \***
 377: 0000: \***        INCLUDE       : SORT.TABLE globals
 378: 0000: \***
 379: 0000: \***        REFERENCE     : PSBF14G.J86
 380: 0000: \***
 381: 0000: \***        Version A     Bruce Scriver                3rd March 1986
 382: 0000: \*** 
 383: 0000: \***        Version B     Andrew Wedgeworth            17th July 1992
 384: 0000: \***        Removal of now redundant return code field.
 385: 0000: \***
 386: 0000: \*******************************************************************************
 387: 0000: \*******************************************************************************
 388: 0000: 
 389: 0000:       STRING   GLOBAL F14.TABLE$(1)
 390: 0000: 
 391: 0000: 
 392: 0000:  %INCLUDE PSBF16G.J86                     ! DLC
 393: 0000: REM\
 394: 0000: \*******************************************************************************
 395: 0000: \*******************************************************************************
 396: 0000: \***
 397: 0000: \***           %INCLUDE GLOBAL DEFINITIONS FOR CONV.TO.HEX FUNCTION
 398: 0000: \***
 399: 0000: \***                       REFERENCE     : PSBF16G.J86
 400: 0000: \*** 
 401: 0000: \***       Version A           Bruce Scriver            25th February 1986
 402: 0000: \***
 403: 0000: \***       Version B         Andrew Wedgeworth               2nd July 1992
 404: 0000: \***       Removal of now redundant F16.RETURN.CODE%.
 405: 0000: \***
 406: 0000: \*******************************************************************************
 407: 0000: \*******************************************************************************
 408: 0000: 
 409: 0000:       STRING   GLOBAL F16.HEX.STRING$
 410: 0000: 
 411: 0000:       ! 1 line deleted from here                                       ! BAW
 412: 0000:  %INCLUDE PSBF17G.J86                     ! DLC
 413: 0000: REM \
 414: 0000: \*******************************************************************************
 415: 0000: \*******************************************************************************
 416: 0000: \***
 417: 0000: \***
 418: 0000: \***        %INCLUDE GLOBAL DEFINITIONS FOR CONV.TO.STRING FUNCTION
 419: 0000: \***
 420: 0000: \***                    REFERENCE     : PSBF17G.J86
 421: 0000: \***
 422: 0000: \***        Version A         Bruce Scriver      24th February 1986
 423: 0000: \***
 424: 0000: \***        Version B       Andrew Wedgeworth         2nd July 1992
 425: 0000: \***        Removal of now redundant F17.RETURN.CODE%
 426: 0000: \***
 427: 0000: \*******************************************************************************
 428: 0000: \*******************************************************************************
 429: 0000: 
 430: 0000:       STRING   GLOBAL F17.RETURNED.STRING$
 431: 0000: 
 432: 0000:       ! 1 line deleted from here                                       ! BAW
 433: 0000: 
 434: 0000:  %INCLUDE PSBF18G.J86                     ! 1.8DA
 435: 0000: REM\
 436: 0000: \*******************************************************************************
 437: 0000: \*******************************************************************************
 438: 0000: \***
 439: 0000: \***        INCLUDE       : CALC.BOOTS.CODE.CHECK.DIGIT globals
 440: 0000: \***
 441: 0000: \***        REFERENCE     : PSBF18G.J86
 442: 0000: \***
 443: 0000: \***        Version A     Stephen Kelsey                  23rd March 1987
 444: 0000: \***
 445: 0000: \***        Version B     Andrew Wedgeworth                 7th July 1992
 446: 0000: \***        Removal of return code field which no longer required.
 447: 0000: \***
 448: 0000: \*******************************************************************************
 449: 0000: \*******************************************************************************
 450: 0000: 
 451: 0000:       STRING   GLOBAL F18.CHECK.DIGIT$
 452: 0000:     
 453: 0000:       ! 1 line deleted from here                                       ! BAW    
 454: 0000: 
 455: 0000:  %INCLUDE PSBF20G.J86                     ! DLC
 456: 0000: REM\
 457: 0000: \*******************************************************************************
 458: 0000: \*******************************************************************************
 459: 0000: \***
 460: 0000: \***     %INCLUDE GLOBAL VARIABLE DEFINITIONS FOR SESS.NUM.UTILITY FUNCTION
 461: 0000: \***
 462: 0000: \***                       REFERENCE     : PSBF20G.J86
 463: 0000: \*** 
 464: 0000: \***     Version A              Bruce Scrive                   5th May 1988   
 465: 0000: \*** 
 466: 0000: \***     Version B              Robert Cowey                   7th May 1991
 467: 0000: \***     Global variable F20.INTEGER.FILE.NO% changed from one byte integer
 468: 0000: \***     to two byte integer.
 469: 0000: \***
 470: 0000: \***     Version D              Andrew Wedgeworth             1st July 1992
 471: 0000: \***     F20.RETURN.CODE% removed as it is no longer required.
 472: 0000: \***
 473: 0000: \*******************************************************************************
 474: 0000: \*******************************************************************************
 475: 0000: 
 476: 0000:       STRING    GLOBAL F20.FILE.NAME$,                                 \
 477: 0000:                        F20.STRING.FILE.NO$,                            \
 478: 0000:                        F20.TABLE.DIMENSIONED.FLAG$,                    \
 479: 0000:                        SESS.NUM.TABLE$(1)
 480: 0000: 
 481: 0000:       INTEGER*2 GLOBAL F20.INTEGER.FILE.NO%
 482: 0000: 
 483: 0000:       ! 1 line deleted from here                                       ! DAW 
 484: 0000: 
 485: 0000:  %INCLUDE PSBF21G.J86                     ! 1.9BG
 486: 0000: REM\
 487: 0000: \*******************************************************************************
 488: 0000: \*******************************************************************************
 489: 0000: \***
 490: 0000: \***        INCLUDE       : CHECK.BAR.CODE globals
 491: 0000: \***
 492: 0000: \***        REFERENCE     : PSBF21G.J86
 493: 0000: \***
 494: 0000: \***        Version A     Bruce Scriver                  13th May 1988
 495: 0000: \***
 496: 0000: \***        Version B     Andrew Wedgeworth             21st July 1992
 497: 0000: \***        Return code removed as no longer used.
 498: 0000: \***
 499: 0000: \*******************************************************************************
 500: 0000: \*******************************************************************************
 501: 0000: 
 502: 0000:       STRING    GLOBAL F21.VALID.CODE.FLAG$
 503: 0000: 
 504: 0000: 
 505: 0000: 
 506: 0000: !%INCLUDE ASYNCNUB.J86                    ! FLC
 507: 0000:  %INCLUDE CHKBFDEC.J86                    ! DLC
 508: 0000: \******************************************************************************
 509: 0000: \***
 510: 0000: \***           %INCLUDE FOR CHKBF - PRICE CHECK BUFFER FILE
 511: 0000: \***
 512: 0000: \***                    - FIELD DECLARATIONS   
 513: 0000: \***                    - FILE REFERENCE PARAMETERS  
 514: 0000: \***  
 515: 0000: \***                    REFERENCE: CHKBFDEC.J86
 516: 0000: \***
 517: 0000: \******************************************************************************
 518: 0000: 
 519: 0000:    INTEGER*1 GLOBAL				\
 520: 0000: 	CHKBF.SESS.NUM%
 521: 0000: 
 522: 0000:    INTEGER*2 GLOBAL				\
 523: 0000: 	CHKBF.RECL%,                            \
 524: 0000:         CHKBF.REPORT.NUM% 	
 525: 0000: 
 526: 0000:    INTEGER*4 GLOBAL				\ DLC
 527: 0000:         CHKBF.POINTER%
 528: 0000: 	
 529: 0000:    STRING GLOBAL			\
 530: 0000: 	CHKBF.ITEM.CODE$,	\ 13 byte ASC - bar code, as passed from PDT
 531: 0000: 	CHKBF.PRICE$,		\  6 byte ASC - price, as passed from PDT 
 532: 0000: 	CHKBF.FILLER$,		\  1 byte ASC - spare
 533: 0000: 	CHKBF.FILE.NAME$
 534: 0000:  %INCLUDE GAPBFDEC.J86                    ! SDH !2.3CS !2.4BG
 535: 0000: \*****************************************************************************
 536: 0000: \***                                                                         *
 537: 0000: \***           %INCLUDE FOR GAPBF - GAP BUFFER FILE                          *
 538: 0000: \***                                                                         *
 539: 0000: \***                    - FIELD DECLARATIONS                                 *
 540: 0000: \***                    - FILE REFERENCE PARAMETERS                          *
 541: 0000: \***                                                                         *
 542: 0000: \***                    REFERENCE: GAPBFDEC.J86                              *
 543: 0000: \***                                                                         *
 544: 0000: \*****************************************************************************
 545: 0000: 
 546: 0000:    INTEGER*1 GLOBAL            \
 547: 0000:    GAPBF.SESS.NUM%
 548: 0000: 
 549: 0000:    INTEGER*2 GLOBAL            \   
 550: 0000:    GAPBF.REPORT.NUM%    
 551: 0000: 
 552: 0000:    STRING GLOBAL               \
 553: 0000:    GAPBF.BOOTS.CODE$,          \ 7 bytes ASC - Item code
 554: 0000:    GAPBF.FILE.NAME$
 555: 0000:  %INCLUDE PLLOLDEC.J86                    ! 2.3CS
 556: 0000: 
 557: 0000: \******************************************************************************
 558: 0000: \******************************************************************************
 559: 0000: \***
 560: 0000: \***         %INCLUDE FOR RF PICKING LIST OF LISTS FILE FIELD DECLARATIONS
 561: 0000: \***
 562: 0000: \***               FILE TYPE    : DIRECT
 563: 0000: \***
 564: 0000: \***               REFERENCE    : PLLOLDEC.J86
 565: 0000: \***
 566: 0000: \***    VERSION A.           Julia Stones.               11 August 2004
 567: 0000: \***               New file for RF system. Holds list of picking lists.
 568: 0000: \***
 569: 0000: \***    VERSION B            Mark Goode                  17th January 2005
 570: 0000: \***    Additional field required to state the lists status ('S' - Shelf Monitor
 571: 0000: \***    'F' - Fast Fill, 'O' - OSSR or 'E' - excess stock.
 572: 0000: \*******************************************************************************
 573: 0000: \*******************************************************************************
 574: 0000: 
 575: 0000: STRING GLOBAL                                                  \
 576: 0000:    PLLOL.FILE.NAME$,           \
 577: 0000:    PLLOL.LISTID$,              \ 3 bytes unpacked list ID
 578: 0000:    PLLOL.CREATOR.ID$,          \ 3 bytes unpacked Creator user ID
 579: 0000:    PLLOL.PICKER.ID$,           \ 3 bytes unpacked Picker user ID
 580: 0000:    PLLOL.ITEM.STATUS$,         \ 1 byte item status " "
 581: 0000:                                \                    "P" = Picked
 582: 0000:                                \                    "U" = Unpicked
 583: 0000:                                \                    "A" = List is active (someone is picking it)
 584: 0000:                                \                    "X" = List is cancelled
 585: 0000:    PLLOL.CREATE.DATE$,         \ 6 bytes unpacked create date YYMMDD
 586: 0000:    PLLOL.CREATE.TIME$,         \ 4 bytes unpacked create time HH:MM
 587: 0000:    PLLOL.PICK.START.TIME$,     \ 4 bytes unpacked pick start time HH:MM
 588: 0000:    PLLOL.PICK.END.TIME$,       \ 4 bytes unpacked pick end time HH:MM
 589: 0000:    PLLOL.ITEM.COUNT$,          \ 4 bytes unpacked item count (max number of items in list
 590: 0000:                                \                              duplicates will cobine to 1 record
 591: 0000:                                \                              on the PLLDB file)
 592: 0000:    PLLOL.OSSR.PICKING$,        \ 1 byte Marked for OSSR picking "Y" = marked for OSSR picking
 593: 0000:                                \                                "N" = not marked for OSSR picking
 594: 0000:    PLLOL.OSSR.STATUS$          ! 1 byte mark the status of the list.         ! BMG         
 595: 0000: 
 596: 0000: 
 597: 0000: INTEGER*4 GLOBAL               \
 598: 0000:        PLLOL.RECORD.NUM%
 599: 0000: 
 600: 0000: INTEGER*2 GLOBAL                \
 601: 0000:    PLLOL.REPORT.NUM%,           \
 602: 0000:    PLLOL.SESS.NUM%
 603: 0000: 
 604: 0000: 
 605: 0000: INTEGER*1 GLOBAL                \
 606: 0000:    PLLOL.RECL%
 607: 0000: 
 608: 0000: 
 609: 0000:  %INCLUDE PLLDBDEC.J86                    ! 2.3CS
 610: 0000: 
 611: 0000: \******************************************************************************
 612: 0000: \******************************************************************************
 613: 0000: \***
 614: 0000: \***         %INCLUDE FOR RF PICKING LIST ITEMS IN LISTS FILE FIELD DECLARATIONS
 615: 0000: \***
 616: 0000: \***               FILE TYPE    : KEYED
 617: 0000: \***
 618: 0000: \***               REFERENCE    : PLLDBDEC.J86
 619: 0000: \***
 620: 0000: \***    VERSION A.              Julia Stones.                   11th August 2004
 621: 0000: \***    New file for RF system. Holds picking list items in lists information.
 622: 0000: \***
 623: 0000: \***    VERSION B.              Mark Goode                     17th january 2005
 624: 0000: \***    Changes for OSSR WAN
 625: 0000: \***
 626: 0000: \***    VERSION C.              Charlies Skadorwa
 627: 0000: \***    Add Stock fig to filler space for PST47
 628: 0000: \***
 629: 0000: \***    VERSION D.              Mark Goode                      29th August 2008
 630: 0000: \***    Add new fields for Multi-site project
 631: 0000: \***
 632: 0000: \***    VERSION E.              Wasim Abdulkalam              11th November 2011
 633: 0000: \***    Added new fields for backshop and OSSR pending sales plan for Stock
 634: 0000: \***    file accuracy project
 635: 0000: \*******************************************************************************
 636: 0000: \*******************************************************************************
 637: 0000: 
 638: 0000: STRING GLOBAL                          \
 639: 0000:        PLLDB.FILE.NAME$,               \
 640: 0000:        PLLDB.KEY$,                     \ 6 bytes unpacked LISTID + ITEMSEQ
 641: 0000:        PLLDB.LISTID$,                  \ 3 bytes unpacked List Number
 642: 0000:        PLLDB.ITEMSEQ$,                 \ 3 bytes unpacked Item Sequence Number
 643: 0000:        PLLDB.BOOTSCODE$,               \ 4 bytes packed Boots item code including check digit
 644: 0000:        PLLDB.QTY.ONSHELF$,             \ 4 bytes unpacked Quantity on shelf
 645: 0000:        PLLDB.FILL.QTY$,                \ 4 bytes unpacked Fill quantity
 646: 0000:        PLLDB.GAPFILL.MRK$,             \ 1 byte ASC Gap/Fill marker "Y" = Gap created from Shelf monitor
 647: 0000:                                        \                            "N" = Fast Fill no TSF update
 648: 0000:        PLLDB.ITEM.STATUS$,             \ 1 byte ASC Item Status "U" = Unpicked, "P" = picked
 649: 0000:        PLLDB.STOCKROOM.CNT$,           \ 4 bytes unpacked Stock Room Count
 650: 0000:        PLLDB.SHELFMON.SALE.FIG$,       \ 4 bytes unpacked Sales figure at Shelf Monitoring
 651: 0000:        PLLDB.OSSR.FLAG$,               \ 1 bytes item OSSR flag   ! BMG
 652: 0000:      \!PLLDB.FILLER$,                  \ 7 byte filler            ! BMG !EWA
 653: 0000:        PLLDB.CNT.PENDSALES.BACKSHOP$,  \ 2 bytes packed backshop pending sales plan count      ! EWA
 654: 0000:        PLLDB.TIME.PENDSALES.BACKSHOP$, \ 2 bytes packed backshop pending sales plan count time ! EWA
 655: 0000:        PLLDB.CNT.PENDSALES.OSSR$,      \ 2 bytes packed OSSR pending sales plan count          ! EWA
 656: 0000:        PLLDB.TIME.PENDSALES.OSSR$,     \ 2 bytes packed OSSR pending sales plan count time     ! EWA
 657: 0000:        PLLDB.STKFIG.STOCKROOM$,        \ 4 bytes unpacked Sales figure at Shelf Monitoring
 658: 0000:                                        \ progam submitted for pint out
 659: 0000:        PLLDB.OSSR.CNT$,                \ 4 bytes unpacked OSSR item stock count figure
 660: 0000:        PLLDB.TIME.SHELFMON$,           \ 2 bytes packed Time of stock floor count hh:mm
 661: 0000:        PLLDB.TIME.BACKSHOP$,           \ 2 bytes packed Time of back shop count hh:mm
 662: 0000:        PLLDB.TIME.OSSR$,               \ 2 bytes packed Time of OSSR count hh:mm
 663: 0000:        PLLDB.BACKSHOP.SALE$,           \ 4 bytes unpacked Sale at time of backshop count
 664: 0000:        PLLDB.OSSR.SALE$,               \ 4 bytes unpacked Sale at time of OSSR count
 665: 0000:        PLLDB.MS.TABLE$,                \                                           ! DMG
 666: 0000:        PLLDB.MS.LOCATION.CNT$(1),      \ 2 byte packed multi-site location count   ! DMG
 667: 0000:        PLLDB.MS.SALES.FIG$(1),         \ 2 byte packed multi-site sales figure     ! DMG                                             ! CMG
 668: 0000:        PLLDB.MS.TIME.CNT$(1),          \ 2 byte packed multi-site time of count    ! DMG                                             ! CMG
 669: 0000:        PLLDB.MS.FILL.QTY$(1),          \ 2 byte packed multi-site fill quantity    ! DMG                                                        ! CMG
 670: 0000:        PLLDB.FILLER2$(1)               ! 2 byte filler                             ! DMG
 671: 0000: 
 672: 0000: INTEGER*2 GLOBAL                       \
 673: 0000:    PLLDB.REPORT.NUM%,                  \
 674: 0000:    PLLDB.SESS.NUM%
 675: 0000: 
 676: 0000: INTEGER*2 GLOBAL                       \
 677: 0000:    PLLDB.RECL%
 678: 0000: 
 679: 0000: 
 680: 0000: 
 681: 0000: \%INCLUDE CIMFDEC.J86                     ! DLC !2.5NWB
 682: 0000: \%INCLUDE CITEMDEC.J86                    ! DLC !2.5NWB
 683: 0000: \%INCLUDE CSRDEC.J86                      ! DLC !2.5NWB
 684: 0000: \%INCLUDE CSRWFDEC.J86                    ! DLC !2.5NWB
 685: 0000: \%INCLUDE CSRBFDEC.J86                    ! DLC !2.5NWB
 686: 0000: !%INCLUDE EPSOMDEC.J86                    ! FLC TEST
 687: 0000:  %INCLUDE FPFDEC.J86                      ! DLC
 688: 0000:  REM \
 689: 0000: \******************************************************************************
 690: 0000: \******************************************************************************
 691: 0000: \***
 692: 0000: \***         %INCLUDE FOR FLASHPACK / PARENT FILE FIELD DECLARATIONS
 693: 0000: \***
 694: 0000: \***               FILE TYPE    : Keyed
 695: 0000: \***
 696: 0000: \***               REFERENCE    : FPFDEC.J86
 697: 0000: \***
 698: 0000: \***         VERSION A : LES COOK  - 21/8/92
 699: 0000: \***
 700: 0000: \***    VERSION B.              ROBERT COWEY.                       21 OCT 1993.
 701: 0000: \***    No changes to this file.
 702: 0000: \***
 703: 0000: \***    VERSION C.              CLIVE NORRIS.                       17 JAN 1994.
 704: 0000: \***    No changes to this file. Version updated to keep in line 
 705: 0000: \***    with changes in FPFFUNC.BAS.
 706: 0000: \***
 707: 0000: \*******************************************************************************
 708: 0000: \*******************************************************************************
 709: 0000: 
 710: 0000:   STRING GLOBAL                  \
 711: 0000:     FPF.FILE.NAME$,              \
 712: 0000:     FPF.PARENT.CODE$,            \ 4 byte UPD with a check digit
 713: 0000:     FPF.CODE$(1),                \ 4 bytes upd first flashpack code of 10                 ! Boots code with a check digit 
 714: 0000:                                  \ (99999999 if no code) 
 715: 0000:     FPF.MULT.FACTOR$(1)          \ 2 bytes UPD multiplication factor for
 716: 0000:                   		 ! first flashpack code.
 717: 0000: 
 718: 0000:   INTEGER*2 GLOBAL        \
 719: 0000:     FPF.RECL%,            \
 720: 0000:     FPF.REPORT.NUM%,      \
 721: 0000:     FPF.SESS.NUM%,        \
 722: 0000:     MAX.FPF.CODES%
 723: 0000: 
 724: 0000:  %INCLUDE IDFDEC.J86                      ! FLC
 725: 0000: REM \
 726: 0000: \******************************************************************************
 727: 0000: \******************************************************************************
 728: 0000: \***
 729: 0000: \***         %INCLUDE FOR ITEM DATA FILE - FIELD DECLARATIONS
 730: 0000: \***                                       FILE REFERENCE PARAMETERS
 731: 0000: \***
 732: 0000: \***                  FILE TYPE    : Keyed
 733: 0000: \***
 734: 0000: \***                  REFERENCE    : IDFDEC.J86
 735: 0000: \***
 736: 0000: \***         VERSION A : Andrew Wedgeworth  29th June 1992    
 737: 0000: \***
 738: 0000: \***    VERSION C.              Robert Cowey.                       25 AUG 1993.
 739: 0000: \***    Replaced un-used RANK$ with BSNS.CNTR$ and FILLER$.
 740: 0000: \***
 741: 0000: \***    VERSION D.              Andrew Wedgeworth               15th March 1995
 742: 0000: \***    Comments updated to reflect the fact that some bits on the file are
 743: 0000: \***    no longer used.
 744: 0000: \***
 745: 0000: \*******************************************************************************
 746: 0000: \*******************************************************************************
 747: 0000: 
 748: 0000:   STRING GLOBAL           \
 749: 0000:     IDF.FILE.NAME$,       \  
 750: 0000:     IDF.BOOTS.CODE$,      \ 4 byte UPD with check digit (key)
 751: 0000:     IDF.FIRST.BAR.CODE$,  \ 6 byte UPD without check digit
 752: 0000:     IDF.SECOND.BAR.CODE$, \ 6 byte UPD without check digit
 753: 0000:     IDF.NO.OF.BAR.CODES$, \ 2 byte UPD. Total number of bar codes for this item
 754: 0000:     IDF.PRODUCT.GRP$,     \ 3 byte UPD. The first two digits are the concept
 755: 0000:                           \ group and the last four the concept sequence
 756: 0000:     IDF.STNDRD.DESC$,     \ 24 bytes
 757: 0000:     IDF.STATUS.1$,        \ 1 byte, values B,C,D,P,X,Z and blank
 758: 0000:     IDF.INTRO.DATE$,      \ 3 byte UPD YYMMDD. Date first added to this file
 759: 0000:     IDF.BSNS.CNTR$,       \ 1 byte ASC. Business Centre ID letter      ! CRC
 760: 0000:     IDF.FILLER$,          \ 1 byte un-used                             ! CRC
 761: 0000:     IDF.PARENT.CODE$,     \ 4 byte UPD with check digit ; may be zero if no
 762: 0000:                           \ flashpacks, current IDF.BOOTS.CODE$ if parent line
 763: 0000:                           \ or Boots Code of parent line if a flashpack.
 764: 0000:     IDF.DATE.OF.LAST.SALE$! 3 byte UPD. Date of last sale.
 765: 0000: 
 766: 0000:   INTEGER*1 GLOBAL        \
 767: 0000:     IDF.BIT.FLAGS.1%,     \ 1 byte - bit values
 768: 0000:                           \ X"80"  - Group code flag
 769: 0000:                           \ X"40"  - Keylines flag
 770: 0000:                           \ X"20"  - Markdown flag
 771: 0000:                           \ X"10"  - Warehouse flag
 772: 0000:                           \ X"08"  - CSR flag
 773: 0000:                           \ X"04"  - Directs A flag
 774: 0000:                           \ X"02"  - Directs B flag
 775: 0000:                           \ X"01"  - Directs C flag
 776: 0000:     IDF.BIT.FLAGS.2%      \ 1 byte - bit values
 777: 0000:                           \ X"80"  - Own brand line flag
 778: 0000:                           \ X"40"  - Exclusive line flag
 779: 0000:                           \ X"20"  - Unused 
 780: 0000:                           \ X"10"  - Unused
 781: 0000:                           \ X"08"  - Stock system flag
 782: 0000:                           \ X"04"  - Pending count flag
 783: 0000:                           \ X"02"  - Reserved
 784: 0000:                           ! X"01"  - Reserved
 785: 0000: 
 786: 0000:   INTEGER*2 GLOBAL        \
 787: 0000:     IDF.RECL%,            \  
 788: 0000:     IDF.REPORT.NUM%,      \ 
 789: 0000:     IDF.SESS.NUM%
 790: 0000:  %INCLUDE INVOKDEC.J86                    ! FLC
 791: 0000: \******************************************************************************
 792: 0000: \******************************************************************************
 793: 0000: \***
 794: 0000: \***   $Workfile:   INVOKDEC.J86  $
 795: 0000: \***
 796: 0000: \***   $Revision:   1.4  $
 797: 0000: \***
 798: 0000: \******************************************************************************
 799: 0000: \******************************************************************************
 800: 0000: \***
 801: 0000: \***   $Log:   V:\archive\j86\invokdec.j8v  $
 802: 0000: \***   
 803: 0000: \***      Rev 1.4   10 Feb 1998 14:11:36   DEV45PS
 804: 0000: \***   Added RP Delivery Days field
 805: 0000: \***   
 806: 0000: \***      Rev 1.3   09 Apr 1997 09:22:06   DEVAWPS
 807: 0000: \***   Added date of successful processing of Points
 808: 0000: \***   Events details.
 809: 0000: \***   
 810: 0000: \***      Rev 1.2   20 Dec 1994 11:02:52   DEVMJPS
 811: 0000: \***   CSR/2 Amendments - new fields added are 
 812: 0000: \***   PSC14 flag and Conversion Status flag 
 813: 0000: \***   
 814: 0000: \******************************************************************************
 815: 0000: \******************************************************************************
 816: 0000: REM \
 817: 0000: \******************************************************************************
 818: 0000: \******************************************************************************
 819: 0000: \***
 820: 0000: \***    FIELD DECLARATIONS AND FILE REFERENCE PARAMETERS FOR INVCE OK FILE 
 821: 0000: \***
 822: 0000: \***                     REFERENCE   : INVOKDEC.J86
 823: 0000: \***
 824: 0000: \***    Version A            Andrew Wedgeworth              3rd August 1992
 825: 0000: \***    
 826: 0000: \***    Version B            Stephen Kelsey                 12th October 1992
 827: 0000: \***    Include Direct Implementation Flag, PSC30 flag and date.
 828: 0000: \***
 829: 0000: \***    Version C            Les Cook                       15th February 1993
 830: 0000: \***    Include UOD Implementation Flag, UOD Booked in date, Previous serial
 831: 0000: \***    number and success flag.
 832: 0000: \***
 833: 0000: \***    Version D            David Smallwood                20th July 1994   
 834: 0000: \***    Include CSR PHASE1 transmission flag and CSR start method flag.
 835: 0000: \***    
 836: 0000: \***    Version E            Mick Bayliss                   19th Oct. 1994
 837: 0000: \***    New fields for CSR Phase 2 - PSC14 Flag and Conversion Status Flag.
 838: 0000: \***
 839: 0000: \***    Version F            Andrew Wedgeworth              27th March 1997
 840: 0000: \***    Added date of successful processing of Points Events details sent from 
 841: 0000: \***    the mainframe.
 842: 0000: \***
 843: 0000: \***    Version G            Nik Sen                        10th February 1998
 844: 0000: \***    Added parameter used by MINSITS RP to determine number of days to 
 845: 0000: \***    check for late delivery.
 846: 0000: \***
 847: 0000: \******************************************************************************
 848: 0000: \******************************************************************************
 849: 0000: 
 850: 0000: 
 851: 0000: \******************************************************************************
 852: 0000: \***
 853: 0000: \***   FILE REFERENCE PARAMETERS
 854: 0000: \***
 855: 0000: \******************************************************************************
 856: 0000: 
 857: 0000:   STRING GLOBAL           \
 858: 0000:     INVOK.FILE.NAME$
 859: 0000: 
 860: 0000:   INTEGER*2 GLOBAL        \
 861: 0000:     INVOK.SESS.NUM%,      \
 862: 0000:     INVOK.REPORT.NUM%
 863: 0000: 
 864: 0000: 
 865: 0000: \******************************************************************************
 866: 0000: \***
 867: 0000: \***   FIELD DECLARATIONS
 868: 0000: \***
 869: 0000: \******************************************************************************
 870: 0000: 
 871: 0000:   STRING GLOBAL                \
 872: 0000:     INVOK.SERIAL.NO$,          \ 5 bytes ASCII
 873: 0000:     INVOK.DATE$,               \ 3 bytes YYMMDD UPD
 874: 0000:     INVOK.SUCCESS.FLAG$,       \ 1 bytes ASCII
 875: 0000:     INVOK.STORE.NO$,           \ 4 bytes ASCII with leading zeroes
 876: 0000:     INVOK.INVENTORY.SRLNO$,    \ 5 bytes ASCII leading zeros
 877: 0000:     INVOK.INVENTORY.SUCCESS$,  \ 1 bytes ASCII 0=failed/1=success
 878: 0000:     INVOK.SALES.SRLNO$,        \ 5 bytes ASCII leading zeros
 879: 0000:     INVOK.SALES.SUCCESS$,      \ 1 bytes ASCII 0=failed/1=success
 880: 0000:     INVOK.NEW.LIST.SRLNO$,     \ 5 bytes ASCII
 881: 0000:     INVOK.NEW.LIST.SUCCESS$,   \ 1 bytes ASCII 0=failed/1=success
 882: 0000:     INVOK.CSR.DELIVERY.NO$,    \ 5 bytes ASCII				
 883: 0000:     INVOK.CSR.IDENT$,          \ 1 bytes ASCII value "Y" 		
 884: 0000:     INVOK.CSR.DELIVERY.DATE$,  \ 6 bytes ASCII YYMMDD			
 885: 0000:     INVOK.CSR.PSC11.FLAG$,     \ 1 bytes ASCII				
 886: 0000:     INVOK.CSR.PSC12.FLAG$,     \ 1 bytes ASCII				
 887: 0000:     INVOK.CSR.PSC13.FLAG$,     \ 1 bytes ASCII				
 888: 0000:     INVOK.CSR.PSC12.DAYS$,     \ 1 bytes UPD				
 889: 0000:     INVOK.PSS33.RUN.DATE$,     \ 3 bytes YYMMDD UPD                     
 890: 0000:     INVOK.PSS33.SUCCESS.FLAG$, \ 1 bytes ASCII 0=failed/1=success       
 891: 0000:     INVOK.DIR.IMPL.FLAG$,      \ 1 byte ASCII  1=phase 1 implemented   BSPK   
 892: 0000:                                \           blank=not yet implemented   BSPK 
 893: 0000:     INVOK.PSC30.RUN.DATE$,     \ 3 bytes YYMMDD UPD                    BSPK                     
 894: 0000:     INVOK.PSC30.SUCCESS.FLAG$, \ 1 bytes ASCII 0=failed/1=success      BSPK
 895: 0000:     INVOK.UOD.IMPL.FLAG$,      \ 1 byte ASCII 1=implemented            CLC
 896: 0000:     INVOK.LAST.UOD.DATE$,      \ 3 bytes UPD                           CLC
 897: 0000:     INVOK.PREV.SERIAL.NO$,     \ 5 bytes ASCII                         CLC
 898: 0000:     INVOK.PREV.SUCCESS.FLAG$,  \ 1 byte ASCII                          CLC
 899: 0000:     INVOK.SUPPRESS.EXCEP.REPORT$,     \ 1 byte ASCII Y/N               DDS
 900: 0000:     INVOK.CSR.STARTED.BY.SUP$,        \ 1 byte ASCII Y/N               DDS
 901: 0000:     INVOK.CSR.PSC14.FLAG$,            \ 1 byte ASCII S/E/X/Y           EMJB
 902: 0000:     INVOK.CSR.CONVERSION.STATUS.FLAG$,\ 1 byte ASCII P/S/X/C           EMJB
 903: 0000:     INVOK.PTS.EVENTS.OK.DATE$, \ 3 bytes UPD                           FAW
 904: 0000:     INVOK.RP.DAYS$,            \ 1 byte ASCII                          GNS
 905: 0000:     INVOK.FILLER$              ! 6 bytes spaces                        GNS
 906: 0000: 
 907: 0000:   INTEGER*2 GLOBAL        \
 908: 0000:     INVOK.RECL%
 909: 0000:  %INCLUDE ONORDDEC.J86                    ! DLC
 910: 0000: \******************************************************************************
 911: 0000: \******************************************************************************
 912: 0000: \***
 913: 0000: \***         %INCLUDE FOR CSR ON ORDER FILE - FIELD DECLARATIONS
 914: 0000: \***                                          FILE REFERENCE PARAMETERS
 915: 0000: \***
 916: 0000: \***               FILE TYPE    : Keyed     
 917: 0000: \***
 918: 0000: \***               REFERENCE    : ONORDDEC.J86
 919: 0000: \***
 920: 0000: \***               DATE OF LAST AMENDMENT -  09/10/92
 921: 0000: \***
 922: 0000: \******************************************************************************
 923: 0000: \*******************************************************************************
 924: 0000: 
 925: 0000:   STRING GLOBAL                  \
 926: 0000:     ONORD.FILE.NAME$,		 \
 927: 0000:     ONORD.KEY$,                  \ 12byte ASC
 928: 0000:     ONORD.ORDER.DATE$,           \ 6 byte ASC
 929: 0000:     ONORD.LIST.FREQ$,            \ 1 byte ASC
 930: 0000:     ONORD.UNIT.NO$,              \ 2 byte ASC 
 931: 0000:     ONORD.SEQ.NO$,               \ 3 byte ASC 
 932: 0000:     ONORD.HIGHEST.SEQ.NO$,       \ 3 byte ASC 
 933: 0000:     ONORD.FILLER$,               \
 934: 0000:     ONORD.ITEM.CODE$,            \ 7 byte ASC 
 935: 0000:     ONORD.QTY.1$,                \ 3 byte ASC
 936: 0000:     ONORD.QTY.2$,                \ 3 byte ASC 
 937: 0000:     ONORD.CSRITEM.UNDONE.FLAG$,  \ 1 byte ASC "Y" or "N"
 938: 0000:     ONORD.CSRIMF.UNDONE.FLAG$,   \ 1 byte ASC "Y" or "N" 
 939: 0000:     ONORD.DELETED.FLAG$          ! 1 byte ASC "Y" or "N" 
 940: 0000:     
 941: 0000:   INTEGER*2 GLOBAL		 \
 942: 0000:     ONORD.REPORT.NUM%,		 \
 943: 0000:     ONORD.RECL%,		 \
 944: 0000:     ONORD.SESS.NUM%  
 945: 0000:     
 946: 0000:  %INCLUDE PCHKDEC.J86                     ! DLC
 947: 0000: \******************************************************************************
 948: 0000: \******************************************************************************
 949: 0000: \***
 950: 0000: \***         %INCLUDE FOR PRICE CHECK FILE - FILE REFERENCE PARAMETERS
 951: 0000: \***
 952: 0000: \***               REFERENCE    : PCHKDEC.J86
 953: 0000: \***
 954: 0000: \******************************************************************************
 955: 0000: \*******************************************************************************
 956: 0000: 
 957: 0000:   STRING GLOBAL           \
 958: 0000:     PCHK.FILE.NAME$
 959: 0000: 
 960: 0000:   INTEGER*2 GLOBAL        \
 961: 0000:     PCHK.REPORT.NUM%,      \
 962: 0000:     PCHK.SESS.NUM%
 963: 0000:  %INCLUDE PIPEINUB.J86                    ! DLC
 964: 0000: 
 965: 0000: \******************************************************************************
 966: 0000: \******************************************************************************
 967: 0000: \***
 968: 0000: \***                   %INCLUDE FOR PSS38 INPUT PIPE
 969: 0000: \***
 970: 0000: \***                         LINK TYPE : PIPEI
 971: 0000: \***
 972: 0000: \***                     REFERENCE : PIPEINUM.J86
 973: 0000: \***
 974: 0000: \******************************************************************************
 975: 0000: \******************************************************************************
 976: 0000: 
 977: 0000:    STRING GLOBAL							\
 978: 0000: 	PIPEI.FILE.NAME$
 979: 0000: 	
 980: 0000:    INTEGER*1 GLOBAL							\
 981: 0000: 	PIPEI.REPORT.NUM%,						\
 982: 0000: 	PIPEI.SESS.NUM%
 983: 0000: !%INCLUDE PIPEONUB.J86                    ! FLC TEST
 984: 0000:  %INCLUDE UNITSDEC.J86                    ! DLC
 985: 0000: \******************************************************************************
 986: 0000: \******************************************************************************
 987: 0000: \***
 988: 0000: \***         %INCLUDE FOR UNITS - FILE REFERENCE PAREMETERS
 989: 0000: \***                              FIELD DECLARATIONS
 990: 0000: \***
 991: 0000: \***               REFERENCE    : UNITSDEC.J86
 992: 0000: \***
 993: 0000: \***
 994: 0000: \******************************************************************************
 995: 0000: \******************************************************************************
 996: 0000: 
 997: 0000:   STRING GLOBAL           \
 998: 0000:     UNITS.UNIT$,          \ 1  byte UPD (key)
 999: 0000:     UNITS.UNIT.NAME$,     \ 27 bytes ASCII
1000: 0000:     UNITS.BC.LETTER$,     \ 1  byte  ASCII
1001: 0000:     UNITS.FILLER$,        \ 6  bytes ASCII (spaces).
1002: 0000:     UNITS.FILE.NAME$
1003: 0000: 
1004: 0000:   INTEGER*2 GLOBAL        \
1005: 0000:     UNITS.REPORT.NUM%,    \ 
1006: 0000:     UNITS.RECL%,          \ 
1007: 0000:     UNITS.SESS.NUM%
1008: 0000:  %INCLUDE STKMQDEC.J86                    ! MMJK
1009: 0000: REM \
1010: 0000: \******************************************************************************
1011: 0000: \******************************************************************************
1012: 0000: \***
1013: 0000: \***      %INCLUDE FOR STOCK MOVEMENT QUEUE FILE FIELD DECLARATIONS
1014: 0000: \***                                             FILE REFERENCE PARAMETERS
1015: 0000: \***
1016: 0000: \***               FILE TYPE    : Sequential
1017: 0000: \***
1018: 0000: \***               REFERENCE    : STKMQDEC.J86
1019: 0000: \***
1020: 0000: \***      Version A.     L. Cook
1021: 0000: \***
1022: 0000: \***      Combined from STKMQNUE.J86 and STKMQFLE.J86
1023: 0000: \***
1024: 0000: \***      Version B.     S.P. Kelsey (CTG)            7th November
1025: 0000: \***      Include CSR Marker in the Type 1 and Type 18 transactions.
1026: 0000: \***
1027: 0000: \***      Version C.     S. Goulding                 8th March
1028: 0000: \***      Add fields for new tranctions types 21 & 23
1029: 0000: \***
1030: 0000: \***      Version D.     ???????????            ????????????
1031: 0000: \***      ????????????????????????????????????????????????????????
1032: 0000: \***
1033: 0000: \***      Version E.     Michael J. Kelsall           16th Dec 1993.
1034: 0000: \***      Addition of txn types, 24, 25, 26, 27 and 28. As part of the
1035: 0000: \***      RETURNS/AUTOMATIC CREDIT CLAIMING system.
1036: 0000: \***
1037: 0000: \***      Version 1.1    Michael J. Kelsall           10th Aug 1994.
1038: 0000: \***      Changes as part of R/ACC update to allow for zero price claim
1039: 0000: \***      processing. Addition of type 29 txn for this change.
1040: 0000: \***
1041: 0000: \***      Version 1.2    Nik Sen                       8th November 1994
1042: 0000: \***      Addition of transaction type 30 as oart of Epsom Life CSR Phase 2
1043: 0000: \***
1044: 0000: \***      Version 1.3    Neil Bennett                   2nd January 2007
1045: 0000: \***      Add ASN processing support. (Rec Type 17)
1046: 0000: \***
1047: 0000: \***      Version 1.4    Brian Greenfield               14th may 2007
1048: 0000: \***      Added STKMQ.RECALL.TYPE$ for use in A7C RECALLS - only type 26 records.
1049: 0000: \***
1050: 0000: \***      Version 1.5    Neil Bennett                  31st January 2008
1051: 0000: \***      Add STKMQ.FLAG$ for record type 11
1052: 0000: \***
1053: 0000: \***      Version 1.6    Dave Constable                5th September 2008
1054: 0000: \***      Add STKMQ.FLAG$ for record type 33
1055: 0000: \***
1056: 0000: \***      Version 1.7    Dave Constable                30th December 2008
1057: 0000: \***      Add STKMQ.RESCAN$ for record type 33
1058: 0000: \***
1059: 0000: \***      Version 1.8    Dave Constable                6th January 2009
1060: 0000: \***      Add Bookin date & time for record type 33
1061: 0000: \***
1062: 0000: \***      Version F      Mark Walker                      27th Mar 2014
1063: 0000: \***      F337 Centralised View of Stock
1064: 0000: \***      - Relocated STKMQ item processing variables to here.
1065: 0000: \***
1066: 0000: \******************************************************************************
1067: 0000: \*******************************************************************************
1068: 0000: \***
1069: 0000: \***  The length of the records on this file vary depending on the record
1070: 0000: \***  transaction type, but they all comprise combinations of the fields
1071: 0000: \***  defined below.
1072: 0000: \***
1073: 0000: \***  Transaction type 0 (Header record) - RECORD DELIMITER, TRANS TYPE,
1074: 0000: \***     FIELD DELIMITER, CREATION DATE, CREATION TIME, RECORD DELIMITER,
1075: 0000: \***     END OF RECORD MARKER.
1076: 0000: \***
1077: 0000: \***  Transaction type 1 - RECORD DELIMITER, TRANS TYPE, FIELD DELIMITER, DATE,
1078: 0000: \***     TIME, FSI, FOLIO YEAR, FOLIO MONTH, FOLIO NUMBER, STORE SUFFIX,
1079: 0000: \***     COUNT OF ITEMS, INVOICE DAY,(FIELD DELIMITER, BOOTS CODE,
1080: 0000: \***     FIELD DELIMITER, QUANTITY, FIELD DELIMITER, CSR MARKER),
1081: 0000: \***     RECORD DELIMITER, END OF RECORD MARKER.
1082: 0000: \***     The fields within brackets are repeated as many times as count of items.
1083: 0000: \***
1084: 0000: \***  Transaction type 2 - RECORD DELIMITER, TRANS TYPE, FIELD DELIMITER, DATE,
1085: 0000: \***     TIME, BOOTS CODE, FIELD DELIMITER, QUANTITY, RECORD DELIMITER,
1086: 0000: \***     END OF RECORD MARKER.
1087: 0000: \***
1088: 0000: \***  Transaction type 3 - RECORD DELIMITER, TRANS TYPE, FIELD DELIMITER, DATE,
1089: 0000: \***     TIME, BOOTS CODE, FIELD DELIMITER, QUANTITY, FIELD DELIMITER,
1090: 0000: \***     REASON CODE, STORE/RETURN CODE, RECORD DELIMITER, END OF RECORD MARKER
1091: 0000: \***
1092: 0000: \***  Transaction type 4 - RECORD DELIMITER, TRANS TYPE, FIELD DELIMITER, DATE,
1093: 0000: \***     TIME, BOOTS CODE, ON IDF FLAG, FIELD DELIMITER, QUANTITY,
1094: 0000: \***     RECORD DELIMITER, END OF RECORD MARKER
1095: 0000: \***
1096: 0000: \***  Transaction type 5 - RECORD DELIMITER, TRANS TYPE, FIELD DELIMITER, DATE,
1097: 0000: \***     TIME, BOOTS CODE, COUNT FLAG, STOCK MOVEMENT DATE, FIELD DELIMITER,
1098: 0000: \***     QUANTITY, RECORD DELIMITER, END OF RECORD MARKER
1099: 0000: \***
1100: 0000: \***  Transaction type 6 - RECORD DELIMITER, TRANS TYPE, FIELD DELIMITER, DATE,
1101: 0000: \***     TIME, BOOTS CODE, REASON (1 byte ASCII)
1102: 0000: \***     RECORD DELIMITER, END OF RECORD MARKER
1103: 0000: \***
1104: 0000: \***  Transaction type 7 - RECORD DELIMITER, TRANS TYPE, FIELD DELIMITER, DATE,
1105: 0000: \***     TIME, BOOTS CODE, CONCEPT SEQUENCE
1106: 0000: \***     RECORD DELIMITER, END OF RECORD MARKER
1107: 0000: \***
1108: 0000: \***  Transaction type 8 - RECORD DELIMITER, TRANS TYPE, FIELD DELIMITER, DATE,
1109: 0000: \***     TIME, PRODUCT GROUP, RECORD DELIMITER, END OF RECORD
1110: 0000: \***     MARKER
1111: 0000: \***
1112: 0000: \***  Transaction type 9 - RECORD DELIMITER, TRANS TYPE, FIELD DELIMITER, DATE,
1113: 0000: \***     TIME, LIST NUMBER, ITEM NUMBER, LIST TYPE,
1114: 0000: \***     COUNT.BY.DATE, RECORD DELIMITER, END OF RECORD MARKER
1115: 0000: \***
1116: 0000: \***  Transaction type 10- RECORD DELIMITER, TRANS TYPE, FIELD DELIMITER, DATE,
1117: 0000: \***     TIME, BOOTS CODE,
1118: 0000: \***     RECORD DELIMITER, END OF RECORD MARKER
1119: 0000: \***
1120: 0000: \***  Transaction type 11- RECORD DELIMITER, TRANS TYPE, FIELD DELIMITER, DATE,
1121: 0000: \***     TIME, BOOTS CODE, FIELD DELIMITER, COUNT QUANTITY, FIELD DELIMITER(opt),
1122: 0000: \***     SOURCE(opt), FLAG(opt), RECORD DELIMITER, END OF RECORD MARKER
1123: 0000: \***
1124: 0000: \***  Transaction type 12- RECORD DELIMITER, TRANS TYPE, FIELD DELIMITER, DATE,
1125: 0000: \***     TIME, BOOTS CODE,
1126: 0000: \***     RECORD DELIMITER, END OF RECORD MARKER
1127: 0000: \***
1128: 0000: \***  Transaction type 13- RECORD DELIMITER, TRANS TYPE, FIELD DELIMITER, DATE,
1129: 0000: \***     TIME, LIST NUMBER, ITEM NUMBER, ITEM STATUS,ITEM CODE,
1130: 0000: \***     COUNT DATE, COUNT TIME, PRICE, FIELD DELIMITER, SHOP FLOOR COUNT,
1131: 0000: \***     FIELD DELIMITER, BACKROOM COUNT, RECORD DELIMITER, END OF REC MARKER
1132: 0000: \***
1133: 0000: \***  Transaction type 14- RECORD DELIMITER, TRANS TYPE, FIELD DELIMITER, DATE,
1134: 0000: \***     TIME, LIST NUMBER, LIST STATUS, RECORD DELIMITER,
1135: 0000: \***     END OF RECORD MARKER
1136: 0000: \***
1137: 0000: \***  Transaction type 16- RECORD DELIMIER, TRANS TYPE, FIELD DELIMITER, DATE,
1138: 0000: \***     TIME, BC LETTER, FIELD DELIMITER, ORIGINAL RECOUNT
1139: 0000: \***     PERCENTAGE, FIELD DELIMITER, CHANGED RECOUNT PERCENTAGE,
1140: 0000: \***     RECORD DELIMITER, END OF RECORD DELIMITER
1141: 0000: \***
1142: 0000: \***  Transaction type 17- RECORD DELIMITER, TRANS TYPE, FIELD DELIMITER, DATE,
1143: 0000: \***     TIME, SOURCE, SUPPLIER NUMBER, ORDER NUMBER, ORDER SUFFIX, PAGE
1144: 0000: \***     NUMBER, ITEM COUNT,
1145: 0000: \***     CARTON NUMBER, CARTON FLAG,                                        ! 1.3NWB
1146: 0000: \***     FIELD DELIMITER, ITEM CODE, BAR CODE,
1147: 0000: \***     QUANTITY - GOOD, FIELD DELIMITER, QUANTITY - DAMAGED, FIELD DELIMITER,
1148: 0000: \***     QUANTITY - STOLEN (the last 8 fields repeat ITEM COUNT times),
1149: 0000: \***     RECORD DELIMITER, END OF RECORD DELIMITER
1150: 0000: \***
1151: 0000: \***  Transaction type 18- RECORD DELIMITER, TRANS TYPE, FIELD DELIMITER, DATE,
1152: 0000: \***     TIME, FOLIO IDENTIFIER, FOLIO YEAR, FOLIO MONTH, FOLIO NUMBER,
1153: 0000: \***     STORE SUFFIX, ITEM COUNT, INVOICE DAY, EXPECTED DATE OF DELIVERY,
1154: 0000: \***     DALLAS MARKER, FIELD DELIMITER, ITEM CODE, FIELD DELIMITER,
1155: 0000: \***     ORDER QUANTITY, FIELD DELIMITER, CSR MARKER,
1156: 0000: \***     (the last six fields repeat ITEM COUNT times),
1157: 0000: \***     RECORD DELIMITER, END OF RECORD DELIMITER
1158: 0000: \***
1159: 0000: \***  Transaction type 19- RECORD DELIMITER, TRANS TYPE, FIELD DELIMITER, DATE,
1160: 0000: \***     TIME, SUPPLIER NUMBER, ORDER NUMBER, ORDER SUFFIX, CONFIRM/AMEND FLAG,
1161: 0000: \***     START TIME, END TIME, NO SINGLES ADDED, NO ITEMS ADDED, NO ITEMS
1162: 0000: \***     BOOKED IN, RECORD DELIMITER, END OF RECORD DELIMITER
1163: 0000: \***
1164: 0000: \***  Transaction type 21 - RECORD DELIMITER, TRANS TYPE, FIELD DELIMITER, DATE,
1165: 0000: \***     TIME, DISTRIBUTION CENTRE, WAREHOUSE NUMBER, STORE NUMBER, UOD NUMBER,
1166: 0000: \***     STATUS, RECORD DELIMITER, END OF RECORD MARKER
1167: 0000: \***
1168: 0000: \***  Transaction type 23 - RECORD DELIMITER, TRANS TYPE, FIELD DELIMITER, DATE,
1169: 0000: \***     TIME, DISTRIBUTION CENTRE, WAREHOUSE NUMBER, STORE NUMBER, UOD NUMBER,
1170: 0000: \***     STATUS, BOOTS/BAR CODE, BOOTS/BAR CODE FLAG, QUANTITY, FIELD DELIMITER
1171: 0000: \***     FSI,FOLIO YEAR, FOLIO MONTH, STORE SUFFIX, FOLIO NO, CSR MARKER
1172: 0000: \***     RECORD DELIMITER, END OF RECORD MARKER
1173: 0000: \***
1174: 0000: \***
1175: 0000: \***  RETURNS/AUTOMATIC CREDIT CLAIMING RECORD TYPES;
1176: 0000: \***
1177: 0000: \***  Transaction type 24 - Whole or Part consignment record
1178: 0000: \***     RECORD DELIMITER, TRANS TYPE, FIELD DELIMITER, DATE, TIME,
1179: 0000: \***     CREDIT CLAIM NUM, BC LETTER, CLAIM TYPE, SUPPLIER NUM, INVOICE NUM,
1180: 0000: \***     FOLIO NUM, BATCH REF NUM, WHOLE/PART CONSIGNMENT, REPAIR CATEGORY,
1181: 0000: \***     REPAIR NUM, PLAN4 POLICY NUM, DDDA/DCDR NUM, DELIV NOTE NUM,
1182: 0000: \***     DELIV DATE, NUM OF CARTONS, ORDER NUM, COMMENT, NUM OF ITEMS,
1183: 0000: \***     ITEM/BAR CODE FLAG, BOOTS/BAR CODE, QTY, PRICE, RECORD DELIMITER,
1184: 0000: \***     END OF RECORD MARKER
1185: 0000: \***     (ITEM/BAR CODE FLAG to PRICE repeated NUM OF ITEMS times)
1186: 0000: \***
1187: 0000: \***  Transaction type 25 - Non-sales func 16 and Misc. txns from controller
1188: 0000: \***     RECORD DELIMITER, TRANS TYPE, FIELD DELIMITER, DATE, TIME,
1189: 0000: \***     CREDIT CLAIM NUM, NUM OF ITEMS, AUTH CODE/CONTACT,
1190: 0000: \***     ADJUST STOCK FIGURE FLAG, REASON, ITEM/BAR CODE FLAG, BOOTS/BAR CODE,
1191: 0000: \***     QTY, PRICE, RECORD DELIMITER, END OF RECORD MARKER
1192: 0000: \***     (ITEM/BAR CODE FLAG to PRICE repeated NUM OF ITEMS times)
1193: 0000: \***
1194: 0000: \***  Transaction type 26 - Data from LDT
1195: 0000: \***     RECORD DELIMITER, TRANS TYPE, FIELD DELIMITER, DATE, TIME, UOD NUM,
1196: 0000: \***     UOD STATUS, CREDIT CLAIM NUM, NUM OF ITEMS UPDATED, TOTAL QTY IN UOD,
1197: 0000: \***     ADJUST STOCK FIGURE FLAG, SUPPLY ROUTE, DISP LOCATION, BC LETTER,
1198: 0000: \***     RECALL NUM, AUTHORISATION, SUPPLIER, RETURN METHOD, CARRIER, BIRD NUM,
1199: 0000: \***     REASON, WAREHOUSE ROUTE, UOD TYPE, REASON FOR DAMAGE, RECEIVING STORE,
1200: 0000: \***     DESTINATION, DATE UOD OPENED, DATE UOD DESPATCHED, TIME UOD
1201: 0000: \***     DESPATCHED, RECALL TYPE$, ITEM.BAR CODE FLAG, BOOTS/BAR CODE, QTY,       ! 1.4BG
1202: 0000: \***     ITEM UPDATED FLAG, RECORD DELIMITER, END OF RECORD MARKER
1203: 0000: \***     (ITEM/BAR CODE FLAG to ITEM UPDATED FLAG repeated NUM OF ITEMS times)
1204: 0000: \***
1205: 0000: \***  Transaction type 27 - End of LDT session
1206: 0000: \***     RECORD DELIMITER, TRANS TYPE, FIELD DELIMITER, DATE, TIME,
1207: 0000: \***     DATE SESSION ENDED, TIME SESSION ENDED, RECORD DELIMITER,
1208: 0000: \***     END OF RECORD MARKER
1209: 0000: \***
1210: 0000: \***  Transaction type 28 - Cancelled Credit Claim
1211: 0000: \***     RECORD DELIMITER, TRANS TYPE, FIELD DELIMITER, DATE, TIME,
1212: 0000: \***     CLAIM NUMBER, UOD NUM, NEW STATUS FLAG, RECORD DELIMITER,
1213: 0000: \***     END OF RECORD MARKER
1214: 0000: \***
1215: 0000: \***  Transaction type 29 - Zero price update
1216: 0000: \***     RECORD DELIMITER, TRANS TYPE, FIELD DELIMITER, DATE, TIME,
1217: 0000: \***     CLAIM NUMBER, ITEM NUMBER, CLAIM VALUE, RECORD DELIMITER,
1218: 0000: \***     END OF RECORD MARKER
1219: 0000: \***
1220: 0000: \***  Transaction type 30 - CSR Issues
1221: 0000: \***     RECORD DELIMITER, TRANS TYPE, FIELD DELIMITER, DATE, TIME,
1222: 0000: \***     BOOTS CODE, FIELD DELIMITER, QUANTITY, FIELD DELIMITER
1223: 0000: \***     EXPECTED DELIVERY DATE, RECORD DELIMITER, END OF RECORD MARKER
1224: 0000: \***
1225: 0000: \***  Transaction type 31 - Quasi Count
1226: 0000: \***     RECORD DELIMITER, TRANS TYPE, FIELD DELIMITER, DATE,
1227: 0000: \***     TIME, LIST NUMBER, ITEM NUMBER, ITEM STATUS,ITEM CODE,
1228: 0000: \***     COUNT DATE, COUNT TIME, PRICE, FIELD DELIMITER, SHOP FLOOR COUNT,
1229: 0000: \***     FIELD DELIMITER, BACKROOM COUNT (PREV STOCK FIG), RECORD DELIMITER,
1230: 0000: \***      END OF REC MARKER
1231: 0000: \***
1232: 0000: \***  Transaction type 32 - Quasi Adjustment count
1233: 0000: \**      RECORD DELIMITER, TRANS TYPE, FIELD DELIMITER, DATE,
1234: 0000: \***     TIME, LIST NUMBER, ITEM NUMBER, ITEM STATUS,ITEM CODE,
1235: 0000: \***     COUNT DATE, COUNT TIME, PRICE, FIELD DELIMITER, SHOP FLOOR COUNT,
1236: 0000: \***     FIELD DELIMITER, BACKROOM COUNT (PREV STOCK FIG), RECORD DELIMITER,
1237: 0000: \***     END OF REC MARKER
1238: 0000: \***
1239: 0000: \***  Transaction type 33 - +UOD Receiving
1240: 0000: \**      RECORD DELIMITER, TRANS TYPE, FIELD DELIMITER, DATE,
1241: 0000: \***     TIME, UOD LICENCE PLATE, DESPATCH DATE, ACTION, ITEM COUNT,
1242: 0000: \***     for audit type+(ITEM CODE, BARCODE, DESPATCHED QTY, VARIANCE )
1243: 0000: \***     END OF REC MARKER
1244: 0000: \***
1245: 0000: \******************************************************************************
1246: 0000: 
1247: 0000:   STRING GLOBAL              \
1248: 0000:     STKMQ.FILE.NAME$,        \
1249: 0000:     STKMQ.RECORD$,           \ Used to store the whole record which is unstrung
1250: 0000:                              \ into the fields below
1251: 0000:     STKMQ.RECORD.DELIMITER$, \ 1 byte ASCII set to " (CHR$(34))
1252: 0000:     STKMQ.TRANS.TYPE$,       \ 1 byte UPD. 00 = Header record
1253: 0000:                              \             01 = W'house invoice delivery record
1254: 0000:                              \             02 = Delivery without invoice record
1255: 0000:                              \             03 = Stock out record
1256: 0000:                              \             04 = Stock count record
1257: 0000:                              \             17 = Delivery without confirmation
1258: 0000:                              \                  of Direct Order detail
1259: 0000:                              \             18 = Confirmed Dallas invoice record
1260: 0000:                              \             19 = Delivery without confirmation
1261: 0000:                              \                  of Direct Order header
1262: 0000:                              \             21 = UOD record
1263: 0000:                              \             23 = Item Level UOD record
1264: 0000:                              \             24 = Whole/Part consignment (R/ACC)
1265: 0000:                              \             25 = NS16 / Misc cont txn (R/ACC)
1266: 0000:                              \             26 = Data from LDT (R/ACC)
1267: 0000:                              \             27 = End of LDT session (R/ACC)
1268: 0000:                              \             28 = Canc. Credit Claim (R/ACC)
1269: 0000:                              \             29 = Zero price update (R/ACC)
1270: 0000:     STKMQ.FIELD.DELIMITER$,  \ 1 byte ASCII set to ; (CHR$(59))
1271: 0000:     STKMQ.CREATION.DATE$,    \ 3 byte UPD set to current date
1272: 0000:     STKMQ.CREATION.TIME$,    \ 3 byte UPD set to current time
1273: 0000:     STKMQ.CSR.MARKER$,       \ 1 byte ASCII. "Y" - This is a CSR Item      BSPK
1274: 0000:                              \               " " - This is not a CSR Item  BSPK
1275: 0000:     STKMQ.DATE$,             \ 3 byte UPD set to current date
1276: 0000:     STKMQ.TIME$,             \ 3 byte UPD set to current time
1277: 0000:     STKMQ.FSI$,              \ 1 byte ASCII
1278: 0000:     STKMQ.FOLIO.YEAR$,       \ 1 byte UPD
1279: 0000:     STKMQ.FOLIO.MONTH$,      \ 1 byte UPD
1280: 0000:     STKMQ.FOLIO.NUMBER$,     \ 2 bytes UPD
1281: 0000:     STKMQ.STORE.SUFFIX$,     \ 1 byte ASCII
1282: 0000:     STKMQ.ITEM.COUNT$,       \ 1 byte UPD between 1 and 17
1283: 0000:     STKMQ.BOOTS.CODE$,       \ 4 bytes UPD
1284: 0000:     STKMQ.ON.IDF.FLAG$,      \ 1 byte ASCII. Y = On IDF   N = Not on IDF
1285: 0000:     STKMQ.QUANTITY$,         \ variable length string equivalent to
1286: 0000:                              \ STR$(STKMQ.QUANTITY%)
1287: 0000:                              \ +ve indicates add to stock
1288: 0000:                              \ -ve indicates subtract from stock
1289: 0000:     STKMQ.REASON.CODE$,      \ 2 bytes UPD
1290: 0000:     STKMQ.STORE.RET.CODE$,   \ 2 bytes UPD
1291: 0000:     STKMQ.ENDREC.MARKER$,    \ 2 bytes ASCII set to XODOA
1292: 0000:     STKMQ.REASON$,           \ 1 byte ASCII. "I" = ineligible,
1293: 0000:                              \               "U" = unsuppliable,
1294: 0000:                              \               "Z" = deleted,
1295: 0000:                              \               " " = not removed.
1296: 0000:     STKMQ.CONCEPT.SEQUENCE$, \ 3 byte UPD. Concept group / sequence
1297: 0000:     STKMQ.INVOICE.DAY$,      \ 1 byte UPD
1298: 0000:     STKMQ.LIST.NUMBER$,      \ 4 byte ASCII
1299: 0000:     STKMQ.ITEM.NUMBER$,      \ 2 byte ASCII
1300: 0000:     STKMQ.ITEM.STATUS$,      \ 1 byte ASCII
1301: 0000:     STKMQ.COUNT.DATE$,       \ 3 byte UPD - YYMMDD
1302: 0000:     STKMQ.COUNT.TIME$,       \ 2 byte UPD - HHMM
1303: 0000:     STKMQ.PRICE$,            \ 5 byte UPD
1304: 0000:     STKMQ.SHOP.COUNT$,       \ variable ASCII
1305: 0000:     STKMQ.BKRM.COUNT$,       \ variable ASCII
1306: 0000:     STKMQ.LIST.STATUS$,      \ 1 byte ASCII
1307: 0000:     STKMQ.LEFT.TO.COUNT$,    \ variable ASCII
1308: 0000:     STKMQ.COUNT.BY.DATE$,    \ 3 bytes UPD
1309: 0000:     STKMQ.PRODUCT.GROUP$,    \ 3 bytes UPD
1310: 0000:     STKMQ.BC.LETTER$,        \ 1 byte ASCII
1311: 0000:     STKMQ.ORG.RECOUNT$,      \ VARIABLE ASCII
1312: 0000:     STKMQ.NEW.RECOUNT$,      \ VARIABLE ASCII
1313: 0000:     STKMQ.LIST.TYPE$,        \ 1 byte ASCII
1314: 0000:     STKMQ.COUNT.FLAG$,       \ 1 byte ASC from corrections file
1315: 0000:     STKMQ.STMVT.DATE$,       \ 3 bytes UPD
1316: 0000:     STKMQ.SUPPLIER.NO$,      \ 4 bytes UPD
1317: 0000:     STKMQ.ORDER.NO$,         \ 2 bytes UPD
1318: 0000:     STKMQ.ORDER.SFX$,        \ 1 byte ASCII
1319: 0000:     STKMQ.PAGE.NO$,          \ 1 byte UPD
1320: 0000:     STKMQ.ORDER.DATE$,       \ 3 bytes UPD
1321: 0000:     STKMQ.EXP.DELV.DATE$,    \ 3 bytes UPD
1322: 0000:     STKMQ.DALLAS.MKR$,       \ 1 byte ASCII DALLAS system marker
1323: 0000:                              \ 'Y' - invoice is from DALLAS system,
1324: 0000:                              \ 'N' - invoice is not from DALLAS system
1325: 0000:                              \ 'Q' - invoice contains quantity alterations
1326: 0000:     STKMQ.SOURCE$,           \ 1 byte ASCII Source flag
1327: 0000:                              \ 'S' - PSS65, 'P' - PDT, PSS57
1328: 0000:                              \ Transaction type 11 'S' - Stocktake else ' '
1329: 0000:     STKMQ.FLAG$,             \ Transaction type 11 'F' - First 'L' - Last or ' '
1330: 0000:     STKMQ.BAR.CODE$,         \ 6 bytes UPD
1331: 0000:     STKMQ.CODE.FLAG$,        \ 1 BYTE ASCII
1332: 0000:     STKMQ.QTY.GOOD$,         \ VARIABLE ASCII
1333: 0000:                              \ Quantity of singles booked in in good condition
1334: 0000:     STKMQ.QTY.BAD$,          \ VARIABLE ASCII
1335: 0000:                              \ Quantity of singles booked in in bad condition
1336: 0000:     STKMQ.QTY.STOLEN$,       \ VARIABLE ASCII
1337: 0000:                              \ Quantity of singles recognised as stolen
1338: 0000:     STKMQ.CONF.AMND.FLAG$,   \ 1 byte ASCII - Confirm/ Amend Flag
1339: 0000:                              \ 'C' - Order has been confirmed
1340: 0000:                              \ 'A' - Order has been amended
1341: 0000:                              \ ' ' - Nothing has been done to the order
1342: 0000:     STKMQ.START.TIME$,       \ 2 byte UPD (HHMM) time order started to be
1343: 0000:                              \ processed
1344: 0000:     STKMQ.END.TIME$,         \ 2 byte UPD (HHMM) time order was completed
1345: 0000:     STKMQ.SNGLS.ADDED$,      \ 2 byte UPD  Singles added to order
1346: 0000:     STKMQ.ITEMS.ADDED$,      \ 2 byte UPD  Items added to order
1347: 0000:     STKMQ.ITEMS.BOOKED$,     \ 2 byte UPD  Items booked in on the order
1348: 0000:     STKMQ.DIST.CENTRE$,      \ 1 byte UPD
1349: 0000:     STKMQ.WHSE.NUMBER$,      \ 1 byte UPD
1350: 0000:     STKMQ.STORE.NUMBER$,     \ 2 byte UPD
1351: 0000:     STKMQ.UOD.NUMBER$,       \ 3 byte UPD
1352: 0000:     STKMQ.STATUS$,           \ 1 byte ASCII
1353: 0000:                              \
1354: 0000:     STKMQ.CREDIT.CLAIM.NUM$, \ 4 byte UPD
1355: 0000:     STKMQ.CLAIM.TYPE$,       \ 1 byte ASC;  "M" = Missing,
1356: 0000:                              \              "E" = Excess,
1357: 0000:                              \              "R" = Repairs
1358: 0000:     STKMQ.SUPPLIER.NUM$,     \ 3 byte UPD
1359: 0000:     STKMQ.INVOICE.NUM$,      \*9 byte ASC
1360: 0000:     STKMQ.FOLIO.NUM$,        \ 3 byte UPD
1361: 0000:     STKMQ.BATCH.REF$,        \ 3 byte UPD
1362: 0000:     STKMQ.WHOLE.PART.CON$,   \ 1 byte ASC   "W" = Whole, "P" = Part
1363: 0000:     STKMQ.REPAIR.CATEGORY$,  \ 1 byte UPD;   1 = Plan4,
1364: 0000:                              \               2 = Estimate,
1365: 0000:                              \               3 = Boots guarantee,
1366: 0000:                              \               4 = Supplier guarantee,
1367: 0000:                              \               5 = Other guarantee,
1368: 0000:     STKMQ.REPAIR.NUM$,       \ 6 byte UPD
1369: 0000:     STKMQ.PLAN4.POLICY.NUM$, \ 6 byte UPD; (Only if repair cat is Plan4)
1370: 0000:     STKMQ.DDDA.DCDR.NUM$,    \ 4 byte UPD
1371: 0000:     STKMQ.DELIV.NOTE.NUM$,   \*9 byte ASC
1372: 0000:     STKMQ.NUM.CARTONS.RECEIV$,\1 byte UPD
1373: 0000:     STKMQ.ORDER.NUM$,        \*7 byte ASC
1374: 0000:     STKMQ.COMMENT$,          \*20 byte ASC
1375: 0000:     STKMQ.ITEM.BARCODE.FLAG$,\ 1 byte ASC;  "I" = Boots item code,
1376: 0000:                              \               "B" = Barcode.
1377: 0000:     STKMQ.ITEM.BARCODE$,     \ 7 byte UPD
1378: 0000:     STKMQ.ITEM.PRICE$,       \ 3 byte UPD;  Spaces.
1379: 0000:     STKMQ.AUTHORISATION$,    \ 15 byte ASC
1380: 0000:     STKMQ.ADJ.STOCK.FIGURE$, \ 1 byte ASC;  "Y" or "N"
1381: 0000:     STKMQ.RETURN.REASON$,    \ 1 byte UPD;  (See CCRSN file)
1382: 0000:     STKMQ.UOD.NUM$,          \ 7 byte UPD
1383: 0000:     STKMQ.UOD.STATUS$,       \ 1 byte ASC;  "O" = Open,
1384: 0000:                              \              "C" = Closed,
1385: 0000:                              \              "D" = Despatched
1386: 0000:     STKMQ.SUPPLY.ROUTE$,     \ 1 byte ASC
1387: 0000:     STKMQ.DISP.LOCATION$,    \ 1 byte ASC   "M" = MDS,
1388: 0000:                              \              "D" = Dispensary
1389: 0000:     STKMQ.RECALL.NUM$,       \ 8 byte ASC
1390: 0000:     STKMQ.SUPPLIER$,         \ 15 byte ASC
1391: 0000:     STKMQ.RETURN.METHOD$,    \ 1 byte UPD;   1 = Carrier,
1392: 0000:                              \               2 = BIRD,
1393: 0000:                              \               3 = Via D6,
1394: 0000:                              \               4 = Representative
1395: 0000:     STKMQ.CARRIER$,          \ 1 byte UPD;   1 = GPO,
1396: 0000:                              \               2 = Parcelforce,
1397: 0000:                              \               3 = Securicor,
1398: 0000:                              \               4 = Other
1399: 0000:     STKMQ.BIRD.NUM$,         \ 8 byte ASC
1400: 0000:     STKMQ.WAREHOUSE.ROUTE$,  \ 1 byte ASC   "R" = RDC,
1401: 0000:                              \              "C" = CSR
1402: 0000:     STKMQ.UOD.TYPE$,         \ 1 byte UPD;   1 = Travel Outer,
1403: 0000:                              \               2 = Town Tray,
1404: 0000:                              \               3 = Roll cage,
1405: 0000:                              \               4 = Other
1406: 0000:     STKMQ.DAMAGE.REASON$,    \ 1 byte UPD    1 = Bad packaging,
1407: 0000:                              \               2 = Poor handling
1408: 0000:     STKMQ.RECEIVING.STORE$,  \ 2 byte UPD
1409: 0000:     STKMQ.DESTINATION$,      \ 1 byte UPD    1 = Business Centre,
1410: 0000:                              \               2 = MTS,
1411: 0000:                              \               3 = Other
1412: 0000:     STKMQ.DATE.UOD.OPENED$,  \ 3 byte UPD
1413: 0000:     STKMQ.DATE.DESPATCHED$,  \ 3 byte UPD
1414: 0000:     STKMQ.TIME.DESPATCHED$,  \ 3 byte UPD
1415: 0000:     STKMQ.ITEM.UPDATED$,     \ 1 byte ASC
1416: 0000:     STKMQ.DATE.SESS.END$,    \ 3 byte UPD
1417: 0000:     STKMQ.TIME.SESS.END$,    \ 3 byte UPD
1418: 0000:     STKMQ.NEW.STATUS.FLAG$,  \ 1 byte ASC   "C" = Closed,
1419: 0000:                              \              "D" = Despatched,
1420: 0000:                              \              "X" = Cancelled
1421: 0000:     STKMQ.ITEM.NUM$,         \ 2 byte UPD   (CCITF key value)
1422: 0000:     STKMQ.CLAIM.VALUE$,      \ 3 byte UPD
1423: 0000:     STKMQ.CARTON.FLAG$,      \ 1 byte  ASCII - ' ' Old Process,             ! 1.3NWB
1424: 0000:                              \                 'N' Normal Book In           ! 1.3NWB
1425: 0000:                              \                 'A' Carton Audit Process     ! 1.3NWB
1426: 0000:                              \                 'E' Exception Process (nof)  ! 1.3NWB
1427: 0000:     STKMQ.CARTON.NO$,        \ 4 bytes UPD (0-9999)                         ! 1.3NWB
1428: 0000:     STKMQ.RECALL.TYPE$       ! 1 byte ASC   "B" = Batch Recall              ! 1.4BG
1429: 0000:                              !              "N" = Non-batch Recall          ! 1.4BG
1430: 0000:                              !              " " = Old Credit Claim          ! 1.4BG
1431: 0000: 
1432: 0000: !***********************************************************!* DC 1.6
1433: 0000: !* Added for +UOD Development                               !* DC 1.6
1434: 0000: !***********************************************************!* DC 1.6
1435: 0000:   STRING GLOBAL \                                           !* DC 1.6 
1436: 0000:     STKMQ.LICENCE.PLATE$, \                                 !* DC 1.6 
1437: 0000:     STKMQ.DESPATCH.DATE$, \                                 !* DC 1.6 
1438: 0000:     STKMQ.ACTION$, \                                        !* DC 1.6 
1439: 0000:     STKMQ.DELIVERY.DATE$, \                                 !* DC 1.6 
1440: 0000:     STKMQ.DELIVERY.TIME$, \                                 !* DC 1.6 
1441: 0000:     STKMQ.DRIVER.ID$, \                                     !* DC 1.6 
1442: 0000:     STKMQ.BOOKIN.DATE$, \                                   !* DC 1.8
1443: 0000:     STKMQ.BOOKIN.TIME$, \                                   !* DC 1.8 
1444: 0000:     STKMQ.OP.ID$, \                                         !* DC 1.6 
1445: 0000:     STKMQ.BOOKIN.METHOD$, \                                 !* DC 1.6 
1446: 0000:     STKMQ.BOOKIN.LEVEL$, \                                  !* DC 1.6 
1447: 0000:     STKMQ.GIT$, \                                           !* DC 1.6 
1448: 0000:     STKMQ.RESCAN$, \                                        !* DC 1.7
1449: 0000:     STKMQ.FILLER$                                           !* DC 1.6 
1450: 0000: 
1451: 0000:   INTEGER*2 GLOBAL           \                              !* DC 1.6 
1452: 0000:     STKMQ.SESS.NUM%,         \                              !* DC 1.6 
1453: 0000:     STKMQ.REPORT.NUM%                                       !* DC 1.6 
1454: 0000: !***********************************************************!* DC 1.6
1455: 0000: 
1456: 0000:     STRING GLOBAL                                                       \   !FMW
1457: 0000:         STKMQ.UOD.QTY$,         \                                       \   !FMW
1458: 0000:         STKMQ.CODE$(1),         \ Item Code                             \   !FMW
1459: 0000:         STKMQ.TYPE$(1),         \ Code type I = Item code               \   !FMW
1460: 0000:                                 \           B = Barcode                 \   !FMW
1461: 0000:         STKMQ.CSR.FLAG$(1),     \ CSR Flag                              \   !FMW
1462: 0000:         STKMQ.EAN.CODE$(1),     \ Barcode                               \   !FMW
1463: 0000:         STKMQ.QTY$(1),          \ Quantity                              \   !FMW
1464: 0000:         STKMQ.GOOD.QUAN$(1),    \ Good Quantity                         \   !FMW
1465: 0000:         STKMQ.DAM.QUAN$(1),     \ Damaged Quantity                      \   !FMW
1466: 0000:         STKMQ.STOL.QUAN$(1),    \ Stolen Quantity                       \   !FMW
1467: 0000:         STKMQ.PRICE.ARRAY$(1)   ! Retail Price                              !FMW
1468: 0000:                                                                             !FMW
1469: 0000:     INTEGER*2 GLOBAL                                                    \   !FMW
1470: 0000:         STKMQ.ITEM%             ! Count of items in a transaction           !FMW
1471: 0000: 
1472: 0000:  %INCLUDE BCSMFDEC.J86                    ! FLC
1473: 0000: REM \
1474: 0000: \******************************************************************************
1475: 0000: \******************************************************************************
1476: 0000: \***
1477: 0000: \***   %INCLUDE FOR BUSINESS CENTRE SUPPLY METHOD FILE REFERENCE PARAMETERS
1478: 0000: \***                                              FIELD DECLARATIONS
1479: 0000: \***
1480: 0000: \***               REFERENCE    : BCSMFDEC.J86
1481: 0000: \***
1482: 0000: \***  Version A - L Cook
1483: 0000: \***  Copied from bcsmfnue.j86 and bcsmffle.j86
1484: 0000: \***
1485: 0000: \***  Version B - Les Cook
1486: 0000: \***  to include integer missed from bcsmfflf.j86 in error
1487: 0000: \***
1488: 0000: \******************************************************************************
1489: 0000: \*******************************************************************************
1490: 0000: 
1491: 0000:   STRING GLOBAL           \
1492: 0000:     BCSMF.FILE.NAME$,              \ 
1493: 0000:     BCSMF.FSI$,                    \ 1 byte ASCII folio series identifier (key)
1494: 0000:     BCSMF.NAME$,                   \ 14 bytes ASCII business centre name
1495: 0000:     BCSMF.PSEUDO.BUSINESS.CENTRE$, \ 1 byte flag "Y" = pseudo bc
1496: 0000:     BCSMF.FILLER$                  ! 3 bytes spaces
1497: 0000: 
1498: 0000:   INTEGER*1 GLOBAL          \
1499: 0000:     BCSMF.RECNT.LIMIT%,     \ percentage of recounts that may be generated
1500: 0000:     BCSMF.MIN.RECNT.LIMIT%, \ minimum limit
1501: 0000:     BCSMF.MAX.RECNT.LIMIT%, \ maximum limit
1502: 0000:     BCSMF.DISCRPNCY.CNT%,   \ used to calculate   
1503: 0000:     BCSMF.DISCRPNCY.PERCNT%,\ if recount
1504: 0000:     BCSMF.STK.CNT.LIMIT%,   \ is necessary
1505: 0000:     BCSMF.SEQUENCE.NO%,     \ used for displaying
1506: 0000:     BCSMF.NO.REPEAT.TICKETS% ! Number of repeat FALCONCRAFT tickets	! CLC
1507: 0000: 
1508: 0000:   INTEGER*2 GLOBAL        \
1509: 0000:     BCSMF.DISCRPNCY.VAL%,   \ (in pounds) used for determining recounts
1510: 0000:     BCSMF.MIN.LIST.NO%,     \ allowable range of 
1511: 0000:     BCSMF.MAX.LIST.NO%,     \ spare list numbers
1512: 0000:     BCSMF.RECL%,          \
1513: 0000:     BCSMF.SESS.NUM%,      \
1514: 0000:     BCSMF.REPORT.NUM%
1515: 0000:  %INCLUDE IEFDEC.J86                      ! DLC
1516: 0000: REM \
1517: 0000: \******************************************************************************
1518: 0000: \******************************************************************************
1519: 0000: \***
1520: 0000: \***         %INCLUDE FOR ITEM EAN CODES FILE - FIELD DECLARATIONS
1521: 0000: \***                                            FILE REFERENCE PARAMETERS
1522: 0000: \***
1523: 0000: \***               FILE TYPE    : Keyed
1524: 0000: \***
1525: 0000: \***               REFERENCE    : IEFDEC.J86
1526: 0000: \***
1527: 0000: \***    VERSION B.              ROBERT COWEY.                       21 OCT 1993.
1528: 0000: \***    No changes to this file.
1529: 0000: \***
1530: 0000: \*******************************************************************************
1531: 0000: \*******************************************************************************
1532: 0000: 
1533: 0000:   STRING GLOBAL                      \
1534: 0000:     IEF.FILE.NAME$,		     \
1535: 0000:     IEF.BOOTS.CODE.BAR.CODE$,        \ 9 byte UPD -                        BBAAS
1536: 0000:                                      \ 3 bytes UPD boots code              BBAAS   
1537: 0000:                                      \ + 6 UPD bar code,                   BBAAS
1538: 0000:                                      \ no check digits. (key)              BBAAS
1539: 0000:     IEF.NEXT.BAR.CODE$               ! 6 byte UPD without check digit
1540: 0000: 
1541: 0000:   INTEGER*2 GLOBAL        \
1542: 0000:     IEF.REPORT.NUM%,	  \
1543: 0000:     IEF.SESS.NUM%,	  \ 
1544: 0000:     IEF.RECL%
1545: 0000:  %INCLUDE DIRORDEC.J86                    ! DLC
1546: 0000: REM \
1547: 0000: \******************************************************************************
1548: 0000: \******************************************************************************
1549: 0000: \***
1550: 0000: \***     %INCLUDE FOR STORE DIRECT ORDERS FILE  - FIELD DECLARATIONS
1551: 0000: \***                                              FILE REFERENCE PARAMETERS
1552: 0000: \***
1553: 0000: \***               FILE TYPE    : Keyed
1554: 0000: \***
1555: 0000: \***               REFERENCE    : DIRORDEC.J86
1556: 0000: \***
1557: 0000: \***               DATE OF LAST AMENDMENT - 14/08/1992
1558: 0000: \***
1559: 0000: \***               VERSION A    : Les Cook    14th August 1992
1560: 0000: \***
1561: 0000: \***  VERSION B                 Neil Bennett                21st December 2006
1562: 0000: \***  New variable added to hold superceded flag for ASN Carton Support.
1563: 0000: \***
1564: 0000: \******************************************************************************
1565: 0000: \******************************************************************************
1566: 0000: 
1567: 0000:   STRING GLOBAL               \
1568: 0000:       DIRORD.FILE.NAME$,      \
1569: 0000:     DIRORD.RECKEY$,           \ 9 byte key which comprises the following fields
1570: 0000:     DIRORD.SUPPLIER$,         \ 3 bytes UPD (key)
1571: 0000:     DIRORD.ORDER.NO$,         \ 2 bytes UPD (key)
1572: 0000:     DIRORD.ORDER.SUF$,        \ 1 byte ASCII (key)
1573: 0000:     DIRORD.BUS.CENTRE$,       \ 1 byte ASCII (key)
1574: 0000:     DIRORD.SOURCE$,           \ 1 byte ASCII (key), 'D' if from PSS57
1575: 0000:                               \                     ' ' for head office order
1576: 0000:     DIRORD.PAGE.NO$,          \ 1 byte UPD (key)
1577: 0000:                               \
1578: 0000:     DIRORD.CONF.END.TIME$,    \ 2 bytes UPD - Ending time of last update
1579: 0000:     DIRORD.CONF.STRT.TIME$,   \ 2 bytes UPD - Starting time of last update
1580: 0000:     DIRORD.CONFIRM.DATE$,     \ 3 bytes UPD. YYMMDD - set to low values if
1581: 0000:                               \                       confirm flag is blank
1582: 0000:     DIRORD.CONFIRM.FLAG$,     \ 1 byte ASCII. C=Complete, A=Amended,
1583: 0000:                               \               blank = not confirmed
1584: 0000:     DIRORD.DRRF.LAST.DATE$,   \ 3 bytes UPD Date of last run
1585: 0000:     DIRORD.DRRF.LAST.TIME$,   \ 2 bytes UPD Time of last run
1586: 0000:     DIRORD.EXP.DELV.DATE$,    \ 3 bytes UPD. YYMMDD - Expected date of order's
1587: 0000:                               \                       delivery
1588: 0000:     DIRORD.FILLER1$,          \ 494 bytes ASCII set to spaces
1589: 0000:     DIRORD.FILLER2$,          \ 474 bytes ASCII set to spaces
1590: 0000:     DIRORD.FILLER3$,          \ 15 bytes ASCII set to spaces
1591: 0000:     DIRORD.ITEM.COUNT$,       \ 1 byte UPD  - Number of items on record
1592: 0000:     DIRORD.ITEM.DETAILS$(2),  \ 256 bytes containing the repeated item string
1593: 0000:                               \ details. The first dimension has 16 elements
1594: 0000:                               \ corresponding to lines on the invoice.  The
1595: 0000:                               \ second dimension has 4 elements:-
1596: 0000:                               \   1. Boots Code - 4 bytes UPD (0 if bar code
1597: 0000:                               \                                has no matching
1598: 0000:                               \                                Boots code on
1599: 0000:                               \                                file)
1600: 0000:                               \   2. Bar Code   - 6 bytes UPD
1601: 0000:                               \   2. Price      - 4 bytes UPD
1602: 0000:                               \   3. Filler     - 2 bytes ASCII spaces
1603: 0000:                               \ Any unused entries are set to spaces
1604: 0000:     DIRORD.NO.ITEMS.BOOKED$,  \ 2 bytes UPD - Total number of items booked in
1605: 0000:     DIRORD.NO.ITEMS.LST.BKD$, \ 2 bytes UPD - Number of items booked in during
1606: 0000:                               \               last date of update
1607: 0000:     DIRORD.NO.ORDER.ITEM$,    \ 2 bytes UPD - Total number of items in order
1608: 0000:     DIRORD.NO.ORDER.SNGL$,    \ 2 bytes UPD - Total single quantity in order
1609: 0000:     DIRORD.ON.SALE.DATE$,     \ 3 bytes UPD. YYMMDD - Date stock should be on
1610: 0000:                               \                       sale
1611: 0000:     DIRORD.ORDER.DATE$,       \ 3 bytes UPD. YYMMDD Date of order
1612: 0000:     DIRORD.SUPERCEDED$        ! 1 byte ASCII (Y/N) default to N             !BNWB
1613: 0000: 
1614: 0000:     INTEGER*2 GLOBAL       \
1615: 0000:       DIRORD.ITEM.QTY%(2), \ contains the repeated item integer details. The
1616: 0000:                            \ first dimension has 16 elements corresponding to
1617: 0000:                            \ lines on the invoice.  The second dimension has 7
1618: 0000:                            \ elements:-
1619: 0000:                            \   1. Quantity expected from order
1620: 0000:                            \   2. Quantity booked in in good condition
1621: 0000:                            \   3. Quantity booked in in damaged condition
1622: 0000:                            \   4. Quantity booked in as stolen
1623: 0000:                            \   5. Quantity last booked in in good condition
1624: 0000:                            \   6. Quantity last booked in in damaged condition
1625: 0000:                            \   7. Quantity last booked in as stolen
1626: 0000:                            \   Fields 2 to 4 are running totals, fields 5 to 7
1627: 0000:                            \   are the values associated with the confirm/amend
1628: 0000:                            \   date.
1629: 0000:       DIRORD.RECL%,        \
1630: 0000:       DIRORD.SESS.NUM%,    \
1631: 0000:       DIRORD.REPORT.NUM%
1632: 0000: 
1633: 0000:     INTEGER*4 GLOBAL       \
1634: 0000:       DIRORD.NO.RECS%
1635: 0000:  %INCLUDE DIRSUDEC.J86                    ! DLC
1636: 0000: REM \
1637: 0000: \******************************************************************************
1638: 0000: \******************************************************************************
1639: 0000: \***
1640: 0000: \***     %INCLUDE FOR STORE DIRECT SUPPLIER FILE FIELD DECLARATIONS
1641: 0000: \***                                             FILE REFERENCE PARAMETERS
1642: 0000: \***      
1643: 0000: \***               FILE TYPE    : Keyed
1644: 0000: \***
1645: 0000: \***               REFERENCE    : DIRSUDEC.J86
1646: 0000: \***
1647: 0000: \***     Version A - L Cook
1648: 0000: \***
1649: 0000: \***     Combined DIRSUFLA.J86 and DIRSUNUA.J86
1650: 0000: \***
1651: 0000: \***   Version B           Mark Goode          3rd December 2008
1652: 0000: \***   Add new fields for the +ve UOD project
1653: 0000: \***
1654: 0000: \******************************************************************************
1655: 0000: \******************************************************************************
1656: 0000: 
1657: 0000:   STRING GLOBAL            \
1658: 0000:     DIRSUP.FILE.NAME$,     \
1659: 0000:     DIRSUP.RECKEY$,        \ 4 byte key which comprises the following fields
1660: 0000:       DIRSUP.BUS.CENTRE$,  \ 1 byte ASCII (key)
1661: 0000:       DIRSUP.SUPPLIER.NO$, \ 3 bytes UPD (key)
1662: 0000:                            \
1663: 0000:     DIRSUP.SUPPLIER.NAME$, \ 10 byte ASCII
1664: 0000:     DIRSUP.LEAD.TIME.MON$, \ 2 bytes UPD. Lead time for MONDAY in days
1665: 0000:     DIRSUP.LEAD.TIME.TUE$, \ 2 bytes UPD. Lead time for TUESDAY in days
1666: 0000:     DIRSUP.LEAD.TIME.WED$, \ 2 bytes UPD. Lead time for WEDNESDAY in days
1667: 0000:     DIRSUP.LEAD.TIME.THU$, \ 2 bytes UPD. Lead time for THURSDAY in days
1668: 0000:     DIRSUP.LEAD.TIME.FRI$, \ 2 bytes UPD. Lead time for FRIDAY in days
1669: 0000:     DIRSUP.LAPSING.DAYS$,  \ 2 bytes UPD. Number of days before order lapses
1670: 0000:     DIRSUP.PART.ORDER.RULES$, \ 1 byte ASCII. A=Rest of order supplied, 
1671: 0000:                               \               N,Z=not supplied 
1672: 0000:     DIRSUP.MAX.CHECK.QTY$,    \ 2 bytes UPD.
1673: 0000:     DIRSUP.CHECK.QTY$,        \ 2 bytes UPD.
1674: 0000:     DIRSUP.DISCREPANCY.QTY$,  \ 2 bytes UPD.
1675: 0000:     DIRSUP.DISCREPANCY.PERC$, \ 2 bytes UPD. Discrepancy percentage
1676: 0000:     DIRSUP.ASN.FLAG$,         \ 1 byte ASCII. Identifies supplier as ASN or Directs   ! BMG
1677: 0000:     DIRSUP.STATIC.SUPPLIER$,  \ 1 byte ASCII. Identifies supplier as being static     ! BMG
1678: 0000:     DIRSUP.FILLER$          ! 3 bytes ASCII set to low values                         ! BMG
1679: 0000: 
1680: 0000:   INTEGER*2 GLOBAL        \
1681: 0000:     DIRSUP.RECL%,         \
1682: 0000:     DIRSUP.SESS.NUM%,     \
1683: 0000:     DIRSUP.REPORT.NUM%
1684: 0000:     
1685: 0000:   INTEGER*4 GLOBAL        \
1686: 0000:     DIRSUP.NO.RECS%  
1687: 0000:  %INCLUDE DIRWFDEC.J86                    ! DLC
1688: 0000: \******************************************************************************
1689: 0000: \******************************************************************************
1690: 0000: \***
1691: 0000: \***      %INCLUDE FOR DIRWF - DIRECT WORK FILE - FIELD DEFINITIONS
1692: 0000: \***                                              FILE REFERENCE PARAMETERS
1693: 0000: \***
1694: 0000: \***
1695: 0000: \***       REFERENCE: DIRWFDEC.J86
1696: 0000: \***
1697: 0000: \******************************************************************************
1698: 0000: \*******************************************************************************
1699: 0000: 
1700: 0000:   STRING GLOBAL								\
1701: 0000: 	DIRWF.FILE.NAME$,						\
1702: 0000: 	DIRWF.RECORD$
1703: 0000: 
1704: 0000:   INTEGER*2 GLOBAL							\
1705: 0000: 	DIRWF.RECL%,	          					\
1706: 0000: 	DIRWF.SESS.NUM%,						\
1707: 0000: 	DIRWF.REPORT.NUM%
1708: 0000:  %INCLUDE DIRECDEC.J86                    ! DLC
1709: 0000: \******************************************************************************
1710: 0000: \******************************************************************************
1711: 0000: \***
1712: 0000: \***         %INCLUDE FOR DIREC DUMMY FILE I/O SESSION NUMBER
1713: 0000: \***
1714: 0000: \***               REFERENCE    : DIRECDEC.J86
1715: 0000: \***
1716: 0000: \******************************************************************************
1717: 0000: \*******************************************************************************
1718: 0000: 
1719: 0000:   STRING GLOBAL           \
1720: 0000:     DIREC.FILE.NAME$
1721: 0000: 
1722: 0000:   INTEGER*2 GLOBAL        \
1723: 0000:     DIREC.REPORT.NUM%,      \
1724: 0000:     DIREC.SESS.NUM%
1725: 0000:  %INCLUDE LDTCFDEC.J86                    ! DLC
1726: 0000: \******************************************************************************
1727: 0000: \******************************************************************************
1728: 0000: \***
1729: 0000: \***      %INCLUDE FOR LDTCF - LDT CHECK FILE - FILE REFERENCE PARAMETERS
1730: 0000: \***                                            FIELD DEFINITIONS
1731: 0000: \***
1732: 0000: \***       REFERENCE: LDTCFDEC.J86
1733: 0000: \***
1734: 0000: \***
1735: 0000: \******************************************************************************
1736: 0000: \*******************************************************************************
1737: 0000: 
1738: 0000:    STRING GLOBAL							\
1739: 0000: 	LDTCF.FILE.NAME$,						\
1740: 0000: 	LDTCF.VERSION.NO$,                                              \
1741: 0000: 	LDTCF.VERSION.DATE$
1742: 0000: 	
1743: 0000:    INTEGER*2 GLOBAL							\
1744: 0000:         LDTCF.SESS.NUM%,						\
1745: 0000: 	LDTCF.REPORT.NUM%
1746: 0000:  %INCLUDE DRSMQDEC.J86                    ! DLC
1747: 0000: \******************************************************************************
1748: 0000: \******************************************************************************
1749: 0000: \***
1750: 0000: \***      %INCLUDE FOR DIRECTS TEMPORARY STOCK MOVEMENT QUEUE
1751: 0000: \***       FILE FIELD DECLARATIONS
1752: 0000: \***       FILE REFERENCE PARAMETERS
1753: 0000: \***
1754: 0000: \***               FILE TYPE    : Sequential
1755: 0000: \***
1756: 0000: \***               REFERENCE    : DRSMQDEC.J86
1757: 0000: \***
1758: 0000: \***
1759: 0000: \******************************************************************************
1760: 0000: \*******************************************************************************
1761: 0000: \***
1762: 0000: \***  The length of the records on this file vary depending on the record
1763: 0000: \***  transaction type, but they all comprise combinations of the fields
1764: 0000: \***  defined below.
1765: 0000: \***
1766: 0000: \***  Transaction type 17- RECORD DELIMITER, TRANS TYPE, FIELD DELIMITER, DATE,
1767: 0000: \***     TIME, SOURCE, SUPPLIER NUMBER, ORDER NUMBER, ORDER SUFFIX, PAGE
1768: 0000: \***     NUMBER, ITEM COUNT, FIELD DELIMITER, ITEM CODE, BAR CODE,
1769: 0000: \***     QUANTITY - GOOD, FIELD DELIMITER, QUANTITY - DAMAGED, FIELD DELIMITER,
1770: 0000: \***     QUANTITY - STOLEN (the last 8 fields repeat ITEM COUNT times),
1771: 0000: \***     RECORD DELIMITER, END OF RECORD DELIMITER
1772: 0000: \***
1773: 0000: \***  Transaction type 19- RECORD DELIMITER, TRANS TYPE, FIELD DELIMITER, DATE,
1774: 0000: \***     TIME, SUPPLIER NUMBER, ORDER NUMBER, ORDER SUFFIX, CONFIRM/AMEND FLAG,
1775: 0000: \***     START TIME, END TIME, NO SINGLES ADDED, NO ITEMS ADDED, NO ITEMS
1776: 0000: \***     BOOKED IN, RECORD DELIMITER, END OF RECORD DELIMITER
1777: 0000: \***
1778: 0000: \*******************************************************************************
1779: 0000: \***
1780: 0000: \***   REVISION 1.0     Neil Bennett                 2nd January 2007
1781: 0000: \***   Add ASN processing support.
1782: 0000: \***
1783: 0000: \*******************************************************************************
1784: 0000: 
1785: 0000:   STRING GLOBAL              \
1786: 0000:     DRSMQ.FILE.NAME$,        \
1787: 0000:     DRSMQ.RECORD$,           \ Used to store the whole record which is unstrung
1788: 0000:                              \ into the fields below
1789: 0000:     DRSMQ.RECORD.DELIMITER$, \ 1 byte ASCII set to " (CHR$(34))
1790: 0000:     DRSMQ.TRANS.TYPE$,       \ 1 byte UPD.
1791: 0000:                              \             17 = Delivery without confirmation
1792: 0000:                              \                  of Direct Order detail
1793: 0000:                              \             19 = Delivery without confirmation
1794: 0000:                              \                  of Direct Order header
1795: 0000:     DRSMQ.FIELD.DELIMITER$,  \ 1 byte ASCII set to ; (CHR$(59))
1796: 0000:     DRSMQ.DATE$,             \ 3 byte UPD set to current date
1797: 0000:     DRSMQ.TIME$,             \ 3 byte UPD set to current time
1798: 0000:     DRSMQ.ITEM.COUNT$,       \ 1 byte UPD between 1 and 17
1799: 0000:     DRSMQ.BOOTS.CODE$,       \ 4 bytes UPD
1800: 0000:     DRSMQ.QUANTITY$,         \ variable length string equivalent to
1801: 0000:                              \ STR$(DRSMQ.QUANTITY%)
1802: 0000:                              \ +ve indicates add to stock
1803: 0000:                              \ -ve indicates subtract from stock
1804: 0000:     DRSMQ.ENDREC.MARKER$,    \ 2 bytes ASCII set to XODOA
1805: 0000:     DRSMQ.SUPPLIER.NO$,      \ 4 bytes UPD
1806: 0000:     DRSMQ.ORDER.NO$,         \ 2 bytes UPD
1807: 0000:     DRSMQ.ORDER.SFX$,        \ 1 byte ASCII
1808: 0000:     DRSMQ.PAGE.NO$,          \ 1 byte UPD
1809: 0000:     DRSMQ.ORDER.DATE$,       \ 3 bytes UPD
1810: 0000:     DRSMQ.SOURCE$,           \ 1 byte ASCII Source flag
1811: 0000:                              \ 'S' - PSS65, 'P' - PDT, PSS57
1812: 0000:     DRSMQ.BAR.CODE$,         \ 6 bytes UPD
1813: 0000:     DRSMQ.QTY.GOOD$,         \ VARIABLE ASCII
1814: 0000:                              \ Quantity of singles booked in in good condition
1815: 0000:     DRSMQ.QTY.BAD$,          \ VARIABLE ASCII
1816: 0000:                              \ Quantity of singles booked in in bad condition
1817: 0000:     DRSMQ.QTY.STOLEN$,       \ VARIABLE ASCII
1818: 0000:                              \ Quantity of singles recognised as stolen
1819: 0000:     DRSMQ.CONF.AMND.FLAG$,   \ 1 byte ASCII - Confirm/ Amend Flag
1820: 0000:                              \ 'C' - Order has been confirmed
1821: 0000:                              \ 'A' - Order has been amended
1822: 0000:                              \ ' ' - Nothing has been done to the order
1823: 0000:     DRSMQ.START.TIME$,       \ 2 byte UPD (HHMM) time order started to be
1824: 0000:                              \ processed
1825: 0000:     DRSMQ.END.TIME$,         \ 2 byte UPD (HHMM) time order was completed
1826: 0000:     DRSMQ.SNGLS.ADDED$,      \ 5 bytes ASCII Singles added to order
1827: 0000:     DRSMQ.ITEMS.ADDED$,      \ 5 bytes ASCII Items added to order
1828: 0000:     DRSMQ.ITEMS.BOOKED$,     \ 5 bytes ASCII Items booked in on the order
1829: 0000:     DRSMQ.CARTON.FLAG$,      \ 1 byte  ASCII - ' ' Old Process,             ! 1.0NWB
1830: 0000:                              \                 'N' Normal Book In           ! 1.0NWB
1831: 0000:                              \                 'A' Carton Audit Process     ! 1.0NWB
1832: 0000:                              \                 'E' Exception Process (nof)  ! 1.0NWB
1833: 0000:     DRSMQ.CARTON.NO$         ! 4 bytes UPD (0-9999)                         ! 1.0NWB
1834: 0000: 
1835: 0000: 
1836: 0000:   INTEGER*2 GLOBAL           \
1837: 0000:     DRSMQ.SESS.NUM%,         \
1838: 0000:     DRSMQ.REPORT.NUM%
1839: 0000:  %INCLUDE LDTBFDEC.J86                    ! ELC
1840: 0000: \******************************************************************************
1841: 0000: \***
1842: 0000: \***           %INCLUDE FOR LDTBF - LDT STOCK BUFFER FILE
1843: 0000: \***
1844: 0000: \***                    - FIELD DECLARATIONS   
1845: 0000: \***                    - FILE REFERENCE PARAMETERS  
1846: 0000: \***  
1847: 0000: \***                    REFERENCE: LDTBFDEC.J86
1848: 0000: \***      
1849: 0000: \******************************************************************************
1850: 0000: \***
1851: 0000: \***     Version A:      Mike Kelsall      12th October 1992
1852: 0000: \***
1853: 0000: \***     Each order in the LDTBF is recorded in the following format:
1854: 0000: \***
1855: 0000: \***         Order Header  -  Record Identifier   2  ASC  "OH"
1856: 0000: \***                          Supplier Number     3  UPD
1857: 0000: \***                          Order Number        2  UPD
1858: 0000: \***                          Order Suffix        1  ASC   
1859: 0000: \*** 
1860: 0000: \***  (N x)  Order Record  -  Record Identifier   2  ASC  "OD"
1861: 0000: \***                          Boots/Bar code      6  UPD
1862: 0000: \***                          Damaged Quantity    2  INT
1863: 0000: \***                          Stolen Quantity     2  INT
1864: 0000: \*** 
1865: 0000: \***         Order Trailer -  Record Identifier   2  ASC  "OT"
1866: 0000: \***                          Number of items     2  INT 
1867: 0000: \***
1868: 0000: \***
1869: 0000: \***     Version B.          Stuart Highley            8th August 1997
1870: 0000: \***     Added fields: LDTBF.DATE$, LDTBF.START.TIME$, LDTBF.END.TIME$,
1871: 0000: \***                   LDTBF.LOGGED.QTY%
1872: 0000: \***
1873: 0000: \******************************************************************************
1874: 0000: 
1875: 0000: INTEGER*1 GLOBAL                 \
1876: 0000:                                  \
1877: 0000:            LDTBF.SESS.NUM% 
1878: 0000: 
1879: 0000: 
1880: 0000: INTEGER*2 GLOBAL                 \
1881: 0000:                                  \
1882: 0000:            LDTBF.RECL%,          \
1883: 0000:            LDTBF.REPORT.NUM%,    \
1884: 0000:                                  \
1885: 0000:            LDTBF.LOGGED.QTY%,    \  2 byte INT - Already logged qty    ! BSH
1886: 0000:            LDTBF.DAMAGED.QTY%,   \  2 byte INT - Damaged quantity, from LDT
1887: 0000:            LDTBF.STOLEN.QTY%,    \  2 byte INT - Stolen quantity, from LDT
1888: 0000:            LDTBF.GOOD.QTY%,      \  2 byte INT - Good quantity, from LDT
1889: 0000:            LDTBF.ORDERED.QTY%,   \  2 byte INT - Ordered quantity
1890: 0000:            LDTBF.NUM.OF.ITEMS%   !  2 byte INT - Number of items in order
1891: 0000:      
1892: 0000: 
1893: 0000: STRING GLOBAL                    \
1894: 0000:                                  \
1895: 0000:            LDTBF.FILE.NAME$,     \
1896: 0000:                                  \
1897: 0000:            LDTBF.RECORD.ID$,     \  2 byte ASC - Record Identifier
1898: 0000:            LDTBF.SUPPLIER.NUM$,  \  3 byte UPD - Supplier number, from LDT
1899: 0000:            LDTBF.ORDER.NUM$,     \  2 byte UPD - Order number, from LDT 
1900: 0000:            LDTBF.ORDER.SUFFIX$,  \  1 byte ASC - Order suffix, from LDT
1901: 0000:            LDTBF.DATE$,          \  3 byte UPD - Date booked in        ! BSH
1902: 0000:            LDTBF.START.TIME$,    \  2 byte UPD - Time started booking  ! BSH
1903: 0000:            LDTBF.END.TIME$,      \  2 byte UPD - Time ended booking    ! BSH
1904: 0000:            LDTBF.REF.CODE$       !  6 byte UPD - Boots/Bar code, from LDT
1905: 0000:  %INCLUDE IDSOFDEC.J86                    ! ELC
1906: 0000: REM \
1907: 0000: \******************************************************************************
1908: 0000: \******************************************************************************
1909: 0000: \***
1910: 0000: \***      %INCLUDE FOR CSR OUTSTANDING INITIAL STOCK QUANTITIES FILE
1911: 0000: \***                                             FIELD DECLARATIONS
1912: 0000: \***                                             FILE REFERENCE PARAMETERS
1913: 0000: \***
1914: 0000: \***               FILE TYPE    : Keyed
1915: 0000: \***
1916: 0000: \***               REFERENCE    : IDSOFFLD.J86
1917: 0000: \***
1918: 0000: \***      Version A.     Stephen Kelsey (CTG)               21st October 1992
1919: 0000: \***
1920: 0000: \******************************************************************************
1921: 0000: \*******************************************************************************
1922: 0000: 
1923: 0000:   STRING GLOBAL                  \
1924: 0000:     IDSOF.BC.LETTER$,            \ 1 byte UPD
1925: 0000:     IDSOF.EXP.DELV.DATE$,        \ 3 byte UPD YYMMDD
1926: 0000:     IDSOF.FILE.NAME$,            \
1927: 0000:     IDSOF.FILLER$,               \ 10 bytes ASC
1928: 0000:     IDSOF.ITEM.CODE$             ! 4 byte UPD
1929: 0000: 
1930: 0000:   INTEGER*2 GLOBAL               \
1931: 0000:     IDSOF.QUANTITY%,             \ Outstanding Stock Quantity
1932: 0000:     IDSOF.RECL%,                 \     
1933: 0000:     IDSOF.REPORT.NUM%,           \     
1934: 0000:     IDSOF.SESS.NUM% 
1935: 0000:     
1936: 0000:  %INCLUDE UODDEC.J86                      ! FLC
1937: 0000: \******************************************************************************
1938: 0000: \******************************************************************************
1939: 0000: \***
1940: 0000: \***         %INCLUDE FOR UOD DUMMY FILE I/O SESSION NUMBER
1941: 0000: \***
1942: 0000: \***               REFERENCE    : UODDEC.J86
1943: 0000: \***
1944: 0000: \******************************************************************************
1945: 0000: \*******************************************************************************
1946: 0000: 
1947: 0000:   STRING GLOBAL           \
1948: 0000:     UOD.FILE.NAME$
1949: 0000: 
1950: 0000:   INTEGER*2 GLOBAL        \
1951: 0000:     UOD.REPORT.NUM%,      \
1952: 0000:     UOD.SESS.NUM%
1953: 0000:  %INCLUDE UODBFDEC.J86                    ! FLC
1954: 0000: REM \
1955: 0000: \******************************************************************************
1956: 0000: \******************************************************************************
1957: 0000: \***
1958: 0000: \***      %INCLUDE FOR UOD BUFFER FILE FIELD DECLARATIONS
1959: 0000: \***                              FILE REFERENCE PARAMETERS
1960: 0000: \***
1961: 0000: \***               FILE TYPE    : Sequential
1962: 0000: \***
1963: 0000: \***               REFERENCE    : UODBFDEC.J86
1964: 0000: \***
1965: 0000: \***      Version A.     Michael Kelsall             8th February 1993
1966: 0000: \***
1967: 0000: \******************************************************************************
1968: 0000: \*******************************************************************************
1969: 0000: \***
1970: 0000: \***  The length of the records on this file vary depending on the record
1971: 0000: \***  transaction type, but they all comprise combinations of the fields
1972: 0000: \***  defined below.
1973: 0000: \***
1974: 0000: \***  Transaction type 0 (Header record) - RECORD DELIMITER, TRANS TYPE,       
1975: 0000: \***     FIELD DELIMITER, CREATION DATE, CREATION TIME, RECORD DELIMITER,
1976: 0000: \***     END OF RECORD MARKER.
1977: 0000: \***
1978: 0000: \***  Transaction type 21 - RECORD DELIMITER, TRANS TYPE, DATE, TIME, 
1979: 0000: \***     DISTRIBUTION CENTRE, WAREHOUSE NUMBER, STORE NUMBER, UOD NUMBER,
1980: 0000: \***     STATUS, RECORD DELIMITER, END OF RECORD MARKER
1981: 0000: \***
1982: 0000: \***  Transaction type 23 - RECORD DELIMITER, TRANS TYPE, DATE, TIME,
1983: 0000: \***     DISTRIBUTION CENTRE, WAREHOUSE NUMBER, STORE NUMBER, UOD NUMBER,
1984: 0000: \***     STATUS, BOOTS/BAR CODE, BOOTS/BAR CODE FLAG, QUANTITY, 
1985: 0000: \***     FIELD DELIMITER, FSI, FOLIO YEAR, FOLIO MONTH, STORE SUFFIX, 
1986: 0000: \***     FOLIO NO, RECORD DELIMITER, END OF RECORD MARKER
1987: 0000: \***
1988: 0000: \******************************************************************************
1989: 0000: 
1990: 0000:   STRING GLOBAL              \
1991: 0000:     UODBF.FILE.NAME$,	     \
1992: 0000:     UODBF.RECORD$,           \ Used to store the whole record which is unstrung
1993: 0000:                              \ into the fields below
1994: 0000:     UODBF.RECORD.DELIMITER$, \ 1 byte ASCII set to " (CHR$(34)) 
1995: 0000:     UODBF.FIELD.DELIMITER$,  \ 1 byte ASCII set to ; (CHR$(59))
1996: 0000:     UODBF.ENDREC.MARKER$,    \ 2 bytes ASCII set to 0D0Ah
1997: 0000:     UODBF.TRANS.TYPE$,       \ 1 byte UPD. 00 = Header record
1998: 0000: 			     \             21 = UOD record
1999: 0000: 			     \             23 = Item Level UOD record
2000: 0000:     UODBF.CREATION.DATE$,    \ 3 byte UPD set to current date
2001: 0000:     UODBF.CREATION.TIME$,    \ 3 byte UPD set to current time
2002: 0000:     UODBF.DATE$,             \ 3 byte UPD set to current date
2003: 0000:     UODBF.TIME$,             \ 3 byte UPD set to current time
2004: 0000:     UODBF.DIST.CENTRE$,      \ 1 byte UPD   
2005: 0000:     UODBF.WAREHOUSE.NUM$,    \ 1 byte UPD   
2006: 0000:     UODBF.STORE.NUM$,        \ 2 byte UPD
2007: 0000:     UODBF.UOD.NUMBER$,       \ 2 byte UPD
2008: 0000:     UODBF.STATUS$,           \ 1 byte ASC.  "B" = Booked in
2009: 0000:     			     \		    "M" = Missing
2010: 0000: 			     \		    "O" = Opened
2011: 0000: 			     \		    "P" = Picking checked
2012: 0000: 			     \		    "R" = Retro booked in
2013: 0000: 			     \		    "D" = Retrospective opened
2014: 0000: 			     \		    "G" = Retrospective checked
2015: 0000: 			     \		    "A" = Automatically booked in
2016: 0000:     UODBF.BOOTS.BAR.CODE$,   \ 6 byte UPD    
2017: 0000:     UODBF.BOOTS.BAR.CODE.FLAG$, \ 1 byte ASC
2018: 0000:     UODBF.FSI$,              \ 1 byte ASCII
2019: 0000:     UODBF.FOLIO.YEAR$,       \ 1 byte UPD
2020: 0000:     UODBF.FOLIO.MONTH$,      \ 1 byte UPD
2021: 0000:     UODBF.FOLIO.NUMBER$,     \ 2 bytes UPD
2022: 0000:     UODBF.STORE.SUFFIX$      ! 1 byte ASCII
2023: 0000: 
2024: 0000: 			     			     			     
2025: 0000:   INTEGER*2 GLOBAL	     \
2026: 0000:     UODBF.SESS.NUM%,         \
2027: 0000:     UODBF.REPORT.NUM%,	     \
2028: 0000:     UODBF.QUANTITY%
2029: 0000: 			     
2030: 0000:  %INCLUDE UODTFDEC.J86                    ! FLC
2031: 0000: \******************************************************************************
2032: 0000: \******************************************************************************
2033: 0000: \***
2034: 0000: \***      %INCLUDE FOR UODS TEMPORARY FILE
2035: 0000: \***       FILE FIELD DECLARATIONS
2036: 0000: \***       FILE REFERENCE PARAMETERS
2037: 0000: \***
2038: 0000: \***               FILE TYPE    : Sequential
2039: 0000: \***
2040: 0000: \***               REFERENCE    : UODTFDEC.J86
2041: 0000: \***
2042: 0000: \***
2043: 0000: \******************************************************************************
2044: 0000: \*******************************************************************************
2045: 0000: 
2046: 0000:   STRING GLOBAL              \
2047: 0000:     UODTF.FILE.NAME$,	     \
2048: 0000:     UODTF.RECORD$            ! Used to store the whole record 
2049: 0000: 			     			     			     
2050: 0000:   INTEGER*2 GLOBAL	     \
2051: 0000:     UODTF.SESS.NUM%,	     \
2052: 0000:     UODTF.REPORT.NUM%			     
2053: 0000: 			     
2054: 0000:  %INCLUDE PILSTDEC.J86                    ! FLC
2055: 0000: 
2056: 0000: \******************************************************************************
2057: 0000: \***
2058: 0000: \***      %INCLUDE FOR PILST - LIST OF LISTS FILE - FIELD DECLARATIONS
2059: 0000: \***                                                FILE REFERENCE PARAMETERS
2060: 0000: \***
2061: 0000: \***                           8th October 1992
2062: 0000: \***
2063: 0000: \******************************************************************************
2064: 0000: 
2065: 0000:    INTEGER*1 GLOBAL             	\
2066: 0000:         PILST.REPORT.NUM%,		\
2067: 0000: 	PILST.SESS.NUM%,		\
2068: 0000: 	PILST.ITEMS.IN.LIST%,		\ No of items in list
2069: 0000: 	PILST.TO.BE.COUNTED%		! No of items left to be counted
2070: 0000: 
2071: 0000:    INTEGER*2 GLOBAL			\
2072: 0000:         PILST.RECL%
2073: 0000: 
2074: 0000:    STRING GLOBAL			\
2075: 0000: 	PILST.FILE.NAME$,		\
2076: 0000: 	PILST.LIST.NUMBER$,		\ 4 byte - list number
2077: 0000: 	PILST.SPARE.LIST.NUMBER$,	\ 4 byte - spare list number
2078: 0000: 	PILST.LIST.NAME$,		\12 byte - list name
2079: 0000: 	PILST.BC.LETTER$,		\ 1 byte - business centre letter
2080: 0000: 	PILST.LIST.TYPE$,		\ 1 byte - list type :
2081: 0000: 					\    "R" = regular,
2082: 0000: 					\    "C" = CSR,
2083: 0000: 					\    "E" = exceptions.
2084: 0000: 	PILST.COUNT.BY.DATE$,		\ 3 byte UPD - count by date
2085: 0000: 	PILST.PRODUCT.GROUP$,		\ 3 byte UPD - product group
2086: 0000: 	PILST.COUNT.DATE$,		\ 3 byte UPD - scheduled count date
2087: 0000: 	PILST.LIST.STATUS$,		\ 1 byte - list status :
2088: 0000: 					\    "C" = to be counted,
2089: 0000: 					\    "R" = to be re-counted,
2090: 0000: 					\    "X" = cancelled,
2091: 0000: 					\    "F" = completed.
2092: 0000: 	PILST.RECOUNT.DATE$,		\ 3 byte UPD - scheduled re-count date
2093: 0000: 	PILST.RECOUNT.ALLOWED$,		\ 1 byte UPD - re-count allowed flag
2094: 0000: 	PILST.CPM.RUN.DATE$,		\ 3 byte UPD - cpm. run date
2095: 0000: 	PILST.PIPLN.RUN.OK$,	        \ 1 byte - PIPLN run ok flag "Y" / "N"
2096: 0000: 	PILST.HIGHEST.LIST.NO$,	        \ 4 byte - highest transmitted list no
2097: 0000:         PILST.DET.FILLER$,              \ 6 bytes
2098: 0000:         PILST.HDR.FILLER$               ! 24 bytes
2099: 0000: 	
2100: 0000:  %INCLUDE PIITMDEC.J86                    ! FLC
2101: 0000: 
2102: 0000: \******************************************************************************
2103: 0000: \***
2104: 0000: \***     %INCLUDE FOR PIITM - ITEM LIST FILE - FIELD DECLARATIONS
2105: 0000: \***                                           FILE REFERENCE PARAMETERS
2106: 0000: \***
2107: 0000: \***     REFERENCE: PIITMDEC.J86
2108: 0000: \***        
2109: 0000: \***                           8TH OCTOBER 1992
2110: 0000: \***
2111: 0000: \******************************************************************************
2112: 0000: 
2113: 0000:    INTEGER*1 GLOBAL							\
2114: 0000: 	PIITM.REPORT.NUM%,						\
2115: 0000: 	PIITM.SESS.NUM%
2116: 0000: 
2117: 0000:    INTEGER*2 GLOBAL			\
2118: 0000: 	PIITM.RECL%,			\
2119: 0000: 	PIITM.DISCREPANCY%,		\ discrepancy
2120: 0000: 	PIITM.DISCREPANCY.AMT%		! discrepancy amount
2121: 0000: 	
2122: 0000:    STRING GLOBAL			\
2123: 0000: 	PIITM.FILE.NAME$,		\
2124: 0000: 	PIITM.LIST.ITEM.KEY$,		\ 4 + 1 bytes - list no. & item no
2125: 0000: 	PIITM.LIST.NUMBER$,		\ 4 byte - list number
2126: 0000: 	PIITM.ITEM.NUMBER$,		\ 2 byte - item number
2127: 0000: 	PIITM.ITEM.CODE$,		\ 4 byte UPD - item code
2128: 0000: 	PIITM.ON.IDF$,			\ 1 byte - on IDF flag "Y" / "N"
2129: 0000: 	PIITM.ACTIVITY.FLAG$,		\ 1 byte - activity flag
2130: 0000: 	PIITM.CYCLE.LENGTH$,		\ 2 byte - count cycle length (weeks)
2131: 0000: 	PIITM.FAMILY.MARKER$,		\ 2 byte - family marker
2132: 0000: 	PIITM.MEMBERS$,			\ 2 byte - number of members
2133: 0000: 	PIITM.ELIGIBILITY.FLAG$,	\ 1 byte - eligibility flag
2134: 0000: 	PIITM.LIST.STATUS$,		\ 1 byte - list status :
2135: 0000: 					\    "C" = to be counted,
2136: 0000: 					\    "R" = to be re-counted,
2137: 0000: 					\    "D" = counted,
2138: 0000: 					\    "F" = completed,
2139: 0000: 					\    "X" = cancelled.
2140: 0000: 	PIITM.POTENTIAL.RECOUNT$,	\ 1 byte - potential recount flag :
2141: 0000: 					\    "0" = not a potential re-count,
2142: 0000: 					\    "1" = failed value test,
2143: 0000: 					\    "2" = failed percentage test.
2144: 0000:         PIITM.FILLER$                   ! 5 bytes
2145: 0000: 					
2146: 0000: !%INCLUDE PDTWFDEC.J86                    ! FLC
2147: 0000: !%INCLUDE IRFDEC.J86                      ! FLC TEST
2148: 0000: 
2149: 0000:  %INCLUDE CCUODDEC.J86                    ! GMJK
2150: 0000: 
2151: 0000: \*****************************************************************************
2152: 0000: \*****************************************************************************
2153: 0000: \***
2154: 0000: \***        %INCLUDE FIELD DECLARATIONS AND FILE REFERENCE PARAMETERS
2155: 0000: \***
2156: 0000: \***                   FILE TYPE:  KEYED
2157: 0000: \***
2158: 0000: \***                   REFERENCE:  CCUODDEC.J86
2159: 0000: \***
2160: 0000: \***                 DESCRIPTION:  RETURNS / AUTOMATIC CREDIT CLAIMING
2161: 0000: \***                   FILE OF OPEN/CLOSED UODS
2162: 0000: \***
2163: 0000: \***
2164: 0000: \***    VERSION A : Michael J. Kelsall      13th September 1993
2165: 0000: \***      
2166: 0000: \***    VERSION B : Mark Walker                   18th Jul 2015
2167: 0000: \***    F392 Retail Stock 5
2168: 0000: \***    Added CCUOD.RETRIEVAL.FLAG$ field to allow record to be
2169: 0000: \***    marked as processed.
2170: 0000: \***
2171: 0000: \*****************************************************************************
2172: 0000: \*****************************************************************************
2173: 0000: 
2174: 0000: STRING GLOBAL           \
2175: 0000:    CCUOD.FILE.NAME$,        \
2176: 0000:    CCUOD.UOD.NUM$,      \  7 byte UPD;  Record key
2177: 0000:    CCUOD.STATUS$,       \  1 byte ASC;  "O" = Open,
2178: 0000:                 \           "C" = Closed,
2179: 0000:                 \           "D" = Despatched,       
2180: 0000:                 \           "X" = Cancelled.
2181: 0000:    CCUOD.CREDIT.CLAIM.NUM$, \  4 byte UPD
2182: 0000:                 \  CCUOD.NUM.OF.ITEMS% here (I2)
2183: 0000:    CCUOD.SUPPLY.ROUTE$,     \  1 byte ASC;  "W" = Warehouse,
2184: 0000:                 \           "E" = EPSOM,
2185: 0000:                 \           "O" = Other Directs,
2186: 0000:                 \               "D" = Dispensary.
2187: 0000:    CCUOD.DISP.LOCATION$,    \  1 byte ASC   "M" = MDS, "D" = Dispensary.
2188: 0000:    CCUOD.BC.LETTER$,        \  1 byte ASC    
2189: 0000:    CCUOD.RECALL.NUM$,       \  8 byte ASC
2190: 0000:    CCUOD.AUTHORISATION$,    \ 15 byte ASC
2191: 0000:    CCUOD.SUPPLIER$,     \ 15 byte ASC
2192: 0000:    CCUOD.METHOD.OF.RETURN$, \  1 byte UPD;   1 = Carrier,
2193: 0000:                 \                2 = BIRD,
2194: 0000:                 \        3 = Via D6,
2195: 0000:                 \        4 = Representative.
2196: 0000:    CCUOD.CARRIER$,      \  1 byte UPD;   1 = GPO,
2197: 0000:                 \                2 = Parcelforce,
2198: 0000:                 \        3 = Securicor,
2199: 0000:                 \        4 = Other.
2200: 0000:    CCUOD.BIRD.NUM$,     \  8 byte ASC                   
2201: 0000:    CCUOD.REASON.NUM$,       \  1 byte UPD     (See CSRNS declaration)
2202: 0000:    CCUOD.RECEIVING.STORE$,  \  2 byte UPD    
2203: 0000:    CCUOD.DESTINATION$,      \  1 byte UPD    1 = Business Centre, 
2204: 0000:                 \            2 = MTS,
2205: 0000:                 \        3 = Pharmacy, 
2206: 0000:                 \        4 = Other.
2207: 0000:    CCUOD.WAREHOUSE.ROUTE$,  \  1 byte ASC   "R" = RDC, "C" = CSR.
2208: 0000:    CCUOD.UOD.TYPE$,     \  1 byte UPD    1 = Travel Outer,
2209: 0000:                 \        2 = Town tray,
2210: 0000:                 \        3 = Roll cage,
2211: 0000:                 \                4 = Other.
2212: 0000:    CCUOD.DAMAGE.REASON$,         \  1 byte UPD    1 = Bad packaging,    
2213: 0000:                 \        2 = Poor handling.
2214: 0000:    CCUOD.DATE.UOD.OPENED$,  \  3 byte UPD 
2215: 0000:    CCUOD.DATE.UOD.DESPATCHED$,  \  3 byte UPD
2216: 0000:    CCUOD.TIME.UOD.DESPATCHED$,  \  3 byte UPD
2217: 0000:    CCUOD.RETRIEVAL.FLAG$, \  1 byte ASC;  " " = to be retrieved             !BMW
2218: 0000:                           \               "N" = marked as processed         !BMW
2219: 0000:    CCUOD.FILLER$,       \ 19 byte ASC;   Spaces.
2220: 0000:                 \
2221: 0000:                 \
2222: 0000:                 \
2223: 0000:    CCUOD.HEADER$,       \   Hdr rec layout; (key of High values)
2224: 0000:    CCUOD.DATE.FILE.UPDATED$,    \  3 byte UPD (all 9's if empty file created)
2225: 0000:    CCUOD.TIME.FILE.UPDATED$,    \  3 byte UPD (all 9's if empty file created)
2226: 0000:    CCUOD.LDT.NUM$,      \  3 byte UPD (Zeros if no outstanding data
2227: 0000:                 \              to be processed by PSS35)
2228: 0000:    CCUOD.HEADER.FILLER$     ! 84 byte ASC;  Spaces.
2229: 0000: 
2230: 0000: 
2231: 0000: INTEGER*2 GLOBAL        \
2232: 0000:    CCUOD.RECL%,         \
2233: 0000:    CCUOD.REPORT.NUM%,       \
2234: 0000:    CCUOD.SESS.NUM%,     \
2235: 0000:                 \
2236: 0000:    CCUOD.NUM.OF.ITEMS%      ! 2 byte INT
2237: 0000: 
2238: 0000:  %INCLUDE CCLAMDEC.J86                    ! 1.4
2239: 0000: 
2240: 0000: \*****************************************************************************
2241: 0000: \*****************************************************************************
2242: 0000: \***
2243: 0000: \***        %INCLUDE FIELD DECLARATIONS AND FILE REFERENCE PARAMETERS
2244: 0000: \***
2245: 0000: \***                   FILE TYPE:  KEYED
2246: 0000: \***
2247: 0000: \***                   REFERENCE:  CCLAMDEC.J86
2248: 0000: \***
2249: 0000: \***	             DESCRIPTION:  RETURNS / AUTOMATIC CREDIT CLAIMING
2250: 0000: \***				   FILE OF CURRENT CREDIT CLAIMS
2251: 0000: \***
2252: 0000: \***
2253: 0000: \***      VERSION A : Michael J. Kelsall      16th December 1993
2254: 0000: \***      
2255: 0000: \*****************************************************************************
2256: 0000: \*****************************************************************************
2257: 0000: 
2258: 0000: STRING GLOBAL			\
2259: 0000:    CCLAM.FILE.NAME$,		\
2260: 0000:    CCLAM.CREDIT.CLAIM.NUM$,	\  4 byte UPD;   Record Key
2261: 0000:    CCLAM.UOD.NUM$,		\  7 byte UPD
2262: 0000:    				\  CCLAM.NUM.OF.ITEMS% here (I2)
2263: 0000:    CCLAM.SUPPLY.ROUTE$,		\  1 byte ASC;  "W" = Warehouse,
2264: 0000:    				\ 	        "E" = EPSOM,
2265: 0000: 				\	        "O" = Other Directs,
2266: 0000: 				\               "D" = Dispensary.
2267: 0000:    CCLAM.DISP.LOCATION$,	\  1 byte ASC   "M" = MDS, "D" = Dispensary.
2268: 0000:    CCLAM.BC.LETTER$,		\  1 byte ASC    
2269: 0000:    CCLAM.RECALL.NUM$,		\  8 byte ASC
2270: 0000:    CCLAM.AUTHORISATION$,	\ 15 byte ASC
2271: 0000:    CCLAM.SUPPLIER$,		\ 15 byte ASC
2272: 0000:    CCLAM.METHOD.OF.RETURN$,	\  1 byte UPD;   1 = Carrier,
2273: 0000:    				\                2 = BIRD,
2274: 0000: 				\	 	 3 = Via D6,
2275: 0000: 				\		 4 = Representative.
2276: 0000:    CCLAM.CARRIER$,		\  1 byte UPD;   1 = GPO,
2277: 0000:    				\                2 = Parcelforce,
2278: 0000: 				\	 	 3 = Securicor,
2279: 0000: 				\ 		 4 = Other.
2280: 0000:    CCLAM.BIRD.NUM$,		\  8 byte ASC					
2281: 0000:    CCLAM.REASON.NUM$,		\  1 byte UPD     (See CSRNS declaration)
2282: 0000:    CCLAM.RECEIVING.STORE$,	\  2 byte UPD    
2283: 0000:    CCLAM.DESTINATION$,		\  1 byte UPD    1 = Business Centre, 
2284: 0000:    				\	         2 = MTS,
2285: 0000:    				\		 3 = Pharmacy, 
2286: 0000: 				\		 4 = Other.
2287: 0000:    CCLAM.WAREHOUSE.ROUTE$,	\  1 byte ASC   "R" = RDC, "C" = CSR.
2288: 0000:    CCLAM.UOD.TYPE$,		\  1 byte UPD    1 = Travel Outer,
2289: 0000:    				\		 2 = Town tray,
2290: 0000: 				\		 3 = Roll cage,
2291: 0000: 				\     	         4 = Other.
2292: 0000:    CCLAM.DAMAGE.REASON$,        \  1 byte UPD    1 = Bad packaging,	
2293: 0000:    				\		 2 = Poor handling.
2294: 0000:    CCLAM.INVOICE.NUM$,		\* 9 byte ASC 
2295: 0000:    CCLAM.FOLIO.NUM$,		\  3 byte UPD
2296: 0000:    CCLAM.BATCH.REF$,		\  3 byte UPD
2297: 0000:    CCLAM.WHOLE.PART.CON$,       \  1 byte ASC   "W" = Whole, "P" = Part
2298: 0000:    CCLAM.REPAIR.CATEGORY$, 	\  1 byte UPD;   1 = Plan4,
2299: 0000:    				\   		 2 = Estimate,
2300: 0000: 				\		 3 = Boots guarantee,
2301: 0000: 				\		 4 = Supplier guarantee,
2302: 0000: 				\		 5 = Other guarantee,
2303: 0000:    CCLAM.REPAIR.NUM$,		\  6 byte UPD
2304: 0000:    CCLAM.PLAN4.POLICY.NUM$,	\  6 byte UPD 
2305: 0000:    CCLAM.DDDA.DCDR.NUM$,	\  4 byte UPD
2306: 0000:    CCLAM.DELIV.NOTE.NUM$,	\* 9 byte ASC
2307: 0000:    CCLAM.DELIV.DATE$,		\  3 byte UPD
2308: 0000:    CCLAM.NUM.CARTONS.RECEIV$,	\  1 byte UPD
2309: 0000:    CCLAM.ORDER.NUM$,		\  7 byte ASC
2310: 0000:    CCLAM.COMMENT$,  		\*20 byte ASC
2311: 0000:    CCLAM.DATE.OF.CLAIM$,	\  3 byte UPD;  Date of UOD despatch
2312: 0000:    CCLAM.TIME.OF.CLAIM$,	\  3 byte UPD;  Time of UOD despatch
2313: 0000:    CCLAM.RETRIEVAL.FLAG$,	\  1 byte ASC;  "Y", "N"  PSS35 sets to Y
2314: 0000:    				\                         PSB30 sets to N
2315: 0000:    CCLAM.CF.RPT.MARKER$,	\  1 byte ASC;  "Y"       PSS35 sets to Y
2316: 0000:    				\               "N"       PSS20 sets to N
2317: 0000:    CCLAM.CANC.MARKER$,		\  1 byte ASC;  Y or N
2318: 0000:    CCLAM.FILLER$		!  7 byte ASC;  Spaces.
2319: 0000: 
2320: 0000: 
2321: 0000: INTEGER*2 GLOBAL		\
2322: 0000:    CCLAM.RECL%,			\
2323: 0000:    CCLAM.REPORT.NUM%,		\
2324: 0000:    CCLAM.SESS.NUM%,		\
2325: 0000: 				\
2326: 0000:    CCLAM.NUM.OF.ITEMS%		!  2 byte INT
2327: 0000: 
2328: 0000:  %INCLUDE CCITMDEC.J86                    ! GMJK
2329: 0000: 
2330: 0000: \*****************************************************************************
2331: 0000: \*****************************************************************************
2332: 0000: \***
2333: 0000: \***        %INCLUDE FIELD DECLARATIONS AND FILE REFERENCE PARAMETERS
2334: 0000: \***
2335: 0000: \***                   FILE TYPE:  KEYED
2336: 0000: \***
2337: 0000: \***                   REFERENCE:  CCUODITM.J86
2338: 0000: \***
2339: 0000: \***	             DESCRIPTION:  RETURNS / AUTOMATIC CREDIT CLAIMING
2340: 0000: \***				   FILE OF ITEMS PER OPEN/CLOSED UOD
2341: 0000: \***
2342: 0000: \***
2343: 0000: \***      VERSION A : Michael J. Kelsall      13th September 1993
2344: 0000: \***      
2345: 0000: \*****************************************************************************
2346: 0000: \*****************************************************************************
2347: 0000: 
2348: 0000: STRING GLOBAL			\
2349: 0000:    CCITM.FILE.NAME$,		\
2350: 0000:    CCITM.KEY$,			\  Consists of next two fields;
2351: 0000:    CCITM.UOD.NUM$,		\  7 byte UPD
2352: 0000:    CCITM.ITEM.NUM$,		\  2 byte UPD
2353: 0000:    				\
2354: 0000:    CCITM.BOOTS.BAR.CODE.FLAG$,	\  1 byte ASC;  "I" = Boots code,
2355: 0000:    				\		"B" = Bar code.
2356: 0000:    CCITM.BOOTS.BAR.CODE$,	\  7 byte UPD
2357: 0000:    				\  CCITM.QTY% here (I2)
2358: 0000:    CCITM.FILLER$                !  4 byte ASC;  Spaces
2359: 0000:       				
2360: 0000: 
2361: 0000: INTEGER*2 GLOBAL		\
2362: 0000:    CCITM.RECL%,			\
2363: 0000:    CCITM.REPORT.NUM%,		\
2364: 0000:    CCITM.SESS.NUM%,		\
2365: 0000: 				\
2366: 0000:    CCITM.QTY%			!  2 byte INT
2367: 0000: 
2368: 0000:  %INCLUDE CCTRLDEC.J86                    ! GMJK
2369: 0000: 
2370: 0000: \*****************************************************************************
2371: 0000: \*****************************************************************************
2372: 0000: \***
2373: 0000: \***        %INCLUDE FIELD DECLARATIONS AND FILE REFERENCE PARAMETERS
2374: 0000: \***
2375: 0000: \***                   FILE TYPE:  DIRECT
2376: 0000: \***
2377: 0000: \***                   REFERENCE:  CCTRLDEC.J86
2378: 0000: \***
2379: 0000: \***	             DESCRIPTION:  RETURNS / AUTOMATIC CREDIT CLAIMING
2380: 0000: \***				   CREDIT CLAIMS CONTROL FILE
2381: 0000: \***
2382: 0000: \***
2383: 0000: \***      VERSION A : Michael J. Kelsall      14th September 1993
2384: 0000: \***      
2385: 0000: \*****************************************************************************
2386: 0000: \*****************************************************************************
2387: 0000: 
2388: 0000: STRING GLOBAL			\
2389: 0000:    CCTRL.FILE.NAME$,		\
2390: 0000:    CCTRL.RECORD$,		\
2391: 0000:    CCTRL.CREDIT.CLAIM.NUM$,	\  4 byte UPD
2392: 0000:    CCTRL.CREDIT.RPT.RUN.DATE$,	\  3 byte UPD
2393: 0000:    CCTRL.UOD.RPT.RUN.DATE$,	\  3 byte UPD
2394: 0000:    CCTRL.FILLER$		! 65 byte ASC;  Spaces
2395: 0000:    
2396: 0000: 
2397: 0000: INTEGER*2 GLOBAL		\
2398: 0000:    CCTRL.RECL%,			\
2399: 0000:    CCTRL.REPORT.NUM%,		\
2400: 0000:    CCTRL.SESS.NUM%,		\
2401: 0000:    CCTRL.REC.NUM%
2402: 0000: 
2403: 0000: INTEGER*4 GLOBAL		\
2404: 0000:    CCTRL.STAFF.SALES%		!  4 INT, total sales to store staff,
2405: 0000:    				!  stored as 5 byte UPD on file
2406: 0000: 
2407: 0000:  %INCLUDE CCTMPDEC.J86                    ! GMJK
2408: 0000: REM \
2409: 0000: \******************************************************************************
2410: 0000: \******************************************************************************
2411: 0000: \***
2412: 0000: \***      %INCLUDE FOR CREDIT CLAIMING TEMPORARY FILE FIELD DECLARATIONS
2413: 0000: \***                                             FILE REFERENCE PARAMETERS
2414: 0000: \***
2415: 0000: \***               FILE TYPE    : Sequential
2416: 0000: \***
2417: 0000: \***               REFERENCE    : CCTMPDEC.J86
2418: 0000: \***
2419: 0000: \***      Version A.     Michael J. Kelsall           30th September 1993.
2420: 0000: \***
2421: 0000: \***      Version 1.1    Brian Greenfield             14th May 2007
2422: 0000: \***      Added new variable CCTMP.RECALL.TYPE$ for A7C Recalls.
2423: 0000: \***
2424: 0000: \******************************************************************************
2425: 0000: \*******************************************************************************
2426: 0000: \***
2427: 0000: \***  The length of the records on this file vary depending on the record
2428: 0000: \***  transaction type, but they all comprise combinations of the fields
2429: 0000: \***  defined below.
2430: 0000: \***
2431: 0000: \***  RETURNS/AUTOMATIC CREDIT CLAIMING RECORD TYPES;
2432: 0000: \***
2433: 0000: \***  Transaction type 24 - Whole or Part consignment record
2434: 0000: \***     RECORD DELIMITER, TRANS TYPE, FIELD DELIMITER, CREDIT CLAIM NUM, 
2435: 0000: \***     BC LETTER, CLAIM TYPE, SUPPLIER NUM, INVOICE NUM, FOLIO NUM, 
2436: 0000: \***     BATCH REF NUM, REPAIR CATEGORY, REPAIR NUM, PLAN4 POLICY NUM, 
2437: 0000: \***     DDDA/DCDR NUM, DELIV NOTE NUM, DELIV DATE, NUM OF CARTONS, ORDER NUM,
2438: 0000: \***     NUM OF ITEMS, ITEM/BAR CODE FLAG, BOOTS/BAR CODE, QTY, PRICE, 
2439: 0000: \***     RECORD DELIMITER, END OF RECORD MARKER
2440: 0000: \***     (ITEM/BAR CODE FLAG to PRICE repeated NUM OF ITEMS times)
2441: 0000: \***
2442: 0000: \***  Transaction type 26 - Data from LDT
2443: 0000: \***     RECORD DELIMITER, TRANS TYPE, FIELD DELIMITER, UOD NUM, UOD STATUS, 
2444: 0000: \***     CREDIT CLAIM NUM, NUM OF ITEMS UPDATED, TOTAL QTY IN UOD, 
2445: 0000: \***     ADJUST STOCK FIGURE FLAG, SUPPLY ROUTE, DISP LOCATION, BC LETTER, 
2446: 0000: \***     RECALL NUM, AUTHORISATION, SUPPLIER, RETURN METHOD, CARRIER, BIRD NUM,
2447: 0000: \***     REASON, WAREHOUSE ROUTE, UOD TYPE, REASON FOR DAMAGE, RECEIVING STORE,
2448: 0000: \***     DESTINATION, DATE UOD OPENED, DATE UOD DESPATCHED, TIME UOD 
2449: 0000: \***     DESPATCHED, RECALL.TYPE$, ITEM.BAR CODE FLAG, BOOTS/BAR CODE, QTY,       ! 1.1BG
2450: 0000: \***     ITEM UPDATED FLAG, RECORD DELIMITER, END OF RECORD MARKER
2451: 0000: \***     (ITEM/BAR CODE FLAG to ITEM UPDATED FLAG repeated NUM OF ITEMS times)
2452: 0000: \***
2453: 0000: \***  Transaction type 28 - Cancelled Credit Claim
2454: 0000: \***     RECORD DELIMITER, TRANS TYPE, FIELD DELIMITER, CLAIM NUMBER, UOD
2455: 0000: \***     NUM, NEW STATUS FLAG, RECORD DELIMITER, END OF RECORD MARKER
2456: 0000: \***
2457: 0000: \******************************************************************************
2458: 0000: 
2459: 0000:   STRING GLOBAL              \
2460: 0000:     CCTMP.FILE.NAME$,        \
2461: 0000:     CCTMP.RECORD$,           \ Used to store the whole record which is unstrung
2462: 0000:                              \ into the fields below
2463: 0000:     CCTMP.RECORD.DELIMITER$, \ 1 byte ASCII set to " (CHR$(34)) 
2464: 0000:     CCTMP.TRANS.TYPE$,       \ 1 byte UPD. 24 = Whole/Part consignment (R/ACC)
2465: 0000:                  \             25 = NS16 / Misc cont txn (R/ACC)
2466: 0000:                  \             26 = Data from LDT (R/ACC)
2467: 0000:                  \             27 = End of LDT session (R/ACC)
2468: 0000:                  \         28 = Canc. Credit Claim (R/ACC)
2469: 0000:     CCTMP.FIELD.DELIMITER$,  \ 1 byte ASCII set to ; (CHR$(59))
2470: 0000:     CCTMP.ENDREC.MARKER$,    \ 2 bytes ASCII set to 0D0AH
2471: 0000:     CCTMP.BC.LETTER$,        \ 1 byte ASCII
2472: 0000:     CCTMP.CREDIT.CLAIM.NUM$, \ 4 byte UPD
2473: 0000:     CCTMP.NUM.ITEMS.UPDATED$,\ 4 byte ASCII
2474: 0000:     CCTMP.TOTAL.QTY.IN.UOD$, \ 4 byte ASCII
2475: 0000:     CCTMP.CLAIM.TYPE$,       \ 1 byte ASC;  "M" = Missing,
2476: 0000:                      \          "E" = Excess,
2477: 0000:                  \              "R" = Repairs
2478: 0000:     CCTMP.SUPPLIER.NUM$,     \ 3 byte UPD
2479: 0000:     CCTMP.INVOICE.NUM$,      \ 3 byte UPD 
2480: 0000:     CCTMP.FOLIO.NUM$,        \ 3 byte UPD
2481: 0000:     CCTMP.BATCH.REF$,        \ 3 byte UPD
2482: 0000:     CCTMP.REPAIR.CATEGORY$,  \ 1 byte UPD;   1 = Plan4,
2483: 0000:                  \           2 = Estimate,
2484: 0000:                  \           3 = Boots guarantee,
2485: 0000:                  \           4 = Supplier guarantee,
2486: 0000:                  \           5 = Other guarantee,
2487: 0000:     CCTMP.REPAIR.NUM$,       \ 4 byte UPD
2488: 0000:     CCTMP.PLAN4.POLICY.NUM$, \ 6 byte UPD; (Only if repair cat is Plan4)
2489: 0000:     CCTMP.DDDA.DCDR.NUM$,    \ 3 byte UPD
2490: 0000:     CCTMP.DELIV.NOTE.NUM$,   \ 3 byte UPD
2491: 0000:     CCTMP.NUM.CARTONS.RECEIV$,\1 byte UPD
2492: 0000:     CCTMP.ORDER.NUM$,        \ 3 byte UPD
2493: 0000:     CCTMP.ITEM.BARCODE.FLAG$,\ 1 byte ASC;  "I" = Boots item code,
2494: 0000:                  \              "B" = Barcode.
2495: 0000:     CCTMP.ITEM.BARCODE$,     \ 7 byte UPD
2496: 0000:     CCTMP.ITEM.PRICE$,       \ 3 byte UPD;  Spaces.
2497: 0000:     CCTMP.AUTHORISATION$,    \ 15 byte ASC
2498: 0000:     CCTMP.ADJ.STOCK.FIGURE$, \ 1 byte ASC  "Y" or "N"
2499: 0000:     CCTMP.RETURN.REASON$,    \ 1 byte UPD;  (See CCRSN file)
2500: 0000:     CCTMP.UOD.NUM$,      \ 7 byte UPD
2501: 0000:     CCTMP.UOD.STATUS$,       \ 1 byte ASC;  "O" = Open,
2502: 0000:                      \              "C" = Closed,
2503: 0000:                  \              "D" = Despatched
2504: 0000:     CCTMP.PREVIOUS.STATUS$,  \ 1 byte ASC   "O" = Open,
2505: 0000:                      \              "C" = Closed
2506: 0000:     CCTMP.SUPPLY.ROUTE$,     \ 1 byte ASC
2507: 0000:     CCTMP.DISP.LOCATION$,    \ 1 byte ASC   "M" = MDS,
2508: 0000:                      \              "D" = Dispensary
2509: 0000:     CCTMP.RECALL.NUM$,       \ 9 byte ASC 
2510: 0000:     CCTMP.SUPPLIER$,         \ 15 byte ASC
2511: 0000:     CCTMP.RETURN.METHOD$,    \ 1 byte UPD;   1 = Carrier,
2512: 0000:                      \           2 = BIRD,
2513: 0000:                  \               3 = Via D6,
2514: 0000:                  \               4 = Representative
2515: 0000:     CCTMP.CARRIER$,      \ 1 byte UPD;   1 = GPO,
2516: 0000:                      \               2 = Parcelforce,
2517: 0000:                  \               3 = Securicor,
2518: 0000:                  \               4 = Other
2519: 0000:     CCTMP.BIRD.NUM$,         \ 8 byte ASC
2520: 0000:     CCTMP.WAREHOUSE.ROUTE$,  \ 1 byte ASC   "R" = RDC,
2521: 0000:                      \          "C" = CSR
2522: 0000:     CCTMP.UOD.TYPE$,         \ 1 byte UPD;   1 = Travel Outer,
2523: 0000:                      \               2 = Town Tray,
2524: 0000:                  \               3 = Roll cage,
2525: 0000:                  \               4 = Other
2526: 0000:     CCTMP.DAMAGE.REASON$,    \ 1 byte UPD    1 = Bad packaging,
2527: 0000:                      \               2 = Poor handling
2528: 0000:     CCTMP.RECEIVING.STORE$,  \ 2 byte UPD
2529: 0000:     CCTMP.DESTINATION$,      \ 1 byte UPD    1 = Business Centre,
2530: 0000:                      \               2 = MTS,
2531: 0000:                  \               3 = Other
2532: 0000:     CCTMP.DATE.UOD.OPENED$,  \ 3 byte UPD
2533: 0000:     CCTMP.DATE.DESPATCHED$,  \ 3 byte UPD
2534: 0000:     CCTMP.TIME.DESPATCHED$,  \ 3 byte UPD
2535: 0000:     CCTMP.ITEM.UPDATED$,     \ 1 byte ASC
2536: 0000:     CCTMP.NEW.STATUS.FLAG$,  \ 1 byte ASC   "C" = Closed,
2537: 0000:                      \          "D" = Despatched,
2538: 0000:                  \          "X" = Cancelled
2539: 0000:     CCTMP.ITEM.QTY$,         \ 3 byte ASCII              
2540: 0000:     CCTMP.RECALL.TYPE$       ! 1 byte ASCII "B" = Batch Recall              ! 1.1BG
2541: 0000:                              !              "N" = Non-batch Recall          ! 1.1BG
2542: 0000:                              !              " " = Old Credit Claim          ! 1.1BG
2543: 0000:     
2544: 0000:                                                  
2545: 0000:   INTEGER*2 GLOBAL           \
2546: 0000:     CCTMP.SESS.NUM%,         \
2547: 0000:     CCTMP.REPORT.NUM%,       \
2548: 0000:                      \
2549: 0000:     CCTMP.NUM.OF.ITEMS%,     \
2550: 0000:     CCTMP.NUM.ITEMS.UPDATED%,\ 
2551: 0000:     CCTMP.TOTAL.QTY.IN.UOD%  !
2552: 0000:                          
2553: 0000:                  
2554: 0000:  %INCLUDE CCBUFDEC.J86                    ! GMJK
2555: 0000: REM \
2556: 0000: \******************************************************************************
2557: 0000: \******************************************************************************
2558: 0000: \***
2559: 0000: \***      %INCLUDE FOR CREDIT CLAIMING BUFFER FILE FIELD DECLARATIONS
2560: 0000: \***                                          FILE REFERENCE PARAMETERS
2561: 0000: \***
2562: 0000: \***               FILE TYPE    : Sequential
2563: 0000: \***
2564: 0000: \***               REFERENCE    : CCBUFDEC.J86
2565: 0000: \***
2566: 0000: \***      Version A.     Michael J. Kelsall           30th September 1993.
2567: 0000: \***
2568: 0000: \******************************************************************************
2569: 0000: \*******************************************************************************
2570: 0000: \***
2571: 0000: \***  The length of the records on this file vary depending on the record
2572: 0000: \***  transaction type, but they all comprise combinations of the fields
2573: 0000: \***  defined below.
2574: 0000: \***
2575: 0000: \***  RETURNS/AUTOMATIC CREDIT CLAIMING RECORD TYPES;
2576: 0000: \***
2577: 0000: \***  Transaction type 24 - Whole or Part consignment record
2578: 0000: \***     RECORD DELIMITER, TRANS TYPE, FIELD DELIMITER, CREDIT CLAIM NUM, 
2579: 0000: \***     BC LETTER, CLAIM TYPE, SUPPLIER NUM, INVOICE NUM, FOLIO NUM, 
2580: 0000: \***     BATCH REF NUM, REPAIR CATEGORY, REPAIR NUM, PLAN4 POLICY NUM, 
2581: 0000: \***     DDDA/DCDR NUM, DELIV NOTE NUM, DELIV DATE, NUM OF CARTONS, ORDER NUM,
2582: 0000: \***     NUM OF ITEMS, ITEM/BAR CODE FLAG, BOOTS/BAR CODE, QTY, PRICE, 
2583: 0000: \***     RECORD DELIMITER, END OF RECORD MARKER
2584: 0000: \***     (ITEM/BAR CODE FLAG to PRICE repeated NUM OF ITEMS times)
2585: 0000: \***
2586: 0000: \***  Transaction type 26 - Data from LDT
2587: 0000: \***     RECORD DELIMITER, TRANS TYPE, FIELD DELIMITER, UOD NUM, UOD STATUS, 
2588: 0000: \***     CREDIT CLAIM NUM, NUM OF ITEMS UPDATED, TOTAL QTY IN UOD, 
2589: 0000: \***     ADJUST STOCK FIGURE FLAG, SUPPLY ROUTE, DISP LOCATION, BC LETTER, 
2590: 0000: \***     RECALL NUM, AUTHORISATION, SUPPLIER, RETURN METHOD, CARRIER, BIRD NUM,
2591: 0000: \***     REASON, WAREHOUSE ROUTE, UOD TYPE, REASON FOR DAMAGE, RECEIVING STORE,
2592: 0000: \***     DESTINATION, DATE UOD OPENED, DATE UOD DESPATCHED, TIME UOD 
2593: 0000: \***     DESPATCHED, ITEM.BAR CODE FLAG, BOOTS/BAR CODE, QTY, ITEM UPDATED 
2594: 0000: \***     FLAG, RECORD DELIMITER, END OF RECORD MARKER
2595: 0000: \***     (ITEM/BAR CODE FLAG to ITEM UPDATED FLAG repeated NUM OF ITEMS times)
2596: 0000: \***
2597: 0000: \***  Transaction type 28 - Cancelled Credit Claim
2598: 0000: \***     RECORD DELIMITER, TRANS TYPE, FIELD DELIMITER, CLAIM NUMBER, UOD
2599: 0000: \***     NUM, NEW STATUS FLAG, RECORD DELIMITER, END OF RECORD MARKER
2600: 0000: \***
2601: 0000: \******************************************************************************
2602: 0000: 
2603: 0000:   STRING GLOBAL              \
2604: 0000:     CCBUF.FILE.NAME$,        \
2605: 0000:     CCBUF.RECORD$,           \ Used to store the whole record which is unstrung
2606: 0000:                              \ into the fields below
2607: 0000:     CCBUF.RECORD.DELIMITER$, \ 1 byte ASCII set to " (CHR$(34)) 
2608: 0000:     CCBUF.TRANS.TYPE$,       \ 1 byte UPD. 24 = Whole/Part consignment (R/ACC)
2609: 0000: 			     \             25 = NS16 / Misc cont txn (R/ACC)
2610: 0000: 			     \	           26 = Data from LDT (R/ACC)
2611: 0000: 			     \             27 = End of LDT session (R/ACC)
2612: 0000: 			     \		   28 = Canc. Credit Claim (R/ACC)
2613: 0000:     CCBUF.FIELD.DELIMITER$,  \ 1 byte ASCII set to ; (CHR$(59))
2614: 0000:     CCBUF.ENDREC.MARKER$,    \ 2 bytes ASCII set to XODOA
2615: 0000:     CCBUF.BC.LETTER$,        \ 1 byte ASCII
2616: 0000:     CCBUF.CREDIT.CLAIM.NUM$, \ 4 byte UPD
2617: 0000:     CCBUF.CLAIM.TYPE$,	     \ 1 byte ASC;  "M" = Missing,
2618: 0000:     			     \		    "E" = Excess,
2619: 0000: 			     \              "R" = Repairs
2620: 0000:     CCBUF.SUPPLIER.NUM$,     \ 3 byte UPD
2621: 0000:     CCBUF.INVOICE.NUM$,	     \ 3 byte UPD 
2622: 0000:     CCBUF.FOLIO.NUM$,	     \ 3 byte UPD
2623: 0000:     CCBUF.BATCH.REF$,	     \ 3 byte UPD
2624: 0000:     CCBUF.REPAIR.CATEGORY$,  \ 1 byte UPD;   1 = Plan4,
2625: 0000:    			     \ 		     2 = Estimate,
2626: 0000: 			     \		     3 = Boots guarantee,
2627: 0000: 			     \		     4 = Supplier guarantee,
2628: 0000: 			     \		     5 = Other guarantee,
2629: 0000:     CCBUF.REPAIR.NUM$,       \ 4 byte UPD
2630: 0000:     CCBUF.PLAN4.POLICY.NUM$, \ 6 byte UPD; (Only if repair cat is Plan4)
2631: 0000:     CCBUF.DDDA.DCDR.NUM$,    \ 3 byte UPD
2632: 0000:     CCBUF.DELIV.NOTE.NUM$,   \ 3 byte UPD
2633: 0000:     CCBUF.NUM.CARTONS.RECEIV$,\1 byte UPD
2634: 0000:     CCBUF.ORDER.NUM$,	     \ 3 byte UPD
2635: 0000:     CCBUF.ITEM.BARCODE.FLAG$,\ 1 byte ASC;  "I" = Boots item code,
2636: 0000:   			     \              "B" = Barcode.
2637: 0000:     CCBUF.ITEM.BARCODE$,     \ 7 byte UPD
2638: 0000:     CCBUF.ITEM.PRICE$,	     \ 3 byte UPD;  Spaces.
2639: 0000:     CCBUF.AUTHORISATION$,    \ 15 byte ASC
2640: 0000:     CCBUF.ADJ.STOCK.FIGURE$, \ 1 byte ASC;  "Y" or "N"
2641: 0000:     CCBUF.RETURN.REASON$,    \ 1 byte UPD;  (See CCRSN file)
2642: 0000:     CCBUF.UOD.NUM$,	     \ 7 byte UPD
2643: 0000:     CCBUF.UOD.STATUS$,	     \ 1 byte ASC;  "O" = Open,
2644: 0000:     			     \              "C" = Closed,
2645: 0000: 			     \              "D" = Despatched
2646: 0000:     CCBUF.SUPPLY.ROUTE$,     \ 1 byte ASC
2647: 0000:     CCBUF.DISP.LOCATION$,    \ 1 byte ASC   "M" = MDS,
2648: 0000:     			     \              "D" = Dispensary
2649: 0000:     CCBUF.RECALL.NUM$,       \ 9 byte ASC 
2650: 0000:     CCBUF.SUPPLIER$,	     \ 15 byte ASC
2651: 0000:     CCBUF.RETURN.METHOD$,    \ 1 byte UPD;   1 = Carrier,
2652: 0000:     			     \		     2 = BIRD,
2653: 0000: 			     \               3 = Via D6,
2654: 0000: 			     \               4 = Representative
2655: 0000:     CCBUF.CARRIER$,	     \ 1 byte UPD;   1 = GPO,
2656: 0000:     			     \               2 = Parcelforce,
2657: 0000: 			     \               3 = Securicor,
2658: 0000: 			     \               4 = Other
2659: 0000:     CCBUF.BIRD.NUM$,	     \ 8 byte ASC
2660: 0000:     CCBUF.WAREHOUSE.ROUTE$,  \ 1 byte ASC   "R" = RDC,
2661: 0000:     			     \  	    "C" = CSR
2662: 0000:     CCBUF.UOD.TYPE$,         \ 1 byte UPD;   1 = Travel Outer,
2663: 0000:     			     \               2 = Town Tray,
2664: 0000: 			     \               3 = Roll cage,
2665: 0000: 			     \               4 = Other
2666: 0000:     CCBUF.DAMAGE.REASON$,    \ 1 byte UPD    1 = Bad packaging,
2667: 0000:      			     \               2 = Poor handling
2668: 0000:     CCBUF.RECEIVING.STORE$,  \ 2 byte UPD
2669: 0000:     CCBUF.DESTINATION$,      \ 1 byte UPD    1 = Business Centre,
2670: 0000:     			     \               2 = MTS,
2671: 0000: 			     \               3 = Other
2672: 0000:     CCBUF.DATE.UOD.OPENED$,  \ 3 byte UPD
2673: 0000:     CCBUF.DATE.DESPATCHED$,  \ 3 byte UPD
2674: 0000:     CCBUF.TIME.DESPATCHED$,  \ 3 byte UPD
2675: 0000:     CCBUF.ITEM.UPDATED$,     \ 1 byte ASC
2676: 0000:     CCBUF.NEW.STATUS.FLAG$   \ 1 byte ASC   "C" = Closed,
2677: 0000:     			     \   	    "D" = Despatched,
2678: 0000: 			     !    	    "X" = Cancelled
2679: 0000:     
2680: 0000: 			     			     			     
2681: 0000:   INTEGER*2 GLOBAL           \
2682: 0000:     CCBUF.SESS.NUM%,         \
2683: 0000:     CCBUF.REPORT.NUM%,	     \
2684: 0000:     			     \
2685: 0000:     CCBUF.NUM.OF.ITEMS%,     \
2686: 0000:     CCBUF.NUM.ITEMS.UPDATED%,\
2687: 0000:     CCBUF.QTY%,		     \
2688: 0000:     CCBUF.TOTAL.QTY.IN.UOD%  !
2689: 0000:         			     
2690: 0000: 			     
2691: 0000:  %INCLUDE CCUPFDEC.J86                    ! HMJK
2692: 0000: 
2693: 0000: \*****************************************************************************
2694: 0000: \*****************************************************************************
2695: 0000: \***
2696: 0000: \***        %INCLUDE FIELD DECLARATIONS AND FILE REFERENCE PARAMETERS
2697: 0000: \***
2698: 0000: \***                   FILE TYPE:  KEYED
2699: 0000: \***
2700: 0000: \***                   REFERENCE:  CCUPFDEC.J86
2701: 0000: \***
2702: 0000: \***	             DESCRIPTION:  RETURNS / AUTOMATIC CREDIT CLAIMING
2703: 0000: \***				   UOD PROCESSED FILE
2704: 0000: \***
2705: 0000: \***
2706: 0000: \***      VERSION A : Michael J. Kelsall      14th March 1994
2707: 0000: \***      
2708: 0000: \*****************************************************************************
2709: 0000: \*****************************************************************************
2710: 0000: 
2711: 0000: STRING GLOBAL			\
2712: 0000:    CCUPF.FILE.NAME$,		\
2713: 0000:    CCUPF.UOD.NUM$,		\  7 byte UPD
2714: 0000:    CCUPF.CURRENT.STATUS$	!  1 byte ASC;  "C" = Closed,
2715: 0000:    				!               "D" - Despatched,
2716: 0000:    				!               "X" - Cancelled.
2717: 0000:       				
2718: 0000: 
2719: 0000: INTEGER*2 GLOBAL		\
2720: 0000:    CCUPF.RECL%,			\
2721: 0000:    CCUPF.REPORT.NUM%,		\
2722: 0000:    CCUPF.SESS.NUM%
2723: 0000: 
2724: 0000:  %INCLUDE CCWKFDEC.J86                    ! GMJK
2725: 0000: \******************************************************************************
2726: 0000: \******************************************************************************
2727: 0000: \***
2728: 0000: \***      %INCLUDE FOR RETURNS WORK FILE - FIELD DEFINITIONS
2729: 0000: \***                                       FILE REFERENCE PARAMETERS
2730: 0000: \***
2731: 0000: \***                  REFERENCE: CCWKFDEC.J86
2732: 0000: \***
2733: 0000: \***  Version A          Michael J. Kelsall              30th September 1993
2734: 0000: \***
2735: 0000: \******************************************************************************
2736: 0000: \*******************************************************************************
2737: 0000: 
2738: 0000:   STRING GLOBAL								\
2739: 0000: 	CCWKF.FILE.NAME$,						\
2740: 0000: 	CCWKF.RECORD$
2741: 0000: 
2742: 0000:   INTEGER*2 GLOBAL							\
2743: 0000: 	CCWKF.RECL%,	          					\
2744: 0000: 	CCWKF.SESS.NUM%,						\
2745: 0000: 	CCWKF.REPORT.NUM%
2746: 0000:  %INCLUDE CCDMYDEC.J86                    ! GMJK
2747: 0000: \******************************************************************************
2748: 0000: \******************************************************************************
2749: 0000: \***
2750: 0000: \***         %INCLUDE FOR RETURNS DUMMY FILE I/O SESSION NUMBER
2751: 0000: \***
2752: 0000: \***               REFERENCE    : CCDMYDEC.J86
2753: 0000: \***
2754: 0000: \***    Version A           Michael J. Kelsall          30th September 1993
2755: 0000: \***
2756: 0000: \******************************************************************************
2757: 0000: \*******************************************************************************
2758: 0000: 
2759: 0000:   STRING GLOBAL           \
2760: 0000:     CCDMY.FILE.NAME$
2761: 0000: 
2762: 0000:   INTEGER*2 GLOBAL        \
2763: 0000:     CCDMY.REPORT.NUM%,    \
2764: 0000:     CCDMY.SESS.NUM%
2765: 0000:  %INCLUDE LDTAFDEC.J86                    ! HMJK
2766: 0000: 
2767: 0000: \*****************************************************************************
2768: 0000: \*****************************************************************************
2769: 0000: \***
2770: 0000: \***        %INCLUDE FIELD DECLARATIONS AND FILE REFERENCE PARAMETERS
2771: 0000: \***
2772: 0000: \***                   FILE TYPE:  DIRECT
2773: 0000: \***
2774: 0000: \***                   REFERENCE:  LDTAFDEC.J86
2775: 0000: \***
2776: 0000: \***	             DESCRIPTION:  LDT / PDT SUPPORT LINK AUDIT FILE
2777: 0000: \***
2778: 0000: \***
2779: 0000: \***      VERSION A         Michael J. Kelsall       30th September 1993
2780: 0000: \***
2781: 0000: \***      VERSION B         Michael J. Kelsall       25th March 1994
2782: 0000: \***      Conversion of LDTAF link duration from minutes to seconds, requiring
2783: 0000: \***      4 byte integer to hold times >09:06:07 (= 32767 seconds)
2784: 0000: \***      
2785: 0000: \*****************************************************************************
2786: 0000: \*****************************************************************************
2787: 0000: 
2788: 0000:   STRING GLOBAL                 \
2789: 0000:     LDTAF.FILE.NAME$,		\
2790: 0000:     LDTAF.START.DATE$,		\ 3 byte UPD  (YYMMDD)
2791: 0000:     LDTAF.START.TIME$		! 3 byte UPD  (HHMMSS)
2792: 0000:     
2793: 0000: 
2794: 0000:   INTEGER*1 GLOBAL              \
2795: 0000:     LDTAF.LINK.TYPE%		!  1 - CSR file    (CSRWF size / num of UNITS)
2796: 0000: 				!  2 - PCHECK      (CHKBF size / null)
2797: 0000: 				!  3 - LDT PROG    (LDTPF size / null)
2798: 0000: 				!  4 - DIRECTS     (DRSMQ size / DIRWF size)
2799: 0000: 				!  5 - UOD         (UODTF size / null)
2800: 0000: 				!  6 - EPSOM req   (PDTWF size / null)
2801: 0000: 				!  7 - EPSOM lists (num of lists / null)
2802: 0000: 				!  8 - RETURNS UOD (CCTMP size / CCBUF size)
2803: 0000: 				!  9 - RETURNS req (CCWKF size / null)
2804: 0000: 				!  MSB ---> 0 = Port A , 1 = Port B. 
2805: 0000: 
2806: 0000:   INTEGER*2 GLOBAL              \
2807: 0000:     LDTAF.SESS.NUM%,            \
2808: 0000:     LDTAF.REPORT.NUM%,		\
2809: 0000:     LDTAF.RECL%
2810: 0000:     				
2811: 0000: 
2812: 0000:   INTEGER*4 GLOBAL              \
2813: 0000:     LDTAF.DATA.VOLUME.1%,	\
2814: 0000:     LDTAF.DATA.VOLUME.2%,	\
2815: 0000:     LDTAF.DURATION%    		! BMJK
2816: 0000:  %INCLUDE SOFTSDEC.J86                    ! GMJK
2817: 0000: REM \
2818: 0000: \******************************************************************************
2819: 0000: \******************************************************************************
2820: 0000: \***
2821: 0000: \***                 %INCLUDE FOR THE SOFTWARE STATUS FILE
2822: 0000: \***   
2823: 0000: \***                      FILE TYPE  :   Direct
2824: 0000: \***
2825: 0000: \***                      REFERENCE  :   SOFTSDEC.J86
2826: 0000: \***
2827: 0000: \***	Version A	       Andrew Wedgeworth	      24th June 1992
2828: 0000: \***
2829: 0000: \******************************************************************************
2830: 0000: \*******************************************************************************
2831: 0000: 
2832: 0000:   STRING GLOBAL           \
2833: 0000:     SOFTS.RECORD$,        \           
2834: 0000:     SOFTS.SPACE$,         \           
2835: 0000:     SOFTS.FILE.NAME$    
2836: 0000:     
2837: 0000:   INTEGER*2 GLOBAL        \
2838: 0000:     SOFTS.RECL%,          \            
2839: 0000:     SOFTS.REPORT.NUM%,	  \      
2840: 0000:     SOFTS.SESS.NUM%
2841: 0000: 
2842: 0000:   INTEGER*4 GLOBAL        \
2843: 0000:     SOFTS.REC.NUM% 	         
2844: 0000:  %INCLUDE STKBFDEC.J86                    ! 1.5
2845: 0000: \******************************************************************************
2846: 0000: \******************************************************************************
2847: 0000: \***
2848: 0000: \***   $Workfile:   STKBFDEC.J86  $
2849: 0000: \***
2850: 0000: \***   $Revision:   1.0  $
2851: 0000: \***
2852: 0000: \******************************************************************************
2853: 0000: \******************************************************************************
2854: 0000: \***
2855: 0000: \***   $Log:   V:\archive\j86\stkbfdec.j8v  $
2856: 0000: \***   
2857: 0000: \***      Rev 1.0   15 Jul 1997 14:20:36   DEV45PS
2858: 0000: \***    
2859: 0000: \***   
2860: 0000: \***      Rev 1.0   09 Jul 1997 11:04:52   DEV45PS
2861: 0000: \***   Stocktake System New Files
2862: 0000: \***   
2863: 0000: \******************************************************************************
2864: 0000: \******************************************************************************\******************************************************************************
2865: 0000: \******************************************************************************
2866: 0000: \***
2867: 0000: \***         %INCLUDE FOR STOCKTAKE BUFFER FILE FIELD DECLARATIONS
2868: 0000: \***
2869: 0000: \***               FILE TYPE    : DIRECT
2870: 0000: \***
2871: 0000: \***               REFERENCE    : STKBFDEC.J86
2872: 0000: \***
2873: 0000: \***    VERSION A.              Nik Sen.               19 Jun 1997.
2874: 0000: \***    New file for stocktaking system. Holds counts read from PDT.
2875: 0000: \***
2876: 0000: \*******************************************************************************
2877: 0000: \*******************************************************************************
2878: 0000: 
2879: 0000: STRING GLOBAL                                                  \
2880: 0000:    STKBF.FILE.NAME$,           \
2881: 0000:    STKBF.DATA$,                \
2882: 0000:    STKBF.STORE.NUMBER$,        \
2883: 0000:    STKBF.STOCKTAKER.NO$,       \
2884: 0000:    STKBF.DATE$,                \
2885: 0000:    STKBF.LOCATION$,            \
2886: 0000:    STKBF.ITEM.CODE$,           \
2887: 0000:    STKBF.QUANTITY$,            \
2888: 0000:    STKBF.PRICE$,               \
2889: 0000:    STKBF.RECORD.COUNT$,        \
2890: 0000:    STKBF.FILLER$
2891: 0000: 
2892: 0000: 
2893: 0000: INTEGER*4 GLOBAL               \
2894: 0000:    STKBF.RECORD.NUM%
2895: 0000: 
2896: 0000: INTEGER*2 GLOBAL                \
2897: 0000:    STKBF.REPORT.NUM%,           \
2898: 0000:    STKBF.SESS.NUM%             
2899: 0000: 
2900: 0000: 
2901: 0000: INTEGER*1 GLOBAL                \
2902: 0000:    STKBF.RECL%         
2903: 0000: 
2904: 0000: 
2905: 0000:  %INCLUDE SXTMPDEC.J86                    ! 1.5
2906: 0000: \******************************************************************************
2907: 0000: \******************************************************************************
2908: 0000: \***
2909: 0000: \***         %INCLUDE FOR TEMPORARY STOCKTAKE BUFFER FILE FIELD DECLARATIONS
2910: 0000: \***
2911: 0000: \***               FILE TYPE    : DIRECT
2912: 0000: \***
2913: 0000: \***               REFERENCE    : SXTMPDEC.J86
2914: 0000: \***
2915: 0000: \***    VERSION A.              Nik Sen.               30 Jun 1997.
2916: 0000: \***    New file for stocktaking system. Holds counts read from PDT.
2917: 0000: \***
2918: 0000: \***    VERSION B              Nik Sen                 23 September 1997
2919: 0000: \***    Removed record count as file converted from direct to sequential.
2920: 0000: \***
2921: 0000: \*******************************************************************************
2922: 0000: \*******************************************************************************
2923: 0000: 
2924: 0000: STRING GLOBAL                                                  \
2925: 0000:    SXTMP.FILE.NAME$,           \
2926: 0000:    SXTMP.DATA$,                \
2927: 0000:    SXTMP.STORE.NUMBER$,        \
2928: 0000:    SXTMP.STOCKTAKER.NO$,       \
2929: 0000:    SXTMP.DATE$,                \
2930: 0000:    SXTMP.LOCATION$,            \
2931: 0000:    SXTMP.ITEM.CODE$,           \
2932: 0000:    SXTMP.QUANTITY$,            \
2933: 0000:    SXTMP.PRICE$,               \
2934: 0000:    SXTMP.RECORD.COUNT$,        \
2935: 0000:    SXTMP.FILLER$
2936: 0000: 
2937: 0000: 
2938: 0000: INTEGER*2 GLOBAL                \
2939: 0000:    SXTMP.REPORT.NUM%,           \
2940: 0000:    SXTMP.SESS.NUM%             
2941: 0000: 
2942: 0000: 
2943: 0000: INTEGER*1 GLOBAL                \
2944: 0000:    SXTMP.RECL%         
2945: 0000: 
2946: 0000: 
2947: 0000:  %INCLUDE STKTKDEC.J86                    ! 1.5
2948: 0000: REM \
2949: 0000: \******************************************************************************
2950: 0000: \******************************************************************************
2951: 0000: \***
2952: 0000: \***         %INCLUDE FOR STOCKTAKE DUMMY FILE - FILE REFERENCE PARAMETERS
2953: 0000: \***
2954: 0000: \***               REFERENCE    : STKTKDEC.J86
2955: 0000: \***
2956: 0000: \******************************************************************************
2957: 0000: \*******************************************************************************
2958: 0000: 
2959: 0000:   STRING GLOBAL           \
2960: 0000:     STKTK.FILE.NAME$
2961: 0000: 
2962: 0000:   INTEGER*2 GLOBAL        \
2963: 0000:     STKTK.REPORT.NUM%,      \
2964: 0000:     STKTK.SESS.NUM%
2965: 0000:  %INCLUDE STLDTDEC.J86                    ! 1.6
2966: 0000: REM \
2967: 0000: \******************************************************************************
2968: 0000: \******************************************************************************
2969: 0000: \***
2970: 0000: \***            %INCLUDE FOR STLDT FILE VARIABLES
2971: 0000: \***
2972: 0000: \***                 FILE TYPE    : Direct
2973: 0000: \***
2974: 0000: \***                 REFERENCE    : STLDTDEC.J86
2975: 0000: \***
2976: 0000: \***       Version B          David Artiss      03/09/2002
2977: 0000: \***       Increase field from 2 to 2 bytes
2978: 0000: \***
2979: 0000: \******************************************************************************
2980: 0000: \*******************************************************************************
2981: 0000: 
2982: 0000:   STRING GLOBAL           \
2983: 0000:     STLDT.FILE.NAME$,     \
2984: 0000:     STLDT.RECORD$,        \ 25 bytes
2985: 0000:     STLDT.STORE$,         \ 4 bytes
2986: 0000:     STLDT.STOCKTAKER$,    \ 4 bytes
2987: 0000:     STLDT.LDT.SERIAL$,    \ 6 bytes
2988: 0000:     STLDT.DATE$,          \ 6 bytes DDMMYY
2989: 0000:     STLDT.TIME$,          \ 4 bytes HHMM
2990: 0000:     STLDT.CRLF$           \
2991: 0000: 
2992: 0000:   INTEGER*2 GLOBAL        \
2993: 0000:     STLDT.RECL%,          \
2994: 0000:     STLDT.SESS.NUM%,      \
2995: 0000:     STLDT.REPORT.NUM%     ! BDA
2996: 0000:      
2997: 0000:   INTEGER*4 GLOBAL        \
2998: 0000:     STLDT.RECORD.NUM%,    \
2999: 0000:     STLDT.COUNTS%,        \ BDA
3000: 0000:     STLDT.ITEMS%
3001: 0000:       
3002: 0000:  %INCLUDE STOCKDEC.J86                    ! 1.7BG
3003: 0000: \***********************************************************************
3004: 0000: \***********************************************************************
3005: 0000: \***
3006: 0000: \***    DESCRIPTION: Stock File
3007: 0000: \***                 Field Definitions         
3008: 0000: \***
3009: 0000: \***    FILE TYPE : Keyed
3010: 0000: \***
3011: 0000: \***********************************************************************
3012: 0000: \***
3013: 0000: \***    Version B.              Robert Cowey             21st Oct 1993
3014: 0000: \***    No changes to this file.
3015: 0000: \***
3016: 0000: \***    Version C.              Mark Walker              24th Jan 2014
3017: 0000: \***    F337 Centralised View of Stock
3018: 0000: \***    - Added sequence ID and item status fields.
3019: 0000: \***    - Minor formatting changes (uncommented).
3020: 0000: \***
3021: 0000: \***    Version D.              Mark Walker              15th Mar 2014
3022: 0000: \***    F337 Centralised View of Stock
3023: 0000: \***    Added next sequence ID field.
3024: 0000: \***
3025: 0000: \***    Version E.              Mark Walker               7th May 2014
3026: 0000: \***    F337 Centralised View of Stock
3027: 0000: \***    Added new 'stock flags' field for future use.
3028: 0000: \***
3029: 0000: \***********************************************************************
3030: 0000: \***********************************************************************
3031: 0000: 
3032: 0000: \***********************************************************************
3033: 0000: \***********************************************************************
3034: 0000: \***
3035: 0000: \***    File Record Layout
3036: 0000: \***
3037: 0000: \***    STOCK.BOOTS.CODE$            4 UPD  Item Code (Key)
3038: 0000: \***    STOCK.STOCK.FIG%             2 INT  Stock Figure
3039: 0000: \***    STOCK.LAST.COUNT%            2 INT  Last Count Quantity
3040: 0000: \***    STOCK.DATE.LAST.COUNT$       3 UPD  Date of Last Count
3041: 0000: \***    STOCK.DATE.LAST.MOVE$        3 UPD  Date of Last Movement
3042: 0000: \***    STOCK.LAST.REC%              2 INT  Last Receipt Quantity
3043: 0000: \***    STOCK.DATE.LAST.REC$         3 UPD  Date of Last Receipt
3044: 0000: \***    STOCK.DATE.LAST.GAP$         3 UPD  Date of Last Gap
3045: 0000: \***    STOCK.SID%                   4 INT  Sequence ID                     !CMW
3046: 0000: \***    STOCK.STATUS.1$              1 ASC  Item Status                     !CMW
3047: 0000: \***    STOCK.FLAGS%                 1 INT  Stock flags                     !EMW
3048: 0000: \***    STOCK.FILLER$                2 UPD  Filler                          !EMW
3049: 0000: \***
3050: 0000: \***********************************************************************
3051: 0000: \***********************************************************************
3052: 0000: 
3053: 0000:     INTEGER*1 GLOBAL                                                    \
3054: 0000:         STOCK.FLAGS%,                                                   \   !EMW
3055: 0000:         STOCK.RECL%
3056: 0000: 
3057: 0000:     INTEGER*2 GLOBAL                                                    \
3058: 0000:         STOCK.LAST.COUNT%,                                              \
3059: 0000:         STOCK.LAST.REC%,                                                \
3060: 0000:         STOCK.REPORT.NUM%,                                              \
3061: 0000:         STOCK.SESS.NUM%,                                                \
3062: 0000:         STOCK.STOCK.FIG%
3063: 0000: 
3064: 0000:     INTEGER*4 GLOBAL                                                    \   !CMW
3065: 0000:         STOCK.NEXT.SID%,                                                \   !DMW
3066: 0000:         STOCK.SID%                                                          !CMW
3067: 0000: 
3068: 0000:     STRING GLOBAL                                                       \
3069: 0000:         STOCK.BOOTS.CODE$,                                              \
3070: 0000:         STOCK.DATE.LAST.COUNT$,                                         \
3071: 0000:         STOCK.DATE.LAST.GAP$,                                           \
3072: 0000:         STOCK.DATE.LAST.MOVE$,                                          \
3073: 0000:         STOCK.DATE.LAST.REC$,                                           \
3074: 0000:         STOCK.FILE.NAME$,                                               \
3075: 0000:         STOCK.FILLER$,                                                  \
3076: 0000:         STOCK.STATUS.1$                                                     !CMW
3077: 0000: 
3078: 0000:  %INCLUDE IMSTCDEC.J86                    ! 1.7BG
3079: 0000: \***********************************************************************
3080: 0000: \***********************************************************************
3081: 0000: \***
3082: 0000: \***    DESCRIPTION: Item Movement & Stock File
3083: 0000: \***                 Field Definitions         
3084: 0000: \***
3085: 0000: \***    FILE TYPE : Keyed
3086: 0000: \***
3087: 0000: \***********************************************************************
3088: 0000: \***
3089: 0000: \***    Version A.          Les Cook                     21st Aug 1992
3090: 0000: \***    Initial version.
3091: 0000: \***
3092: 0000: \***    VERSION 1.1         Julia Stones                 13th Jun 2005
3093: 0000: \***    Added new external functions for
3094: 0000: \***        MIMSTC - merged IMSTC
3095: 0000: \***        CIMSTC - Copy of IMSTC
3096: 0000: \***        BIMSTC - Backup of IMSTC
3097: 0000: \***
3098: 0000: \***    Version C.          Mark Walker                  23rd Jan 2014
3099: 0000: \***    F337 Centralised View of Stock
3100: 0000: \***    - Added sequence ID field definition.
3101: 0000: \***    - Moved BIMST, CIMST and MIMST field definitions to separate
3102: 0000: \***      modules.
3103: 0000: \***    - Moved TIMST record length to TIMSTDEC.J86.
3104: 0000: \***    - Minor formatting changes (uncommented).
3105: 0000: \***
3106: 0000: \***    Version D.          Mark Walker                  30th Apr 2014
3107: 0000: \***    F337 Centralised View of Stock
3108: 0000: \***    QC599: Introduced item level TSL restart pointer to allow
3109: 0000: \***           Sales Support restart/recovery to continue processing
3110: 0000: \***           correctly from the next unprocessed item.
3111: 0000: \***
3112: 0000: \***********************************************************************
3113: 0000: \***********************************************************************
3114: 0000: 
3115: 0000: \***********************************************************************
3116: 0000: \***********************************************************************
3117: 0000: \***
3118: 0000: \***    File Record Layout
3119: 0000: \***
3120: 0000: \***    IMSTC.BAR.CODE$             11 UPD  Barcode (Key)
3121: 0000: \***    IMSTC.RESTART%               4 INT  IMSTC Restart pointer
3122: 0000: \***    IMSTC.NUMITEMS%              4 INT  Number of items sold
3123: 0000: \***    IMSTC.AMTSALE%               4 INT  Amount of items sold
3124: 0000: \***    IMSTC.TSL.RESTART%           4 INT  TSL Restart pointer             !DMW
3125: 0000: \***    IMSTC.STKMQ.RESTART%         4 INT  STKMQ Restart pointer
3126: 0000: \***    IMSTC.STATUS.FLAG$           1 ASC  Status flags
3127: 0000: \***    IMSTC.STOCK.FIGURE%          2 INT  Stock Figure
3128: 0000: \***    IMSTC.REASON.ITEM.REMOVED$   1 ASC  Deletion Reason
3129: 0000: \***    IMSTC.SID%                   4 INT  Sequence ID
3130: 0000: \***    IMSTC.FILLER$                1 UPD  Filler
3131: 0000: \***
3132: 0000: \***********************************************************************
3133: 0000: \***********************************************************************
3134: 0000: 
3135: 0000:     INTEGER*2 GLOBAL                                                    \
3136: 0000:         IMSTC.SESS.NUM%,                                                \
3137: 0000:         IMSTC.RECL%,                                                    \
3138: 0000:         IMSTC.REPORT.NUM%,                                              \
3139: 0000:         IMSTC.STOCK.FIGURE%
3140: 0000: 
3141: 0000:     INTEGER*4 GLOBAL                                                    \
3142: 0000:         IMSTC.AMTSALE%,                                                 \
3143: 0000:         IMSTC.NEXT.SID%,                                                \   !CMW
3144: 0000:         IMSTC.NUMITEMS%,                                                \
3145: 0000:         IMSTC.RESERVED%,                                                \
3146: 0000:         IMSTC.RESTART%,                                                 \
3147: 0000:         IMSTC.SID%,                                                     \   !CMW
3148: 0000:         IMSTC.STKMQ.RESTART%,                                           \
3149: 0000:         IMSTC.TSL.RESTART%                                                  !DMW
3150: 0000: 
3151: 0000:     STRING GLOBAL                                                       \
3152: 0000:         IMSTC.BAR.CODE$,                                                \
3153: 0000:         IMSTC.FILE.NAME$,                                               \
3154: 0000:         IMSTC.FILLER$,                                                  \
3155: 0000:         IMSTC.HOLD.PENDING$,                                            \
3156: 0000:         IMSTC.REASON.ITEM.REMOVED$,                                     \
3157: 0000:         IMSTC.STATUS.FLAG$
3158: 0000: 
3159: 0000:  %INCLUDE LSSSTDEC.J86                    ! 1.7BG
3160: 0000: REM \
3161: 0000: \******************************************************************************
3162: 0000: \******************************************************************************
3163: 0000: \***
3164: 0000: \***                 %INCLUDE FOR THE LSS STOCK COUNT FILE
3165: 0000: \***   
3166: 0000: \***                      FILE TYPE  :   Direct
3167: 0000: \***
3168: 0000: \***                      REFERENCE  :   LSSSTDEC.J86
3169: 0000: \***
3170: 0000: \***    Version A          Brian Greenfield          16th October 2002
3171: 0000: \***
3172: 0000: \******************************************************************************
3173: 0000: \*******************************************************************************
3174: 0000: 
3175: 0000:   STRING GLOBAL              \ 
3176: 0000:     LSSST.FILE.NAME$,        \
3177: 0000:     LSSST.IRF.BAR.CODE$,     \
3178: 0000:     LSSST.STOCK.BOOTS.CODE$, \
3179: 0000:     LSSST.STOCK.COUNT$,      \
3180: 0000:     LSSST.TSF$
3181: 0000:         
3182: 0000:   INTEGER*2 GLOBAL        \
3183: 0000:     LSSST.RECL%,          \            
3184: 0000:     LSSST.REPORT.NUM%,    \      
3185: 0000:     LSSST.SESS.NUM%
3186: 0000: 
3187: 0000:          
3188: 0000:  %INCLUDE SXTCFDEC.J86                    ! 1.8DA
3189: 0000: \******************************************************************************
3190: 0000: \******************************************************************************
3191: 0000: \***
3192: 0000: \***   $Workfile:   SXTCFDEC.J86  $
3193: 0000: \***
3194: 0000: \***   $Revision:   1.1  $
3195: 0000: \***
3196: 0000: \******************************************************************************
3197: 0000: \******************************************************************************
3198: 0000: \***
3199: 0000: \***   $Log:   V:\archive\j86\sxtcfdec.j8v  $
3200: 0000: \***   
3201: 0000: \***      Rev 1.1   07 Jan 1998 10:26:30   DEV69PS
3202: 0000: \***    
3203: 0000: \***   
3204: 0000: \***      Rev 1.0   15 Jul 1997 14:21:06   DEV45PS
3205: 0000: \***    
3206: 0000: \***   
3207: 0000: \***      Rev 1.1   15 Jul 1997 13:44:06   DEV45PS
3208: 0000: \***    
3209: 0000: \***   
3210: 0000: \***      Rev 1.0   09 Jul 1997 11:05:28   DEV45PS
3211: 0000: \***   Stocktake System New Files
3212: 0000: \***   
3213: 0000: \*** 
3214: 0000: \***   
3215: 0000: \******************************************************************************
3216: 0000: \******************************************************************************\*****************************************************************************
3217: 0000: \*****************************************************************************
3218: 0000: \***
3219: 0000: \***               %INCLUDE FOR SXTCF - FIELD DECLARATIONS
3220: 0000: \***                                    FILE REFERENCE PARAMETERS
3221: 0000: \***
3222: 0000: \***                      FILE TYPE    : DIRECT
3223: 0000: \***
3224: 0000: \***                      REFERENCE    : SXTCFDEC
3225: 0000: \***
3226: 0000: \***           VERSION A : NIK SEN  3rd July 1997
3227: 0000: \***
3228: 0000: \***
3229: 0000: 
3230: 0000: \*****************************************************************************
3231: 0000: \*****************************************************************************
3232: 0000: 
3233: 0000: 
3234: 0000:   STRING GLOBAL           \
3235: 0000:     SXTCF.FILE.NAME$
3236: 0000: 
3237: 0000:   INTEGER*1 GLOBAL        \
3238: 0000:     SXTCF.HEADER.EXPECTED%
3239: 0000: 
3240: 0000:   INTEGER*2 GLOBAL        \
3241: 0000:     SXTCF.SESS.NUM%,      \
3242: 0000:     SXTCF.REPORT.NUM%,    \
3243: 0000:     SXTCF.RECL%
3244: 0000: 
3245: 0000:   INTEGER*4 GLOBAL        \
3246: 0000:     SXTCF.REC.NUM%
3247: 0000: 
3248: 0000: 
3249: 0000:   INTEGER*4 GLOBAL                                   \
3250: 0000:             SXTCF.STKBF.POINTER%,                    \ Pointer to STKBF
3251: 0000:             SXTCF.ITEM.COUNT%,                       \ No of items processed
3252: 0000:             SXTCF.CURRENT.COUNT%                     ! Items in current batch
3253: 0000: 
3254: 0000: 
3255: 0000:   STRING GLOBAL                                 \
3256: 0000:        SXTCF.START.DATE$,                       \
3257: 0000:        SXTCF.START.TIME$,                       \
3258: 0000:        SXTCF.END.DATE$,                         \
3259: 0000:        SXTCF.END.TIME$,                         \
3260: 0000:        SXTCF.STOCKTAKE.IN.PROGRESS$,            \ Y=Yes; N=No; S=Stop; C=Complete 1 BYTE
3261: 0000:        SXTCF.STOCKTAKER$,                       \ Current Stocktaker
3262: 0000:        SXTCF.CUR.LOCATION$,                     \ Location code currently be processed ! 1.1
3263: 0000:        SXTCF.FILLER$                            \ 
3264: 0000: 
3265: 0000: 
3266: 0000:  %INCLUDE STKCFDEC.J86                    ! 1.8DA
3267: 0000: \******************************************************************************
3268: 0000: \******************************************************************************
3269: 0000: \***
3270: 0000: \***   $Workfile:   STKCFDEC.J86  $
3271: 0000: \***
3272: 0000: \***   $Revision:   1.2  $
3273: 0000: \***
3274: 0000: \******************************************************************************
3275: 0000: \******************************************************************************
3276: 0000: \***
3277: 0000: \***   $Log:   V:\archive\j86\stkcfdec.j8v  $
3278: 0000: \***   
3279: 0000: \***      Rev 1.2   03 Jul 1997 14:18:38   DEV45PS
3280: 0000: \***   Stocktake In Progress Flag Removed
3281: 0000: \***   
3282: 0000: \***      Rev 1.1   30 Jun 1997 15:29:04   DEV45PS
3283: 0000: \***   Added Stocktake In Progress flag
3284: 0000: \***   
3285: 0000: \******************************************************************************
3286: 0000: \******************************************************************************\*****************************************************************************
3287: 0000: \*****************************************************************************
3288: 0000: \***
3289: 0000: \***               %INCLUDE FOR STKCF - FIELD DECLARATIONS
3290: 0000: \***                                    FILE REFERENCE PARAMETERS
3291: 0000: \***
3292: 0000: \***                      FILE TYPE    : DIRECT
3293: 0000: \***
3294: 0000: \***                      REFERENCE    : STKCFDEA
3295: 0000: \***
3296: 0000: \***           VERSION A : STEVEN GOULDING  11.01.93
3297: 0000: \***
3298: 0000: \***
3299: 0000: \***           VERSION B        NIK SEN        5th June 1997
3300: 0000: \***           Added Stocktake.In.Progress flag.
3301: 0000: \***           
3302: 0000: \***           VERSION C        NIK SEN        3rd July 1997
3303: 0000: \***           Removed Stocktake.In.Progress flag. Now moved to Stocktake
3304: 0000: \***           Control File to prevent conflicts when STKCF is locked.
3305: 0000: \***
3306: 0000: \*****************************************************************************
3307: 0000: \*****************************************************************************
3308: 0000: 
3309: 0000: REM \
3310: 0000: 
3311: 0000:   STRING GLOBAL           \
3312: 0000:     STKCF.FILE.NAME$
3313: 0000: 
3314: 0000:   INTEGER*2 GLOBAL        \
3315: 0000:     STKCF.SESS.NUM%,      \
3316: 0000:     STKCF.REPORT.NUM%,    \
3317: 0000:     STKCF.RECL%
3318: 0000: 
3319: 0000:   INTEGER*4 GLOBAL        \
3320: 0000:     STKCF.REC.NUM%
3321: 0000: REM \
3322: 0000: 
3323: 0000: 
3324: 0000:   INTEGER*4 GLOBAL                                   \
3325: 0000:             STKCF.STKMQ.POINTER%,                    \ Pointer to STKMQ
3326: 0000:             STKCF.ITEM.COUNT%                        \ No of items processed
3327: 0000: 
3328: 0000:   INTEGER*2 GLOBAL                                   \
3329: 0000:             STKCF.STMVT.REC.CNT%                     \ No of recs on STMVT file
3330: 0000: 
3331: 0000:   INTEGER*1 GLOBAL                                   \
3332: 0000:             STKCF.PREV.PITRL.UPDATE%                 \ The HOUR of update
3333: 0000: 
3334: 0000:   STRING    GLOBAL                                   \ 1 BYTE
3335: 0000:             STKCF.STOCK.SUPPORT.STATUS$              \ Y = enabled
3336: 0000:                                                      \ N = disabled
3337: 0000:                                                      \ C = Not available to
3338: 0000:                                                      \         Screens
3339: 0000:                                                      \ T = Trailer written
3340: 0000:                                                      \ 1 - 7 According to
3341: 0000:                                                      \       which STKMQ backup
3342: 0000:                                                      \       done.
3343: 0000: 
3344: 0000:   STRING    GLOBAL                                   \
3345: 0000:   	    STKCF.LAST.DIRORD.BC$,	 	     \ Last BC processed
3346: 0000: 	    					     \ in type 17 (1 byte)
3347: 0000:   	    STKCF.LAST.DIRORD.SUPPLIER$,	     \ Last supplier processed
3348: 0000: 	    					     \ in type 17 (3 bytes UPD)
3349: 0000: 	    STKCF.LAST.DIRORD.ORDER.NO$,	     \ last order no processed
3350: 0000: 	    					     \ in type 17 (2 bytes UPD)
3351: 0000: 	    STKCF.LAST.DIRORD.ORDER.SUFFIX$,	     \ last order sfx processed
3352: 0000: 	    					     \ in type 17 (1 byte)
3353: 0000:   	    STKCF.LAST.DIRORD.REC.SOURCE$, 	     \ Last record source
3354: 0000: 	    					     \ in type 17 (1 byte)
3355: 0000:        STKCF.STK.FILE.AVAIL$,                   \ Y=Yes; N=No; 1 BYTE
3356: 0000:        STKCF.STOCK.TAKE.PROCESSING.REQUIRED$,   \ Y=Yes; N=No; 1 BYTE
3357: 0000:        STKCF.FILLER$                            \ 
3358: 0000: 
3359: 0000: 
3360: 0000:  %INCLUDE STKMFDEC.J86                    ! 1.8DA
3361: 0000: \******************************************************************************
3362: 0000: \******************************************************************************
3363: 0000: \***
3364: 0000: \***   $Workfile:   STKMFDEC.J86  $
3365: 0000: \***
3366: 0000: \***   $Revision:   1.0  $
3367: 0000: \***
3368: 0000: \******************************************************************************
3369: 0000: \******************************************************************************
3370: 0000: \***
3371: 0000: \***   $Log:   V:\archive\j86\stkmfdec.j8v  $
3372: 0000: \***   
3373: 0000: \***      Rev 1.0   15 Jul 1997 14:20:54   DEV45PS
3374: 0000: \***    
3375: 0000: \***   
3376: 0000: \***      Rev 1.0   09 Jul 1997 11:05:16   DEV45PS
3377: 0000: \***   Stocktake System New Files
3378: 0000: \***   
3379: 0000: \******************************************************************************
3380: 0000: \******************************************************************************\******************************************************************************
3381: 0000: \******************************************************************************
3382: 0000: \***
3383: 0000: \***  %INCLUDES FOR STOCKTAKE MAONFRAME TRANSMISSION FILE FIELD DECLARATIONS
3384: 0000: \***
3385: 0000: \***               FILE TYPE    : DIRECT
3386: 0000: \***
3387: 0000: \***               REFERENCE    : STKMFDEC.J86
3388: 0000: \***
3389: 0000: \***    VERSION A.              Nik Sen.               19 Jun 1997.
3390: 0000: \***    New file for stocktaking system. Holds stocktake data for 
3391: 0000: \***    transmission to the maonframe.
3392: 0000: \***
3393: 0000: \*******************************************************************************
3394: 0000: \*******************************************************************************
3395: 0000: 
3396: 0000: STRING GLOBAL                                                  \
3397: 0000:        STKMF.FILE.NAME$,               \
3398: 0000:        STKMF.DATA$,                    \
3399: 0000:        STKMF.STORE.NUMBER$,            \
3400: 0000:        STKMF.STOCKTAKER.NUM$,          \
3401: 0000:        STKMF.FILLER$,                  \
3402: 0000:        STKMF.DELIMITER$,               \
3403: 0000:        STKMF.DATE$,                    \
3404: 0000:        STKMF.LOCATION$,                \
3405: 0000:        STKMF.ITEM.CODE$,               \
3406: 0000:        STKMF.QUANTITY$,                \
3407: 0000:        STKMF.PRICE$,                   \
3408: 0000:        STKMF.RECORD.COUNT$
3409: 0000:                        
3410: 0000: INTEGER*4 GLOBAL               \
3411: 0000:        STKMF.RECORD.NUM%
3412: 0000: 
3413: 0000: INTEGER*2 GLOBAL                \
3414: 0000:    STKMF.REPORT.NUM%,           \
3415: 0000:    STKMF.SESS.NUM%             
3416: 0000: 
3417: 0000: 
3418: 0000: INTEGER*1 GLOBAL                \
3419: 0000:    STKMF.RECL%         
3420: 0000: 
3421: 0000: 
3422: 0000:  %INCLUDE STKRCDEC.J86                    ! 1.8DA
3423: 0000: \******************************************************************************
3424: 0000: \******************************************************************************
3425: 0000: \***
3426: 0000: \***   $Workfile:   STKRCDEC.J86  $
3427: 0000: \***
3428: 0000: \***   $Revision:   1.1  $
3429: 0000: \***
3430: 0000: \******************************************************************************
3431: 0000: \******************************************************************************
3432: 0000: \***
3433: 0000: \***   $Log:   V:\archive\j86\stkrcdec.j8v  $
3434: 0000: \***   
3435: 0000: \***      Rev 1.1   03 Feb 1998 10:06:02   DEV69PS
3436: 0000: \***    
3437: 0000: \***   
3438: 0000: \***      Rev 1.0   15 Jul 1997 14:20:58   DEV45PS
3439: 0000: \***    
3440: 0000: \***   
3441: 0000: \***      Rev 1.0   09 Jul 1997 11:05:22   DEV45PS
3442: 0000: \***   Stocktake System New Files
3443: 0000: \***   
3444: 0000: \******************************************************************************
3445: 0000: \******************************************************************************\******************************************************************************
3446: 0000: \******************************************************************************
3447: 0000: \***
3448: 0000: \***         %INCLUDE FOR STOCKTAKE RECOUNT FILE FIELD DECLARATIONS
3449: 0000: \***
3450: 0000: \***               FILE TYPE    : DIRECT
3451: 0000: \***
3452: 0000: \***               REFERENCE    : STKRCDEC.J86
3453: 0000: \***
3454: 0000: \***    VERSION A.              Nik Sen.               19 Jun 1997.
3455: 0000: \***    New file for stocktaking system. Holds all items where a recount
3456: 0000: \***    has occurred.
3457: 0000: \***
3458: 0000: \*******************************************************************************
3459: 0000: \*******************************************************************************
3460: 0000: 
3461: 0000: STRING GLOBAL                                                  \
3462: 0000:        STKRC.FILE.NAME$,               \
3463: 0000:        STKRC.ITEM.CODE$,               \
3464: 0000:        STKRC.ITEM.DESCRIPTION$,        \
3465: 0000:        STKRC.LOCATION$,                \
3466: 0000:        STKRC.INITIAL.QUANTITY$,        \
3467: 0000:        STKRC.INITIAL.STOCKTAKER$,      \
3468: 0000:        STKRC.FINAL.QUANTITY$,          \
3469: 0000:        STKRC.FINAL.STOCKTAKER$
3470: 0000: 
3471: 0000: INTEGER*4 GLOBAL               \     !1.1
3472: 0000:        STKRC.RECORD.NUM%
3473: 0000: 
3474: 0000: 
3475: 0000: INTEGER*2 GLOBAL                \
3476: 0000:    STKRC.REPORT.NUM%,           \
3477: 0000:    STKRC.SESS.NUM%             
3478: 0000: 
3479: 0000: 
3480: 0000: INTEGER*1 GLOBAL                \
3481: 0000:    STKRC.LOC.CNT%,              \     
3482: 0000:    STKRC.RECL%         
3483: 0000: 
3484: 0000: 
3485: 0000:  %INCLUDE XGCFDEC.J86                     ! 1.8DA
3486: 0000: \******************************************************************************
3487: 0000: \******************************************************************************
3488: 0000: \***
3489: 0000: \***         %INCLUDE FOR STOCKTAKE GROUP CODE FILE
3490: 0000: \***
3491: 0000: \***                  FILE TYPE    : Keyed
3492: 0000: \***
3493: 0000: \***                  REFERENCE    : XGCFDEC.J86
3494: 0000: \***
3495: 0000: \***    VERSION A               Steve Wright                        24 Aug 1999
3496: 0000: \***
3497: 0000: \*******************************************************************************
3498: 0000: \*******************************************************************************
3499: 0000: 
3500: 0000: STRING GLOBAL           \
3501: 0000:    XGCF.FILE.NAME$,     \
3502: 0000:    XGCF.PRODUCT.GRP$,   \  Redundant - key changed from product group to BC
3503: 0000:    XGCF.BAR.CODE$,      \
3504: 0000:    XGCF.BSNS.CNTR$,     \  New key - 1 byte business centre
3505: 0000:    XGCF.RSRVD$          !  New key - 2 byte filler, must be 0x0000 (set by function)
3506: 0000: 
3507: 0000: INTEGER*2 GLOBAL        \
3508: 0000:    XGCF.RECL%,          \  
3509: 0000:    XGCF.REPORT.NUM%,    \ 
3510: 0000:    XGCF.SESS.NUM%
3511: 0000:  %INCLUDE STKEXDEC.J86                    ! 1.8DA
3512: 0000: \******************************************************************************
3513: 0000: \******************************************************************************
3514: 0000: \***
3515: 0000: \***   $Workfile:   STKEXDEC.J86  $
3516: 0000: \***
3517: 0000: \***   $Revision:   1.1  $
3518: 0000: \***
3519: 0000: \******************************************************************************
3520: 0000: \******************************************************************************
3521: 0000: \***
3522: 0000: \***   $Log:   V:\archive\j86\stkexdec.j8v  $
3523: 0000: \***   
3524: 0000: \***      Rev 1.1   05 Aug 1997 13:49:18   DEV45PS
3525: 0000: \***   Added Reason Code
3526: 0000: \***   
3527: 0000: \***      Rev 1.0   15 Jul 1997 14:20:44   DEV45PS
3528: 0000: \***    
3529: 0000: \***   
3530: 0000: \***      Rev 1.0   09 Jul 1997 11:05:04   DEV45PS
3531: 0000: \***   Stocktake System New Files
3532: 0000: \***   
3533: 0000: \******************************************************************************
3534: 0000: \******************************************************************************\******************************************************************************
3535: 0000: \******************************************************************************
3536: 0000: \***
3537: 0000: \***         %INCLUDE FOR STOCKTAKE EXCEPTIONS FILE FIELD DECLARATIONS
3538: 0000: \***
3539: 0000: \***               FILE TYPE    : DIRECT
3540: 0000: \***
3541: 0000: \***               REFERENCE    : STKEXDEC.J86
3542: 0000: \***
3543: 0000: \***    VERSION A.              Nik Sen.               19 Jun 1997.
3544: 0000: \***    New file for stocktaking system. Holds all counted items which  
3545: 0000: \***    are not on the IDF.
3546: 0000: \***
3547: 0000: \***    VERSION B              Nik Sen                 5th August 1997
3548: 0000: \***    Added reason code.
3549: 0000: \***
3550: 0000: \*******************************************************************************
3551: 0000: \*******************************************************************************
3552: 0000: 
3553: 0000: STRING GLOBAL                                                  \
3554: 0000:    STKEX.FILE.NAME$,            \
3555: 0000:    STKEX.ITEM.CODE$,           \
3556: 0000:    STKEX.QUANTITY$,            \
3557: 0000:    STKEX.LOCATION$,            \
3558: 0000:    STKEX.STOCKTAKER.NUM$,      \
3559: 0000:    STKEX.REASON.CODE$
3560: 0000: 
3561: 0000: 
3562: 0000: INTEGER*4 GLOBAL               \
3563: 0000:        STKEX.RECORD.NUM%
3564: 0000: 
3565: 0000: INTEGER*2 GLOBAL                \
3566: 0000:    STKEX.REPORT.NUM%,           \
3567: 0000:    STKEX.SESS.NUM%             
3568: 0000: 
3569: 0000: 
3570: 0000: INTEGER*1 GLOBAL                \
3571: 0000:    STKEX.RECL%         
3572: 0000: 
3573: 0000: 
3574: 0000:  %INCLUDE STKIFDEC.J86                    ! 1.8DA
3575: 0000: \******************************************************************************
3576: 0000: \******************************************************************************
3577: 0000: \***
3578: 0000: \***   $Workfile:   STKIFDEC.J86  $
3579: 0000: \***
3580: 0000: \***   $Revision:   1.2  $
3581: 0000: \***
3582: 0000: \******************************************************************************
3583: 0000: \******************************************************************************
3584: 0000: \***
3585: 0000: \***   $Log:   V:\archive\j86\stkifdec.j8v  $
3586: 0000: \***   
3587: 0000: \***      Rev 1.2   21 Aug 1997 11:20:56   DEV45PS
3588: 0000: \***    
3589: 0000: \***   
3590: 0000: \***      Rev 1.1   19 Aug 1997 11:06:14   DEV45PS
3591: 0000: \***   Added Stocktake Transmission File Record Number Field
3592: 0000: \***   
3593: 0000: \***      Rev 1.0   15 Jul 1997 14:20:48   DEV45PS
3594: 0000: \***    
3595: 0000: \***   
3596: 0000: \***      Rev 1.0   09 Jul 1997 11:05:10   DEV45PS
3597: 0000: \***   Stocktake System New Files
3598: 0000: \***   
3599: 0000: \******************************************************************************
3600: 0000: \******************************************************************************\******************************************************************************
3601: 0000: \******************************************************************************
3602: 0000: \***
3603: 0000: \***         %INCLUDE FOR STOCKTAKE ITEM FILE FIELD DECLARATIONS
3604: 0000: \***
3605: 0000: \***               FILE TYPE    : KEYED
3606: 0000: \***
3607: 0000: \***               REFERENCE    : STKIFDEC.J86
3608: 0000: \***
3609: 0000: \***    VERSION A.              Nik Sen.               19 Jun 1997.
3610: 0000: \***    New file for stocktaking system. Holds information about all counted
3611: 0000: \***    items found on the STOCK and IDF files. Key is Boots Code + Location 
3612: 0000: \***
3613: 0000: \***    VERSION B               Nik Sen                19 August 1997
3614: 0000: \***    Added STKMF Record Number field.
3615: 0000: \***
3616: 0000: \*******************************************************************************
3617: 0000: \*******************************************************************************
3618: 0000: 
3619: 0000: STRING GLOBAL                                                  \
3620: 0000:        STKIF.FILE.NAME$,               \
3621: 0000:        STKIF.KEY$,                     \
3622: 0000:        STKIF.ITEM.CODE$,               \
3623: 0000:        STKIF.LOCATION$,                \
3624: 0000:        STKIF.BUSINESS.CENTRE$,         \
3625: 0000:        STKIF.GROUP.SEQUENCE$,          \
3626: 0000:        STKIF.QUANTITY$,                \
3627: 0000:        STKIF.DESCRIPTION$,             \
3628: 0000:        STKIF.STOCKTAKER.NUM$
3629: 0000: 
3630: 0000: 
3631: 0000: 
3632: 0000: INTEGER*2 GLOBAL                \
3633: 0000:    STKIF.REPORT.NUM%,           \
3634: 0000:    STKIF.SESS.NUM%             
3635: 0000: 
3636: 0000: 
3637: 0000: INTEGER*1 GLOBAL                \
3638: 0000:    STKIF.RECL%         
3639: 0000: 
3640: 0000: INTEGER*4 GLOBAL                \
3641: 0000:    STKIF.STKMF.RECORD.NUM%
3642: 0000: 
3643: 0000: 
3644: 0000: 
3645: 0000:  %INCLUDE LOCNTDEC.J86                    ! 1.8DA
3646: 0000: \******************************************************************************
3647: 0000: \******************************************************************************
3648: 0000: \***
3649: 0000: \***   $Workfile:   LOCNTDEC.J86  $
3650: 0000: \***
3651: 0000: \***   $Revision:   1.0  $
3652: 0000: \***
3653: 0000: \******************************************************************************
3654: 0000: \******************************************************************************
3655: 0000: \***
3656: 0000: \***   $Log:   V:\archive\j86\locntdec.j8v  $
3657: 0000: \***   
3658: 0000: \***      Rev 1.0   03 Feb 1998 10:07:40   DEV69PS
3659: 0000: \***    
3660: 0000: \***   
3661: 0000: \******************************************************************************
3662: 0000: \******************************************************************************
3663: 0000: \***
3664: 0000: \***         %INCLUDE FOR STOCKTAKE LOCATION COUNTERS (LOCCNT) DECLARATIONS
3665: 0000: \***
3666: 0000: \***               FILE TYPE    : DIRECT
3667: 0000: \***
3668: 0000: \***               REFERENCE    : LOCNTDEC.J86
3669: 0000: \***
3670: 0000: \***    VERSION A.              Johnnie Chan           6th Jan 1998
3671: 0000: \***    New file for stocktaking system. Holds all locations counted using
3672: 0000: \***    1st to 10000th record for S0000-S9999 and 10001st to 20000th record
3673: 0000: \***    for B0000-B9999.
3674: 0000: \***
3675: 0000: \*******************************************************************************
3676: 0000: \*******************************************************************************
3677: 0000: 
3678: 0000: STRING GLOBAL                           \
3679: 0000:        LOCCNT.FILE.NAME$
3680: 0000:        
3681: 0000: INTEGER*4 GLOBAL                        \
3682: 0000:        LOCCNT.RECORD.NUM%
3683: 0000: 
3684: 0000: 
3685: 0000: INTEGER*2 GLOBAL                        \
3686: 0000:        LOCCNT.REPORT.NUM%,              \
3687: 0000:        LOCCNT.SESS.NUM%             
3688: 0000: 
3689: 0000: 
3690: 0000: INTEGER*1 GLOBAL                        \
3691: 0000:        LOCCNT.LOCATION.COUNT%,          \
3692: 0000:        LOCCNT.RECL%         
3693: 0000: 
3694: 0000: 
3695: 0000:  %INCLUDE STKIGDEC.J86                    ! 1.8DA
3696: 0000: \******************************************************************************
3697: 0000: \******************************************************************************
3698: 0000: \***
3699: 0000: \***         %INCLUDE FOR STOCKTAKE ITEM GROUP FIELD DECLARATIONS
3700: 0000: \***
3701: 0000: \***               FILE TYPE    : DIRECT
3702: 0000: \***
3703: 0000: \***               REFERENCE    : STKIGDEC.J86
3704: 0000: \***
3705: 0000: \***    VERSION A.              Nik Sen.               17 Jun 1997.
3706: 0000: \***    New file for stocktaking system. Holds Business Centres, Concept
3707: 0000: \***    and product groups which define scope of stocktake.
3708: 0000: \***
3709: 0000: \*******************************************************************************
3710: 0000: \*******************************************************************************
3711: 0000: 
3712: 0000: STRING GLOBAL                                                  \
3713: 0000:    STKIG.FILE.NAME$,            \
3714: 0000:    STKIG.DATA$
3715: 0000: 
3716: 0000: INTEGER*4 GLOBAL               \
3717: 0000:    STKIG.RECORD.NUM%
3718: 0000: 
3719: 0000: INTEGER*2 GLOBAL                \
3720: 0000:    STKIG.REPORT.NUM%,           \
3721: 0000:    STKIG.SESS.NUM%             
3722: 0000: 
3723: 0000: 
3724: 0000: INTEGER*1 GLOBAL                \
3725: 0000:    STKIG.RECL%         
3726: 0000: 
3727: 0000: 
3728: 0000:  %INCLUDE STKTFDEC.J86                    ! 1.8DA
3729: 0000: \******************************************************************************
3730: 0000: \******************************************************************************
3731: 0000: \***
3732: 0000: \***   $Workfile:   STKTFDEC.J86  $
3733: 0000: \***
3734: 0000: \***   $Revision:   1.1  $
3735: 0000: \***
3736: 0000: \******************************************************************************
3737: 0000: \******************************************************************************
3738: 0000: \***
3739: 0000: \***   $Log:   V:\archive\j86\stktfdec.j8v  $
3740: 0000: \***   
3741: 0000: \***      Rev 1.1   15 Jul 1997 14:36:28   DEV45PS
3742: 0000: \***    
3743: 0000: \***   
3744: 0000: \***      Rev 1.0   15 Jul 1997 14:21:02   DEV45PS
3745: 0000: \***   Stocktake System New Files
3746: 0000: \***   
3747: 0000: \******************************************************************************
3748: 0000: \******************************************************************************\******************************************************************************
3749: 0000: \******************************************************************************
3750: 0000: \***
3751: 0000: \***         %INCLUDE FOR STOCKTAKE TOTALS FILE FIELD DECLARATIONS
3752: 0000: \***
3753: 0000: \***               FILE TYPE    : KEYED
3754: 0000: \***
3755: 0000: \***               REFERENCE    : STKTFDEC.J86
3756: 0000: \***
3757: 0000: \***    VERSION A.              Nik Sen.               15 July 1997.
3758: 0000: \***    New file for stocktaking system. Holds information about all counted
3759: 0000: \***    items found on the STOCK and IDF files. Key is Boots Code. 
3760: 0000: \***
3761: 0000: \*******************************************************************************
3762: 0000: \*******************************************************************************
3763: 0000: 
3764: 0000: STRING GLOBAL                                                  \
3765: 0000:        STKTF.FILE.NAME$,               \
3766: 0000:        STKTF.BOOTS.CODE$,              \
3767: 0000:        STKTF.BUSINESS.CENTRE$,         \
3768: 0000:        STKTF.GROUP.SEQUENCE$,          \
3769: 0000:        STKTF.QUANTITY$                
3770: 0000: 
3771: 0000: 
3772: 0000: 
3773: 0000: INTEGER*2 GLOBAL                \
3774: 0000:    STKTF.REPORT.NUM%,           \
3775: 0000:    STKTF.SESS.NUM%             
3776: 0000: 
3777: 0000: 
3778: 0000: INTEGER*1 GLOBAL                \
3779: 0000:    STKTF.RECL%         
3780: 0000: 
3781: 0000: 
3782: 0000:  %INCLUDE IRFDEC.J86                      ! 1.8DA
3783: 0000: 
3784: 0000: \**********************************************************************************
3785: 0000: \***
3786: 0000: \***       %INCLUDE FOR ITEM RECORD FILE - FIELD DECLARATIONS
3787: 0000: \***                                     - FILE REFERENCE PARAMETERS
3788: 0000: \***
3789: 0000: \***                      FILE TYPE    : Keyed
3790: 0000: \***
3791: 0000: \***                      REFERENCE    : IRFDEC.J86
3792: 0000: \***
3793: 0000: \***     Version A               Andrew Wedgeworth            29th June 1992
3794: 0000: \***
3795: 0000: \***     Version B               Andrew Wedgeworth        14th December 1992
3796: 0000: \***     Version letter incremented to match other IRF code.
3797: 0000: \***
3798: 0000: \***     Version C             Steve Windsor          12.02.93
3799: 0000: \***     Version letter incremented to match other IRF code.
3800: 0000: \***
3801: 0000: \***     Version D             Steve Windsor          12.05.93
3802: 0000: \***     Version letter incremented to match other IRF code.
3803: 0000: \***
3804: 0000: \***     Version E           Steve Perkins       20th September 1993
3805: 0000: \***     Deals project : Handling of Converted/Unconverted records
3806: 0000: \***     ++   Anything with 'Delete' after initials should be   ++
3807: 0000: \***     ++   deleted once the IRF has been converted in all    ++
3808: 0000: \***     ++   stores.                                           ++
3809: 0000: \***
3810: 0000: \***     Version F           Mark Walker            5th January 1994
3811: 0000: \***     Version letter incremented to match other IRF code.
3812: 0000: \***
3813: 0000: \***     Version 96A         Mark Walker               22nd May 1995
3814: 0000: \***     Definition for IRF.POINTS% added.
3815: 0000: \***
3816: 0000: \***                     Stuart McConnachie           12th June 1995
3817: 0000: \***     INDICAT3% comments added for discount/loyalty flags.
3818: 0000: \***
3819: 0000: \***     Version for 96C  Andrew Wedgeworth            22nd May 1996
3820: 0000: \***     Removed IRF.FILLER$ field, as this is now redundant.
3821: 0000: \***
3822: 0000: \***     Version G     Stuart William McConnachie      11th February 2000
3823: 0000: \***     Converted IRF.INDICAT2$ to integer flag byte.
3824: 0000: \***
3825: 0000: \***     REVISION 1.6.               ROBERT COWEY.               9 JUL 2002.
3826: 0000: \***     Major changes for 2002 Deals Rewrite project.
3827: 0000: \***     Incorporated up to date record layout to assist development work
3828: 0000: \***     (placed in the IRFDEC.J86 to make it visible from ...LST files).
3829: 0000: \***     Moved various comments against variables to record layout.
3830: 0000: \***     Relisted variables in alphabetical order.
3831: 0000: \***     Deleted redundant variables associated with the old deals system ...
3832: 0000: \***     DEAL.NUM$, DEAL.SAVING$
3833: 0000: \***     Retained variables that are otherwise redundant (to be set to null X'00'
3834: 0000: \***     within file functions) ...
3835: 0000: \***     INDICAT2%, INDICAT4%, SALEQUAN$, POINTS%
3836: 0000: \***     Defined variables to hold interpreted deals data for new deals system ...
3837: 0000: \***     DEAL.NUM$(n) and LIST.ID%(n) (where 'n' represents entry 0, 1 and 2).
3838: 0000: \***     These two variables are interpretations of DEAL.DATA% which is defined
3839: 0000: \***     locally within IRFFUN.BAS to keep underlying data invisible to programs.
3840: 0000: \***
3841: 0000: \***     REVISION 1.7                ROBERT COWEY.               5 AUG 2002.
3842: 0000: \***     Further changes for 2002 Deals Rewrite project (PSBF19 related).
3843: 0000: \***     Defined NEW.IRF.DATA$ as a global variable for use with new functions
3844: 0000: \***     CONCAT.NEW.IRF.DATA$ and SPLIT.NEW.IRF.DATA$.
3845: 0000: \***
3846: 0000: \***     REVISION 1.8                ROBERT COWEY.              15 JUL 2003.
3847: 0000: \***     Usage of INDICAT0% bit-3 X'08' changed to Item Contains Alcohol.
3848: 0000: \***     No changes to this file other than description.
3849: 0000: \***     No changes to IRF file functions.
3850: 0000: \***
3851: 0000: \***     REVISION 1.9.      STUART WILLIAM MCCONNACHIE           22 OCT 2003.
3852: 0000: \***     Changes to remove limit of 3 deals per item.
3853: 0000: \***     Declaration of new variables for IRF Deal Extension file (IRFDEX).
3854: 0000: \***
3855: 0000: \***     REVISION 2.0.            ALAN CARR                       9 FEB 2006.
3856: 0000: \***     Add new IRF.INDICAT8% 1 byte, amend IRF.UNUSED$ from 3 to 2 bytes.
3857: 0000: \***
3858: 0000: \***     REVISION 2.1              TITTOO THOMAS                  01 July 2011
3859: 0000: \***     The IRF.UNUSED field is disintegrated to 2 new indicator fields
3860: 0000: \***                      IRF.INDICAT9%   1 INT
3861: 0000: \***                      IRF.INDICAT10%  1 INT
3862: 0000: \***...............................................................................
3863: 0000: 
3864: 0000: 
3865: 0000: \**********************************************************************************
3866: 0000: \***
3867: 0000: \***    IRF RECORD LAYOUT - REVISION 1.7 - CORRECT FOR 2011 CORE Stores PROJECT
3868: 0000: \***
3869: 0000: \***     1 11  UPD  BAR.CODE$   Without check digit - File KEY
3870: 0000: \***    12  1  INT  INDICAT0%
3871: 0000: \***                    X"01" - Contains statins                           ! 2.2 TT
3872: 0000: \***                    X"02" - Item not priced (giveaway)
3873: 0000: \***                    X"04" - Item not returnable
3874: 0000: \***                    X"08" - Item contains alcohol
3875: 0000: \***                    X"10" - Blocked from sale                          ! 2.2 TT
3876: 0000: \***                    X"20" - Enforced price entry
3877: 0000: \***                    X"40" - Enforced quantity entry
3878: 0000: \***                    X"80" - Movement kept
3879: 0000: \***    13  1  INT  INDICAT1%
3880: 0000: \***                    X"01" - Asprin
3881: 0000: \***                    X"02" - Paracetamol
3882: 0000: \***                    X"04" - TPLU inclusion flag
3883: 0000: \***                    X"08" - Giftcard item                              ! 2.2 TT
3884: 0000: \***                    X"10" - Withdrawn Block from sale                  ! 2.2 TT
3885: 0000: \***                    X"20" - Non-solid dose painkiller                  ! 2.2 TT
3886: 0000: \***                    X"40" - Insurance policy item                      ! 2.2 TT
3887: 0000: \***                    X"80" - Ibuprofen
3888: 0000: \***    14  2  INT  DEAL.DATA%(0)   Interpreted into sub-variables ...
3889: 0000: \***                    X'3F' - into DEAL.NUM$(0) "0000" to "9999" (2 byte UPD)
3890: 0000: \***                    X'C0' - into LIST.ID%(0) X'00' X
3891: 0000: \***                                             X'01' A
3892: 0000: \***                                             X'10' B
3893: 0000: \***                                             X'11' C                   ! 1.9 RC
3894: 0000: \***    16  1  INT  INDICAT8%                                              ! 2.0 AJC
3895: 0000: \***                    X"01" - Chlamydia NHS test kit                     ! 2.2 TT
3896: 0000: \***                    X"02" - Chlamydia open sell test kit               ! 2.2 TT
3897: 0000: \***                    X"04" - Unrestricted group code                    ! 2.2 TT
3898: 0000: \***                    X"08" - Nightingale Till prompt                    ! 2.2 TT
3899: 0000: \***                    X"10" - Contains Ephedrine                         ! 2.2 TT
3900: 0000: \***                    X"60" -  X'00' - If also Blocked From Sale Recall, ! 2.2 TT
3901: 0000: \***                                        Emergency                      ! 2.2 TT
3902: 0000: \***                             X'00' - If NOT Blocked From Sale Recall,  ! 2.2 TT
3903: 0000: \***                                        No recall                      ! 2.2 TT
3904: 0000: \***                             X'20' 100% returns                        ! 2.2 TT
3905: 0000: \***                             X'40' Withdrawn recall                    ! 2.2 TT
3906: 0000: \***                             X'60' Reverse Logistics                   ! 2.2 TT
3907: 0000: \***                    X"80" - WEEE item flag                             ! 2.0 AJC
3908: 0000: \***    17  1  INT  INDICAT9%
3909: 0000: \***                    X'3F' - Disposal special instruction (0-63)
3910: 0000: \***                    X"40" - Resaleable Indicator
3911: 0000: \***                    X"80" - Boots.com Extended Indicator
3912: 0000: \***    18  1  INT  INDICAT10%
3913: 0000: \***                    X'07' - Age restrictions
3914: 0000: \***                             X'00' - No Age restriction
3915: 0000: \***                             X'01' - Age 12 or over
3916: 0000: \***                             X'02' - Age 15 or over
3917: 0000: \***                             X'03' - Age 16 or over
3918: 0000: \***                             X'04' - Age 18 or over
3919: 0000: \***                             X'05' - Age 21 or over
3920: 0000: \***                             X'06' - Reserved
3921: 0000: \***                             X'07' - Reserved
3922: 0000: \***                    X'38' - Ethical classification
3923: 0000: \***                             X'00' - No ethical classification
3924: 0000: \***                             X'08' - Pharmacy medicine (P)
3925: 0000: \***                             X'10' - General Sale License (GSL)
3926: 0000: \***                             X'18' - Prescription Only Medicine (POM)
3927: 0000: \***                             X'20' - Reserved
3928: 0000: \***                             X'28' - Reserved
3929: 0000: \***                             X'30' - Reserved
3930: 0000: \***                             X'38' - Reserved
3931: 0000: \***                    X'C0' - Returns route
3932: 0000: \***                             X'00' - Not Returnable (Destroy)
3933: 0000: \***                             X'40' - Returns & Recovery
3934: 0000: \***                             X'80' - Direct
3935: 0000: \***                             X'C0' - Semi-centralised
3936: 0000: \***    19  5  UPD  SALEPRIC$   Current price in pence
3937: 0000: \***    24  1  INT  INDICAT5%   Guarantee duration
3938: 0000: \***                    X'3F' - Lowest 6 bits indicate duration (1-63)
3939: 0000: \***                    X'40' - Contains Pseudoephedrine                   ! 2.2 TT
3940: 0000: \***                    X'80' - Guarantee Duration Type                    ! 2.2 TT
3941: 0000: \***                              (1 = Months, 0 = Years)                  ! 2.2 TT
3942: 0000: \***    25 18  ASC  ITEMNAME$   Description used by till
3943: 0000: \***    43  3  UPD  BOOTS.CODE$ Without check digit
3944: 0000: \***    46  2  INT  DEAL.DATA%(1)   Similar structure to DEAL.DATA%(0)
3945: 0000: \***    48  2  INT  DEAL.DATA%(2)   Similar structure to DEAL.DATA%(0)
3946: 0000: \***    50  1  INT  INDICAT3%
3947: 0000: \***                    X"01" - Discountexempt (item exempt from discount)
3948: 0000: \***                    X"02" - Boots brand item
3949: 0000: \***                    X"04" - Item redeemable for loyalty
3950: 0000: \***                    X"08" - Loyalty exempt (item exempt from loyalty)
3951: 0000: \***                    X"10" - **Redundant                                ! 2.2 TT
3952: 0000: \***                    X"20" - Local Price active
3953: 0000: \***                    X"40" - Stock system item
3954: 0000: \***                    X"80" - **Redundant                                ! 2.2 TT
3955: 0000: \***
3956: 0000: \***    Record Length 50
3957: 0000: \***
3958: 0000: \***
3959: 0000: \***    IRF DEAL EXTENSION RECORD LAYOUT ! 1.9 RC
3960: 0000: \***
3961: 0000: \***     1  3  UPD  BOOTS.CODE$
3962: 0000: \***     4  2  INT  IRF.DEAL.DATA%(3)   Similar structure to DEAL.DATA%(0)
3963: 0000: \***     6  2  INT  IRF.DEAL.DATA%(4)   Similar structure to DEAL.DATA%(0)
3964: 0000: \***     8  2  INT  IRF.DEAL.DATA%(5)   Similar structure to DEAL.DATA%(0)
3965: 0000: \***    10  2  INT  IRF.DEAL.DATA%(6)   Similar structure to DEAL.DATA%(0)
3966: 0000: \***    12  2  INT  IRF.DEAL.DATA%(7)   Similar structure to DEAL.DATA%(0)
3967: 0000: \***    14  2  INT  IRF.DEAL.DATA%(8)   Similar structure to DEAL.DATA%(0)
3968: 0000: \***    16  2  INT  IRF.DEAL.DATA%(9)   Similar structure to DEAL.DATA%(0)
3969: 0000: \***
3970: 0000: \***    Record Length 17
3971: 0000: \***
3972: 0000: \**********************************************************************************
3973: 0000: 
3974: 0000: 
3975: 0000:     STRING GLOBAL            \
3976: 0000:         IRF.ALT.FILE.NAME$,  \
3977: 0000:         IRF.BAR.CODE$,       \
3978: 0000:         IRF.BOOTS.CODE$,     \
3979: 0000:         IRF.DEAL.SAVING$,    \ 2 byte - deal saving amount (0 - 99.99) ! ESP
3980: 0000:         IRF.DEPARTME$,       \ 3 byte UPD. Department number          ! ESP Delete
3981: 0000:         IRF.FILE.NAME$,      \
3982: 0000:         IRF.HOLDING.PRICE$,  \ 4 byte UPD. Current H.O. price in pence if a local
3983: 0000:                              \ price is in effect, zero otherwise.     ! ESP Delete
3984: 0000:         IRF.ITEMNAME$,       \
3985: 0000: \       IRF.MPGROUP$,        \ Removed SBH 31/1/96
3986: 0000:         IRF.RECORD$,         \                                         ! ESP Delete
3987: 0000:         IRF.SALEPRIC$,       \
3988: 0000:         IRF.SALEQUAN$,       \ Redundant (set to null within functions)    ! 1.6 RC
3989: 0000:         IRF.UNUSED$,         \                                                        ! 1.6 RC
3990: 0000:         NEW.IRF.DATA$        !                                             ! 1.7 RC
3991: 0000: 
3992: 0000:     STRING GLOBAL            \                                             ! 1.6 RC
3993: 0000:         IRF.DEAL.NUM$(1)                                                   ! 1.6 RC
3994: 0000: 
3995: 0000:     INTEGER*1 GLOBAL         \
3996: 0000:         IRF.DD.SUB%,         \ IRF.DEAL.DATA% subscript                    ! 1.6 RC
3997: 0000:         IRF.INDICAT0%,       \
3998: 0000:         IRF.INDICAT1%,       \
3999: 0000:         IRF.INDICAT2%,       \ Redundant (set to null within functions)    ! 1.6 RC
4000: 0000:         IRF.INDICAT3%,       \
4001: 0000:         IRF.INDICAT4%,       \ Redundant (set to null within functions)    ! 1.6 RC
4002: 0000:         IRF.INDICAT5%,       \                                             ! 2.0 AJC
4003: 0000:         IRF.INDICAT8%,       \                                             ! 2.0 AJC
4004: 0000:         IRF.INDICAT9%,       \                                             ! 2.2 TT
4005: 0000:         IRF.INDICAT10%                                                     ! 2.2 TT
4006: 0000: 
4007: 0000:     INTEGER*1 GLOBAL         \                                             ! 1.6 RC
4008: 0000:         IRF.LIST.ID%(1)                                                    ! 1.6 RC
4009: 0000: 
4010: 0000:     INTEGER*2 GLOBAL         \
4011: 0000:         IRF.ALT.REPORT.NUM%, \
4012: 0000:         IRF.ALT.SESS.NUM%,   \
4013: 0000:         IRF.POINTS%,         \ Redundant (set to null within functions)    ! 1.6 RC
4014: 0000:         IRF.RECL%,           \
4015: 0000:         IRF.REPORT.NUM%,     \
4016: 0000:         IRF.SESS.NUM%,       \
4017: 0000:         IRF.MAX.DEALS%       !                                             ! 1.9 SM
4018: 0000: 
4019: 0000:     STRING GLOBAL IRFDEX.FILE.NAME$                                        ! 1.9 SM
4020: 0000: 
4021: 0000:     INTEGER*2 GLOBAL IRFDEX.SESS.NUM%                                      ! 1.9 SM
4022: 0000:     INTEGER*2 GLOBAL IRFDEX.REPORT.NUM%                                    ! 1.9 SM
4023: 0000:     INTEGER*2 GLOBAL IRFDEX.RECL%                                          ! 1.9 SM
4024: 0000: 
4025: 0000: 
4026: 0000: !   INTEGER*2 GLOBAL      \ IRF.DEAL.DATA%(n) variables are defined locally  1.6 RC
4027: 0000: !       IRF.DEAL.DATA%(1) \ within IRFFUN.BAS to keep invisible to programs  1.6 RC
4028: 0000: 
4029: 0000:  %INCLUDE STKDCDEC.J86                    ! 1.8DA
4030: 0000: \******************************************************************************
4031: 0000: \******************************************************************************
4032: 0000: \***
4033: 0000: \***   $Workfile:   STKDCDEC.J86  $
4034: 0000: \***
4035: 0000: \***   $Revision:   1.0  $
4036: 0000: \***
4037: 0000: \******************************************************************************
4038: 0000: \******************************************************************************
4039: 0000: \***
4040: 0000: \***   $Log:   V:\archive\j86\stkdcdec.j8v  $
4041: 0000: \***   
4042: 0000: \***      Rev 1.0   15 Jul 1997 14:20:40   DEV45PS
4043: 0000: \***    
4044: 0000: \***   
4045: 0000: \***      Rev 1.0   09 Jul 1997 11:04:58   DEV45PS
4046: 0000: \***   Stocktake System New Files
4047: 0000: \***   
4048: 0000: \******************************************************************************
4049: 0000: \******************************************************************************\******************************************************************************
4050: 0000: \******************************************************************************
4051: 0000: \***
4052: 0000: \***         %INCLUDE FOR STOCKTAKE DUMP CODEP FIELD DECLARATIONS
4053: 0000: \***
4054: 0000: \***               FILE TYPE    : DIRECT
4055: 0000: \***
4056: 0000: \***               REFERENCE    : STKDCDEC.J86
4057: 0000: \***
4058: 0000: \***    VERSION A.              Nik Sen.               19 Jun 1997.
4059: 0000: \***    New file for stocktaking system. Holds all items counted using
4060: 0000: \***    dump codes during the stocktake.
4061: 0000: \***
4062: 0000: \*******************************************************************************
4063: 0000: \*******************************************************************************
4064: 0000: 
4065: 0000: STRING GLOBAL                                                  \
4066: 0000:        STKDC.FILE.NAME$,               \
4067: 0000:        STKDC.DUMP.CODE$,               \
4068: 0000:        STKDC.QUANTITY$,                \
4069: 0000:        STKDC.PRICE$,                   \
4070: 0000:        STKDC.LOCATION$,                \
4071: 0000:        STKDC.STOCKTAKER.NUM$
4072: 0000:         
4073: 0000: INTEGER*4 GLOBAL               \
4074: 0000:        STKDC.RECORD.NUM%
4075: 0000: 
4076: 0000: 
4077: 0000: INTEGER*2 GLOBAL                \
4078: 0000:    STKDC.REPORT.NUM%,           \
4079: 0000:    STKDC.SESS.NUM%             
4080: 0000: 
4081: 0000: 
4082: 0000: INTEGER*1 GLOBAL                \
4083: 0000:    STKDC.RECL%         
4084: 0000: 
4085: 0000: 
4086: 0000:  %INCLUDE MINLSDEC.J86                    ! 1.9BG
4087: 0000: 
4088: 0000: \*****************************************************************************
4089: 0000: \*****************************************************************************
4090: 0000: \***
4091: 0000: \***        %INCLUDE FIELD DECLARATIONS AND FILE REFERENCE PARAMETERS
4092: 0000: \***
4093: 0000: \***                   FILE TYPE:  KEYED
4094: 0000: \***
4095: 0000: \***                   REFERENCE:  MINLSDEC.J86
4096: 0000: \***
4097: 0000: \***              DESCRIPTION:  MINSITS RP - SCREEN COUNT INFORMATION
4098: 0000: \***
4099: 0000: \***
4100: 0000: \***
4101: 0000: \***      VERSION 1 : Julia Stones             8th January 1998  
4102: 0000: \***      
4103: 0000: \*****************************************************************************
4104: 0000: \*****************************************************************************
4105: 0000: 
4106: 0000: STRING GLOBAL   \
4107: 0000:    MINLS.FILE.NAME$,  \
4108: 0000:    MINLS.ITEM.CODE$,     \  4 byte UPD;  Record key
4109: 0000:    MINLS.RECOUNT.DATE$,  \  3 byte UPD;  YYMMDD      
4110: 0000:    MINLS.DISCREPANCY$,    \  3 byte UPD        
4111: 0000:    MINLS.COUNT.STATUS$     ! 1 byte ASCII 
4112: 0000: 
4113: 0000: INTEGER*2 GLOBAL  \
4114: 0000:    MINLS.RECL%,   \
4115: 0000:    MINLS.REPORT.NUM%,  \
4116: 0000:    MINLS.SESS.NUM%   !
4117: 0000: 
4118: 0000: 
4119: 0000: 
4120: 0000:  %INCLUDE NEGSCDEC.J86                    ! 1.9BG
4121: 0000: 
4122: 0000: \*****************************************************************************
4123: 0000: \*****************************************************************************
4124: 0000: \***
4125: 0000: \***        %INCLUDE FIELD DECLARATIONS AND FILE REFERENCE PARAMETERS
4126: 0000: \***
4127: 0000: \***                   FILE TYPE:  KEYED
4128: 0000: \***
4129: 0000: \***                   REFERENCE:  NEGSCDEC.J86
4130: 0000: \***
4131: 0000: \***              DESCRIPTION:  CURRENT NEGATIVE STOCK COUNT INFORMATION
4132: 0000: \***
4133: 0000: \***
4134: 0000: \***
4135: 0000: \***      VERSION 1 : Julia Stones             15th July 1999  
4136: 0000: \***      
4137: 0000: \***    REVISION 1.2.            ROBERT COWEY.                  09 SEP 2003.
4138: 0000: \***    Changes for RF trial.
4139: 0000: \***    Recompiled to prevent future automatic recompiles.
4140: 0000: \***    No changes to actual code.
4141: 0000: \***
4142: 0000: \*****************************************************************************
4143: 0000: \*****************************************************************************
4144: 0000: 
4145: 0000: STRING GLOBAL   \
4146: 0000:    NEGSC.FILE.NAME$,  \
4147: 0000:    NEGSC.KEY$,   \      !  5 bytes UPD; 1 byte Record type 
4148: 0000:                         \                 Record type 01 item record
4149: 0000:                         \                 Record type 02 total count record
4150: 0000:                         \               4 bytes item code (set to zero's if
4151: 0000:                         \                 record type 02)
4152: 0000:    NEGSC.STATUS.1$      !  1 byte ASC
4153: 0000:                         !            'B' - Discontinued but still on display
4154: 0000:                         !            'C' - Cancel outstanding orders
4155: 0000:                         !            'D' - Discontinued and no longer on display
4156: 0000:                         !            'P' - Suspended (orders to Store)
4157: 0000:                         !            'X' - Deleted
4158: 0000:                         !            ' ' - No special Status (default value)
4159: 0000:   
4160: 0000: INTEGER*2 GLOBAL  \
4161: 0000:    NEGSC.RECL%,   \
4162: 0000:    NEGSC.REPORT.NUM%,  \
4163: 0000:    NEGSC.SESS.NUM%,    \
4164: 0000:    NEGSC.ITEM.TSF%,    \
4165: 0000:    NEGSC.NUMBER.OF.DAYS%   !
4166: 0000: 
4167: 0000: 
4168: 0000: 
4169: 0000:  %INCLUDE SSPSCDEC.J86                    ! 2.0JAS
4170: 0000: \*****************************************************************************
4171: 0000: \*****************************************************************************
4172: 0000: \***
4173: 0000: \***               %INCLUDE FOR SSPSCTRL - FIELD DECLARATIONS
4174: 0000: \***                                          FILE REFERENCE PARAMETERS
4175: 0000: \***
4176: 0000: \***                      FILE TYPE    : DIRECT
4177: 0000: \***
4178: 0000: \***                      REFERENCE    : SSPSCdea.J86
4179: 0000: \***
4180: 0000: \***    Version A               Julia Stones          23 Oct 2003
4181: 0000: \***
4182: 0000: \***
4183: 0000: \*****************************************************************************
4184: 0000: \*****************************************************************************
4185: 0000: 
4186: 0000: REM \
4187: 0000: 
4188: 0000:   STRING GLOBAL           \
4189: 0000:     SSPSCTRL.FILE.NAME$
4190: 0000: 
4191: 0000:   INTEGER*2 GLOBAL        \
4192: 0000:     SSPSCTRL.REPORT.NUM%,   \
4193: 0000:     SSPSCTRL.SESS.NUM%
4194: 0000: REM \
4195: 0000: 
4196: 0000:   STRING GLOBAL           \
4197: 0000:     SSPS.BTCSK.NUM$,      \ 3 byte, file ext number (000 - 999)
4198: 0000:     SSPS.BTCSF.NUM$,      \ 3 byte, file ext number (000 - 999)
4199: 0000:     SSPS.BTCSK.FTP$,      \ 3 byte, last file ext number sent to SMARTSCRIPT
4200: 0000:     SSPS.BTCSF.FTP$,      \ 3 byte, last file ext number sent to SMARTSCRIPT
4201: 0000:     SSPS.FILLER$          ! 68 byte, spaces
4202: 0000: 
4203: 0000:   INTEGER*2 GLOBAL        \
4204: 0000:     SSPSCTRL.RECL%
4205: 0000:  %INCLUDE BTCSDEC.J86                     ! 2.0JAS
4206: 0000: \*****************************************************************************
4207: 0000: \*****************************************************************************
4208: 0000: \***
4209: 0000: \***      %INCLUDE FOR BTCS FILE - FIELD DECLARATIONS
4210: 0000: \***                               FILE REFERENCE PARAMETERS
4211: 0000: \***
4212: 0000: \***      FILE TYPE    : DIRECT
4213: 0000: \***
4214: 0000: \***      REFERENCE    : BTCSDEC
4215: 0000: \***
4216: 0000: \***      VERSION A    : Julia Stones 22/10/03
4217: 0000: \***
4218: 0000: \*****************************************************************************
4219: 0000: \*****************************************************************************
4220: 0000: 
4221: 0000:     STRING GLOBAL        BTCS.FILE.NAME$
4222: 0000: 
4223: 0000: 
4224: 0000:     INTEGER*2 GLOBAL     BTCS.SESS.NUM%,        \
4225: 0000:                          BTCS.RECL%,            \
4226: 0000:                          BTCS.REPORT.NUM%
4227: 0000: 
4228: 0000: 
4229: 0000:     INTEGER*4 GLOBAL     BTCS.REC.NUM%
4230: 0000: 
4231: 0000: 
4232: 0000:     STRING GLOBAL        BTCS.RECORD$,           \ Whole record form file:
4233: 0000:                          BTCS.RECORD.TYPE$,      \ 1 ASC Type of record:
4234: 0000:                                                  \       "H" = header
4235: 0000:                                                  \       "D" = detail
4236: 0000:                                                  \       "T" = trailer
4237: 0000:                          BTCS.STORE.NUMBER$,     \ 4 ASC 4 digit Store number
4238: 0000:                          BTCS.STKTAKE.NUM$,      \ 4 ASC 4 digit Stock take number
4239: 0000:                          BTCS.DATE$,             \ 6 ASC Date YYMMDD
4240: 0000:                          BTCS.TIME$,             \ 6 ASC Time HHMMSS
4241: 0000:                          BTCS.DISP.AREA$,        \ 1 ASC M = MDS
4242: 0000:                                                  \       D = Dispensing
4243: 0000:                          BTCS.FILLER$,           \   ASC Set to spaces
4244: 0000:                          BTCS.NUM.RECORD$,       \ 4 ASC Record sequence number starting at 0001
4245: 0000:                          BTCS.ITEM.CODE$,        \13 ASC Item Code/PIP code
4246: 0000:                          BTCS.CODE.TYPE$,        \ 1 ASC E = EAN item code
4247: 0000:                                                  \       P = PIP code
4248: 0000:                          BTCS.PACK.QTY$,         \ 6 ASC Number of packs, bottles etc
4249: 0000:                          BTCS.DIS.UNIT.QTY$,     \ 4 ASC Dispensed unit quantity
4250: 0000:                          BTCS.RECORD.COUNT$,     \ 4 ASC Amount of records in file (inc header and trailer)
4251: 0000:                          BTCS.ENDREC$            \ 2 ASC ODOA
4252: 0000: 
4253: 0000:  %INCLUDE PRINTDEC.J86                    ! 2.0JAS
4254: 0000: 
4255: 0000: REM \
4256: 0000: \*******************************************************************************
4257: 0000: \*******************************************************************************
4258: 0000: \***
4259: 0000: \***    %INCLUDE FOR PRINT FILE VARIABLE DECLARATIONS
4260: 0000: \***
4261: 0000: \***        REFERENCE   :   PRINTDE (J86)
4262: 0000: \***
4263: 0000: \***        FILE TYPE   :   Printer / Labeller
4264: 0000: \***
4265: 0000: \***    VERSION A.              ANDREW WEDGEWORTH                   09 JUL 1992.
4266: 0000: \***    Original version created by merging PRINTFLG and PRINTNUG.
4267: 0000: \***
4268: 0000: \***    VERSION B.              UNKNOWN.                            ?? ??? 1992.
4269: 0000: \***    Changes unknown.             
4270: 0000: \***
4271: 0000: \***    VERSION C.              ROBERT COWEY.                       18 NOV 1992.
4272: 0000: \***    No changes made to this file.
4273: 0000: \***
4274: 0000: \***    Version D               Andrew Wedgeworth                 24th May 1992
4275: 0000: \***    Variable added to contain condensed print record length.
4276: 0000: \***
4277: 0000: \*******************************************************************************
4278: 0000: \*******************************************************************************
4279: 0000: 
4280: 0000: 
4281: 0000:     STRING GLOBAL \
4282: 0000:         PRINT.LINE$, \
4283: 0000:         PRINT.FILE.NAME$, \
4284: 0000:         SELF.LAN.NAME$, \
4285: 0000:         SELF.NOLAN.NAME$
4286: 0000: 
4287: 0000:     INTEGER*2 GLOBAL \
4288: 0000:         PRINT.CONDENSED.RECL%, \                                       ! DAW  
4289: 0000:         PRINT.SESS.NUM%, \
4290: 0000:         PRINT.REPORT.NUM%, \
4291: 0000:         PRINT.REPORT.RECL%, \
4292: 0000:         PRINT.SELF.RECL%
4293: 0000: 
4294: 0000:  %INCLUDE SOPTSDEC.J86                    ! 2.1JAS
4295: 0000: REM \
4296: 0000: \******************************************************************************
4297: 0000: \******************************************************************************
4298: 0000: \***
4299: 0000: \***                 %INCLUDE FOR THE STORE OPTIONS FILE
4300: 0000: \***   
4301: 0000: \***                      FILE TYPE  :   Direct
4302: 0000: \***
4303: 0000: \***                      REFERENCE  :   SOPTSDEC.J86
4304: 0000: \***
4305: 0000: \***    Version A         Stuart William McConnachie      19th June 1995
4306: 0000: \***
4307: 0000: \******************************************************************************
4308: 0000: \*******************************************************************************
4309: 0000: 
4310: 0000:   STRING GLOBAL           \
4311: 0000:     SOPTS.RECORD$,        \           
4312: 0000:     SOPTS.SPACE$,         \           
4313: 0000:     SOPTS.FILE.NAME$
4314: 0000:     
4315: 0000:   INTEGER*2 GLOBAL        \
4316: 0000:     SOPTS.RECL%,          \            
4317: 0000:     SOPTS.REPORT.NUM%,    \      
4318: 0000:     SOPTS.SESS.NUM%
4319: 0000: 
4320: 0000:   INTEGER*4 GLOBAL        \
4321: 0000:     SOPTS.REC.NUM%
4322: 0000: 
4323: 0000:  %INCLUDE TSFDEC.J86                      ! 2.1JAS
4324: 0000: \*****************************************************************************
4325: 0000: \*****************************************************************************
4326: 0000: \***
4327: 0000: \***      %INCLUDE FOR TERMINAL STATUS FILE - FIELD DECLARATIONS
4328: 0000: \***                                          FILE REFERENCE PARAMETERS
4329: 0000: \***
4330: 0000: \***                      FILE TYPE    : KEYED
4331: 0000: \***
4332: 0000: \***                      REFERENCE    : TSFDEC
4333: 0000: \***
4334: 0000: \***           VERSION A : STEVEN GOULDING              13.10.92
4335: 0000: \***
4336: 0000: \***           VERSION B : STEVE WINDSOR                15.09.93
4337: 0000: \***           Updated to keep in step.
4338: 0000: \***
4339: 0000: \***           VERSION C : STUART WILLIAM MCCONNACHIE   18.03.97
4340: 0000: \***           Added extra fields in user data.
4341: 0000: \*** 
4342: 0000: \***           VERSION D : REBECCA DAKIN                22.02.99
4343: 0000: \***           Added ACSALD.CUT.OFF, as part of Cash Accounting project.
4344: 0000: \***
4345: 0000: \***           VERSION E : AMY HOGGARD                  16.10.00
4346: 0000: \***           Added TILLBAG.CUT.OFF, as part of ECO project.
4347: 0000: \***
4348: 0000: \***           VERSION F : STUART WILLIAM MCCONNACHIE   20.05.05
4349: 0000: \***           Added "new" fields as no one else can be bothered.
4350: 0000: \***           Corrected offset bug of controller ID.
4351: 0000: \***
4352: 0000: \***           VERSION G : JAMIE THORPE                 05.10.05
4353: 0000: \***           Added new INVDUE.DATE record to the store record 
4354: 0000: \***           (for Zero TSF proj.)
4355: 0000: \***           This is the date that the most recent INVDUE file
4356: 0000: \***           was created.
4357: 0000: \***
4358: 0000: \***    VERSION H               Mark Walker                      3rd Nov 2014
4359: 0000: \***    F294 PCI Phase 1
4360: 0000: \***    Includes the following changes:
4361: 0000: \***    - Removed redundant 'smartcard software level' field.
4362: 0000: \***    - Extended TSF.INDICAT2% integer field from 1 to 2 bytes.
4363: 0000: \***
4364: 0000: \*****************************************************************************
4365: 0000: \*****************************************************************************
4366: 0000: 
4367: 0000:     STRING GLOBAL               \
4368: 0000:         TSF.FILE.NAME$,         \
4369: 0000:         TSF.REC$(1),            \ One dimensional array
4370: 0000:         TSF.SECTOR.FILLER$,     \
4371: 0000:         TSF.SECTOR.INFO$
4372: 0000:         
4373: 0000:     INTEGER*1 GLOBAL            \
4374: 0000:         TSF.REC.SUB%            ! Subscript used with TSF.REC array
4375: 0000: 
4376: 0000:     INTEGER*2 GLOBAL            \
4377: 0000:         TSF.SESS.NUM%,          \
4378: 0000:         TSF.RECL%,              \
4379: 0000:         TSF.REPORT.NUM%,        \
4380: 0000:         TSF.SECTOR.NUM%
4381: 0000: 
4382: 0000:     STRING GLOBAL               \
4383: 0000:         TSF.TERM.STORE$,        \ 2 byte UPD.Terminal number or 
4384: 0000:                                 \ 9999 for store (key)
4385: 0000:         TSF.TSL.NAME$,          \ 8 bytes. Most recent old TSL file
4386: 0000:         TSF.MONITOR$,           \ 2 byte UPD last monitoring terminal
4387: 0000:         TSF.TLOGFLAG$,          \ 1 byte, EALLGHC processed flag
4388: 0000:         TSF.OPERATOR$,          \ Operator number
4389: 0000:         TSF.TRANSNUM$,          \ Most recent transaction
4390: 0000:         TSF.RCPSTATUS$,         \ Store close requested through RCF                                                             
4391: 0000:         TSF.SIGN.OFF.DELAY$,    \ 1 byte PD counter to auto sign off    \  !CSWM
4392: 0000:         TSF.USER$,              \ User data
4393: 0000:         TSF.CONTROLLER$,        \ Controller ID
4394: 0000:         TSF.INVDUE.DATE$,       \ Creation date of the INVDUE
4395: 0000:                                 \ (Updated by PSS33)                    \   !GJT
4396: 0000:         TSF.SPACE$              ! 34 bytes or 14 bytes
4397: 0000: 
4398: 0000:     INTEGER*1 GLOBAL            \
4399: 0000:         TSF.INDICAT0%,          \ Indicator byte 0
4400: 0000:         TSF.INDICAT1%,          \ Indicator byte 1
4401: 0000: \       TSF.INDICAT2%,          \ Indicator byte 2                      \   !HMW
4402: 0000:         TSF.MTSL.CUT.OFF%,      \ MTSL cut-off required flag            \  !CSWM
4403: 0000:         TSF.CUSTD.CUT.OFF%,     \ CUSTD cut-off required flag           \  !CSWM
4404: 0000:         TSF.ACSAL.CUT.OFF%,     \ ACSAL cut-off required flag               !DRD
4405: 0000:         TSF.TILLBAG.CUT.OFF%    ! TILLBAG cut-off required flag             !EAH
4406: 0000:     
4407: 0000:     INTEGER*2 GLOBAL            \
4408: 0000: \       TSF.SC.LEVEL%           ! Smartcard software level              \   !HMW
4409: 0000:         TSF.INDICAT2%           ! Indicator flags 2                         !HMW
4410: 0000: 
4411: 0000:     INTEGER*4 GLOBAL            \
4412: 0000:         TSF.GROSSPOS,           \ Gross plus
4413: 0000:         TSF.GROSSNEG,           \ Gross minus
4414: 0000:         TSF.NETCASH,            \ Net cash
4415: 0000:         TSF.NETNCASH,           \ Net non-cash
4416: 0000:         TSF.AMTLOAN,            \ Loans
4417: 0000:         TSF.AMTPICKU,           \ Withdrawals
4418: 0000:         TSF.AMTCASHC,           \ Cash count
4419: 0000:         TSF.NETCCURR,           \ Net cash currency face value
4420: 0000:         TSF.NETCCCURR           ! Net cash count currency face value
4421: 0000: 
4422: 0000:  %INCLUDE LOCALDEC.J86                    ! 2.1JAS
4423: 0000: \***********************************************************************
4424: 0000: \***********************************************************************
4425: 0000: \***
4426: 0000: \***    DESCRIPTION: Local Price File
4427: 0000: \***                 Field Definitions
4428: 0000: \***
4429: 0000: \***    FILE TYPE : Keyed
4430: 0000: \***
4431: 0000: \***********************************************************************
4432: 0000: \***
4433: 0000: \***    Version A.          Paul Flanagan                1st Jul 1993
4434: 0000: \***    Initial version.
4435: 0000: \***
4436: 0000: \***    Version B.          Clive Norris                24th Nov 1993
4437: 0000: \***    AUTH.NUM$, STOCK.FIG$ and RETRIEVAL.FLAG$ replaced filler as
4438: 0000: \***    part of the RETURNS/AUTOMATIC CREDIT CLAIMING package.
4439: 0000: \***
4440: 0000: \***    Version C.          Mick Bayliss                 6th Dec 1994
4441: 0000: \***    Added missing field.
4442: 0000: \***
4443: 0000: \***    Version D.          Mark Walker                  1st Jul 2015
4444: 0000: \***    F392 Retail Stock 5
4445: 0000: \***    Added key length field.
4446: 0000: \***
4447: 0000: \***********************************************************************
4448: 0000: \***********************************************************************
4449: 0000: 
4450: 0000:     STRING GLOBAL             \
4451: 0000:         LOCAL.AUTH.NUM$,      \ 4 bytes UPD Auth'n number
4452: 0000:                               \             from Business Centre.
4453: 0000:         LOCAL.END.DATE$,      \ 3 bytes UPD yymmdd.
4454: 0000:         LOCAL.FILE.NAME$,     \
4455: 0000:         LOCAL.H.O.PRICE$,     \ 5 byte UPD.
4456: 0000:         LOCAL.HO.CHANGE$,     \ 3 bytes UPD. Date of HO price change
4457: 0000:                               \ (this will be zero if no change since
4458: 0000:                               \ local price was initiated).
4459: 0000:         LOCAL.ITEM.CODE$,     \ 4 bytes UPD (key) Boots code 
4460: 0000:                               \                   with check digit. 
4461: 0000:         LOCAL.OPERATOR$,      \ 4 bytes UPD operator id (when set up).
4462: 0000:         LOCAL.PRICE$,         \ 5 bytes UPD.
4463: 0000:         LOCAL.REASON$,        \ 4 byte ASCII 
4464: 0000:         LOCAL.RETRIEVAL.FLAG$,\ 1 byte ASC "Y" or "N"  
4465: 0000:         LOCAL.SPACE$,         \                                            !CMJB
4466: 0000:         LOCAL.START.DATE$,    \ 3 bytes UPD yymmdd. 
4467: 0000:         LOCAL.START.TIME$     ! 2 bytes UPD hhmm.
4468: 0000:         
4469: 0000:     INTEGER*2 GLOBAL          \
4470: 0000:         LOCAL.KEYL%,          \                                             !DMW
4471: 0000:         LOCAL.RECL%,          \
4472: 0000:         LOCAL.REPORT.NUM%,    \
4473: 0000:         LOCAL.SESS.NUM%,      \
4474: 0000:         LOCAL.STOCK.FIG%      !  No. of items authorised at the price.
4475: 0000: 
4476: 0000:  %INCLUDE CCREJDEC.J86                    ! 1.2JAS
4477: 0000: REM \
4478: 0000: \******************************************************************************
4479: 0000: \******************************************************************************
4480: 0000: \***
4481: 0000: \***      %INCLUDE FOR CREDIT CLAIMING REJECT FILE FIELD DECLARATIONS
4482: 0000: \***                                          FILE REFERENCE PARAMETERS
4483: 0000: \***
4484: 0000: \***               FILE TYPE    : Sequential
4485: 0000: \***
4486: 0000: \***               REFERENCE    : CCREJDEC.J86
4487: 0000: \***
4488: 0000: \***      Version A.     Julia Stones           11th March 2004.
4489: 0000: \***
4490: 0000: \******************************************************************************
4491: 0000: \*******************************************************************************
4492: 0000: \***
4493: 0000: \***
4494: 0000: \***
4495: 0000: \******************************************************************************
4496: 0000: 
4497: 0000:   STRING GLOBAL              \
4498: 0000:     CCREJ.FILE.NAME$,        \
4499: 0000:     CCREJC.FILE.NAME$,       \
4500: 0000:     CCREJP.FILE.NAME$,       \
4501: 0000:     CCREJ.RECORD$,           \ Used to store the whole record which is unstrung
4502: 0000:                              \ into the fields below
4503: 0000:     CCREJ.ENDREC.MARKER$,    \ 2 bytes ASCII set to XODOA
4504: 0000:     CCREJ.DATE$,             \ 8 byte ASCII
4505: 0000:     CCREJ.RETURN.REASON$,    \ 2 byte ASCII
4506: 0000:     CCREJ.BC.LETTER$,        \ 1 byte ASCII
4507: 0000:     CCREJ.UOD.NUM$,          \ 14 byte ASCII
4508: 0000:     CCREJ.ITEM.BARCODE.FLAG$,\ 1 byte ASC;  "I" = Boots item code,
4509: 0000:               \                             "B" = Barcode.
4510: 0000:     CCREJ.ITEM.BARCODE$,     \ 12 byte ASCII
4511: 0000:     CCREJ.DESC$,             \ 24 byte ASCII
4512: 0000:     CCREJ.ITEM.BC$,          \ 1 byte ASCII
4513: 0000:     CCREJ.ITEM.QTY$,         \ 4 byte ASCII
4514: 0000:     CCREJ.REJECT.REASON$     ! 1 byte ASCII "1" = Item not on file
4515: 0000:                              !              "2" = Credit Claim not allowed against this
4516: 0000:                              !                    Business Centre
4517: 0000:                              !              "3" = Item does not belong to Business Centre
4518: 0000:                              !                    being claimed against
4519: 0000: 
4520: 0000: 
4521: 0000:   INTEGER*2 GLOBAL           \
4522: 0000:     CCREJ.RECL%,             \
4523: 0000:     CCREJC.RECL%,            \
4524: 0000:     CCREJP.RECL%,            \
4525: 0000:     CCREJC.SESS.NUM%,        \
4526: 0000:     CCREJP.SESS.NUM%,        \
4527: 0000:     CCREJ.SESS.NUM%,         \
4528: 0000:     CCREJC.REPORT.NUM%,      \
4529: 0000:     CCREJP.REPORT.NUM%,      \
4530: 0000:     CCREJ.REPORT.NUM%
4531: 0000: 
4532: 0000: 
4533: 0000:  %INCLUDE RBDEC.J86                       ! 2.6BG
4534: 0000: \/******************************************************************/
4535: 0000: \/*                                                                */
4536: 0000: \/* Recalls Buffer FILE GLOBAL VARIABLE DECLARATIONS               */
4537: 0000: \/*                                                                */
4538: 0000: \/* REFERENCE   : RBDEC.J86                                        */
4539: 0000: \/*                                                                */
4540: 0000: \/* VERSION A.          Brian Greenfield        11th may 2007      */
4541: 0000: \/*                                                                */
4542: 0000: \/******************************************************************/
4543: 0000: 
4544: 0000:    STRING GLOBAL                \
4545: 0000:       RB.FILE.NAME$,            \
4546: 0000:                                 \
4547: 0000:       RB.RCD$,                  \  ? bytes  (25/14/12)
4548: 0000:       RB.REC.TYPE$,             \  1 byte   (H/D/T)
4549: 0000:       RB.REFERENCE$,            \  8 bytes
4550: 0000:       RB.LABEL$,                \ 14 bytes (8 bytes label type)
4551: 0000:                                 \          (6 bytes label number)
4552: 0000:       RB.ITEM.CODE$,            \  7 bytes (with check digit)
4553: 0000:       RB.STOCK.COUNT$,          \  4 bytes (1 - 9999)
4554: 0000:       RB.ITEM.COUNT$,           \  5 bytes (1 - 99999)
4555: 0000:       RB.RECORD.COUNT$          !  4 bytes (1 - 9999 inc header and trailer)
4556: 0000: 
4557: 0000:    INTEGER*2 GLOBAL             \
4558: 0000:       RB.REPORT.NUM%,           \
4559: 0000:       RB.SESS.NUM%              !
4560: 0000: 
4561: 0000: \/******************************************************************/
4562: 0000:  %INCLUDE REWKFDEC.J86                    ! 2.6BG
4563: 0000: \/******************************************************************/
4564: 0000: \/*                                                                */
4565: 0000: \/* Recalls Work FILE GLOBAL VARIABLE DECLARATIONS                 */
4566: 0000: \/*                                                                */
4567: 0000: \/* REFERENCE   : REWKFDEC.J86                                     */
4568: 0000: \/*                                                                */
4569: 0000: \/* VERSION A.          Brian Greenfield        11th may 2007      */
4570: 0000: \/*                                                                */
4571: 0000: \/* VERSION B.          Brian Greenfield        15th April 2008    */
4572: 0000: \/*                                                                */
4573: 0000: \/* VERSION C.          Brian Greenfield        6th May 2008       */
4574: 0000: \/*                                                                */
4575: 0000: \/******************************************************************/
4576: 0000: 
4577: 0000:    STRING GLOBAL                \
4578: 0000:       REWKF.FILE.NAME$,         \
4579: 0000:                                 \
4580: 0000:       REWKF.RCD$,               \  ? bytes  (25/47/8)
4581: 0000:       REWKF.REC.TYPE$,          \  1 byte   (H/D/T)
4582: 0000:       REWKF.REFERENCE$,         \  8 bytes
4583: 0000:       REWKF.LABEL$,             \ 14 bytes (8 bytes label type)
4584: 0000:                                 \          (6 bytes label number - zero's)
4585: 0000:       REWKF.BATCH.TYPE$,        \  1 byte  (E/F/R/S/W/X/I/C) !BBG
4586: 0000:       REWKF.MRQ$,               \  2 bytes ASCII !CBG
4587: 0000:       REWKF.DUE.BY.DATE$,       \  8 bytes (YYYYMMDD) !BBG
4588: 0000:       REWKF.BARCODE$,           \ 13 bytes (with check digit)
4589: 0000:       REWKF.ITEM.CODE$,         \  7 bytes (with check digit)
4590: 0000:       REWKF.DESCRIPTION$,       \ 20 bytes (truncated from the IDF)
4591: 0000:       REWKF.TSF$,               \  4 bytes (1 - 9999 or SPACES for recall types F, S, & X)
4592: 0000:       REWKF.ITEM.COUNT$         !  5 bytes (1 - 99999)
4593: 0000:       
4594: 0000:    INTEGER*2 GLOBAL             \
4595: 0000:       REWKF.REPORT.NUM%,        \
4596: 0000:       REWKF.SESS.NUM%           !
4597: 0000: 
4598: 0000: \/******************************************************************/
4599: 0000:  %INCLUDE RECALDEC.J86                    ! 2.6BG
4600: 0000: \******************************************************************************
4601: 0000: \******************************************************************************
4602: 0000: \***
4603: 0000: \***         INCLUDE FOR RECALLS.BIN DECLARATIONS
4604: 0000: \***
4605: 0000: \***               FILE TYPE    : Keyed
4606: 0000: \***
4607: 0000: \***               REFERENCE    : RECALDEC.J86
4608: 0000: \***
4609: 0000: \***    VERSION A               BRIAN GREENFIELD                    14th May 2007
4610: 0000: \***    Initial Version
4611: 0000: \***
4612: 0000: \***    Version B               BRIAN GREENFIELD                    20th June 2007
4613: 0000: \***    Altered due to a change in the file layout.
4614: 0000: \***
4615: 0000: \*******************************************************************************
4616: 0000: \*******************************************************************************
4617: 0000: 
4618: 0000:   STRING GLOBAL                \
4619: 0000:     RECALLS.FILE.NAME$,        \
4620: 0000:                                \
4621: 0000:     RECALLS.REFERENCE$,        \ 8 bytes UPD  - Key is reference + RECALLS.CHAIN%
4622: 0000:     RECALLS.TYPE$,             \ 1 byte  ASC  - E = Emergency
4623: 0000:                                \                F = Batch Emergency
4624: 0000:                                \                G = generic items not authorised for sale
4625: 0000:                                \                R = 100% Returns
4626: 0000:                                \                S = Batch 100% Returns
4627: 0000:                                \                W = Withdrawn
4628: 0000:                                \                X = batch Withdrawn
4629: 0000:     RECALLS.DESCRIPTION$,      \ 20 bytes ASC
4630: 0000:     RECALLS.LABEL.TYPE$,       \ 8 bytes ASC
4631: 0000:     RECALLS.SUPPLY.ROUTE$,     \ 1 byte ASC
4632: 0000:     RECALLS.REASON.CODE$,      \ 1 byte ASC
4633: 0000:     RECALLS.BC$,               \ 1 byte ASC
4634: 0000:     RECALLS.ACTIVE.DATE$,      \ 8 bytes ASC  - YYYYMMDD
4635: 0000:     RECALLS.DUE.BY.DATE$,      \ 8 bytes ASC  - YYYYMMDD
4636: 0000:     RECALLS.COMPLETION.DATE$,  \ 8 bytes ASC  - YYYYMMDD
4637: 0000:     RECALLS.STATUS$,           \ 1 byte ASC   - N = Not Actioned, A = Actioned, P = Partially Actioned
4638: 0000:     RECALLS.BATCH.NUM$,        \ 30 bytes ASC
4639: 0000:     RECALLS.ITEM.COUNT$,       \ 4 bytes ASC  - Total count of items in this recall
4640: 0000:                                \
4641: 0000:                                \ The following 8 bytes are repeated for the number of items in this part
4642: 0000:                                \ of the recall chain - up to 50 items per chain.
4643: 0000:     RECALLS.ITEM.CODE$(1),     \ 4 bytes PD   - 6 digit Item Code
4644: 0000:     RECALLS.ITEM.STOCK$(1),    \ 2 bytes PD   - SPACES if not yet actioned                         !BBG
4645: 0000:     RECALLS.SESS.STOCK$(1),    \ 2 bytes PD   - 4 digit session stock count - used only by the PPC !BBG
4646: 0000:     RECALLS.ITEM.UPT.FLAG$(1), \ 1 byte ASC   - used by the PPC only - Y = actioned, N - reset, space = unactioned
4647: 0000:                                \
4648: 0000:     RECALLS.FILLER$            !
4649: 0000:     
4650: 0000:   INTEGER*1 GLOBAL             \
4651: 0000:     RECALLS.CHAIN%
4652: 0000:     
4653: 0000:   INTEGER*2 GLOBAL             \
4654: 0000:     RECALLS.RECL%,             \
4655: 0000:     RECALLS.KEYL%,             \
4656: 0000:     RECALLS.REPORT.NUM%,       \
4657: 0000:     RECALLS.SESS.NUM%,         \
4658: 0000:     RECALLS.MAX.REC.ITEMS%
4659: 0000: 
4660: 0000: 
4661: 0000:  %INCLUDE DELVIDEC.J86                    ! 2.7SH
4662: 0000: \/******************************************************************/
4663: 0000: \/*                                                                */
4664: 0000: \/* DELVINDX FILE GLOBAl VARIABLE DECLARATIONS                     */
4665: 0000: \/*                                                                */
4666: 0000: \/* REFERENCE   : DELVIDEC.J86                                     */
4667: 0000: \/*                                                                */
4668: 0000: \/* VERSION A.          Stuart Highley              14 July 2008   */
4669: 0000: \/*                                                                */
4670: 0000: \/* VERSION B.          Stuart Highley               18 Dec 2008   */
4671: 0000: \/* Make file fixed rec length.                                    */
4672: 0000: \/******************************************************************/
4673: 0000: 
4674: 0000:    STRING GLOBAL                    \
4675: 0000:       DELVINDX.FILE.NAME$,          \
4676: 0000:       DELVINDX.FILLER$,             \
4677: 0000:       DELVINDX.ASN.NUM$,            \
4678: 0000:       DELVINDX.ASN.CARTON.COUNT$,   \
4679: 0000:       DELVINDX.UOD.LICENCE$,        \
4680: 0000:       DELVINDX.UOD.DESPATCH.DATE$,  \
4681: 0000:       DELVINDX.UOD.BOL.FLAG$,       \
4682: 0000:       DELVINDX.UOD.SEQ$,            \
4683: 0000:       DELVINDX.UOD.PARENT$,         \
4684: 0000:       DELVINDX.UOD.TYPE$,           \
4685: 0000:       DELVINDX.UOD.EXP.DEL.DATE$
4686: 0000: 
4687: 0000:    INTEGER*2 GLOBAL             \
4688: 0000:       DELVINDX.REPORT.NUM%,     \
4689: 0000:       DELVINDX.SESS.NUM%
4690: 0000: 
4691: 0000: \/******************************************************************/
4692: 0000:  %INCLUDE UODOTDEC.J86                    ! 2.7SH
4693: 0000: \*******************************************************************************
4694: 0000: \***
4695: 0000: \***    UOD Outers FILE GLOBAl VARIABLE DECLARATIONS
4696: 0000: \***
4697: 0000: \***    REFERENCE   : UODOTDEC.J86
4698: 0000: \***
4699: 0000: \***    VERSION A.              Stuart Highley                  14th Jul 2008
4700: 0000: \***
4701: 0000: \***    VERSION B.              Mark Goode                      10th Dec 2008
4702: 0000: \***    Add summary record read/write functionality.
4703: 0000: \***
4704: 0000: \***    REVISION 1.8.           Robert Cowey                    14th Jan 2009
4705: 0000: \***    Changes for 10A PosUOD fixes creating SSC04.286 Rv 1.3.
4706: 0000: \***    No new variables but defined new function UODOT.REC$.
4707: 0000: \***
4708: 0000: \***    VERSION C.              Mark Walker                     18th Feb 2015
4709: 0000: \***    F391 HUMSS UOD Messaging
4710: 0000: \***    Includes the following changes:
4711: 0000: \***    - Defined UOD number field.
4712: 0000: \***    - Various coding standards related changes (uncommented).
4713: 0000: \***
4714: 0000: \*******************************************************************************
4715: 0000: 
4716: 0000:     STRING GLOBAL                                                       \
4717: 0000:         UODOT.AUDIT.OP.ID$,                                             \
4718: 0000:         UODOT.BOOKED.DATE$,                                             \
4719: 0000:         UODOT.BOOKED.TIME$,                                             \
4720: 0000:         UODOT.CHILD.LICENCE$(1),                                        \
4721: 0000:         UODOT.CHILD.TYPE$(1),                                           \
4722: 0000:         UODOT.DESPATCH.DATE$,                                           \
4723: 0000:         UODOT.DRVR.DEL.DATE$,                                           \
4724: 0000:         UODOT.DRVR.DEL.TIME$,                                           \
4725: 0000:         UODOT.DRVR.ID$,                                                 \
4726: 0000:         UODOT.EST.DEL.DATE$,                                            \
4727: 0000:         UODOT.FILE.NAME$,                                               \
4728: 0000:         UODOT.FILLER$,                                                  \
4729: 0000:         UODOT.IMMEDIATE.PARENT$,                                        \
4730: 0000:         UODOT.LEVEL$,                                                   \
4731: 0000:         UODOT.LICENCE$,                                                 \
4732: 0000:         UODOT.OPEN.FLAG$,                                               \
4733: 0000:         UODOT.REASON$,                                                  \
4734: 0000:         UODOT.STATUS$,                                                  \
4735: 0000:         UODOT.STORE.OP.ID$,                                             \
4736: 0000:         UODOT.SUMMARY.STATUS$,                                          \   !BMG
4737: 0000:         UODOT.TYPE$,                                                    \
4738: 0000:         UODOT.ULTIMATE.PARENT$,                                         \
4739: 0000:         UODOT.UOD.NUMBER$,                                              \   !CMW
4740: 0000:         UODOT.WAREHOUSE.AREA$
4741: 0000: 
4742: 0000:     INTEGER*1 GLOBAL                                                    \
4743: 0000:         UODOT.BOL,                                                      \
4744: 0000:         UODOT.SDPD
4745: 0000: 
4746: 0000:     INTEGER*2 GLOBAL                                                    \
4747: 0000:         UODOT.AUDITED,                                                  \
4748: 0000:         UODOT.AUTO,                                                     \
4749: 0000:         UODOT.BOOKED,                                                   \
4750: 0000:         UODOT.CONTROLLER,                                               \
4751: 0000:         UODOT.GIT.MISMATCH,                                             \
4752: 0000:         UODOT.KEYL%,                                                    \
4753: 0000:         UODOT.MAX.CHILDREN%,                                            \
4754: 0000:         UODOT.MC70,                                                     \
4755: 0000:         UODOT.NUM.CHILDREN%,                                            \
4756: 0000:         UODOT.NUM.ITEMS%,                                               \
4757: 0000:         UODOT.PARTIAL,                                                  \
4758: 0000:         UODOT.PDT,                                                      \
4759: 0000:         UODOT.RECL%,                                                    \
4760: 0000:         UODOT.REPORT.NUM%,                                              \
4761: 0000:         UODOT.RF,                                                       \
4762: 0000:         UODOT.SEQ%,                                                     \
4763: 0000:         UODOT.SESS.NUM%,                                                \
4764: 0000:         UODOT.STOCK.UPDATED
4765: 0000: 
4766: 0000:  %INCLUDE AFDEC.J86                       ! 2.7SH
4767: 0000: 
4768: 0000: \REM
4769: 0000: \*******************************************************************************
4770: 0000: \*******************************************************************************
4771: 0000: \***
4772: 0000: \***    %INCLUDE FOR GSA AUTHORISATION FILE VARIABLE DECLARATIONS
4773: 0000: \***
4774: 0000: \***        REFERENCE   :  AFDEC (J86)
4775: 0000: \***
4776: 0000: \***        FILE TYPE   :  Keyed
4777: 0000: \***
4778: 0000: \***    The GSA Authorisation File (EALAUTH.DAT) should not be confused with
4779: 0000: \***    the Operating System Authorisation File (ADXCSOUF.DAT).
4780: 0000: \***
4781: 0000: \***    VERSION A.              ROBERT COWEY.                       18 AUG 1992.
4782: 0000: \***    Original version created by merging AFFLDD and AFNUMD.
4783: 0000: \***
4784: 0000: \***    VERSION B.              Steve Windsor                          Nov 1992.
4785: 0000: \***    Addition of new fields for the CASTLE project.
4786: 0000: \***    Supervisor flag and operator model.
4787: 0000: \***
4788: 0000: \***    VERSION C.              ROBERT COWEY.                       03 MAR 1994.
4789: 0000: \***    Defined fields DATE.PSWD.CHANGE$, and MODEL.FLAGS.1% and ...2%.
4790: 0000: \***
4791: 0000: \***    VERSION D.             Mike Bishop                          30 JUN 2004
4792: 0000: \***    Defined field AF.STAFF.NUM$ AF.EMPLOYEE.FLAG$
4793: 0000: \***
4794: 0000: \***    VERSION E.             Alan Carr  (AJC)                      4 Oct 2004
4795: 0000: \***    Defined field AF.RECEIPT.NAME$
4796: 0000: \***
4797: 0000: \***    VERSION F.             Alan Carr  (AJC)                     31 Jan 2005
4798: 0000: \***    Defined field AF.GROUP.CODE$
4799: 0000: \***
4800: 0000: \***    REVISION 1.6.                ROBERT COWEY.                15 JUN 2009.
4801: 0000: \***    Changes for A9C POS improvements project.
4802: 0000: \***    Used up last available three bytes of EALAUTH user data by redefining 
4803: 0000: \***    remaining AF.USER$ variable as AF.BIRTH.DATE$.
4804: 0000: \***    See IBM manual "GSA Programming Guide" Appendix A-27 for file layout 
4805: 0000: \***    describing INDICAT flags (and position of original 20 bytes user data).
4806: 0000: \***
4807: 0000: \***    REVISION 1.7.                ROBERT COWEY.                22 JUN 2009.
4808: 0000: \***    Changes for A9C POS improvements project creating PSB99.286 Rv 1.8.
4809: 0000: \***    Defect 3247 - Redefined AF.BIRTH.DATE$ format as UPD-hex DDMCYY.
4810: 0000: \***    Description text change only - No code changes to this file.
4811: 0000: \***
4812: 0000: \*******************************************************************************
4813: 0000: \*******************************************************************************
4814: 0000: 
4815: 0000: 
4816: 0000:     STRING GLOBAL \
4817: 0000:         AF.BIRTH.DATE$,       \ ! 3 byte DDMCYY UPD/hex format         ! 1.7 RC
4818: 0000:                               \ ! M is month  A=Oct B=Nov C=Dec        ! 1.7 RC
4819: 0000:                               \ ! C is century  0=19xx 1=20xx          ! 1.7 RC
4820: 0000:         AF.DATE.PSWD.CHANGE$, \ ! 3 bytes UPD                          ! CRC
4821: 0000:         AF.FILE.NAME$, \
4822: 0000:         AF.FLAGS.01.12$, \      ! 15 bytes
4823: 0000:         AF.FLAGS.13.16$, \      ! 4 bytes
4824: 0000:         AF.OPERATOR.NAME$,\     ! 20 bytes
4825: 0000:         AF.OPERATOR.NO$, \      ! 4 byte UPD (key)
4826: 0000:         AF.OPTIONS.KEY$, \      ! 1 byte UPD
4827: 0000:         AF.PASSWORD$, \         ! 4 byte UPD
4828: 0000:         AF.RECEIPT.NAME$, \     ! 12 bytes                             ! AJC
4829: 0000:         AF.STAFF.NUM$, \         ! 4 byte UPD                          DMB
4830: 0000:         AF.EMPLOYEE.FLAG$, \     ! 1 byte UPD                          DMB
4831: 0000:         AF.GROUP.CODE$, \       ! 1  byte UPD                          AJC
4832: 0000: \       AF.USER$, \             ! 3  bytes                             ! 1.6 RC
4833: 0000:         AF.SUP.FLAG$, \         ! 1  byte                              BSJW
4834: 0000:         AF.OP.MODEL$            ! 3  bytes                             BSJW
4835: 0000: 
4836: 0000:     INTEGER*1 GLOBAL \
4837: 0000:         AF.INDICAT4%, \
4838: 0000:         AF.INDICAT5%, \
4839: 0000:         AF.INDICAT6%, \
4840: 0000:         AF.INDICAT7%, \
4841: 0000:         AF.INDICAT8%, \
4842: 0000:         AF.INDICAT9%, \
4843: 0000:         AF.INDICAT10%, \
4844: 0000:         AF.INDICAT11%, \
4845: 0000:         AF.INDICAT12%, \
4846: 0000:         AF.INDICAT13%, \
4847: 0000:         AF.INDICAT14%, \
4848: 0000:         AF.INDICAT15%, \
4849: 0000:         AF.INDICAT16%, \
4850: 0000:         AF.REPORT.NUM%
4851: 0000: 
4852: 0000:     INTEGER*2 GLOBAL \
4853: 0000:         AF.INDICAT1%, \
4854: 0000:         AF.INDICAT2%, \
4855: 0000:         AF.INDICAT3%, \
4856: 0000:         AF.MODEL.FLAGS.1%, \                                           ! CRC
4857: 0000:         AF.MODEL.FLAGS.2%, \                                           ! CRC
4858: 0000:         AF.RECL%, \
4859: 0000:         AF.SESS.NUM%
4860: 0000: 
4861: 0000:  %INCLUDE UBDEC.J86                       ! 2.7SH
4862: 0000: \/******************************************************************/
4863: 0000: \/*                                                                */
4864: 0000: \/* UOD Banked FILE GLOBAL VARIABLE DECLARATIONS                   */
4865: 0000: \/*                                                                */
4866: 0000: \/* REFERENCE   : UBDEC.J86                                        */
4867: 0000: \/*                                                                */
4868: 0000: \/* VERSION A.          Stuart Highley            14 August 2008   */
4869: 0000: \/                                                                 */
4870: 0000: \/* VERSION B.          Charles Skadorwa          9 October 2008   */
4871: 0000: \/*                                                                */
4872: 0000: \/* VERSION C.          Stuart Highley            16 December 2008 */
4873: 0000: \/* Look carefully below and ye shall find my change.              */
4874: 0000: \/*                                                                */
4875: 0000: \/* VERSION D.          Mark Goode                22nd December 08 */
4876: 0000: \/* Changes to the fields on the audit record                      */
4877: 0000: \/******************************************************************/
4878: 0000: 
4879: 0000:    STRING GLOBAL                \
4880: 0000:       UB.TEMP.NAME$,            \
4881: 0000:       UB.FILE.NAME$,            \
4882: 0000:       UB.REC$,                  \
4883: 0000:       UB.REC.TYPE$,             \
4884: 0000:       UB.OP.ID$,                \
4885: 0000:       UB.METHOD$,               \
4886: 0000:       UB.REPORT.RQD$,           \
4887: 0000:       UB.LICENCE$,              \
4888: 0000:       UB.DESPATCH.DATE$,        \
4889: 0000:       UB.BOOKED.DATE$,          \
4890: 0000:       UB.BOOKED.TIME$,          \
4891: 0000:       UB.BOOK.TYPE$,            \
4892: 0000:       UB.BAR.CODE$,             \
4893: 0000:       UB.QTY$,                  \
4894: 0000:       UB.DRVR.ID$,              \
4895: 0000:       UB.DRVR.CHCK.DATE$,       \
4896: 0000:       UB.DRVR.CHCK.TIME$,       \
4897: 0000:       UB.DRVR.GIT.MATCH$,       \
4898: 0000:       UB.REC.COUNT$,            \
4899: 0000:       UB.ONIGHT.DELIVERY.TYPE$, \                                !BCSk
4900: 0000:       UB.DRIVER.CHECKIN.REQD$,  \                                !BCSk
4901: 0000:       UB.DRVR.REJECTED$,        \ "Y" or "N" on batch rec,       !CSH
4902: 0000:                                 \ " " on session rec             !CSH
4903: 0000:       UB.DRVR.CONFIRM.SCAN$,    \                                !BCSk
4904: 0000:       UB.BOOKED.STATUS$                                          !DMG
4905: 0000:       
4906: 0000:    INTEGER*2 GLOBAL             \
4907: 0000:       UB.RECL%,                 \
4908: 0000:       UB.REPORT.NUM%,           \
4909: 0000:       UB.SESS.NUM%
4910: 0000: 
4911: 0000: \/******************************************************************/
4912: 0000:  
4913: 0000: \*****************************************************************************
4914: 0000: \*****************************************************************************
4915: 0000: \***                                                                       ***
4916: 0000: \***      V A R I A B L E   D E C L A R A T I O N S                        ***
4917: 0000: \***                                                                       ***
4918: 0000: \*****************************************************************************
4919: 0000: \*****************************************************************************
4920: 0000: 
4921: 0000: INTEGER*1 GLOBAL                          \
4922: 0000:         ASN.ACTIVE%,                      \ 2.5NWB
4923: 0000:         BC.CHECK%(1),                     \ FLC
4924: 0000:         ERROR.COUNT%,                     \
4925: 0000:         REC.MAX%,                         \
4926: 0000:         LDT.TRANSMIT,                     \ HDS
4927: 0000:         NESTING.LEVEL%,                   \ FLC
4928: 0000:         TRUE,                             \ HDS
4929: 0000:         FALSE,                            \ HDS
4930: 0000:         PORT.EVENT%,                      \ FLC
4931: 0000:         RE.CHAIN,                         \ DSW
4932: 0000:         WARM.START,                       \ DSW
4933: 0000:         GAP,                              \ GMJK
4934: 0000:         CCBUF.ENTRY.REQUIRED,             \ GMJK
4935: 0000:         CCBUF.RECS.PRESENT,               \ GMJK
4936: 0000:         CCREJ.RECS.PRESENT,               \ 2.2JAS
4937: 0000:         DETAIL.RECORDS.RECEIVED,          \ GMJK
4938: 0000:         END.OF.CCTMP,                     \ GMJK
4939: 0000:         END.OF.FILE,                      \ GMJK
4940: 0000:         TABLE.FULL,                       \ GMJK
4941: 0000:         REWKF.RECS.PRESENT,               \ 2.6BG
4942: 0000:         ALL.PRODUCTS                      ! 1.8DA
4943: 0000: \       ALLOW.CSR.PROCESSING              ! 1.2 !2.5NWB
4944: 0000: 
4945: 0000: INTEGER*2 GLOBAL                          \
4946: 0000:         ACTUAL.NUM.OF.UODS%,              \ FLC
4947: 0000:         BTSCNT%,                          \2.3CS
4948: 0000:         EANCNT%,                          \2.3CS
4949: 0000:         COUNTED.ITEMS%,                   \ FLC
4950: 0000: \       CSR.ITEMS.COUNT%,                 \     !2.5NWB
4951: 0000:         CSR.AUDIT.SESS.NUM%,              \ CDS
4952: 0000:         CURRENT.REPORT.NUM%,              \ DLC
4953: 0000:         EXPECTED.NUM.OF.UODS%,            \ FLC
4954: 0000:         FILE.HEADER.LISTS%,               \ FLC
4955: 0000:         FILE.TRAILER.LISTS%,              \ FLC
4956: 0000:         FIRST.TIME,                       \ CDS
4957: 0000:         ORDERS.EXPECTED%,                 \ CDS
4958: 0000:         INT.DELAY%,                       \ FLC
4959: 0000:         ITEMS.BOOKED.IN%,                 \ CDS
4960: 0000:         ITEM.COUNT%,                      \ FLC
4961: 0000:         LINES.BOOKED.IN%,                 \ CDS
4962: 0000:         LINES.ADDED%,                     \ CDS
4963: 0000:         LINE.TOTAL%,                      \ CDS
4964: 0000:         LIST.COUNT%,                      \ FLC
4965: 0000:         LIST.TRAILER.ITEMS%,              \ FLC
4966: 0000:         ONORD.COUNT%,                     \
4967: 0000:         ORDERS.FOUND%,                    \ CDS
4968: 0000:         RC%,                              \ DLC
4969: 0000:         SINGLES.ADDED%,                   \ CDS
4970: 0000:         TYPE.17.WRITTEN,                  \ CDS
4971: 0000:         UOD.NUM.ITEMS%,                   \ FLC
4972: 0000:         ACTUAL.NUM%,                      \ GMJK
4973: 0000:         ACTUAL.UOD.ITEMS%,                \ GMJK
4974: 0000:         CURR.ITEM%,                       \ GMJK
4975: 0000:         CURR.REC%,                        \ GMJK
4976: 0000:         CURR.SUBSCRIPT%,                  \ GMJK
4977: 0000:         EXPECTED.NUM%,                    \ GMJK
4978: 0000:         FILE.NUM%,                        \ GMJK
4979: 0000:         ITEM.POS%,                        \ GMJK
4980: 0000:         MAX.TABLE.SIZE%,                  \ GMJK
4981: 0000:         NUM.BARCODES%,                    \ GMJK
4982: 0000:         NUM.BC.EXTRACTED%,                \ GMJK
4983: 0000:         NUM.ITEMS%,                       \ GMJK
4984: 0000:         NUM.STATUS.O.C.X.UODS%,           \ 1.4
4985: 0000:         NUM.OF.CANCELLED.UODS%,           \ 1.4
4986: 0000:         NUM.OF.DESPATCHED.UODS%,          \ 1.4
4987: 0000:         NUM.RECORDS%,                     \ GMJK
4988: 0000:         RECORD$,                          \ GMJK
4989: 0000:         REC.NUM%,                         \ GMJK
4990: 0000:         RECS.PER.SECTOR%,                 \ GMJK
4991: 0000:         BC%,CG%,PG%,                      \ 1.8DA
4992: 0000:         SECTOR%                           ! GMJK
4993: 0000: 
4994: 0000: INTEGER*4 GLOBAL                          \
4995: 0000:         LAST.ACTIVE%,                     \
4996: 0000:         LAST.STOCKTAKE%,                  \ 1.5
4997: 0000:         TIMEOUT.VALUE%                    ! FLC
4998: 0000: 
4999: 0000: 
5000: 0000: STRING GLOBAL                             \ for modules 00, 01 , 02 , 03 and 04
5001: 0000:         ACK$,                             \ 1.5
5002: 0000:         ALL.FILES.CLOSED$,                \
5003: 0000:         APPL$,                            \ FLC
5004: 0000:         APPLICATION.NO$,                  \
5005: 0000:         BAR.CODES$(1),                    \ FLC
5006: 0000:         BCSMF.RECORD$,                    \ GMJK
5007: 0000:         BOOKING.STARTED$,                 \ CDS
5008: 0000:         BOOKING.ENDED$,                   \ CDS
5009: 0000:         CCUOD.OPEN.FLAG$,                 \ GMJK
5010: 0000:         CCLAM.OPEN.FLAG$,                 \ 1.4
5011: 0000:         CCITM.OPEN.FLAG$,                 \ GMJK
5012: 0000:         CCTRL.OPEN.FLAG$,                 \ GMJK
5013: 0000:         CCDMY.OPEN.FLAG$,                 \ GMJK
5014: 0000:         CCTMP.OPEN.FLAG$,                 \ GMJK
5015: 0000:         CCBUF.OPEN.FLAG$,                 \ GMJK
5016: 0000:         CCUPF.OPEN.FLAG$,                 \ HMJK
5017: 0000:         CCWKF.OPEN.FLAG$,                 \ GMJK
5018: 0000:         STKRC.OPEN.FLAG$,                 \ 1.8DA
5019: 0000:         XGCF.OPEN.FLAG$,                  \ 1.8DA
5020: 0000:         STKEX.OPEN.FLAG$,                 \ 1.8DA
5021: 0000:         STKIF.OPEN.FLAG$,                 \ 1.8DA
5022: 0000:         LOCCNT.OPEN.FLAG$,                \ 1.8DA
5023: 0000:         STKTF.OPEN.FLAG$,                 \ 1.8DA
5024: 0000:         STKDC.OPEN.FLAG$,                 \ 1.8DA
5025: 0000: \       CSR.LIST.ALREADY.PROCESSED.FLAG$, \ !2.5NWB
5026: 0000: \       CSR.OPEN.FLAG$,                   \ !2.5NWB
5027: 0000:         CHKBF.OPEN.FLAG$,                 \ DSW
5028: 0000:         GAPBF.OPEN.FLAG$,                 \ SDH  2.3CS !2.4BG
5029: 0000:         PLLOL.OPEN.FLAG$,                 \ 2.3CS
5030: 0000:         PLLDB.OPEN.FLAG$,                 \ 2.3CS
5031: 0000:         PLLDB.TABLE$(1),                  \ 2.3CS
5032: 0000:         EAN.TABLE$(1),                    \ 2.3CS
5033: 0000: \       CITEM.OPEN.FLAG$,                 \ !2.5NWB
5034: 0000: \       CIMF.OPEN.FLAG$,                  \ !2.5NWB
5035: 0000: \       CSRWF.OPEN.FLAG$,                 \ !2.5NWB
5036: 0000: \       CSRBF.OPEN.FLAG$,                 \ !2.5NWB
5037: 0000:         CSR.AUDIT.FILE$,                  \ CDS
5038: 0000:         CSR.AUDIT.DATA$,                  \ CDS
5039: 0000:         CSR.AUDIT.OPEN.FLAG$,             \ CDS
5040: 0000:         CURR.LIST$,                       \ FLC
5041: 0000:         CURR.TERMINAL$,                   \
5042: 0000:         CURRENT.CODE$,                    \ DLC
5043: 0000:         DATA.IN$,                         \
5044: 0000:         DATE.TODAY$,                      \ FLC
5045: 0000:         STKMQ.OPEN.FLAG$,                 \ CDS
5046: 0000:         STLDT.OPEN.FLAG$,                 \ 1.6
5047: 0000:         BCSMF.OPEN.FLAG$,                 \ CDS
5048: 0000:         IEF.OPEN.FLAG$,                   \ CDS
5049: 0000:         DATA.FILES.REQ$,                  \ GMJK
5050: 0000:         DETAIL.RECORDS.RECEIVED$,         \ FLC
5051: 0000:         DIREC.OPEN.FLAG$,                 \ CDS
5052: 0000:         DIRORD.OPEN.FLAG$,                \ CDS
5053: 0000:         DIRSUP.OPEN.FLAG$,                \ CDS
5054: 0000:         DIRWF.OPEN.FLAG$,                 \ CDS
5055: 0000:         EPSOM.OPEN.FLAG$,                 \ FLC
5056: 0000:         LDTAF.OPEN.FLAG$,                 \ GMJK
5057: 0000:         LDTCF.OPEN.FLAG$,                 \ CDS
5058: 0000:         DRSMQ.OPEN.FLAG$,                 \ CDS
5059: 0000:         FILE.OPERATION$,                  \ DLC
5060: 0000: \       FIRST.CSR.LIST.FOR.PDT$,          \ 2.5NWB
5061: 0000:         FIRST.EOT.FOR.THIS.PDT$,          \
5062: 0000:         FIRST.ITEM.TO.BE.PROCESSED$,      \
5063: 0000:         FIRST.RETURN$,                    \ FLC
5064: 0000:         FPF.OPEN.FLAG$,                   \
5065: 0000:         HOLD.FLAG$,                       \
5066: 0000:         IDF.OPEN.FLAG$,                   \
5067: 0000:         IDSOF.OPEN.FLAG$,                 \ ELC
5068: 0000:         IRF.OPEN.FLAG$,                   \ FLC
5069: 0000:         IMSTC.OPEN.FLAG$,                 \1.7BG
5070: 0000:         LAST.ACTIVE.DATE$,                \
5071: 0000:         LAST.STOCKTAKE.DATE$,             \ 1.5
5072: 0000:         LAST.MESSAGE$,                    \
5073: 0000:         LOG.ON.DATE$,                     \ GMJK
5074: 0000:         LOG.ON.TIME$,                     \ GMJK
5075: 0000:         LDTBF.HEADER.WRITTEN$,            \ ELC
5076: 0000:         LDTBF.OPEN.FLAG$,                 \ ELC
5077: 0000:         LIST.ABANDONED$,                  \
5078: 0000:         LIST.BC$,                         \ FLC
5079: 0000:         LIST.TRANSMIT$(1),                \ FLC
5080: 0000:         LSSST.OPEN.FLAG$,                 \1.7BG
5081: 0000:         MONITORED.PORT$,                  \ DLC
5082: 0000:         NUM.SECTOR$,                      \ GMJK
5083: 0000:         ONORD.OPEN.FLAG$,                 \
5084: 0000:         ONORD.DELETED$(1),                \
5085: 0000:         ORDER.LINE.TABLE$(1),             \ CDS
5086: 0000:         PCHK.OPEN.FLAG$,                  \
5087: 0000:         PDT.ACTION$,                      \ FLC
5088: 0000:         PIITM.OPEN.FLAG$,                 \ FLC
5089: 0000:         PILST.OPEN.FLAG$,                 \ FLC
5090: 0000:         PIPE.OUT$,                        \
5091: 0000:         PDTWF.OPEN.FLAG$,                 \ FLC
5092: 0000:         PK2$,                             \
5093: 0000:         PK4$,                             \
5094: 0000:         PORT.STRING$,                     \
5095: 0000:         PREV.LOGGED.STATE$,               \ ELC
5096: 0000: \       PROCESS.CSR.WORKFILE$,            \ !2.5NWB
5097: 0000:         PSS38.STATUS$,                    \ FLC
5098: 0000:         RB.OPEN.FLAG$,                    \ 2.6BG
5099: 0000:         REWKF.OPEN.FLAG$,                 \ 2.6BG
5100: 0000:         RECALLS.OPEN.FLAG$,               \ 2.6BG
5101: 0000:         DELVINDX.OPEN.FLAG$,              \ 2.7SH
5102: 0000:         AF.OPEN.FLAG$,                    \ 2.7SH
5103: 0000:         UB.OPEN.FLAG$,                    \ 2.7SH
5104: 0000:         RECEIVE.STATE$,                   \
5105: 0000:         REQ.LIST.STORE$(1),               \ FLC
5106: 0000:         REQ.LIST.DATA$(1),                \ FLC
5107: 0000:         SAVED.ORDER.NO$,                  \ CDS
5108: 0000:         SAVED.ORDER.SUFFIX$,              \ CDS
5109: 0000:         SAVED.PAGE.NO$,                   \ CDS
5110: 0000:         SAVED.STORE.NUMBER$,              \ 1.8DA
5111: 0000:         SAVED.SUPPLIER.NO$,               \ CDS
5112: 0000:         SECTOR$,                          \ GMJK
5113: 0000:         SOFTS.OPEN.FLAG$,                 \ GMJK
5114: 0000:         SOH$,                             \ 1.5
5115: 0000:         STORED.UOD.HEADER$,               \ FLC
5116: 0000:         STORE.NUMBER$,                    \ 1.5
5117: 0000:         STOCK.OPEN.FLAG$,                 \1.7BG
5118: 0000:         STX$,                             \ FLC
5119: 0000:         STKBF.OPEN.FLAG$,                 \ 1.5
5120: 0000:         SXTMP.OPEN.FLAG$,                 \ 1.5
5121: 0000:         T.DATE$,                          \ 1.5
5122: 0000:         T.TIME$,                          \ 1.5
5123: 0000:         TEMP.TIME$,                       \ GMJK
5124: 0000:         TRAILER.LIST$,                    \ FLC
5125: 0000:         UOD.NUMBER$,                      \ FLC
5126: 0000:         UOD.NUM.ITEMS$,                   \ FLC
5127: 0000:         UOD.OPEN.FLAG$,                   \ FLC
5128: 0000:         UOD.STATUS.FLAG$,                 \ FLC
5129: 0000:         UODBF.OPEN.FLAG$,                 \ FLC
5130: 0000:         UODTF.OPEN.FLAG$,                 \ FLC
5131: 0000:         UNITS.OPEN.FLAG$
5132: 0000: 
5133: 0000: STRING GLOBAL                             \ GMJK
5134: 0000:         ITEM.STORAGE$,                    \ GMJK
5135: 0000:         ITEM.DESC.STORAGE$,               \ GMJK
5136: 0000:         BARCODE.DATA$,                    \ GMJK
5137: 0000:         BARCODE.INDEX$,                   \ GMJK
5138: 0000:         BARCODE.INDEX.STORAGE$,           \ GMJK
5139: 0000:         BARCODE.STORAGE$,                 \ GMJK
5140: 0000:         ITEM.DATA$,                       \ GMJK
5141: 0000:         ITEM.DATA.DESC$,                  \ GMJK
5142: 0000:         ITEM.POS.TABLE$(1),               \ GMJK
5143: 0000:         CCUOD.TABLE$(1),                  \ GMJK
5144: 0000:         CCLAM.TABLE$(1),                  \ 1.4
5145: 0000:         DATA.FILES.REQUIRED$,             \ GMJK
5146: 0000:         FINISH.DATE$,                     \ GMJK
5147: 0000:         FINISH.TIME$,                     \ GMJK
5148: 0000:         LDT.CCUOD.UPDATE.DATE$,           \ GMJK
5149: 0000:         LDT.CCUOD.UPDATE.TIME$,           \ GMJK
5150: 0000:         LDT.DATE.TIME$,                   \ GMJK
5151: 0000:         LDT.LAST.CLAIM.NUM$,              \ GMJK
5152: 0000:         STKCF.OPEN.FLAG$,                 \ 1.8DA
5153: 0000:         STKMF.OPEN.FLAG$,                 \ 1.8DA
5154: 0000:         CONCEPT.GROUPS$(1),               \ 1.8DA
5155: 0000:         PRODUCT.GROUPS$(1),               \ 1.8DA
5156: 0000:         BUSINESS.CENTRES$(1),             \ ! 1.8DA 2.1JAS
5157: 0000:         SOPTS.OPEN.FLAG$,                 \ ! 2.1JAS
5158: 0000:         LOCAL.OPEN.FLAG$,                 \ ! 2.1JAS
5159: 0000:         TSF.OPEN.FLAG$,                   \ ! 2.1JAS 2.2JAS
5160: 0000:         CCREJ.OPEN.FLAG$,                 \ 2.2JAS
5161: 0000:         CREDIT.CLAIM.FLAG$                ! 2.2JAS
5162: 0000: 
5163: 0000: 
5164: 0000: STRING GLOBAL                             \
5165: 0000:         BATCH.SCREEN.FLAG$,               \
5166: 0000:         EXP.STATES$,                      \
5167: 0000:         MODULE.NUMBER$,                   \
5168: 0000:         OPERATOR.ID$,                     \
5169: 0000:         STATE$,                           \
5170: 0000:         TRANS.FROM$,                      \
5171: 0000:         TRANS.TO$
5172: 0000: 
5173: 0000:  STRING GLOBAL                            \
5174: 0000:         REC.CHECK$(1),                    \
5175: 0000:         V.TAB$(1)
5176: 0000: 
5177: 0000: \*****************************************************************************
5178: 0000: \*****************************************************************************
5179: 0000: \***                                                                       ***
5180: 0000: \*** E X T E R N A L   F U N C T I O N   D E C L A R A T I O N S           ***
5181: 0000: \***                                                                       ***
5182: 0000: \*****************************************************************************
5183: 0000: \*****************************************************************************
5184: 0000: 
5185: 0000: \*****************************************************************************
5186: 0000: \***   include external definitions for the following functions
5187: 0000: \***
5188: 0000: \***     ADXERROR
5189: 0000: \***     ADXSERVE
5190: 0000: \***     ADXSERCL
5191: 0000: \***     APPLICATION.LOG             01
5192: 0000: \***     READ.NEXT.IEF               11
5193: 0000: \***     SORT.TABLE                  14
5194: 0000: \***     CONV.TO.HEX                 16
5195: 0000: \***     CONV.TO.STRING              17
5196: 0000: \***     SESS.NUM.UTILITY            20
5197: 0000: \***     STKMQ
5198: 0000: \***     BCSMF
5199: 0000: \***     IDF
5200: 0000: \***     INVOK
5201: 0000: \***     PCHK
5202: 0000: \***     UOD
5203: 0000: \***     UODBF
5204: 0000: \***     UODTF
5205: 0000: \***     STKBF
5206: 0000: \***     SXTMP
5207: 0000: \***     SSPSC
5208: 0000: \***     BTCS
5209: 0000: \***     PRINT
5210: 0000: \***     SOPTS
5211: 0000: \***     LOCAL
5212: 0000: \***
5213: 0000: \*****************************************************************************
5214: 0000: 
5215: 0000:  %INCLUDE ADXERROR.J86
5216: 0000: \******************************************************************************
5217: 0000: \******************************************************************************
5218: 0000: \***                                                                        ***
5219: 0000: \***    %INCLUDE FOR FUNCTION ADXERROR (an I.B.M. system function)          ***
5220: 0000: \***                                                                        ***
5221: 0000: \***         AUTHOR        :  Stephen Kelsey                                ***
5222: 0000: \***                                                                        ***
5223: 0000: \***         DATE WRITTEN  :  21st February 1986                            ***
5224: 0000: \***                                                                        ***
5225: 0000: \***         DATE OF LAST REVISION  - 21st February 1986                    ***
5226: 0000: \***                                                                        ***
5227: 0000: \***         VERSION B     :  Stuart William McConnachie  18th March 1997   ***
5228: 0000: \***    Define size of ADXERROR return value from function.  This change    ***
5229: 0000: \***    was introduced by IBM in the 4690 Programming Guide.  Not defining  ***
5230: 0000: \***    this variable can cause Memory Protection Violations at run time.   ***
5231: 0000: \***                                                                        ***
5232: 0000: \******************************************************************************
5233: 0000: \******************************************************************************
5234: 0000: 
5235: 0000:    FUNCTION ADXERROR (TERM%,                                                  \
5236: 0000:                       MSGGRP%,                                                \
5237: 0000:                       MSGNUM%,                                                \
5238: 0000:                       SEVERITY%,                                              \
5239: 0000:                       EVENT.NUM%,                                             \
5240: 0000:                       UNIQUE$) EXTERNAL
5241: 0000: 
5242: 0000:       INTEGER*2  MSGNUM%,                                                     \
5243: 0000:                  TERM%,                                                       \
5244: 0000:                  ADXERROR                                                     !BSWM
5245: 0000: 
5246: 0000:       INTEGER*1 EVENT.NUM%,                                                   \
5247: 0000:                 MSGGRP%,                                                      \
5248: 0000:                 SEVERITY%
5249: 0000: 
5250: 0000:       STRING  UNIQUE$
5251: 0000: 
5252: 0000:    END FUNCTION
5253: 0000: 
5254: 0000:  %INCLUDE ADXSERVE.J86
5255: 0000: \******************************************************************************
5256: 0000: \******************************************************************************
5257: 0000: \***                                                                        ***
5258: 0000: \***    %INCLUDE FOR FUNCTION ADXSERVE (an I.B.M. system function)          ***
5259: 0000: \***                                                                        ***
5260: 0000: \***         AUTHOR        :  Bruce Scriver                                 ***
5261: 0000: \***                                                                        ***
5262: 0000: \***         DATE WRITTEN  :  14th March 1986                               ***
5263: 0000: \***                                                                        ***
5264: 0000: \***         DATE OF LAST REVISION  - 14th March 1986                       ***
5265: 0000: \***                                                                        ***
5266: 0000: \***                                                                        ***
5267: 0000: \******************************************************************************
5268: 0000: \******************************************************************************
5269: 0000: 
5270: 0000:    SUB ADXSERVE (RETURN.CODE%,                                                \
5271: 0000:                  ADX.FUNCTION%,                                               \
5272: 0000:                  ADX.PARM.1%,                                                 \
5273: 0000:                  ADX.PARM.2$)                                                 \
5274: 0000:    EXTERNAL
5275: 0000:   
5276: 0000:       STRING     ADX.PARM.2$
5277: 0000: 
5278: 0000:       INTEGER*2  ADX.FUNCTION%,                                               \
5279: 0000:                  ADX.PARM.1%
5280: 0000: 
5281: 0000:       INTEGER*4  RETURN.CODE%                                                 \
5282: 0000: 
5283: 0000:    END SUB     
5284: 0000: 
5285: 0000:  %INCLUDE ADXSERCL.J86                    ! DSW
5286: 0000: SUB ADXSERCL EXTERNAL
5287: 0000: END SUB
5288: 0000:  %INCLUDE PSBF01E.J86                     ! DLC
5289: 0000: REM \
5290: 0000: \*******************************************************************************
5291: 0000: \*******************************************************************************
5292: 0000: \***
5293: 0000: \***      %INCLUDE FOR EXTERNAL DEFINITION OF FUNCTION APPLICATION.LOG
5294: 0000: \***
5295: 0000: \***                      FUNCTION NUMBER   : PSBF01
5296: 0000: \***
5297: 0000: \***                    INCLUDE REFERENCE : PSBF01E.J86
5298: 0000: \*** 
5299: 0000: \***      Version B           Andrew Wedgeworth          1st July 1992
5300: 0000: \***      Three parameters which passed to the function have been removed.
5301: 0000: \***      APPLICATION.LOG has been added as a variable name (this holds the
5302: 0000: \***      return code).
5303: 0000: \***
5304: 0000: \*******************************************************************************
5305: 0000: 
5306: 0000: 
5307: 0000:    FUNCTION APPLICATION.LOG (MESSAGE.NO%,                                     \
5308: 0000:                              VAR.STRING.1$,                                   \
5309: 0000:                              VAR.STRING.2$,                                   \
5310: 0000:                              EVENT.NO%)  EXTERNAL
5311: 0000: 
5312: 0000:       INTEGER*1 EVENT.NO%
5313: 0000: 
5314: 0000:       INTEGER*2 APPLICATION.LOG,                                       \ GAW
5315: 0000:                 MESSAGE.NO%
5316: 0000: 
5317: 0000:       STRING VAR.STRING.1$,                                            \
5318: 0000:              VAR.STRING.2$
5319: 0000: 
5320: 0000:    END FUNCTION
5321: 0000: 
5322: 0000: \*******************************************************************************
5323: 0000:  %INCLUDE PSBF05E.J86                     ! 1.9BG
5324: 0000: REM\
5325: 0000: \*******************************************************************************
5326: 0000: \*******************************************************************************
5327: 0000: \***
5328: 0000: \***        INCLUDE       : CHECK.BOOTS.CODE external definition
5329: 0000: \***
5330: 0000: \***        REFERENCE     : PSBF05E.J86
5331: 0000: \***
5332: 0000: \***        Version A       Bruce Scriver                  24th February 1986  
5333: 0000: \*** 
5334: 0000: \***        Version B       Andrew Wedgeworth                  15th July 1992 
5335: 0000: \***        Redundant parameters removed, and CHECK.BOOTS.CODE defined as a 
5336: 0000: \***        variable to hold the return code.  
5337: 0000: \***
5338: 0000: \*******************************************************************************
5339: 0000: \*******************************************************************************
5340: 0000: 
5341: 0000:    FUNCTION CHECK.BOOTS.CODE (BOOTS.CODE$)                                     \
5342: 0000:    EXTERNAL
5343: 0000:    ! 3 parameters removed from here                                    ! BAW   
5344: 0000: 
5345: 0000:       STRING BOOTS.CODE$
5346: 0000:    ! 3 variables removed from here                                     ! BAW
5347: 0000:    
5348: 0000:       INTEGER*2 CHECK.BOOTS.CODE                                       ! BAW
5349: 0000:    
5350: 0000: 
5351: 0000:    END FUNCTION
5352: 0000: 
5353: 0000: !%INCLUDE PSBF06E.J86                     ! FLC
5354: 0000:  %INCLUDE PSBF11E.J86                     ! DLC
5355: 0000: REM \
5356: 0000: \*******************************************************************************
5357: 0000: \*******************************************************************************
5358: 0000: \***
5359: 0000: \***    %INCLUDE FOR EXTERNAL DEFINITION OF FUNCTION READ.NEXT.IEF
5360: 0000: \***
5361: 0000: \***
5362: 0000: \***            FUNCTION NUMBER       : PSBF11
5363: 0000: \***
5364: 0000: \***            INCLUDE REFERENCE     : PSBF11E.J86
5365: 0000: \***
5366: 0000: \***            DATE OF LAST AMENDMENT -  3rd March 1986
5367: 0000: \***
5368: 0000: \***     Version B             Andrew Wedgeworth          15th July 1992
5369: 0000: \***     Removal of redundant function parameters.  READ.NEXT.IEF defined as
5370: 0000: \***     a variable to hold the return code.
5371: 0000: \***
5372: 0000: \*******************************************************************************
5373: 0000: \*******************************************************************************
5374: 0000: 
5375: 0000: REM \
5376: 0000: \*******************************************************************************
5377: 0000: \*******************************************************************************
5378: 0000: \***
5379: 0000: \***
5380: 0000: \***            FUNCTION OVERVIEW
5381: 0000: \***            -----------------
5382: 0000: \***
5383: 0000: \***   This function finds and retreives the next bar code in an IEF chain.
5384: 0000: \***   If the code found is the last code in the chain, the function checks that
5385: 0000: \***   the number of codes in the chain is equal to the expected number.  If it
5386: 0000: \***   is not, a message is displayed and logged.  If an error occurs in reading
5387: 0000: \***   the IEF, a message is displayed and logged, and the function returns to
5388: 0000: \***   the calling program with a return code of 1.
5389: 0000: \***
5390: 0000: \***
5391: 0000: \*******************************************************************************
5392: 0000: \*******************************************************************************
5393: 0000: 
5394: 0000:    FUNCTION READ.NEXT.IEF (LAST.BAR.CODE$,                             \
5395: 0000:                            TOTAL.COUNT%,                               \
5396: 0000:                            BOOTS.CODE$)  EXTERNAL
5397: 0000:    ! 3 parameters deleted from here                                    ! BAW			   
5398: 0000: 
5399: 0000:       STRING  BOOTS.CODE$,                                             \
5400: 0000:               LAST.BAR.CODE$
5401: 0000:       ! 3 variables removed from here                                  ! BAW
5402: 0000: 
5403: 0000:       INTEGER*2 READ.NEXT.IEF,                                         \ BAW
5404: 0000:                 TOTAL.COUNT%
5405: 0000:              
5406: 0000: 
5407: 0000: 
5408: 0000:    END FUNCTION
5409: 0000: 
5410: 0000: \*******************************************************************************
5411: 0000:  %INCLUDE PSBF14E.J86                     ! DLC
5412: 0000: REM\
5413: 0000: \*******************************************************************************
5414: 0000: \*******************************************************************************
5415: 0000: \***
5416: 0000: \***        INCLUDE       : SORT.TABLE external definition
5417: 0000: \***
5418: 0000: \***        REFERENCE     : PSBF14E.J86
5419: 0000: \***
5420: 0000: \***        Version A     Bruce Scriver                   3rd March 1986   
5421: 0000: \*** 
5422: 0000: \***        Version B     Andrew Wedgeworth               17th July 1992
5423: 0000: \***        Redundant function parameters removed.  SORT.TABLE defined as a
5424: 0000: \***        variable to hold the return code.
5425: 0000: \***
5426: 0000: \*******************************************************************************
5427: 0000: \*******************************************************************************
5428: 0000: 
5429: 0000:    FUNCTION SORT.TABLE (NUMBER.OF.ENTRIES%)                                    \
5430: 0000:    EXTERNAL
5431: 0000: 
5432: 0000:       INTEGER   NUMBER.OF.ENTRIES%,                                    \ BAW
5433: 0000:                 SORT.TABLE                 
5434: 0000: 
5435: 0000:    END FUNCTION
5436: 0000: 
5437: 0000:  %INCLUDE PSBF16E.J86                     ! DLC
5438: 0000: REM\
5439: 0000: \*******************************************************************************
5440: 0000: \*******************************************************************************
5441: 0000: \***
5442: 0000: \***       %INCLUDE FOR EXTERNAL DEFINITION OF CONV.TO.HEX FUNCTION
5443: 0000: \***
5444: 0000: \***                  REFERENCE     : PSBF16E.J86
5445: 0000: \***
5446: 0000: \***       Version A            Bruce Scriver          25th February 1986
5447: 0000: \***
5448: 0000: \***       Version B           Andrew Wedgeworth            2nd July 1992
5449: 0000: \***       Removal of redundant parameters, and CONV.TO.HEX defined as a 
5450: 0000: \***       variable to hold the return code. 
5451: 0000: \***
5452: 0000: \*******************************************************************************
5453: 0000: \*******************************************************************************
5454: 0000: 
5455: 0000:    FUNCTION CONV.TO.HEX (INTEGER4%)                                            \
5456: 0000:    EXTERNAL
5457: 0000:    ! 3 parameters removed from here                                    ! BAW
5458: 0000: 
5459: 0000:    ! 3 lines deleted from here                                         ! BAW
5460: 0000:    
5461: 0000:       INTEGER*2 CONV.TO.HEX                                            ! BAW
5462: 0000: 
5463: 0000:       INTEGER*4 INTEGER4%
5464: 0000: 
5465: 0000:    END FUNCTION
5466: 0000: 
5467: 0000:  %INCLUDE PSBF17E.J86                     ! DLC
5468: 0000: REM \
5469: 0000: \*******************************************************************************
5470: 0000: \*******************************************************************************
5471: 0000: \***
5472: 0000: \***
5473: 0000: \***       %INCLUDE FOR EXTERNAL DEFINITION OF CONV.TO.STRING FUNCTION
5474: 0000: \***
5475: 0000: \***                     REFERENCE     : PSBF17E.J86
5476: 0000: \***
5477: 0000: \***       Version A            Bruce Scriver       24th February 1986           
5478: 0000: \***
5479: 0000: \***       Version B          Andrew Wedgeworth          2nd July 1992
5480: 0000: \***       Redundant parameters removed, and the function's name is 
5481: 0000: \***       is defined as a variable to hold the return code. 
5482: 0000: \***
5483: 0000: \*******************************************************************************
5484: 0000: \*******************************************************************************
5485: 0000: 
5486: 0000:    FUNCTION CONV.TO.STRING (EVENT.NUMBER%,                                     \
5487: 0000:                             INTEGER4%)                                         \
5488: 0000:    EXTERNAL
5489: 0000: ! 3 parameters removed from here                                       ! BAW
5490: 0000: 
5491: 0000: ! 3 lines deleted from here                                            ! BAW
5492: 0000: 
5493: 0000:       INTEGER*1 EVENT.NUMBER%
5494: 0000: 
5495: 0000:       INTEGER*2 CONV.TO.STRING                                         ! BAW
5496: 0000: 
5497: 0000:       INTEGER*4 INTEGER4%
5498: 0000: 
5499: 0000:    END FUNCTION
5500: 0000: 
5501: 0000:  %INCLUDE PSBF18E.J86                     ! 1.8DA
5502: 0000: REM\
5503: 0000: \*******************************************************************************
5504: 0000: \*******************************************************************************
5505: 0000: \***
5506: 0000: \***        INCLUDE       : CALC.BOOTS.CODE.CHECK.DIGIT external definition
5507: 0000: \***
5508: 0000: \***        REFERENCE     : PSBF18E.J86
5509: 0000: \***
5510: 0000: \***        Version A      Stephen Kelsey                   23rd March 1987 
5511: 0000: \***
5512: 0000: \***        Version B      Andrew Wedgeworth                  7th July 1992 
5513: 0000: \***        Removal of redundant parameters, and inclusion of function's 
5514: 0000: \***        name as a variable to hold the return code.
5515: 0000: \***
5516: 0000: \*******************************************************************************
5517: 0000: \*******************************************************************************
5518: 0000: 
5519: 0000:    FUNCTION CALC.BOOTS.CODE.CHECK.DIGIT (BOOTS.CODE.6.DIGIT$)          \ 
5520: 0000:    EXTERNAL
5521: 0000:    ! 3 parameters removed from here                                    ! BAW
5522: 0000: 
5523: 0000:    STRING BOOTS.CODE.6.DIGIT$
5524: 0000:    ! 3 variables deleted from here                                     ! BAW
5525: 0000:    
5526: 0000:    INTEGER* 2 CALC.BOOTS.CODE.CHECK.DIGIT                              ! BAW
5527: 0000:    
5528: 0000:    END FUNCTION
5529: 0000: 
5530: 0000:  %INCLUDE PSBF20E.J86                     ! DLC
5531: 0000: REM\
5532: 0000: \*******************************************************************************
5533: 0000: \*******************************************************************************
5534: 0000: \***
5535: 0000: \***       %INCLUDE FOR EXTERNAL DEFINITION OF SESS.NUM.UTILITY
5536: 0000: \***
5537: 0000: \***                  REFERENCE     : PSBF20E.J86
5538: 0000: \***
5539: 0000: \***     VERSION C            Janet Smith                13th May 1992
5540: 0000: \***     Increased PASSED.INTEGER to 2 bytes to cater for more than
5541: 0000: \***     128 files.
5542: 0000: \***
5543: 0000: \***     VERSION D.           Andrew Wedgeworth          1st July 1992
5544: 0000: \***     Removal of redundant parameters and addition of SESS.NUM.UTILITY
5545: 0000: \***     as a variable.  This new variable contains the function's return
5546: 0000: \***     code.
5547: 0000: \***
5548: 0000: \*******************************************************************************
5549: 0000: \*******************************************************************************
5550: 0000: 
5551: 0000:    FUNCTION SESS.NUM.UTILITY (FUNCTION.FLAG$,                          \
5552: 0000:                               PASSED.INTEGER%,                         \
5553: 0000:                               PASSED.STRING$)                          \
5554: 0000:    EXTERNAL
5555: 0000: 
5556: 0000:    STRING    FUNCTION.FLAG$,                                           \
5557: 0000:              PASSED.STRING$
5558: 0000:    ! 3 variables removed from here                                     ! CAW
5559: 0000: 
5560: 0000: 
5561: 0000:    INTEGER*2 SESS.NUM.UTILITY,                                         \ CAW
5562: 0000:              PASSED.INTEGER%				               ! CJAS
5563: 0000: 
5564: 0000:    END FUNCTION
5565: 0000: 
5566: 0000:  %INCLUDE PSBF21E.J86                     ! 1.9BG
5567: 0000: REM\
5568: 0000: \*******************************************************************************
5569: 0000: \*******************************************************************************
5570: 0000: \***
5571: 0000: \***        INCLUDE       : CHECK.BAR.CODE external definition
5572: 0000: \***
5573: 0000: \***        REFERENCE     : PSBF21E.J86
5574: 0000: \***
5575: 0000: \***        Version A     Bruce Scriver                  13th May 1988
5576: 0000: \***
5577: 0000: \***        Version B     Andrew Wedgeworth             21st July 1992
5578: 0000: \***        Redundant function parameters removed.  CHECK.BAR.CODE defined as
5579: 0000: \***        a variable to hold the return code.
5580: 0000: \***
5581: 0000: \*******************************************************************************
5582: 0000: \*******************************************************************************
5583: 0000: 
5584: 0000:    FUNCTION CHECK.BAR.CODE (BAR.CODE$)                                 \
5585: 0000:    EXTERNAL
5586: 0000: 
5587: 0000:    STRING    BAR.CODE$
5588: 0000: 
5589: 0000:    INTEGER*2 CHECK.BAR.CODE                                            ! BAW
5590: 0000: 
5591: 0000:    END FUNCTION
5592: 0000: 
5593: 0000: 
5594: 0000:  %INCLUDE IDFEXT.J86                      ! FLC
5595: 0000: \*******************************************************************************
5596: 0000: \***                                                                         ***
5597: 0000: \***      EXTERNAL FUNCTION DEFINITIONS FOR THE ITEM DESCRIPTION FILE        ***
5598: 0000: \***                                                                         ***
5599: 0000: \***                       REFERENCE : IDFEXT.J86                            ***
5600: 0000: \***                                                                         ***
5601: 0000: \***      Version A           Andrew Wedgeworth         9th July 1992        ***
5602: 0000: \***
5603: 0000: \***    VERSION C.              Robert Cowey.                       25 AUG 1993.
5604: 0000: \***    No changes to this file.
5605: 0000: \***
5606: 0000: \***   VERSION D               Nik Sen                 22nd December 1994
5607: 0000: \***   WRITE.IDF.HOLD added
5608: 0000: \***
5609: 0000: \*******************************************************************************
5610: 0000: 
5611: 0000:        FUNCTION IDF.SET EXTERNAL                                      
5612: 0000:        END FUNCTION                                                   
5613: 0000: 
5614: 0000: 
5615: 0000:        FUNCTION READ.IDF EXTERNAL                                     
5616: 0000:           INTEGER*2 READ.IDF                                          
5617: 0000:        END FUNCTION                                                   
5618: 0000: 
5619: 0000: 
5620: 0000:        FUNCTION READ.IDF.LOCK EXTERNAL                                
5621: 0000:           INTEGER*2 READ.IDF.LOCK                                     
5622: 0000:        END FUNCTION                                                   
5623: 0000: 
5624: 0000:        FUNCTION WRITE.IDF EXTERNAL
5625: 0000:           INTEGER*2 WRITE.IDF
5626: 0000:        END FUNCTION	       
5627: 0000: 
5628: 0000:        FUNCTION WRITE.IDF.HOLD EXTERNAL
5629: 0000:           INTEGER*2 WRITE.IDF.HOLD
5630: 0000:        END FUNCTION
5631: 0000: 
5632: 0000:        FUNCTION WRITE.IDF.UNLOCK EXTERNAL                                  
5633: 0000:           INTEGER*2 WRITE.IDF.UNLOCK                                      
5634: 0000:        END FUNCTION                                                   
5635: 0000: !%INCLUDE IRFEXT.J86                      ! FLC TEST
5636: 0000:  %INCLUDE STKMQEXT.J86                    ! GMJK
5637: 0000: \*****************************************************************************
5638: 0000: \*****************************************************************************
5639: 0000: \***
5640: 0000: \***      EXTERNAL FUNCTION DEFINITIONS FOR STOCK MOVEMENT QUEUE FILE
5641: 0000: \***
5642: 0000: \***                      REFERENCE: STKMQEXT.J86
5643: 0000: \***
5644: 0000: \***       Version A            Les Cook                     8/9/92
5645: 0000: \***
5646: 0000: \***    VERSION F.              ROBERT COWEY.                       21 OCT 1993.
5647: 0000: \***    No changes to this file.
5648: 0000: \***
5649: 0000: \*******************************************************************************
5650: 0000: \*******************************************************************************
5651: 0000: 
5652: 0000:      FUNCTION STKMQ.SET EXTERNAL
5653: 0000:      END FUNCTION
5654: 0000:      
5655: 0000:      FUNCTION READ.STKMQ EXTERNAL
5656: 0000:         INTEGER*2 READ.STKMQ
5657: 0000:      END FUNCTION
5658: 0000:      
5659: 0000:      FUNCTION WRITE.STKMQ EXTERNAL
5660: 0000:         INTEGER*2 WRITE.STKMQ
5661: 0000:      END FUNCTION
5662: 0000:      
5663: 0000:      FUNCTION WRITE.HOLD.STKMQ EXTERNAL
5664: 0000:         INTEGER*2 WRITE.HOLD.STKMQ
5665: 0000:      END FUNCTION
5666: 0000:      
5667: 0000:      
5668: 0000:      
5669: 0000:  %INCLUDE BCSMFEXT.J86                    ! FLC
5670: 0000: \*****************************************************************************
5671: 0000: \*****************************************************************************
5672: 0000: \***
5673: 0000: \***   EXTERNAL FUNCTION DEFINITIONS FOR BUSINESS CENTRE SUPPLY METHOD FILE
5674: 0000: \***
5675: 0000: \***               REFERENCE: BCSMFFUN.BAS
5676: 0000: \***
5677: 0000: \***        Version B           Les Cook              11/1/93
5678: 0000: \***
5679: 0000: \*****************************************************************************
5680: 0000: \*****************************************************************************
5681: 0000: 
5682: 0000:     FUNCTION BCSMF.SET EXTERNAL
5683: 0000:     END FUNCTION
5684: 0000:     
5685: 0000:     FUNCTION READ.BCSMF EXTERNAL
5686: 0000:        INTEGER*2 READ.BCSMF
5687: 0000:     END FUNCTION
5688: 0000:     
5689: 0000:     FUNCTION READ.BCSMF.LOCK EXTERNAL
5690: 0000:        INTEGER*2 READ.BCSMF.LOCK
5691: 0000:     END FUNCTION
5692: 0000:     
5693: 0000:     FUNCTION WRITE.BCSMF EXTERNAL
5694: 0000:        INTEGER*2 WRITE.BCSMF
5695: 0000:     END FUNCTION
5696: 0000:     
5697: 0000:     FUNCTION WRITE.BCSMF.UNLOCK EXTERNAL
5698: 0000:        INTEGER*2 WRITE.BCSMF.UNLOCK
5699: 0000:     END FUNCTION
5700: 0000:     
5701: 0000:     
5702: 0000:  %INCLUDE INVOKEXT.J86                    ! FLC
5703: 0000: \*******************************************************************************
5704: 0000: \***                                                                         ***
5705: 0000: \***      EXTERNAL FUNCTION DEFINITIONS FOR THE INVCE OK FILE                ***
5706: 0000: \***                                                                         ***
5707: 0000: \***                     REFERENCE : INVOKEXT.J86                            ***
5708: 0000: \***                                                                         ***
5709: 0000: \***      Version A         Andrew Wedgeworth       3rd August 1992          ***
5710: 0000: \***                                                                         ***
5711: 0000: \***      Version B         Stephen Kelsey (CTG)    9th October 1992         ***
5712: 0000: \***          Add functions READ.INVOK.LOCKED and WRITE.INVOK.UNLOCK         ***
5713: 0000: \***                                                                         ***
5714: 0000: \*******************************************************************************
5715: 0000: 
5716: 0000: 
5717: 0000:       FUNCTION INVOK.SET EXTERNAL 
5718: 0000:       END FUNCTION
5719: 0000:       
5720: 0000:       FUNCTION READ.INVOK EXTERNAL
5721: 0000:          INTEGER*2 READ.INVOK
5722: 0000:       END FUNCTION	             
5723: 0000:       
5724: 0000:       FUNCTION READ.INVOK.LOCKED EXTERNAL                              ! BSPK
5725: 0000:          INTEGER*2 READ.INVOK.LOCKED                                   ! BSPK
5726: 0000:       END FUNCTION	                                               ! BSPK
5727: 0000:       
5728: 0000:       FUNCTION WRITE.INVOK.UNLOCK EXTERNAL                             ! BSPK
5729: 0000:          INTEGER*2 WRITE.INVOK.UNLOCK                                  ! BSPK
5730: 0000:       END FUNCTION	                                               ! BSPK
5731: 0000:  %INCLUDE PCHKEXT.J86                     ! DLC
5732: 0000: \*****************************************************************************
5733: 0000: \*****************************************************************************
5734: 0000: \***
5735: 0000: \***        EXTERNAL FUNCTION DEFINITIONS FOR PCHK
5736: 0000: \***
5737: 0000: \***        REFERENCE: PCHKEXT.J86
5738: 0000: \***
5739: 0000: \*****************************************************************************
5740: 0000: \*****************************************************************************
5741: 0000: 
5742: 0000: 
5743: 0000:    FUNCTION PCHK.SET EXTERNAL
5744: 0000:    END FUNCTION
5745: 0000:    
5746: 0000:    FUNCTION READ.PCHK EXTERNAL
5747: 0000:    END FUNCTION
5748: 0000:    
5749: 0000:    FUNCTION WRITE.PCHK EXTERNAL
5750: 0000:    END FUNCTION
5751: 0000:    
5752: 0000:    
5753: 0000: \%INCLUDE CSREXT.J86                      ! DLC !2.5NWB
5754: 0000:  %INCLUDE EPSOMEXT.J86                    ! DLC
5755: 0000: \*****************************************************************************
5756: 0000: \*****************************************************************************
5757: 0000: \***
5758: 0000: \***      EXTERNAL FUNCTION DEFINITIONS FOR EPSOM
5759: 0000: \***
5760: 0000: \***      REFERENCE: EPSOMEXT.J86
5761: 0000: \***
5762: 0000: \*****************************************************************************
5763: 0000: \*****************************************************************************
5764: 0000: 
5765: 0000: 
5766: 0000:    FUNCTION EPSOM.SET EXTERNAL
5767: 0000:    END FUNCTION
5768: 0000:    
5769: 0000:  %INCLUDE UNITSEXT.J86                    ! DLC
5770: 0000: \*****************************************************************************
5771: 0000: \*****************************************************************************
5772: 0000: \*** 
5773: 0000: \***        EXTERNAL FUNCTION DEFINITIONS FOR UNITS
5774: 0000: \***
5775: 0000: \***        REFERENCE:  UNITSEXT.J86
5776: 0000: \***
5777: 0000: \*****************************************************************************
5778: 0000: \*****************************************************************************
5779: 0000: 
5780: 0000:    FUNCTION UNITS.SET EXTERNAL
5781: 0000:    END FUNCTION
5782: 0000:    
5783: 0000:    FUNCTION READ.UNITS EXTERNAL
5784: 0000:       INTEGER*2 READ.UNITS
5785: 0000:    END FUNCTION
5786: 0000:    
5787: 0000:    FUNCTION READ.UNITS.LOCK EXTERNAL
5788: 0000:       INTEGER*2 READ.UNITS.LOCK
5789: 0000:    END FUNCTION
5790: 0000:    
5791: 0000:    FUNCTION WRITE.UNITS EXTERNAL
5792: 0000:       INTEGER*2 WRITE.UNITS
5793: 0000:    END FUNCTION
5794: 0000:    
5795: 0000:    FUNCTION WRITE.UNITS.UNLOCK EXTERNAL
5796: 0000:       INTEGER*2 WRITE.UNITS.UNLOCK
5797: 0000:    END FUNCTION
5798: 0000:    
5799: 0000:    
5800: 0000:    
5801: 0000:  %INCLUDE DIRECEXT.J86                    ! DLC
5802: 0000: \*****************************************************************************
5803: 0000: \*****************************************************************************
5804: 0000: \***
5805: 0000: \***       EXTERNAL FUNCTION DEFINITIONS FOR DIREC
5806: 0000: \***
5807: 0000: \***       REFERENCE: DIRECEXT.J86
5808: 0000: \***
5809: 0000: \*****************************************************************************
5810: 0000: \*****************************************************************************
5811: 0000: 
5812: 0000:    FUNCTION DIREC.SET EXTERNAL 
5813: 0000:    END FUNCTION
5814: 0000:    
5815: 0000:    
5816: 0000:  %INCLUDE LDTBFEXT.J86                    ! ELC
5817: 0000: \*******************************************************************************
5818: 0000: \***                                                                         
5819: 0000: \***         EXTERNAL FUNCTION DEFINITIONS FOR THE LDT BUFFER FILE          
5820: 0000: \***                                                                         
5821: 0000: \***                     REFERENCE : LDTBFEXT.J86                            
5822: 0000: \***                                                                         
5823: 0000: \***          Version B     Les Cook      4th November 1992               
5824: 0000: \***                                                                         
5825: 0000: \*******************************************************************************
5826: 0000: 
5827: 0000:        FUNCTION LDTBF.SET EXTERNAL                                      
5828: 0000:        END FUNCTION                                                   
5829: 0000: 
5830: 0000: 
5831: 0000:        FUNCTION READ.LDTBF EXTERNAL                                  
5832: 0000:           INTEGER*2 READ.LDTBF                                       
5833: 0000:        END FUNCTION                                                   
5834: 0000:        
5835: 0000:        FUNCTION WRITE.LDTBF EXTERNAL
5836: 0000:           INTEGER*2 WRITE.LDTBF
5837: 0000:        END FUNCTION
5838: 0000:  %INCLUDE UODEXT.J86                      ! FLC
5839: 0000: \*****************************************************************************
5840: 0000: \*****************************************************************************
5841: 0000: \***
5842: 0000: \***     EXTERNAL FUNCTION DEFINITIONS FOR UOD DUMMY FILE
5843: 0000: \***
5844: 0000: \***     REFERENCE: UODEXT.J86
5845: 0000: \***
5846: 0000: \*****************************************************************************
5847: 0000: \*****************************************************************************
5848: 0000: 
5849: 0000:    FUNCTION UOD.SET EXTERNAL
5850: 0000:    END FUNCTION
5851: 0000:    
5852: 0000:    
5853: 0000:  %INCLUDE UODBFEXT.J86                    ! FLC
5854: 0000: \*******************************************************************************
5855: 0000: \*******************************************************************************
5856: 0000: \***
5857: 0000: \***           UOD BUFFER FILE EXTERNAL FILE PUBLIC DEFINITIONS
5858: 0000: \***
5859: 0000: \***                    REFERENCE    : UODBFEXT.BAS
5860: 0000: \***
5861: 0000: \***    Version A.         Michael Kelsall              08th February 1993
5862: 0000: \***
5863: 0000: \*******************************************************************************
5864: 0000: \*******************************************************************************
5865: 0000: 
5866: 0000:  
5867: 0000:   FUNCTION UODBF.SET EXTERNAL
5868: 0000:       INTEGER*2 UODBF.SET
5869: 0000:   END FUNCTION
5870: 0000: 
5871: 0000: 
5872: 0000:   FUNCTION READ.UODBF EXTERNAL
5873: 0000:       INTEGER*2 READ.UODBF 
5874: 0000:   END FUNCTION
5875: 0000: 
5876: 0000:   
5877: 0000:   FUNCTION WRITE.UODBF EXTERNAL
5878: 0000:       INTEGER*2 WRITE.UODBF
5879: 0000:   END FUNCTION
5880: 0000: 
5881: 0000:   
5882: 0000:   FUNCTION WRITE.HOLD.UODBF EXTERNAL
5883: 0000:       INTEGER*2 WRITE.HOLD.UODBF						
5884: 0000:   END FUNCTION								
5885: 0000: 
5886: 0000:  %INCLUDE UODTFEXT.J86                    ! FLC
5887: 0000: \*****************************************************************************
5888: 0000: \*****************************************************************************
5889: 0000: \***
5890: 0000: \***        EXTERNAL FUNCTION DEFINITIONS FOR UODTF
5891: 0000: \***
5892: 0000: \***        REFERENCE:  UODTFEXT.J86
5893: 0000: \***
5894: 0000: \***        Version A         Les Cook         22/2/1993
5895: 0000: \***
5896: 0000: \*****************************************************************************
5897: 0000: \*****************************************************************************
5898: 0000: 
5899: 0000:    FUNCTION UODTF.SET EXTERNAL
5900: 0000:    END FUNCTION
5901: 0000:    
5902: 0000:    FUNCTION READ.UODTF EXTERNAL
5903: 0000:       INTEGER*2 READ.UODTF
5904: 0000:    END FUNCTION
5905: 0000:    
5906: 0000:    FUNCTION WRITE.UODTF EXTERNAL
5907: 0000:       INTEGER*2 WRITE.UODTF
5908: 0000:    END FUNCTION
5909: 0000:    
5910: 0000:    
5911: 0000:  %INCLUDE PILSTEXT.J86                    ! FLC
5912: 0000: \*****************************************************************************
5913: 0000: \*****************************************************************************
5914: 0000: \***
5915: 0000: \***     EXTERNAL FUNCTION DEFINITIONS FOR PILST
5916: 0000: \***
5917: 0000: \***     REFERENCE: PILSTEXT.J86
5918: 0000: \***
5919: 0000: \***     9th October 1992
5920: 0000: \***
5921: 0000: \*****************************************************************************
5922: 0000: \*****************************************************************************
5923: 0000: 
5924: 0000:    FUNCTION PILST.SET EXTERNAL
5925: 0000:    END FUNCTION
5926: 0000:    
5927: 0000:    FUNCTION READ.PILST EXTERNAL
5928: 0000:       INTEGER*2 READ.PILST
5929: 0000:    END FUNCTION
5930: 0000:    
5931: 0000:    FUNCTION READ.PILST.LOCK EXTERNAL
5932: 0000:       INTEGER*2 READ.PILST.LOCK
5933: 0000:    END FUNCTION
5934: 0000:    
5935: 0000:    FUNCTION WRITE.PILST EXTERNAL
5936: 0000:       INTEGER*2 WRITE.PILST
5937: 0000:    END FUNCTION
5938: 0000:    
5939: 0000:    FUNCTION WRITE.PILST.HOLD EXTERNAL
5940: 0000:       INTEGER*2 WRITE.PILST.HOLD
5941: 0000:    END FUNCTION
5942: 0000:    
5943: 0000:    FUNCTION WRITE.PILST.UNLOCK EXTERNAL
5944: 0000:       INTEGER*2 WRITE.PILST.UNLOCK
5945: 0000:    END FUNCTION
5946: 0000:    
5947: 0000:    
5948: 0000:  %INCLUDE PIITMEXT.J86                    ! FLC
5949: 0000: \*****************************************************************************
5950: 0000: \*****************************************************************************
5951: 0000: \***
5952: 0000: \***            EXTERNAL FUNCTION DEFINITIONS FOR PIITM
5953: 0000: \***
5954: 0000: \***            REFERENCE: PIITMEXT.J86
5955: 0000: \***
5956: 0000: \***            Les Cook 9/10/1992
5957: 0000: \***
5958: 0000: \*****************************************************************************
5959: 0000: \*****************************************************************************
5960: 0000: 
5961: 0000:    FUNCTION PIITM.SET EXTERNAL
5962: 0000:    END FUNCTION
5963: 0000:    
5964: 0000:    FUNCTION READ.PIITM EXTERNAL
5965: 0000:       INTEGER*2 READ.PIITM
5966: 0000:    END FUNCTION
5967: 0000:    
5968: 0000:    FUNCTION READ.PIITM.LOCK EXTERNAL
5969: 0000:       INTEGER*2 READ.PIITM.LOCK
5970: 0000:    END FUNCTION
5971: 0000:    
5972: 0000:    FUNCTION WRITE.PIITM EXTERNAL
5973: 0000:       INTEGER*2 WRITE.PIITM
5974: 0000:    END FUNCTION
5975: 0000:    
5976: 0000:    FUNCTION WRITE.PIITM.UNLOCK EXTERNAL
5977: 0000:       INTEGER*2 WRITE.PIITM.UNLOCK
5978: 0000:    END FUNCTION
5979: 0000:    
5980: 0000:    FUNCTION WRITE.PIITM.HOLD.UNLOCK EXTERNAL
5981: 0000:       INTEGER*2 WRITE.PIITM.HOLD.UNLOCK
5982: 0000:    END FUNCTION
5983: 0000:    
5984: 0000:    FUNCTION WRITE.PIITM.HOLD EXTERNAL
5985: 0000:       INTEGER*2 WRITE.PIITM.HOLD
5986: 0000:    END FUNCTION
5987: 0000:    
5988: 0000: !%INCLUDE PDTWFEXT.J86                    ! FLC
5989: 0000: 
5990: 0000:  %INCLUDE CCUODEXT.J86                    ! GMJK
5991: 0000: 
5992: 0000: \*****************************************************************************
5993: 0000: \*****************************************************************************
5994: 0000: \***
5995: 0000: \***        %INCLUDE FOR FILE HANDLING FUNCTIONS EXTERNAL DEFINITIONS
5996: 0000: \***
5997: 0000: \***                   FILE TYPE:  KEYED
5998: 0000: \***
5999: 0000: \***                   REFERENCE:  CCUODEXT.J86
6000: 0000: \***
6001: 0000: \***	             DESCRIPTION:  RETURNS / AUTOMATIC CREDIT CLAIMING
6002: 0000: \***				   FILE OF OPEN/CLOSED UODS
6003: 0000: \***
6004: 0000: \***
6005: 0000: \***      VERSION A : Michael J. Kelsall      13th September 1993
6006: 0000: \***      
6007: 0000: \*****************************************************************************
6008: 0000: \*****************************************************************************
6009: 0000: 
6010: 0000: 
6011: 0000:   FUNCTION CCUOD.SET EXTERNAL
6012: 0000:      INTEGER*2 CCUOD.SET
6013: 0000:   END FUNCTION
6014: 0000: 
6015: 0000: 
6016: 0000:   FUNCTION READ.CCUOD EXTERNAL
6017: 0000:     INTEGER*2 READ.CCUOD
6018: 0000:   END FUNCTION
6019: 0000:   
6020: 0000: 
6021: 0000:   FUNCTION READ.CCUOD.LOCKED EXTERNAL
6022: 0000:     INTEGER*2 READ.CCUOD.LOCKED
6023: 0000:   END FUNCTION  
6024: 0000: 
6025: 0000: 
6026: 0000:   FUNCTION WRITE.HOLD.CCUOD EXTERNAL
6027: 0000:     INTEGER*2 WRITE.HOLD.CCUOD
6028: 0000:   END FUNCTION
6029: 0000: 
6030: 0000: 
6031: 0000:   FUNCTION WRITE.UNLOCK.CCUOD EXTERNAL
6032: 0000:     INTEGER*2 WRITE.UNLOCK.CCUOD
6033: 0000:   END FUNCTION
6034: 0000: 
6035: 0000: 
6036: 0000:   FUNCTION WRITE.HOLD.UNLOCK.CCUOD EXTERNAL
6037: 0000:     INTEGER*2 WRITE.HOLD.UNLOCK.CCUOD
6038: 0000:   END FUNCTION
6039: 0000:   
6040: 0000: 
6041: 0000:   FUNCTION WRITE.CCUOD EXTERNAL
6042: 0000:     INTEGER*2 WRITE.CCUOD
6043: 0000:   END FUNCTION
6044: 0000: 
6045: 0000:  %INCLUDE CCLAMEXT.J86                    ! 1.4
6046: 0000: 
6047: 0000: \*****************************************************************************
6048: 0000: \*****************************************************************************
6049: 0000: \***
6050: 0000: \***        %INCLUDE FOR FILE HANDLING FUNCTIONS EXTERNAL DEFINITIONS
6051: 0000: \***
6052: 0000: \***                   FILE TYPE:  KEYED
6053: 0000: \***
6054: 0000: \***                   REFERENCE:  CCLAMEXT.J86
6055: 0000: \***
6056: 0000: \***	             DESCRIPTION:  RETURNS / AUTOMATIC CREDIT CLAIMING
6057: 0000: \***				   FILE OF CURRENT CREDIT CLAIMS
6058: 0000: \***
6059: 0000: \***
6060: 0000: \***      VERSION A : Michael J. Kelsall      14th September 1993
6061: 0000: \***      
6062: 0000: \*****************************************************************************
6063: 0000: \*****************************************************************************
6064: 0000: 
6065: 0000: 
6066: 0000:   FUNCTION CCLAM.SET EXTERNAL
6067: 0000:      INTEGER*2 CCLAM.SET
6068: 0000:   END FUNCTION
6069: 0000: 
6070: 0000: 
6071: 0000:   FUNCTION READ.CCLAM EXTERNAL
6072: 0000:     INTEGER*2 READ.CCLAM
6073: 0000:   END FUNCTION
6074: 0000:   
6075: 0000: 
6076: 0000:   FUNCTION READ.CCLAM.LOCKED EXTERNAL
6077: 0000:     INTEGER*2 READ.CCLAM.LOCKED
6078: 0000:   END FUNCTION  
6079: 0000: 
6080: 0000: 
6081: 0000:   FUNCTION WRITE.HOLD.CCLAM EXTERNAL
6082: 0000:     INTEGER*2 WRITE.HOLD.CCLAM
6083: 0000:   END FUNCTION
6084: 0000: 
6085: 0000: 
6086: 0000:   FUNCTION WRITE.UNLOCK.CCLAM EXTERNAL
6087: 0000:     INTEGER*2 WRITE.UNLOCK.CCLAM
6088: 0000:   END FUNCTION
6089: 0000: 
6090: 0000: 
6091: 0000:   FUNCTION WRITE.HOLD.UNLOCK.CCLAM EXTERNAL
6092: 0000:     INTEGER*2 WRITE.HOLD.UNLOCK.CCLAM
6093: 0000:   END FUNCTION
6094: 0000:   
6095: 0000: 
6096: 0000:   FUNCTION WRITE.CCLAM EXTERNAL
6097: 0000:     INTEGER*2 WRITE.CCLAM
6098: 0000:   END FUNCTION
6099: 0000: 
6100: 0000:  %INCLUDE CCITMEXT.J86                    ! GMJK
6101: 0000: 
6102: 0000: \*****************************************************************************
6103: 0000: \*****************************************************************************
6104: 0000: \***
6105: 0000: \***        %INCLUDE FOR FILE HANDLING FUNCTION EXTERNAL DECLARATIONS
6106: 0000: \***
6107: 0000: \***                   FILE TYPE:  KEYED
6108: 0000: \***
6109: 0000: \***                   REFERENCE:  CCITMEXT.J86
6110: 0000: \***
6111: 0000: \***	             DESCRIPTION:  RETURNS / AUTOMATIC CREDIT CLAIMING
6112: 0000: \***				   FILE OF ITEMS PER OPEN/CLOSED UODS
6113: 0000: \***
6114: 0000: \***
6115: 0000: \***      VERSION A : Michael J. Kelsall      13th September 1993
6116: 0000: \***      
6117: 0000: \*****************************************************************************
6118: 0000: \*****************************************************************************
6119: 0000: 
6120: 0000: 
6121: 0000:   FUNCTION CCITM.SET EXTERNAL
6122: 0000:      INTEGER*2 CCITM.SET
6123: 0000:   END FUNCTION
6124: 0000: 
6125: 0000: 
6126: 0000:   FUNCTION READ.CCITM EXTERNAL
6127: 0000:     INTEGER*2 READ.CCITM
6128: 0000:   END FUNCTION
6129: 0000:   
6130: 0000: 
6131: 0000:   FUNCTION READ.CCITM.LOCKED EXTERNAL
6132: 0000:     INTEGER*2 READ.CCITM.LOCKED
6133: 0000:   END FUNCTION  
6134: 0000: 
6135: 0000: 
6136: 0000:   FUNCTION WRITE.HOLD.CCITM EXTERNAL
6137: 0000:     INTEGER*2 WRITE.HOLD.CCITM
6138: 0000:   END FUNCTION
6139: 0000: 
6140: 0000: 
6141: 0000:   FUNCTION WRITE.UNLOCK.CCITM EXTERNAL
6142: 0000:     INTEGER*2 WRITE.UNLOCK.CCITM
6143: 0000:   END FUNCTION
6144: 0000: 
6145: 0000: 
6146: 0000:   FUNCTION WRITE.HOLD.UNLOCK.CCITM EXTERNAL
6147: 0000:     INTEGER*2 WRITE.HOLD.UNLOCK.CCITM
6148: 0000:   END FUNCTION
6149: 0000: 
6150: 0000: 
6151: 0000:   FUNCTION WRITE.CCITM EXTERNAL
6152: 0000:     INTEGER*2 WRITE.CCITM
6153: 0000:   END FUNCTION
6154: 0000: 
6155: 0000:  %INCLUDE CCTRLEXT.J86                    ! GMJK
6156: 0000: 
6157: 0000: \*****************************************************************************
6158: 0000: \*****************************************************************************
6159: 0000: \***
6160: 0000: \***        %INCLUDE FOR FILE HANDLING FUNCTIONS EXTERNAL DEFINITIONS
6161: 0000: \***
6162: 0000: \***                   FILE TYPE:  DIRECT
6163: 0000: \***
6164: 0000: \***                   REFERENCE:  CCTRLEXT.J86
6165: 0000: \***
6166: 0000: \***	             DESCRIPTION:  RETURNS / AUTOMATIC CREDIT CLAIMING
6167: 0000: \***				   CREDIT CLAIMS CONTROL FILE
6168: 0000: \***
6169: 0000: \***
6170: 0000: \***      VERSION A : Michael J. Kelsall      14th September 1993
6171: 0000: \***      
6172: 0000: \*****************************************************************************
6173: 0000: \*****************************************************************************
6174: 0000: 
6175: 0000: 
6176: 0000:   FUNCTION CCTRL.SET EXTERNAL
6177: 0000:      INTEGER*2 CCTRL.SET
6178: 0000:   END FUNCTION
6179: 0000: 
6180: 0000: 
6181: 0000:   FUNCTION READ.CCTRL EXTERNAL
6182: 0000:     INTEGER*2 READ.CCTRL
6183: 0000:   END FUNCTION
6184: 0000:   
6185: 0000: 
6186: 0000:   FUNCTION READ.CCTRL.LOCKED EXTERNAL
6187: 0000:     INTEGER*2 READ.CCTRL.LOCKED
6188: 0000:   END FUNCTION  
6189: 0000: 
6190: 0000: 
6191: 0000:   FUNCTION WRITE.HOLD.CCTRL EXTERNAL
6192: 0000:     INTEGER*2 WRITE.HOLD.CCTRL
6193: 0000:   END FUNCTION
6194: 0000: 
6195: 0000: 
6196: 0000:   FUNCTION WRITE.UNLOCK.CCTRL EXTERNAL
6197: 0000:     INTEGER*2 WRITE.UNLOCK.CCTRL
6198: 0000:   END FUNCTION
6199: 0000: 
6200: 0000: 
6201: 0000:   FUNCTION WRITE.HOLD.UNLOCK.CCTRL EXTERNAL
6202: 0000:     INTEGER*2 WRITE.HOLD.UNLOCK.CCTRL
6203: 0000:   END FUNCTION
6204: 0000:   
6205: 0000: 
6206: 0000:   FUNCTION WRITE.CCTRL EXTERNAL
6207: 0000:     INTEGER*2 WRITE.CCTRL
6208: 0000:   END FUNCTION
6209: 0000: 
6210: 0000:  %INCLUDE CCTMPEXT.J86                    ! GMJK
6211: 0000: \*******************************************************************************
6212: 0000: \*******************************************************************************
6213: 0000: \***
6214: 0000: \*** RETURNS / AUTOMATIC CREDIT CLAIMING FILE EXTERNAL FILE PUBLIC DEFINITIONS
6215: 0000: \***
6216: 0000: \***                    REFERENCE    : CCTMPEXT.BAS
6217: 0000: \***
6218: 0000: \***    Version A.         Michael Kelsall              30th September 1993
6219: 0000: \***
6220: 0000: \*******************************************************************************
6221: 0000: \*******************************************************************************
6222: 0000: 
6223: 0000:  
6224: 0000:   FUNCTION CCTMP.SET EXTERNAL
6225: 0000:       INTEGER*2 CCTMP.SET
6226: 0000:   END FUNCTION
6227: 0000: 
6228: 0000: 
6229: 0000:   FUNCTION READ.CCTMP EXTERNAL
6230: 0000:       INTEGER*2 READ.CCTMP 
6231: 0000:   END FUNCTION
6232: 0000: 
6233: 0000:   
6234: 0000:   FUNCTION WRITE.CCTMP EXTERNAL
6235: 0000:       INTEGER*2 WRITE.CCTMP
6236: 0000:   END FUNCTION
6237: 0000: 
6238: 0000:   
6239: 0000:   FUNCTION WRITE.HOLD.CCTMP EXTERNAL
6240: 0000:       INTEGER*2 WRITE.HOLD.CCTMP						
6241: 0000:   END FUNCTION								
6242: 0000: 
6243: 0000:  %INCLUDE CCBUFEXT.J86                    ! GMJK
6244: 0000: \*******************************************************************************
6245: 0000: \*******************************************************************************
6246: 0000: \***
6247: 0000: \*** RETURNS / AUTOMATIC CREDIT CLAIMING FILE EXTERNAL FILE PUBLIC DEFINITIONS
6248: 0000: \***
6249: 0000: \***                    REFERENCE    : CCBUFEXT.BAS
6250: 0000: \***
6251: 0000: \***    Version A.         Michael Kelsall              30th September 1993
6252: 0000: \***
6253: 0000: \*******************************************************************************
6254: 0000: \*******************************************************************************
6255: 0000: 
6256: 0000:  
6257: 0000:   FUNCTION CCBUF.SET EXTERNAL
6258: 0000:       INTEGER*2 CCBUF.SET
6259: 0000:   END FUNCTION
6260: 0000: 
6261: 0000: 
6262: 0000:   FUNCTION READ.CCBUF EXTERNAL
6263: 0000:       INTEGER*2 READ.CCBUF 
6264: 0000:   END FUNCTION
6265: 0000: 
6266: 0000:   
6267: 0000:   FUNCTION WRITE.CCBUF EXTERNAL
6268: 0000:       INTEGER*2 WRITE.CCBUF
6269: 0000:   END FUNCTION
6270: 0000: 
6271: 0000:   
6272: 0000:   FUNCTION WRITE.HOLD.CCBUF EXTERNAL
6273: 0000:       INTEGER*2 WRITE.HOLD.CCBUF						
6274: 0000:   END FUNCTION								
6275: 0000: 
6276: 0000:  %INCLUDE CCUPFEXT.J86                    ! HMJK
6277: 0000: 
6278: 0000: \*****************************************************************************
6279: 0000: \*****************************************************************************
6280: 0000: \***
6281: 0000: \***        %INCLUDE FOR FILE HANDLING FUNCTION EXTERNAL DECLARATIONS
6282: 0000: \***
6283: 0000: \***                   FILE TYPE:  KEYED
6284: 0000: \***
6285: 0000: \***                   REFERENCE:  CCUPFEXT.J86
6286: 0000: \***
6287: 0000: \***	             DESCRIPTION:  RETURNS / AUTOMATIC CREDIT CLAIMING
6288: 0000: \***				   UOD PROCESSED FILE 
6289: 0000: \***
6290: 0000: \***      VERSION A : Michael J. Kelsall      14th March 1994
6291: 0000: \***      
6292: 0000: \*****************************************************************************
6293: 0000: \*****************************************************************************
6294: 0000: 
6295: 0000: 
6296: 0000:   FUNCTION CCUPF.SET EXTERNAL
6297: 0000:      INTEGER*2 CCUPF.SET
6298: 0000:   END FUNCTION
6299: 0000: 
6300: 0000: 
6301: 0000:   FUNCTION READ.CCUPF EXTERNAL
6302: 0000:     INTEGER*2 READ.CCUPF
6303: 0000:   END FUNCTION
6304: 0000:   
6305: 0000: 
6306: 0000:   FUNCTION READ.CCUPF.LOCKED EXTERNAL
6307: 0000:     INTEGER*2 READ.CCUPF.LOCKED
6308: 0000:   END FUNCTION  
6309: 0000: 
6310: 0000: 
6311: 0000:   FUNCTION WRITE.HOLD.CCUPF EXTERNAL
6312: 0000:     INTEGER*2 WRITE.HOLD.CCUPF
6313: 0000:   END FUNCTION
6314: 0000: 
6315: 0000: 
6316: 0000:   FUNCTION WRITE.UNLOCK.CCUPF EXTERNAL
6317: 0000:     INTEGER*2 WRITE.UNLOCK.CCUPF
6318: 0000:   END FUNCTION
6319: 0000: 
6320: 0000: 
6321: 0000:   FUNCTION WRITE.HOLD.UNLOCK.CCUPF EXTERNAL
6322: 0000:     INTEGER*2 WRITE.HOLD.UNLOCK.CCUPF
6323: 0000:   END FUNCTION
6324: 0000: 
6325: 0000: 
6326: 0000:   FUNCTION WRITE.CCUPF EXTERNAL
6327: 0000:     INTEGER*2 WRITE.CCUPF
6328: 0000:   END FUNCTION
6329: 0000: 
6330: 0000:  %INCLUDE CCWKFEXT.J86                    ! GMJK
6331: 0000: \*****************************************************************************
6332: 0000: \*****************************************************************************
6333: 0000: \***
6334: 0000: \***       EXTERNAL FUNCTION DEFINTIONS FOR CCWKF - RETURNS WORK FILE
6335: 0000: \***
6336: 0000: \***                      REFERENCE: CCWKFEXT.J86
6337: 0000: \***
6338: 0000: \***    Version A          Michael J. Kelsall            30th September 1993
6339: 0000: \***
6340: 0000: \*****************************************************************************
6341: 0000: \*****************************************************************************
6342: 0000: 
6343: 0000:    FUNCTION CCWKF.SET EXTERNAL
6344: 0000:       INTEGER*2 CCWKF.SET
6345: 0000:    END FUNCTION
6346: 0000:    
6347: 0000:    FUNCTION READ.CCWKF EXTERNAL
6348: 0000:       INTEGER*2 READ.CCWKF
6349: 0000:    END FUNCTION
6350: 0000:    
6351: 0000:    FUNCTION WRITE.CCWKF EXTERNAL
6352: 0000:       INTEGER*2 WRITE.CCWKF
6353: 0000:    END FUNCTION
6354: 0000:    
6355: 0000:  %INCLUDE CCDMYEXT.J86                    ! GMJK
6356: 0000: \*****************************************************************************
6357: 0000: \*****************************************************************************
6358: 0000: \***
6359: 0000: \***        EXTERNAL FUNCTION DEFINITIONS FOR RETURNS DUMMY FILE
6360: 0000: \***
6361: 0000: \***                      REFERENCE: CCDMYEXT.J86
6362: 0000: \***
6363: 0000: \***    Version A       Michael J. Kelsall             30th September 1993
6364: 0000: \***
6365: 0000: \*****************************************************************************
6366: 0000: \*****************************************************************************
6367: 0000: 
6368: 0000:    FUNCTION CCDMY.SET EXTERNAL
6369: 0000:       INTEGER*2 CCDMY.SET
6370: 0000:    END FUNCTION
6371: 0000:    
6372: 0000:    
6373: 0000:  %INCLUDE LDTAFEXT.J86                    ! HMJK
6374: 0000: 
6375: 0000: \*****************************************************************************
6376: 0000: \*****************************************************************************
6377: 0000: \***
6378: 0000: \***        %INCLUDE FOR FILE HANDLING FUNCTIONS EXTERNAL DEFINITIONS
6379: 0000: \***
6380: 0000: \***                   FILE TYPE:  DIRECT
6381: 0000: \***
6382: 0000: \***                   REFERENCE:  LDTAFEXT.J86
6383: 0000: \***
6384: 0000: \***	             DESCRIPTION:  LDT / PDT SUPPORT LINK AUDIT FILE
6385: 0000: \***
6386: 0000: \***
6387: 0000: \***      VERSION A        Michael J. Kelsall        30th September 1993
6388: 0000: \*** 
6389: 0000: \***      VERSION B        Michael J. Kelsall        25th March 1994
6390: 0000: \***      No change to external definitions.
6391: 0000: \***      
6392: 0000: \*****************************************************************************
6393: 0000: \*****************************************************************************
6394: 0000: 
6395: 0000: 
6396: 0000:   FUNCTION LDTAF.SET EXTERNAL
6397: 0000:      INTEGER*2 LDTAF.SET
6398: 0000:   END FUNCTION
6399: 0000: 
6400: 0000: 
6401: 0000:   FUNCTION READ.LDTAF EXTERNAL
6402: 0000:     INTEGER*2 READ.LDTAF
6403: 0000:   END FUNCTION
6404: 0000:   
6405: 0000: 
6406: 0000:   FUNCTION WRITE.HOLD.LDTAF EXTERNAL
6407: 0000:     INTEGER*2 WRITE.HOLD.LDTAF
6408: 0000:   END FUNCTION
6409: 0000: 
6410: 0000: 
6411: 0000:   FUNCTION WRITE.LDTAF EXTERNAL
6412: 0000:     INTEGER*2 WRITE.LDTAF
6413: 0000:   END FUNCTION
6414: 0000: 
6415: 0000:  %INCLUDE SOFTSEXT.J86                    ! GMJK
6416: 0000: \*******************************************************************************
6417: 0000: \***                                                                         ***
6418: 0000: \***      EXTERNAL FUNCTION DEFINITIONS FOR THE SOFTWARE STATUS FILE         ***
6419: 0000: \***                                                                         ***
6420: 0000: \***                     REFERENCE : SOFTSEXT.J86                            ***
6421: 0000: \***                                                                         ***
6422: 0000: \***      Version A         Andrew Wedgeworth          1st July 1992         ***
6423: 0000: \***
6424: 0000: \***   Version B
6425: 0000: \***                                                                      ***
6426: 0000: \***      Version C         Steve Wright               3rd May 1996          ***
6427: 0000: \***      Synchronise with function source.                                  ***
6428: 0000: \*******************************************************************************
6429: 0000: 
6430: 0000:       FUNCTION SOFTS.SET EXTERNAL 
6431: 0000:       END FUNCTION
6432: 0000:       
6433: 0000:       FUNCTION READ.SOFTS EXTERNAL
6434: 0000:           INTEGER*2 I%, READ.SOFTS
6435: 0000:       END FUNCTION	                   
6436: 0000: 
6437: 0000:       FUNCTION WRITE.SOFTS EXTERNAL
6438: 0000:           INTEGER*2 I%, WRITE.SOFTS
6439: 0000:       END FUNCTION
6440: 0000: 
6441: 0000: 
6442: 0000:  %INCLUDE STKBFEXT.J86                    ! 1.5
6443: 0000: \******************************************************************************
6444: 0000: \******************************************************************************
6445: 0000: \***
6446: 0000: \***   $Workfile:   STKBFEXT.J86  $
6447: 0000: \***
6448: 0000: \***   $Revision:   1.0  $
6449: 0000: \***
6450: 0000: \******************************************************************************
6451: 0000: \******************************************************************************
6452: 0000: \***
6453: 0000: \***   $Log:   V:\archive\j86\stkbfext.j8v  $
6454: 0000: \***   
6455: 0000: \***      Rev 1.0   15 Jul 1997 14:20:38   DEV45PS
6456: 0000: \***    
6457: 0000: \***   
6458: 0000: \***      Rev 1.0   09 Jul 1997 11:04:54   DEV45PS
6459: 0000: \***   Stocktake System New Files
6460: 0000: \***   
6461: 0000: \******************************************************************************
6462: 0000: \******************************************************************************\*****************************************************************************
6463: 0000: \***
6464: 0000: \***           FUNCTION DEFINITIONS FOR THE STOCKTAKE BUFFER FILE
6465: 0000: \***
6466: 0000: \***           REFERENCE:   STKBFEXT.J86
6467: 0000: \***
6468: 0000: \***           VERSION A         Nik Sen         19th June 1997
6469: 0000: \***
6470: 0000: \***
6471: 0000: \*******************************************************************************
6472: 0000: \*******************************************************************************
6473: 0000: 
6474: 0000:    FUNCTION STKBF.SET EXTERNAL
6475: 0000:    END FUNCTION
6476: 0000:    
6477: 0000:    FUNCTION READ.STKBF EXTERNAL
6478: 0000:       INTEGER*2 READ.STKBF
6479: 0000:    END FUNCTION
6480: 0000:    
6481: 0000:    FUNCTION WRITE.STKBF EXTERNAL
6482: 0000:       INTEGER*2 WRITE.STKBF
6483: 0000:    END FUNCTION
6484: 0000:  
6485: 0000:  %INCLUDE SXTMPEXT.J86                    ! 1.5
6486: 0000: \*****************************************************************************
6487: 0000: \***
6488: 0000: \***           FUNCTION DEFINITIONS FOR THE TEMPORARY STOCKTAKE BUFFER FILE
6489: 0000: \***
6490: 0000: \***           REFERENCE:   STKBFEXT.J86
6491: 0000: \***
6492: 0000: \***           VERSION A         Nik Sen         30th June 1997
6493: 0000: \***
6494: 0000: \***
6495: 0000: \*******************************************************************************
6496: 0000: \*******************************************************************************
6497: 0000: 
6498: 0000:    FUNCTION SXTMP.SET EXTERNAL
6499: 0000:    END FUNCTION
6500: 0000:    
6501: 0000:    FUNCTION READ.SXTMP EXTERNAL
6502: 0000:       INTEGER*2 READ.SXTMP
6503: 0000:    END FUNCTION
6504: 0000:    
6505: 0000:    FUNCTION WRITE.SXTMP EXTERNAL
6506: 0000:       INTEGER*2 WRITE.SXTMP
6507: 0000:    END FUNCTION
6508: 0000:  
6509: 0000:  %INCLUDE STKTKEXT.J86                    ! 1.5
6510: 0000: \*****************************************************************************
6511: 0000: \*****************************************************************************
6512: 0000: \***
6513: 0000: \***      EXTERNAL FUNCTION DEFINITIONS FOR STOCKTAKE
6514: 0000: \***
6515: 0000: \***      REFERENCE: STKTKEXT.J86
6516: 0000: \***
6517: 0000: \*****************************************************************************
6518: 0000: \*****************************************************************************
6519: 0000: 
6520: 0000: 
6521: 0000:    FUNCTION STKTK.SET EXTERNAL
6522: 0000:    END FUNCTION
6523: 0000:    
6524: 0000:  %INCLUDE STLDTEXT.J86                    ! 1.6
6525: 0000: \*****************************************************************************
6526: 0000: \*****************************************************************************
6527: 0000: \***
6528: 0000: \***                   FUNCTION DEFINITIONS FOR THE STLDT
6529: 0000: \***
6530: 0000: \***           Version A           David Artiss         20th December 2000
6531: 0000: \***
6532: 0000: \*****************************************************************************
6533: 0000: \*****************************************************************************
6534: 0000: 
6535: 0000:    FUNCTION STLDT.SET EXTERNAL
6536: 0000:    END FUNCTION
6537: 0000: 
6538: 0000:   FUNCTION READ.STLDT EXTERNAL
6539: 0000:    INTEGER*2 READ.STLDT
6540: 0000:   END FUNCTION
6541: 0000: 
6542: 0000:   FUNCTION WRITE.STLDT EXTERNAL
6543: 0000:    INTEGER*2 WRITE.STLDT
6544: 0000:   END FUNCTION
6545: 0000:  %INCLUDE SXTCFEXT.J86                    ! 1.8DA
6546: 0000: \******************************************************************************
6547: 0000: \******************************************************************************
6548: 0000: \***
6549: 0000: \***   $Workfile:   SXTCFEXT.J86  $
6550: 0000: \***
6551: 0000: \***   $Revision:   1.0  $
6552: 0000: \***
6553: 0000: \******************************************************************************
6554: 0000: \******************************************************************************
6555: 0000: \***
6556: 0000: \***   $Log:   V:\archive\j86\sxtcfext.j8v  $
6557: 0000: \***   
6558: 0000: \***      Rev 1.0   15 Jul 1997 14:21:08   DEV45PS
6559: 0000: \***    
6560: 0000: \***   
6561: 0000: \***      Rev 1.0   09 Jul 1997 11:05:30   DEV45PS
6562: 0000: \***   Stocktake System New Files
6563: 0000: \***   
6564: 0000: \******************************************************************************
6565: 0000: \******************************************************************************\*****************************************************************************
6566: 0000: \*****************************************************************************
6567: 0000: \***
6568: 0000: \***                  FUNCTION DEFINITIONS FOR SXTCF
6569: 0000: \***
6570: 0000: \***                      REFERENCE    : SXTCFEXA
6571: 0000: \***
6572: 0000: \***           VERSION A : NIK SEN  3rd July 1997
6573: 0000: \***
6574: 0000: \*****************************************************************************
6575: 0000: \*****************************************************************************
6576: 0000: 
6577: 0000:    FUNCTION SXTCF.SET EXTERNAL
6578: 0000:    END FUNCTION
6579: 0000: 
6580: 0000:   FUNCTION READ.SXTCF.LOCK EXTERNAL
6581: 0000:    INTEGER*1 READ.SXTCF.LOCK
6582: 0000:   END FUNCTION
6583: 0000: 
6584: 0000:   FUNCTION WRITE.SXTCF.UNLOCK EXTERNAL
6585: 0000:    INTEGER*1 WRITE.SXTCF.UNLOCK
6586: 0000:   END FUNCTION
6587: 0000: 
6588: 0000:   FUNCTION WRITE.SXTCF.UNLOCK.HOLD EXTERNAL
6589: 0000:    INTEGER*1 WRITE.SXTCF.UNLOCK.HOLD
6590: 0000:   END FUNCTION
6591: 0000: 
6592: 0000:   FUNCTION READ.SXTCF EXTERNAL
6593: 0000:    INTEGER*1 READ.SXTCF
6594: 0000:   END FUNCTION
6595: 0000: 
6596: 0000:   FUNCTION WRITE.SXTCF         EXTERNAL
6597: 0000:    INTEGER*1 WRITE.SXTCF        
6598: 0000:   END FUNCTION
6599: 0000: 
6600: 0000:  %INCLUDE STKCFEXT.J86                    ! 1.8DA
6601: 0000: \*****************************************************************************
6602: 0000: \*****************************************************************************
6603: 0000: \***
6604: 0000: \***                  FUNCTION DEFINITIONS FOR STKCF
6605: 0000: \***
6606: 0000: \***                      REFERENCE    : STKCFEXA
6607: 0000: \***
6608: 0000: \***           VERSION A : STEVEN GOULDING  11.01.93
6609: 0000: \***
6610: 0000: \*****************************************************************************
6611: 0000: \*****************************************************************************
6612: 0000: 
6613: 0000:    FUNCTION STKCF.SET EXTERNAL
6614: 0000:    END FUNCTION
6615: 0000: 
6616: 0000:   FUNCTION READ.STKCF.LOCK EXTERNAL
6617: 0000:    INTEGER*1 READ.STKCF.LOCK
6618: 0000:   END FUNCTION
6619: 0000: 
6620: 0000:   FUNCTION WRITE.STKCF.UNLOCK EXTERNAL
6621: 0000:    INTEGER*1 WRITE.STKCF.UNLOCK
6622: 0000:   END FUNCTION
6623: 0000: 
6624: 0000:   FUNCTION WRITE.STKCF.UNLOCK.HOLD EXTERNAL
6625: 0000:    INTEGER*1 WRITE.STKCF.UNLOCK.HOLD
6626: 0000:   END FUNCTION
6627: 0000: 
6628: 0000:   FUNCTION READ.STKCF EXTERNAL
6629: 0000:    INTEGER*1 READ.STKCF
6630: 0000:   END FUNCTION
6631: 0000: 
6632: 0000:   FUNCTION WRITE.STKCF         EXTERNAL
6633: 0000:    INTEGER*1 WRITE.STKCF        
6634: 0000:   END FUNCTION
6635: 0000: 
6636: 0000:  %INCLUDE STKMFEXT.J86                    ! 1.8DA
6637: 0000: \******************************************************************************
6638: 0000: \******************************************************************************
6639: 0000: \***
6640: 0000: \***   $Workfile:   STKMFEXT.J86  $
6641: 0000: \***
6642: 0000: \***   $Revision:   1.0  $
6643: 0000: \***
6644: 0000: \******************************************************************************
6645: 0000: \******************************************************************************
6646: 0000: \***
6647: 0000: \***   $Log:   V:\archive\j86\stkmfext.j8v  $
6648: 0000: \***   
6649: 0000: \***      Rev 1.0   15 Jul 1997 14:20:56   DEV45PS
6650: 0000: \***    
6651: 0000: \***   
6652: 0000: \***      Rev 1.0   09 Jul 1997 11:05:18   DEV45PS
6653: 0000: \***   Stocktake System New Files
6654: 0000: \***   
6655: 0000: \******************************************************************************
6656: 0000: \******************************************************************************\*****************************************************************************
6657: 0000: \***
6658: 0000: \***  FUNCTION DEFINITIONS FOR THE STOCKTAKE MAINFRAME TRANSMISSION FILE
6659: 0000: \***
6660: 0000: \***           REFERENCE:   STKMFEXT.J86
6661: 0000: \***
6662: 0000: \***           VERSION A         Nik Sen         19th June 1997
6663: 0000: \***
6664: 0000: \***
6665: 0000: \*******************************************************************************
6666: 0000: \*******************************************************************************
6667: 0000: 
6668: 0000:    FUNCTION STKMF.SET EXTERNAL
6669: 0000:    END FUNCTION
6670: 0000:    
6671: 0000:    FUNCTION READ.STKMF EXTERNAL
6672: 0000:       INTEGER*2 READ.STKMF
6673: 0000:    END FUNCTION
6674: 0000:    
6675: 0000:    FUNCTION WRITE.STKMF EXTERNAL
6676: 0000:       INTEGER*2 WRITE.STKMF
6677: 0000:    END FUNCTION
6678: 0000:  
6679: 0000:  %INCLUDE STKRCEXT.J86                    ! 1.8DA
6680: 0000: \******************************************************************************
6681: 0000: \******************************************************************************
6682: 0000: \***
6683: 0000: \***   $Workfile:   STKRCEXT.J86  $
6684: 0000: \***
6685: 0000: \***   $Revision:   1.0  $
6686: 0000: \***
6687: 0000: \******************************************************************************
6688: 0000: \******************************************************************************
6689: 0000: \***
6690: 0000: \***   $Log:   V:\archive\j86\stkrcext.j8v  $
6691: 0000: \***   
6692: 0000: \***      Rev 1.0   15 Jul 1997 14:21:00   DEV45PS
6693: 0000: \***    
6694: 0000: \***   
6695: 0000: \***      Rev 1.0   09 Jul 1997 11:05:24   DEV45PS
6696: 0000: \***   Stocktake System New Files
6697: 0000: \***   
6698: 0000: \******************************************************************************
6699: 0000: \******************************************************************************\*****************************************************************************
6700: 0000: \***
6701: 0000: \***           FUNCTION DEFINITIONS FOR THE STOCKTAKE RECOUNT FILE
6702: 0000: \***
6703: 0000: \***           REFERENCE:   STKRCEXT.J86
6704: 0000: \***
6705: 0000: \***           VERSION A         Nik Sen         19th June 1997
6706: 0000: \***
6707: 0000: \***
6708: 0000: \*******************************************************************************
6709: 0000: \*******************************************************************************
6710: 0000: 
6711: 0000:    FUNCTION STKRC.SET EXTERNAL
6712: 0000:    END FUNCTION
6713: 0000:    
6714: 0000:    FUNCTION READ.STKRC EXTERNAL
6715: 0000:       INTEGER*2 READ.STKRC
6716: 0000:    END FUNCTION
6717: 0000:    
6718: 0000:    FUNCTION WRITE.STKRC EXTERNAL
6719: 0000:       INTEGER*2 WRITE.STKRC
6720: 0000:    END FUNCTION
6721: 0000:  
6722: 0000:  %INCLUDE XGCFEXT.J86                     ! 1.8DA
6723: 0000: \******************************************************************************
6724: 0000: \******************************************************************************
6725: 0000: \***
6726: 0000: \***         %INCLUDE FOR STOCKTAKE GROUP CODE FILE
6727: 0000: \***
6728: 0000: \***                  FILE TYPE    : Keyed
6729: 0000: \***
6730: 0000: \***                  REFERENCE    : XGCFEXT.J86
6731: 0000: \***
6732: 0000: \***    VERSION A               Steve Wright                        24 Aug 1999
6733: 0000: \***
6734: 0000: \*******************************************************************************
6735: 0000: \*******************************************************************************
6736: 0000: 
6737: 0000: FUNCTION XGCF.SET EXTERNAL
6738: 0000: END FUNCTION
6739: 0000: 
6740: 0000: FUNCTION READ.XGCF EXTERNAL
6741: 0000:    INTEGER*2 READ.XGCF
6742: 0000: END FUNCTION
6743: 0000: 
6744: 0000: FUNCTION READ.XGCF.LOCK EXTERNAL
6745: 0000:    INTEGER*2 READ.XGCF.LOCK
6746: 0000: END FUNCTION
6747: 0000: 
6748: 0000: FUNCTION WRITE.XGCF EXTERNAL
6749: 0000:    INTEGER*2 WRITE.XGCF
6750: 0000: END FUNCTION
6751: 0000: 
6752: 0000: FUNCTION WRITE.XGCF.HOLD EXTERNAL
6753: 0000:    INTEGER*2 WRITE.XGCF.HOLD
6754: 0000: END FUNCTION
6755: 0000: 
6756: 0000: FUNCTION WRITE.XGCF.UNLOCK EXTERNAL
6757: 0000:    INTEGER*2 WRITE.XGCF.UNLOCK
6758: 0000: END FUNCTION
6759: 0000: 
6760: 0000:  %INCLUDE STKEXEXT.J86                    ! 1.8DA
6761: 0000: \******************************************************************************
6762: 0000: \******************************************************************************
6763: 0000: \***
6764: 0000: \***   $Workfile:   STKEXEXT.J86  $
6765: 0000: \***
6766: 0000: \***   $Revision:   1.0  $
6767: 0000: \***
6768: 0000: \******************************************************************************
6769: 0000: \******************************************************************************
6770: 0000: \***
6771: 0000: \***   $Log:   V:\archive\j86\stkexext.j8v  $
6772: 0000: \***   
6773: 0000: \***      Rev 1.0   15 Jul 1997 14:20:44   DEV45PS
6774: 0000: \***    
6775: 0000: \***   
6776: 0000: \***      Rev 1.0   09 Jul 1997 11:05:06   DEV45PS
6777: 0000: \***   Stocktake System New Files
6778: 0000: \***   
6779: 0000: \******************************************************************************
6780: 0000: \******************************************************************************\*****************************************************************************
6781: 0000: \***
6782: 0000: \***           FUNCTION DEFINITIONS FOR THE STOCKTAKE EXCEPTIONS FILE
6783: 0000: \***
6784: 0000: \***           REFERENCE:   STKEXEXT.J86
6785: 0000: \***
6786: 0000: \***           VERSION A         Nik Sen         19th June 1997
6787: 0000: \***
6788: 0000: \***
6789: 0000: \*******************************************************************************
6790: 0000: \*******************************************************************************
6791: 0000: 
6792: 0000:    FUNCTION STKEX.SET EXTERNAL
6793: 0000:    END FUNCTION
6794: 0000:    
6795: 0000:    FUNCTION READ.STKEX EXTERNAL
6796: 0000:       INTEGER*2 READ.STKEX
6797: 0000:    END FUNCTION
6798: 0000:    
6799: 0000:    FUNCTION WRITE.STKEX EXTERNAL
6800: 0000:       INTEGER*2 WRITE.STKEX
6801: 0000:    END FUNCTION
6802: 0000:  
6803: 0000:  %INCLUDE STKIFEXT.J86                    ! 1.8DA
6804: 0000: \******************************************************************************
6805: 0000: \******************************************************************************
6806: 0000: \***
6807: 0000: \***   $Workfile:   STKIFEXT.J86  $
6808: 0000: \***
6809: 0000: \***   $Revision:   1.0  $
6810: 0000: \***
6811: 0000: \******************************************************************************
6812: 0000: \******************************************************************************
6813: 0000: \***
6814: 0000: \***   $Log:   V:\archive\j86\stkifext.j8v  $
6815: 0000: \***   
6816: 0000: \***      Rev 1.0   15 Jul 1997 14:20:48   DEV45PS
6817: 0000: \***    
6818: 0000: \***   
6819: 0000: \***      Rev 1.0   09 Jul 1997 11:05:12   DEV45PS
6820: 0000: \***   Stocktake System New Files
6821: 0000: \***   
6822: 0000: \******************************************************************************
6823: 0000: \******************************************************************************\*****************************************************************************
6824: 0000: \***
6825: 0000: \***           FUNCTION DEFINITIONS FOR THE STOCKTAKE ITEM FILE
6826: 0000: \***
6827: 0000: \***           REFERENCE:   STKIFEXT.J86
6828: 0000: \***
6829: 0000: \***           VERSION A         Nik Sen         19th June 1997
6830: 0000: \***
6831: 0000: \***
6832: 0000: \*******************************************************************************
6833: 0000: \*******************************************************************************
6834: 0000: 
6835: 0000:    FUNCTION STKIF.SET EXTERNAL
6836: 0000:    END FUNCTION
6837: 0000:    
6838: 0000:    FUNCTION READ.STKIF EXTERNAL
6839: 0000:       INTEGER*2 READ.STKIF
6840: 0000:    END FUNCTION
6841: 0000:    
6842: 0000:    FUNCTION WRITE.STKIF EXTERNAL
6843: 0000:       INTEGER*2 WRITE.STKIF
6844: 0000:    END FUNCTION
6845: 0000:  
6846: 0000:  %INCLUDE LOCNTEXT.J86                    ! 1.8DA
6847: 0000: \******************************************************************************
6848: 0000: \******************************************************************************
6849: 0000: \***
6850: 0000: \***   $Workfile:   LOCNTEXT.J86  $
6851: 0000: \***
6852: 0000: \***   $Revision:   1.0  $
6853: 0000: \***
6854: 0000: \******************************************************************************
6855: 0000: \******************************************************************************
6856: 0000: \***
6857: 0000: \***   $Log:   V:\archive\j86\locntext.j8v  $
6858: 0000: \***   
6859: 0000: \***      Rev 1.0   03 Feb 1998 10:07:40   DEV69PS
6860: 0000: \***    
6861: 0000: \***   
6862: 0000: \******************************************************************************
6863: 0000: \******************************************************************************
6864: 0000: \***
6865: 0000: \***           FUNCTION DEFINITIONS FOR THE STOCKTAKE LOCATION COUNT FILE
6866: 0000: \***
6867: 0000: \***           REFERENCE:   LOCNTEXT.J86
6868: 0000: \***
6869: 0000: \***           VERSION A         Johnnie Chan    6th Jan 1998
6870: 0000: \***
6871: 0000: \***
6872: 0000: \*******************************************************************************
6873: 0000: \*******************************************************************************
6874: 0000: 
6875: 0000:    FUNCTION LOCCNT.SET EXTERNAL
6876: 0000:    END FUNCTION
6877: 0000:    
6878: 0000:    FUNCTION READ.LOCCNT EXTERNAL
6879: 0000:       INTEGER*2 READ.LOCCNT
6880: 0000:    END FUNCTION
6881: 0000:    
6882: 0000:    FUNCTION WRITE.LOCCNT EXTERNAL
6883: 0000:       INTEGER*2 WRITE.LOCCNT
6884: 0000:    END FUNCTION
6885: 0000: 
6886: 0000:    FUNCTION GET.LOCCNT.RECNUM(LOC.CODE$) EXTERNAL
6887: 0000:       INTEGER*4 GET.LOCCNT.RECNUM
6888: 0000:       STRING LOC.CODE$
6889: 0000:    END FUNCTION
6890: 0000:  
6891: 0000:  %INCLUDE STKIGEXT.J86                    ! 1.8DA
6892: 0000: \*****************************************************************************
6893: 0000: \***
6894: 0000: \***           FUNCTION DEFINITIONS FOR THE STOCKTAKE ITEM GROUP FILE
6895: 0000: \***
6896: 0000: \***           REFERENCE:   STKIGEXT.J86
6897: 0000: \***
6898: 0000: \***           VERSION A         Nik Sen         17th June 1997
6899: 0000: \***
6900: 0000: \***
6901: 0000: \*******************************************************************************
6902: 0000: \*******************************************************************************
6903: 0000: 
6904: 0000:    FUNCTION STKIG.SET EXTERNAL
6905: 0000:    END FUNCTION
6906: 0000:    
6907: 0000:    FUNCTION READ.STKIG EXTERNAL
6908: 0000:       INTEGER*2 READ.STKIG
6909: 0000:    END FUNCTION
6910: 0000:    
6911: 0000:    FUNCTION WRITE.STKIG EXTERNAL
6912: 0000:       INTEGER*2 WRITE.STKIG
6913: 0000:    END FUNCTION
6914: 0000:  
6915: 0000:  %INCLUDE STKTFEXT.J86                    ! 1.8DA
6916: 0000: \******************************************************************************
6917: 0000: \******************************************************************************
6918: 0000: \***
6919: 0000: \***   $Workfile:   STKTFEXT.J86  $
6920: 0000: \***
6921: 0000: \***   $Revision:   1.1  $
6922: 0000: \***
6923: 0000: \******************************************************************************
6924: 0000: \******************************************************************************
6925: 0000: \***
6926: 0000: \***   $Log:   V:\archive\j86\stktfext.j8v  $
6927: 0000: \***   
6928: 0000: \***      Rev 1.1   15 Jul 1997 14:36:30   DEV45PS
6929: 0000: \***    
6930: 0000: \***   
6931: 0000: \***      Rev 1.0   15 Jul 1997 14:21:04   DEV45PS
6932: 0000: \***   Stocktake System New Files
6933: 0000: \***   
6934: 0000: \******************************************************************************
6935: 0000: \******************************************************************************\*****************************************************************************
6936: 0000: \***
6937: 0000: \***           FUNCTION DEFINITIONS FOR THE STOCKTAKE TOTALS FILE
6938: 0000: \***
6939: 0000: \***           REFERENCE:   STKTFEXT.J86
6940: 0000: \***
6941: 0000: \***           VERSION A         Nik Sen         15th July 1997
6942: 0000: \***
6943: 0000: \***
6944: 0000: \*******************************************************************************
6945: 0000: \*******************************************************************************
6946: 0000: 
6947: 0000:    FUNCTION STKTF.SET EXTERNAL
6948: 0000:    END FUNCTION
6949: 0000:    
6950: 0000:    FUNCTION READ.STKTF EXTERNAL
6951: 0000:       INTEGER*2 READ.STKTF
6952: 0000:    END FUNCTION
6953: 0000:    
6954: 0000:    FUNCTION WRITE.STKTF EXTERNAL
6955: 0000:       INTEGER*2 WRITE.STKTF
6956: 0000:    END FUNCTION
6957: 0000:  
6958: 0000:  %INCLUDE IRFEXT.J86                      ! 1.8DA
6959: 0000: \*********************************************************************************
6960: 0000: \***
6961: 0000: \***      EXTERNAL FUNCTION DEFINITIONS FOR THE ITEM REFERENCE FILE
6962: 0000: \***
6963: 0000: \***                    REFERENCE : IRFEXT.J86
6964: 0000: \***
6965: 0000: \***      Version A          Andrew Wedgeworth        9th July 1992
6966: 0000: \***
6967: 0000: \***      Version B          Andrew Wedgeworth        14th December 1992
6968: 0000: \***      Version letter incremented to match other IRF code.
6969: 0000: \***
6970: 0000: \***      Version C           Steve Windsor        12.02.93
6971: 0000: \***      Added external reference to read the alternate IRF.
6972: 0000: \***
6973: 0000: \***      Version D           Steve Windsor        12.05.93
6974: 0000: \***      Added all external references that wre in the original FNS.
6975: 0000: \***
6976: 0000: \***      Version E           Steve Perkins        21.09.93
6977: 0000: \***      Deals project: Fields changed for new deals project
6978: 0000: \*** 
6979: 0000: \***      Version F           Mark Walker          5th January 1994
6980: 0000: \***      Version letter incremented to match other IRF code.           
6981: 0000: \***                                                                    
6982: 0000: \***      Version G     Stuart William McConnachie      11th February 2000
6983: 0000: \***      Converted IRF.INDICAT2$ to integer flag byte.
6984: 0000: \***
6985: 0000: \***      REVISION 1.6.               ROBERT COWEY.               9 JUL 2002.
6986: 0000: \***      Major changes to IRF layout for 2002 Deals Rewrite project.
6987: 0000: \***      No changes to this particular file for this revision.
6988: 0000: \***
6989: 0000: \***      REVISION 1.7.               ROBERT COWEY.               5 AUG 2002.
6990: 0000: \***      Further changes for 2002 Deals Rewrite project (PSBF19 related).
6991: 0000: \***      Defined new functions CONCAT.NEW.IRF.DATA$ and SPLIT.NEW.IRF.DATA$.
6992: 0000: \***
6993: 0000: \***      REVISION 1.8                ROBERT COWEY.              15 JUL 2003.
6994: 0000: \***      Usage of INDICAT0% bit-3 X'08' changed to Item Contains Alcohol.
6995: 0000: \***      No changes to this file other than description.
6996: 0000: \***      No changes to IRF file functions.
6997: 0000: \***
6998: 0000: \***      REVISION 1.9.      STUART WILLIAM MCCONNACHIE           22 OCT 2003.
6999: 0000: \***      Changes to remove limit of 3 deals per item.
7000: 0000: \***      No changes to this file.
7001: 0000: \***
7002: 0000: \***      REVISION 2.0.             ALAN CARR                      9 FEB 2006.
7003: 0000: \***      Add new IRF.INDICAT8% 1 byte, amend IRF.UNUSED$ from 3 to 2 bytes.
7004: 0000: \***      No changes to this file.
7005: 0000: \***
7006: 0000: \***..............................................................................
7007: 0000:    
7008: 0000:    FUNCTION IRF.SET EXTERNAL
7009: 0000:    END FUNCTION
7010: 0000: 
7011: 0000:   FUNCTION CONCAT.NEW.IRF.DATA$ EXTERNAL                                  ! 1.7 RC
7012: 0000:   END FUNCTION                                                            ! 1.7 RC
7013: 0000: 
7014: 0000:   FUNCTION SPLIT.NEW.IRF.DATA$ EXTERNAL                                   ! 1.7 RC
7015: 0000:   END FUNCTION                                                            ! 1.7 RC
7016: 0000:   
7017: 0000:   FUNCTION READ.IRF EXTERNAL
7018: 0000:    INTEGER*2 READ.IRF
7019: 0000:   END FUNCTION
7020: 0000: 
7021: 0000:   FUNCTION READ.IRF.ALT EXTERNAL
7022: 0000:    INTEGER*2 READ.IRF.ALT
7023: 0000:   END FUNCTION
7024: 0000: 
7025: 0000:   FUNCTION READ.IRF.LOCK EXTERNAL
7026: 0000:    INTEGER*2 READ.IRF.LOCK
7027: 0000:   END FUNCTION
7028: 0000: 
7029: 0000:   FUNCTION WRITE.IRF EXTERNAL
7030: 0000:    INTEGER*2 WRITE.IRF
7031: 0000:   END FUNCTION
7032: 0000: 
7033: 0000:   FUNCTION WRITE.IRF.UNLOCK EXTERNAL
7034: 0000:    INTEGER*2 WRITE.IRF.UNLOCK
7035: 0000:   END FUNCTION
7036: 0000: 
7037: 0000:   FUNCTION WRITE.IRF.HOLD EXTERNAL
7038: 0000:    INTEGER*2 WRITE.IRF.HOLD
7039: 0000:   END FUNCTION
7040: 0000: 
7041: 0000:   FUNCTION WRITE.IRF.HOLD.UNLOCK EXTERNAL
7042: 0000:    INTEGER*2 WRITE.IRF.HOLD.UNLOCK
7043: 0000:   END FUNCTION
7044: 0000: 
7045: 0000:   
7046: 0000:  %INCLUDE STKDCEXT.J86                    ! 1.8DA
7047: 0000: \******************************************************************************
7048: 0000: \******************************************************************************
7049: 0000: \***
7050: 0000: \***   $Workfile:   STKDCEXT.J86  $
7051: 0000: \***
7052: 0000: \***   $Revision:   1.0  $
7053: 0000: \***
7054: 0000: \******************************************************************************
7055: 0000: \******************************************************************************
7056: 0000: \***
7057: 0000: \***   $Log:   V:\archive\j86\stkdcext.j8v  $
7058: 0000: \***   
7059: 0000: \***      Rev 1.0   15 Jul 1997 14:20:40   DEV45PS
7060: 0000: \***    
7061: 0000: \***   
7062: 0000: \***      Rev 1.0   09 Jul 1997 11:05:00   DEV45PS
7063: 0000: \***   Stocktake System New Files
7064: 0000: \***   
7065: 0000: \******************************************************************************
7066: 0000: \******************************************************************************\*****************************************************************************
7067: 0000: \***
7068: 0000: \***           FUNCTION DEFINITIONS FOR THE STOCKTAKE DUMP CODE FILE
7069: 0000: \***
7070: 0000: \***           REFERENCE:   STKDCEXT.J86
7071: 0000: \***
7072: 0000: \***           VERSION A         Nik Sen         19th June 1997
7073: 0000: \***
7074: 0000: \***
7075: 0000: \*******************************************************************************
7076: 0000: \*******************************************************************************
7077: 0000: 
7078: 0000:    FUNCTION STKDC.SET EXTERNAL
7079: 0000:    END FUNCTION
7080: 0000:    
7081: 0000:    FUNCTION READ.STKDC EXTERNAL
7082: 0000:       INTEGER*2 READ.STKDC
7083: 0000:    END FUNCTION
7084: 0000:    
7085: 0000:    FUNCTION WRITE.STKDC EXTERNAL
7086: 0000:       INTEGER*2 WRITE.STKDC
7087: 0000:    END FUNCTION
7088: 0000:  
7089: 0000:  %INCLUDE IMSTCEXT.J86                    ! 1.9BG
7090: 0000: \***********************************************************************
7091: 0000: \***********************************************************************
7092: 0000: \***
7093: 0000: \***    DESCRIPTION: Item Movement & Stock File
7094: 0000: \***                 External File Function Definitions
7095: 0000: \***
7096: 0000: \***    FILE TYPE : Keyed
7097: 0000: \***
7098: 0000: \***********************************************************************
7099: 0000: \***
7100: 0000: \***    Version A.          Les Cook                     21st Aug 1992
7101: 0000: \***    Initial version.
7102: 0000: \***
7103: 0000: \***    VERSION 1.1         Julia Stones                 13th Jun 2005
7104: 0000: \***    Added new external functions for
7105: 0000: \***        MIMSTC - merged IMSTC
7106: 0000: \***        CIMSTC - Copy of IMSTC
7107: 0000: \***        BIMSTC - Backup of IMSTC
7108: 0000: \***
7109: 0000: \***    Version C.          Mark Walker                  23rd Jan 2014
7110: 0000: \***    F337 Centralised View of Stock
7111: 0000: \***    - Moved BIMST, CIMST and MIMST external function definitions
7112: 0000: \***      to separate modules.
7113: 0000: \***    - Minor formatting changes (uncommented).
7114: 0000: \***
7115: 0000: \***********************************************************************
7116: 0000: \***********************************************************************
7117: 0000: 
7118: 0000: FUNCTION IMSTC.SET EXTERNAL
7119: 0000: END FUNCTION
7120: 0000: 
7121: 0000: FUNCTION READ.IMSTC EXTERNAL
7122: 0000:     INTEGER*2 READ.IMSTC
7123: 0000: END FUNCTION
7124: 0000: 
7125: 0000: FUNCTION READ.IMSTC.LOCK EXTERNAL
7126: 0000:     INTEGER*2 READ.IMSTC.LOCK
7127: 0000: END FUNCTION
7128: 0000: 
7129: 0000: FUNCTION WRITE.IMSTC EXTERNAL
7130: 0000:    INTEGER*2 WRITE.IMSTC
7131: 0000: END FUNCTION
7132: 0000: 
7133: 0000: FUNCTION WRITE.IMSTC.UNLOCK.HOLD EXTERNAL
7134: 0000:     INTEGER*2 WRITE.IMSTC.UNLOCK.HOLD
7135: 0000: END FUNCTION
7136: 0000: 
7137: 0000: FUNCTION WRITE.IMSTC.UNLOCK EXTERNAL
7138: 0000:    INTEGER*2 WRITE.IMSTC.UNLOCK
7139: 0000: END FUNCTION
7140: 0000: 
7141: 0000: FUNCTION WRITE.IMSTC.HOLD EXTERNAL
7142: 0000:    INTEGER*2 WRITE.IMSTC.HOLD
7143: 0000: END FUNCTION
7144: 0000: 
7145: 0000:  %INCLUDE STOCKEXT.J86                    ! 1.9BG
7146: 0000: \***********************************************************************
7147: 0000: \***********************************************************************
7148: 0000: \***
7149: 0000: \***    DESCRIPTION: Stock File
7150: 0000: \***                 External File Function Definitions
7151: 0000: \***
7152: 0000: \***    FILE TYPE : Keyed
7153: 0000: \***
7154: 0000: \***********************************************************************
7155: 0000: \***
7156: 0000: \***    Version A.          Les Cook                     21st Aug 1992
7157: 0000: \***    Initial version.
7158: 0000: \***
7159: 0000: \***    Version B.          Robert Cowey                 21st Oct 1993
7160: 0000: \***    No changes to this file.
7161: 0000: \***
7162: 0000: \***    Version C.          Nik Sen                      22nd Dec 1994
7163: 0000: \***    WRITE.STOCK.HOLD added.
7164: 0000: \***
7165: 0000: \***    Version D.          Mark Walker                  23rd Jan 2014
7166: 0000: \***    F337 Centralised View of Stock
7167: 0000: \***    - Minor formatting changes (uncommented).
7168: 0000: \***
7169: 0000: \***********************************************************************
7170: 0000: \***********************************************************************
7171: 0000: 
7172: 0000: FUNCTION STOCK.SET EXTERNAL
7173: 0000: END FUNCTION
7174: 0000:    
7175: 0000: FUNCTION READ.STOCK EXTERNAL
7176: 0000:     INTEGER*2 READ.STOCK
7177: 0000: END FUNCTION
7178: 0000:    
7179: 0000: FUNCTION WRITE.STOCK EXTERNAL
7180: 0000:     INTEGER*2 WRITE.STOCK
7181: 0000: END FUNCTION
7182: 0000:    
7183: 0000: FUNCTION WRITE.STOCK.HOLD EXTERNAL
7184: 0000:     INTEGER*2 WRITE.STOCK.HOLD
7185: 0000: END FUNCTION
7186: 0000: 
7187: 0000: FUNCTION READ.STOCK.LOCK EXTERNAL
7188: 0000:     INTEGER*2 READ.STOCK.LOCK
7189: 0000: END FUNCTION
7190: 0000:    
7191: 0000: FUNCTION WRITE.STOCK.UNLOCK EXTERNAL
7192: 0000:     INTEGER*2 WRITE.STOCK.UNLOCK
7193: 0000: END FUNCTION
7194: 0000:    
7195: 0000: FUNCTION WRITE.STOCK.UNLOCK.HOLD EXTERNAL
7196: 0000:     INTEGER*2 WRITE.STOCK.UNLOCK.HOLD
7197: 0000: END FUNCTION
7198: 0000: 
7199: 0000:  %INCLUDE MINLSEXT.J86                    ! 1.9BG
7200: 0000: 
7201: 0000: \*****************************************************************************
7202: 0000: \*****************************************************************************
7203: 0000: \***
7204: 0000: \***        %INCLUDE FOR FILE HANDLING FUNCTIONS EXTERNAL DEFINITIONS
7205: 0000: \***
7206: 0000: \***                   FILE TYPE:  KEYED
7207: 0000: \***
7208: 0000: \***                   REFERENCE:  MINLSEXT.J86
7209: 0000: \***
7210: 0000: \***	             DESCRIPTION:  MINSITS RP - SCREEN COUNT INFORMATION
7211: 0000: \***
7212: 0000: \***
7213: 0000: \***
7214: 0000: \***      VERSION 1 : Julia Stones             8th January 1998   
7215: 0000: \***      
7216: 0000: \*****************************************************************************
7217: 0000: \*****************************************************************************
7218: 0000: 
7219: 0000: 
7220: 0000:   FUNCTION MINLS.SET EXTERNAL
7221: 0000:      INTEGER*2 MINLS.SET
7222: 0000:   END FUNCTION
7223: 0000: 
7224: 0000: 
7225: 0000:   FUNCTION READ.MINLS EXTERNAL
7226: 0000:     INTEGER*2 READ.MINLS
7227: 0000:   END FUNCTION
7228: 0000:   
7229: 0000: 
7230: 0000:   FUNCTION READ.MINLS.LOCKED EXTERNAL
7231: 0000:     INTEGER*2 READ.MINLS.LOCKED
7232: 0000:   END FUNCTION  
7233: 0000: 
7234: 0000: 
7235: 0000:   FUNCTION WRITE.HOLD.MINLS EXTERNAL
7236: 0000:     INTEGER*2 WRITE.HOLD.MINLS
7237: 0000:   END FUNCTION
7238: 0000: 
7239: 0000: 
7240: 0000:   FUNCTION WRITE.UNLOCK.MINLS EXTERNAL
7241: 0000:     INTEGER*2 WRITE.UNLOCK.MINLS
7242: 0000:   END FUNCTION
7243: 0000: 
7244: 0000: 
7245: 0000:   FUNCTION WRITE.HOLD.UNLOCK.MINLS EXTERNAL
7246: 0000:     INTEGER*2 WRITE.HOLD.UNLOCK.MINLS
7247: 0000:   END FUNCTION
7248: 0000:   
7249: 0000: 
7250: 0000:   FUNCTION WRITE.MINLS EXTERNAL
7251: 0000:     INTEGER*2 WRITE.MINLS
7252: 0000:   END FUNCTION
7253: 0000: 
7254: 0000:  %INCLUDE NEGSCEXT.J86                    ! 1.9BG
7255: 0000: 
7256: 0000: \*****************************************************************************
7257: 0000: \*****************************************************************************
7258: 0000: \***
7259: 0000: \***        %INCLUDE FOR FILE HANDLING FUNCTIONS EXTERNAL DEFINITIONS
7260: 0000: \***
7261: 0000: \***                   FILE TYPE:  KEYED
7262: 0000: \***
7263: 0000: \***                   REFERENCE:  NEGSCEXT.J86
7264: 0000: \***
7265: 0000: \***                 DESCRIPTION:  CURRENT NEGATIVE STOCK COUNT INFORMATION
7266: 0000: \***
7267: 0000: \***
7268: 0000: \***
7269: 0000: \***      VERSION 1 : Julia Stones             15th July 1999   
7270: 0000: \***      
7271: 0000: \***    REVISION 1.2.            ROBERT COWEY.                  09 SEP 2003.
7272: 0000: \***    Changes for RF trial.
7273: 0000: \***    Recompiled to prevent future automatic recompiles.
7274: 0000: \***    No changes to actual code.
7275: 0000: \***
7276: 0000: \*****************************************************************************
7277: 0000: \*****************************************************************************
7278: 0000: 
7279: 0000: 
7280: 0000:   FUNCTION NEGSC.SET EXTERNAL
7281: 0000:      INTEGER*2 NEGSC.SET
7282: 0000:   END FUNCTION
7283: 0000: 
7284: 0000: 
7285: 0000:   FUNCTION READ.NEGSC EXTERNAL
7286: 0000:     INTEGER*2 READ.NEGSC
7287: 0000:   END FUNCTION
7288: 0000:   
7289: 0000: 
7290: 0000:   FUNCTION READ.NEGSC.LOCKED EXTERNAL
7291: 0000:     INTEGER*2 READ.NEGSC.LOCKED
7292: 0000:   END FUNCTION  
7293: 0000: 
7294: 0000: 
7295: 0000:   FUNCTION WRITE.HOLD.NEGSC EXTERNAL
7296: 0000:     INTEGER*2 WRITE.HOLD.NEGSC
7297: 0000:   END FUNCTION
7298: 0000: 
7299: 0000: 
7300: 0000:   FUNCTION WRITE.UNLOCK.NEGSC EXTERNAL
7301: 0000:     INTEGER*2 WRITE.UNLOCK.NEGSC
7302: 0000:   END FUNCTION
7303: 0000: 
7304: 0000: 
7305: 0000:   FUNCTION WRITE.HOLD.UNLOCK.NEGSC EXTERNAL
7306: 0000:     INTEGER*2 WRITE.HOLD.UNLOCK.NEGSC
7307: 0000:   END FUNCTION
7308: 0000:   
7309: 0000: 
7310: 0000:   FUNCTION WRITE.NEGSC EXTERNAL
7311: 0000:     INTEGER*2 WRITE.NEGSC
7312: 0000:   END FUNCTION
7313: 0000: 
7314: 0000:  %INCLUDE SSPSCEXT.J86                    ! 2.0JAS
7315: 0000: \*****************************************************************************
7316: 0000: \*****************************************************************************
7317: 0000: \***
7318: 0000: \***         FUNCTION DEFINITIONS FOR SSPSCTRL
7319: 0000: \***
7320: 0000: \***                    REFERENCE : SSPSCexa.J86
7321: 0000: \***
7322: 0000: \***    Version A           Julia Stones         23.10.2003
7323: 0000: \***
7324: 0000: \*******************************************************************************
7325: 0000: \*******************************************************************************
7326: 0000: 
7327: 0000:   FUNCTION SSPSCTRL.SET EXTERNAL
7328: 0000:    INTEGER*2 SSPSCTRL.SET
7329: 0000:   END FUNCTION
7330: 0000: 
7331: 0000:   FUNCTION READ.SSPSCTRL EXTERNAL
7332: 0000:    INTEGER*2 READ.SSPSCTRL
7333: 0000:   END FUNCTION
7334: 0000: 
7335: 0000:   FUNCTION READ.SSPSCTRL.LOCKED EXTERNAL
7336: 0000:    INTEGER*2 READ.SSPSCTRL.LOCKED
7337: 0000:   END FUNCTION
7338: 0000: 
7339: 0000:   FUNCTION WRITE.SSPSCTRL EXTERNAL
7340: 0000:    INTEGER*2 WRITE.SSPSCTRL
7341: 0000:   END FUNCTION
7342: 0000: 
7343: 0000:   FUNCTION WRITE.SSPSCTRL.UNLOCK EXTERNAL
7344: 0000:    INTEGER*2 WRITE.SSPSCTRL.UNLOCK
7345: 0000:   END FUNCTION
7346: 0000: 
7347: 0000:  %INCLUDE BTCSEXT.J86                     ! 2.0JAS
7348: 0000: \*****************************************************************************
7349: 0000: \*****************************************************************************
7350: 0000: \***
7351: 0000: \***         FUNCTION DEFINITIONS FOR BTCS FILE
7352: 0000: \***
7353: 0000: \***         REFERENCE    : BTCSEXT
7354: 0000: \***
7355: 0000: \***         VERSION A    : JULIA STONES 23/10/03
7356: 0000: \***
7357: 0000: \*****************************************************************************
7358: 0000: \*****************************************************************************
7359: 0000: 
7360: 0000:     FUNCTION BTCS.SET EXTERNAL
7361: 0000:     END FUNCTION
7362: 0000: 
7363: 0000:     FUNCTION READ.BTCS EXTERNAL
7364: 0000:     INTEGER*1 READ.BTCS
7365: 0000:     END FUNCTION
7366: 0000: 
7367: 0000:     FUNCTION READ.BTCS.LOCK EXTERNAL
7368: 0000:     INTEGER*1 READ.BTCS.LOCK
7369: 0000:     END FUNCTION
7370: 0000: 
7371: 0000:     FUNCTION WRITE.BTCS EXTERNAL
7372: 0000:     INTEGER*1 WRITE.BTCS
7373: 0000:     END FUNCTION
7374: 0000: 
7375: 0000:     FUNCTION WRITE.BTCS.UNLOCK EXTERNAL
7376: 0000:     INTEGER*1 WRITE.BTCS.UNLOCK
7377: 0000:     END FUNCTION
7378: 0000: 
7379: 0000:     FUNCTION WRITE.BTCS.UNLOCK.HOLD EXTERNAL
7380: 0000:     INTEGER*1 WRITE.BTCS.UNLOCK.HOLD
7381: 0000:     END FUNCTION
7382: 0000: 
7383: 0000:  %INCLUDE PRINTEXT.J86                    ! 2.0JAS
7384: 0000: 
7385: 0000: REM \
7386: 0000: \*******************************************************************************
7387: 0000: \*******************************************************************************
7388: 0000: \***
7389: 0000: \***    %INCLUDE FOR PRINT FILE EXTERNAL FUNCTIONS
7390: 0000: \***
7391: 0000: \***        REFERENCE   :   PRINTEX (J86)
7392: 0000: \***
7393: 0000: \***        FILE TYPE   :   Printer / Labeller
7394: 0000: \***
7395: 0000: \***    VERSION A.              ANDREW WEDGEWORTH                   09 JUL 1992.
7396: 0000: \***    Original version created from PRINTEXG.
7397: 0000: \***
7398: 0000: \***    VERSION B.              UNKNOWN.                            ?? ??? 1992.
7399: 0000: \***    Changes unknown.
7400: 0000: \***
7401: 0000: \***    VERSION C.              ROBERT COWEY.                       18 NOV 1992.
7402: 0000: \***    Defined function variables for use as return codes.
7403: 0000: \***
7404: 0000: \***    Version C               Andrew Wedgeworth                 24th May 1992
7405: 0000: \***    Condensed print function added.
7406: 0000: \***
7407: 0000: \***    Version D               Stuart WIlliam McConnachie       31st July 2000.
7408: 0000: \***    Added function for PCL printing to LaserJet.
7409: 0000: \***
7410: 0000: \***    Version E               Charles Skadorwa                   4th Apr 2008.
7411: 0000: \***    Added parameter to WRITE.CONDENSED.PRINT function to
7412: 0000: \***    enable Alliance Pharmacy Brother Laser printers to print
7413: 0000: \***    in condensed mode.
7414: 0000: \***
7415: 0000: \***    Version F           Charles Skadorwa                       2nd Mar 2016.
7416: 0000: \***    It was found that certain reports would not print when stores
7417: 0000: \***    were converted to LAN attached printing.
7418: 0000: \***
7419: 0000: \***    Added new function: WRITE.PRINT.PLUS.LF based on WRITE.PRINT.
7420: 0000: \***    This adds a Line-Feed characters to every print line.
7421: 0000: \***
7422: 0000: \*******************************************************************************
7423: 0000: \*******************************************************************************
7424: 0000: 
7425: 0000: 
7426: 0000:     FUNCTION PRINT.SET EXTERNAL
7427: 0000:         INTEGER*2 PRINT.SET
7428: 0000:     END FUNCTION
7429: 0000: 
7430: 0000: 
7431: 0000:     FUNCTION WRITE.PRINT EXTERNAL
7432: 0000:        INTEGER*2 WRITE.PRINT
7433: 0000:     END FUNCTION
7434: 0000: 
7435: 0000: 
7436: 0000:     FUNCTION WRITE.PRINT.PLUS.LF EXTERNAL                               !FCS
7437: 0000:        INTEGER*2 WRITE.PRINT.PLUS.LF                                    !FCS
7438: 0000:     END FUNCTION                                                        !FCS
7439: 0000: 
7440: 0000: 
7441: 0000:     FUNCTION WRITE.CONDENSED.PRINT (AP.STORE) EXTERNAL                 ! ECSk
7442: 0000:        INTEGER*2 WRITE.CONDENSED.PRINT
7443: 0000:     END FUNCTION
7444: 0000: 
7445: 0000: 
7446: 0000:     FUNCTION WRITE.PCL.PRINT EXTERNAL                                  ! DSWM
7447: 0000:        INTEGER*2 WRITE.PCL.PRINT                                       ! DSWM
7448: 0000:     END FUNCTION                                                       ! DSWM
7449: 0000: 
7450: 0000: 
7451: 0000:     FUNCTION WRITE.LABEL EXTERNAL
7452: 0000:         INTEGER*2 WRITE.LABEL
7453: 0000:     END FUNCTION
7454: 0000: 
7455: 0000:  %INCLUDE SOPTSEXT.J86                    ! 2.1JAS
7456: 0000: \*******************************************************************************
7457: 0000: \***                                                                         ***
7458: 0000: \***      EXTERNAL FUNCTION DEFINITIONS FOR THE STORE OPTIONS FILE           ***
7459: 0000: \***                                                                         ***
7460: 0000: \***                     REFERENCE : SOPTSEXT.J86                            ***
7461: 0000: \***                                                                         ***
7462: 0000: \***      Version A      Stuart William McConnachie      19th June 1995      ***
7463: 0000: \***                                                                         ***
7464: 0000: \*******************************************************************************
7465: 0000: 
7466: 0000:       FUNCTION SOPTS.SET EXTERNAL
7467: 0000:       END FUNCTION
7468: 0000:       
7469: 0000:       FUNCTION READ.SOPTS EXTERNAL
7470: 0000:          INTEGER*2 READ.SOPTS
7471: 0000:       END FUNCTION
7472: 0000: 
7473: 0000:       FUNCTION WRITE.SOPTS EXTERNAL
7474: 0000:          INTEGER*2 WRITE.SOPTS
7475: 0000:       END FUNCTION
7476: 0000: 
7477: 0000:  %INCLUDE LOCALEXT.J86                    ! 2.1JAS
7478: 0000: \***********************************************************************
7479: 0000: \***********************************************************************
7480: 0000: \***
7481: 0000: \***    DESCRIPTION: Local Price File
7482: 0000: \***                 External File Function Definitions
7483: 0000: \***
7484: 0000: \***    FILE TYPE : Keyed
7485: 0000: \***
7486: 0000: \***********************************************************************
7487: 0000: \***
7488: 0000: \***    Version A.              Paul Flanagan            1st Jul 1993
7489: 0000: \***    Initial version.
7490: 0000: \***
7491: 0000: \***    Version B.              Clive Norris            30th Nov 1993
7492: 0000: \***    Renamed to keep the versions in line.
7493: 0000: \***
7494: 0000: \***    Version C.              Mark Walker             29th Jun 2015
7495: 0000: \***    F392 Retail Stock 5
7496: 0000: \***    Added function WRITE.LOCAL.UNLOCK.HOLD
7497: 0000: \***
7498: 0000: \***********************************************************************
7499: 0000: \***********************************************************************
7500: 0000: 
7501: 0000: FUNCTION LOCAL.SET EXTERNAL
7502: 0000: END FUNCTION
7503: 0000: 
7504: 0000: FUNCTION READ.LOCAL EXTERNAL
7505: 0000:     INTEGER*2 READ.LOCAL
7506: 0000: END FUNCTION
7507: 0000: 
7508: 0000: FUNCTION READ.LOCAL.LOCK EXTERNAL
7509: 0000:     INTEGER*2 READ.LOCAL.LOCK
7510: 0000: END FUNCTION
7511: 0000: 
7512: 0000: FUNCTION WRITE.LOCAL EXTERNAL
7513: 0000:     INTEGER*2 WRITE.LOCAL
7514: 0000: END FUNCTION
7515: 0000: 
7516: 0000: FUNCTION WRITE.LOCAL.UNLOCK EXTERNAL
7517: 0000:     INTEGER*2 WRITE.LOCAL.UNLOCK
7518: 0000: END FUNCTION
7519: 0000: 
7520: 0000: FUNCTION WRITE.LOCAL.UNLOCK.HOLD EXTERNAL                                   !CMW
7521: 0000:     INTEGER*2 WRITE.LOCAL.UNLOCK.HOLD                                       !CMW
7522: 0000: END FUNCTION                                                                !CMW
7523: 0000: 
7524: 0000:  %INCLUDE CCREJEXT.J86                    ! 2.2JAS
7525: 0000: \*******************************************************************************
7526: 0000: \*******************************************************************************
7527: 0000: \***
7528: 0000: \*** RETURNS / AUTOMATIC CREDIT CLAIMING FILE EXTERNAL FILE PUBLIC DEFINITIONS
7529: 0000: \***
7530: 0000: \***                    REFERENCE    : CCREJEXT.BAS
7531: 0000: \***
7532: 0000: \***    Version A.         Julia Stones              12th March 2004
7533: 0000: \***
7534: 0000: \*******************************************************************************
7535: 0000: \*******************************************************************************
7536: 0000: 
7537: 0000: 
7538: 0000:   FUNCTION CCREJ.SET EXTERNAL
7539: 0000:       INTEGER*2 CCREJ.SET
7540: 0000:   END FUNCTION
7541: 0000: 
7542: 0000:   FUNCTION CCREJC.SET EXTERNAL
7543: 0000:       INTEGER*2 CCREJC.SET
7544: 0000:   END FUNCTION
7545: 0000: 
7546: 0000:   FUNCTION CCREJP.SET EXTERNAL
7547: 0000:       INTEGER*2 CCREJP.SET
7548: 0000:   END FUNCTION
7549: 0000: 
7550: 0000:   FUNCTION READ.CCREJ EXTERNAL
7551: 0000:       INTEGER*2 READ.CCREJ
7552: 0000:   END FUNCTION
7553: 0000: 
7554: 0000:   FUNCTION READ.CCREJC EXTERNAL
7555: 0000:       INTEGER*2 READ.CCREJC
7556: 0000:   END FUNCTION
7557: 0000: 
7558: 0000:   FUNCTION READ.CCREJP EXTERNAL
7559: 0000:       INTEGER*2 READ.CCREJP
7560: 0000:   END FUNCTION
7561: 0000: 
7562: 0000:   FUNCTION WRITE.CCREJ EXTERNAL
7563: 0000:       INTEGER*2 WRITE.CCREJ
7564: 0000:   END FUNCTION
7565: 0000: 
7566: 0000:   FUNCTION WRITE.CCREJC EXTERNAL
7567: 0000:       INTEGER*2 WRITE.CCREJC
7568: 0000:   END FUNCTION
7569: 0000: 
7570: 0000:   FUNCTION WRITE.HOLD.CCREJ EXTERNAL
7571: 0000:       INTEGER*2 WRITE.HOLD.CCREJ
7572: 0000:   END FUNCTION
7573: 0000: 
7574: 0000:   FUNCTION WRITE.HOLD.CCREJC EXTERNAL
7575: 0000:       INTEGER*2 WRITE.HOLD.CCREJC
7576: 0000:   END FUNCTION
7577: 0000: 
7578: 0000:  %INCLUDE RBEXT.J86                       ! 2.6BG
7579: 0000: \/******************************************************************/
7580: 0000: \/*                                                                */
7581: 0000: \/* Recalls Buffer FILE EXTERNAL FUNCTION DEFNS                    */
7582: 0000: \/*                                                                */
7583: 0000: \/* REFERENCE   : RBEXT.J86                                        */
7584: 0000: \/*                                                                */
7585: 0000: \/* VERSION A.          Brian Greenield         11th May 2007      */
7586: 0000: \/*                                                                */
7587: 0000: \/******************************************************************/
7588: 0000: 
7589: 0000:    FUNCTION RB.SET EXTERNAL
7590: 0000:       INTEGER*1 RB.SET
7591: 0000:    END FUNCTION
7592: 0000: 
7593: 0000:    FUNCTION READ.RB EXTERNAL
7594: 0000:       INTEGER*2 READ.RB
7595: 0000:    END FUNCTION
7596: 0000: 
7597: 0000:    FUNCTION WRITE.RB EXTERNAL
7598: 0000:       INTEGER*2 WRITE.RB
7599: 0000:    END FUNCTION
7600: 0000: 
7601: 0000: \/******************************************************************/
7602: 0000:  %INCLUDE REWKFEXT.J86                    ! 2.6BG
7603: 0000: \/******************************************************************/
7604: 0000: \/*                                                                */
7605: 0000: \/* Recalls Work FILE EXTERNAL FUNCTION DEFNS                      */
7606: 0000: \/*                                                                */
7607: 0000: \/* REFERENCE   : REWKFEXT.J86                                     */
7608: 0000: \/*                                                                */
7609: 0000: \/* VERSION A.          Brian Greenield         11th May 2007      */
7610: 0000: \/*                                                                */
7611: 0000: \/******************************************************************/
7612: 0000: 
7613: 0000:    FUNCTION REWKF.SET EXTERNAL
7614: 0000:       INTEGER*1 REWKF.SET
7615: 0000:    END FUNCTION
7616: 0000: 
7617: 0000:    FUNCTION READ.REWKF EXTERNAL
7618: 0000:       INTEGER*2 READ.REWKF
7619: 0000:    END FUNCTION
7620: 0000: 
7621: 0000:    FUNCTION WRITE.REWKF EXTERNAL
7622: 0000:       INTEGER*2 WRITE.REWKF
7623: 0000:    END FUNCTION
7624: 0000: 
7625: 0000: \/******************************************************************/
7626: 0000:  %INCLUDE RECALEXT.J86                    ! 2.6BG
7627: 0000: \******************************************************************************
7628: 0000: \******************************************************************************
7629: 0000: \***
7630: 0000: \***                 FUNCTION DEFINITIONS FOR RECALLS.BIN
7631: 0000: \***
7632: 0000: \***                        REFERENCE: RECALFEXT.J86
7633: 0000: \***
7634: 0000: \***    VERSION A               BRIAN GREENFIELD                14th May 2007
7635: 0000: \***    Initial Version
7636: 0000: \***
7637: 0000: \***    Version B               CHARLES SKADORWA                26th June 2007
7638: 0000: \***    Added DELETE.RECALLS function.
7639: 0000: \***
7640: 0000: \*******************************************************************************
7641: 0000: \*******************************************************************************
7642: 0000: 
7643: 0000:    FUNCTION RECALLS.SET EXTERNAL
7644: 0000:       INTEGER*1 RECALLS.SET
7645: 0000:    END FUNCTION
7646: 0000:    
7647: 0000:    FUNCTION WRITE.RECALLS EXTERNAL
7648: 0000:       INTEGER*1 WRITE.RECALLS
7649: 0000:    END FUNCTION
7650: 0000:    
7651: 0000:    FUNCTION READ.RECALLS EXTERNAL
7652: 0000:       INTEGER*1 READ.RECALLS
7653: 0000:    END FUNCTION
7654: 0000:    
7655: 0000:   FUNCTION DELETE.RECALLS (KEY$) EXTERNAL
7656: 0000:       INTEGER*1 DELETE.RECALLS
7657: 0000:    END FUNCTION
7658: 0000:  %INCLUDE DELVIEXT.J86                    ! 2.7SH
7659: 0000: \/******************************************************************/
7660: 0000: \/*                                                                */
7661: 0000: \/* DELVINDX FILE EXTERNAL FUNCTION DEFNS                          */
7662: 0000: \/*                                                                */
7663: 0000: \/* REFERENCE   : DELVIEXT.J86                                     */
7664: 0000: \/*                                                                */
7665: 0000: \/* VERSION A.          Stuart Highley              14 July 2008   */
7666: 0000: \/*                                                                */
7667: 0000: \/******************************************************************/
7668: 0000: 
7669: 0000:    FUNCTION DELVINDX.SET EXTERNAL
7670: 0000:       INTEGER*1 DELVINDX.SET
7671: 0000:    END FUNCTION
7672: 0000: 
7673: 0000:    FUNCTION READ.DELVINDX EXTERNAL
7674: 0000:       INTEGER*2 READ.DELVINDX
7675: 0000:    END FUNCTION
7676: 0000: 
7677: 0000:    FUNCTION WRITE.DELVINDX EXTERNAL
7678: 0000:       INTEGER*2 WRITE.DELVINDX
7679: 0000:    END FUNCTION
7680: 0000: 
7681: 0000: \/******************************************************************/
7682: 0000:  %INCLUDE UODOTEXT.J86                    ! 2.7SH
7683: 0000: \/******************************************************************/
7684: 0000: \/*                                                                */
7685: 0000: \/* UOD Outers FILE EXTERNAL FUNCTION DEFNS                        */
7686: 0000: \/*                                                                */
7687: 0000: \/* REFERENCE   : UODOTEXT.J86                                     */
7688: 0000: \/*                                                                */
7689: 0000: \/* VERSION A.          Stuart Highley              14 July 2008   */
7690: 0000: \/*                                                                
7691: 0000: \/* REVISION 1.8.            ROBERT COWEY.            14 JAN 2009.
7692: 0000: \/* Changes for 10A PosUOD fixes creating SSC04.286 Rv 1.3.
7693: 0000: \/* Defined new function UODOT.REC$.
7694: 0000: \/*
7695: 0000: \/******************************************************************/
7696: 0000: 
7697: 0000:     FUNCTION UODOT.KEY$ EXTERNAL
7698: 0000:         STRING    UODOT.KEY$
7699: 0000:         STRING    WORK$
7700: 0000:     END FUNCTION
7701: 0000: 
7702: 0000:     FUNCTION UODOT.SET EXTERNAL
7703: 0000:         INTEGER*1 UODOT.SET
7704: 0000:     END FUNCTION
7705: 0000: 
7706: 0000:     FUNCTION READ.UODOT EXTERNAL
7707: 0000:         STRING    CHILD.LIST$
7708: 0000:         INTEGER*1 UODOT.INDICAT1%
7709: 0000:         INTEGER*2 UODOT.STATUS%
7710: 0000:         INTEGER*2 READ.UODOT
7711: 0000:         INTEGER*2 I%
7712: 0000:     END FUNCTION
7713: 0000: 
7714: 0000: 
7715: 0000:     FUNCTION READ.UODOT.ON.DESPATCH EXTERNAL
7716: 0000:         STRING TEMP$
7717: 0000:         INTEGER*2 RC%
7718: 0000:         INTEGER*2 READ.UODOT.ON.DESPATCH
7719: 0000:     END FUNCTION
7720: 0000: 
7721: 0000:     FUNCTION READ.UODOT.LOCK EXTERNAL
7722: 0000:         INTEGER*1 UODOT.INDICAT1%
7723: 0000:         INTEGER*2 UODOT.STATUS%
7724: 0000:         INTEGER*2 READ.UODOT.LOCK
7725: 0000:         INTEGER*2 I%
7726: 0000:         STRING    CHILD.LIST$
7727: 0000:     END FUNCTION
7728: 0000: 
7729: 0000:     FUNCTION WRITE.UODOT EXTERNAL
7730: 0000:         INTEGER*1 UODOT.INDICAT1%
7731: 0000:         INTEGER*2 UODOT.STATUS%
7732: 0000:         INTEGER*2 WRITE.UODOT
7733: 0000:         INTEGER*2 I%
7734: 0000:         STRING    CHILD.LIST$
7735: 0000:     END FUNCTION
7736: 0000: 
7737: 0000:     FUNCTION WRITE.UODOT.UNLOCK EXTERNAL
7738: 0000:         INTEGER*1 UODOT.INDICAT1%
7739: 0000:         INTEGER*2 UODOT.STATUS%
7740: 0000:         INTEGER*2 WRITE.UODOT.UNLOCK
7741: 0000:         INTEGER*2 I%
7742: 0000:         STRING    CHILD.LIST$
7743: 0000:     END FUNCTION
7744: 0000: 
7745: 0000: \/******************************************************************/
7746: 0000: 
7747: 0000:     FUNCTION DELETE.UODOT EXTERNAL
7748: 0000:         INTEGER*2 DELETE.UODOT
7749: 0000:     END FUNCTION
7750: 0000: 
7751: 0000: \/******************************************************************/
7752: 0000: 
7753: 0000:     FUNCTION UODOT.REC$ EXTERNAL                                      ! 1.8 RC
7754: 0000:         STRING UODOT.REC$                                             ! 1.8 RC
7755: 0000:     END FUNCTION                                                      ! 1.8 RC
7756: 0000: 
7757: 0000: 
7758: 0000:  %INCLUDE AFEXT.J86                       ! 2.7SH
7759: 0000: 
7760: 0000: \REM
7761: 0000: \*******************************************************************************
7762: 0000: \*******************************************************************************
7763: 0000: \***
7764: 0000: \***    %INCLUDE FOR GSA AUTHORISATION FILE EXTERNAL FUNCTIONS
7765: 0000: \***
7766: 0000: \***        REFERENCE   :  AFEXT (J86)
7767: 0000: \***
7768: 0000: \***        FILE TYPE   :  Keyed
7769: 0000: \***
7770: 0000: \***    The GSA Authorisation File (EALAUTH.DAT) should not be confused with
7771: 0000: \***    the Operating System Authorisation File (ADXCSOUF.DAT).
7772: 0000: \***
7773: 0000: \***    VERSION A.              ROBERT COWEY.                       18 AUG 1992.
7774: 0000: \***    Original version created from AFEXTA.
7775: 0000: \***
7776: 0000: \***    VERSION B.              Steve Windsor                       29 Dec 1992.
7777: 0000: \***    Version incremented to keep in line with other included code           
7778: 0000: \***
7779: 0000: \***    VERSION C.              ROBERT COWEY.                       03 MAR 1994.
7780: 0000: \***    No changes to this file.
7781: 0000: \***
7782: 0000: \***    REVISION 1.6.                ROBERT COWEY.                15 JUN 2009.
7783: 0000: \***    Changes for A9C POS improvements project.
7784: 0000: \***    Used up last available three bytes of EALAUTH user data by redefining 
7785: 0000: \***    remaining AF.USER$ variable as AF.BIRTH.DATE$.
7786: 0000: \***    No changes to this file.
7787: 0000: \***
7788: 0000: \***    REVISION 1.7.                ROBERT COWEY.                22 JUN 2009.
7789: 0000: \***    Changes for A9C POS improvements project creating PSB99.286 Rv 1.8.
7790: 0000: \***    Defect 3247 - Redefined AF.BIRTH.DATE$ format within AFDEC.J86.
7791: 0000: \***    Description text change only - No code changes to this file.
7792: 0000: \***
7793: 0000: \*******************************************************************************
7794: 0000: \*******************************************************************************
7795: 0000: 
7796: 0000: 
7797: 0000: FUNCTION AF.SET EXTERNAL
7798: 0000:     INTEGER*2 AF.SET
7799: 0000: END FUNCTION
7800: 0000: 
7801: 0000: 
7802: 0000: FUNCTION READ.AF EXTERNAL
7803: 0000:     INTEGER*2 READ.AF
7804: 0000: END FUNCTION
7805: 0000: 
7806: 0000: 
7807: 0000: FUNCTION READ.AF.LOCKED EXTERNAL
7808: 0000:     INTEGER*2 READ.AF.LOCKED
7809: 0000: END FUNCTION
7810: 0000: 
7811: 0000:   
7812: 0000: FUNCTION READ.AF.ABREV EXTERNAL
7813: 0000:     INTEGER*2 READ.AF.ABREV
7814: 0000: END FUNCTION
7815: 0000: 
7816: 0000: 
7817: 0000: FUNCTION READ.AF.ABREV.LOCKED EXTERNAL
7818: 0000:     INTEGER*2 READ.AF.ABREV.LOCKED
7819: 0000: END FUNCTION
7820: 0000: 
7821: 0000:   
7822: 0000: FUNCTION WRITE.AF.UNLOCK EXTERNAL
7823: 0000:     INTEGER*2 WRITE.AF.UNLOCK
7824: 0000: END FUNCTION
7825: 0000: 
7826: 0000: 
7827: 0000: FUNCTION WRITE.AF.ABREV EXTERNAL
7828: 0000:     INTEGER*2 WRITE.AF.ABREV
7829: 0000: END FUNCTION
7830: 0000: 
7831: 0000: 
7832: 0000: FUNCTION WRITE.AF.ABREV.UNLOCK EXTERNAL
7833: 0000:     INTEGER*2 WRITE.AF.ABREV.UNLOCK
7834: 0000: END FUNCTION
7835: 0000: 
7836: 0000:  %INCLUDE UBEXT.J86                       ! 2.7SH
7837: 0000: \/******************************************************************/
7838: 0000: \/*                                                                */
7839: 0000: \/* UOD Bookin FILE EXTERNAL FUNCTION DEFNS                        */
7840: 0000: \/*                                                                */
7841: 0000: \/* REFERENCE   : UBEXT.J86                                        */
7842: 0000: \/*                                                                */
7843: 0000: \/* VERSION A.          Stuart Highley            14 August 2008   */
7844: 0000: \/*                                                                */
7845: 0000: \/******************************************************************/
7846: 0000: 
7847: 0000:    FUNCTION UB.SET EXTERNAL
7848: 0000:       INTEGER*1 UB.SET
7849: 0000:    END FUNCTION
7850: 0000: 
7851: 0000:    FUNCTION READ.UB EXTERNAL
7852: 0000:       INTEGER*2 READ.UB
7853: 0000:    END FUNCTION
7854: 0000: 
7855: 0000:    FUNCTION WRITE.UB EXTERNAL
7856: 0000:       INTEGER*2 WRITE.UB
7857: 0000:    END FUNCTION
7858: 0000: 
7859: 0000: \/******************************************************************/
7860: 0000:  
7861: 0000: \*****************************************************************************
7862: 0000: \*****************************************************************************
7863: 0000: \***                                                                       ***
7864: 0000: \*** I N T E R N A L   F U N C T I O N   D E C L A R A T I O N S           ***
7865: 0000: \***                                                                       ***
7866: 0000: \***   - FN.SECONDS                                                        ***
7867: 0000: \***   - FN.Z.PACK                                                         ***
7868: 0000: \***   - FN.VALIDATE.DATA                                                  ***
7869: 0000: \***   - FN.CONV.TO.INTEGER (SIGNED)                                       ***
7870: 0000: \***                                                                       ***
7871: 0000: \*****************************************************************************
7872: 0000: \*****************************************************************************
7873: 0000: 
7874: 0000: \******************************************************************************
7875: 0000: \***
7876: 0000: \***   Function : FN.SECONDS( TIME.VALUE$ )
7877: 0000: \***
7878: 0000: \***   Purpose  : Convert passed TIME in format HHMMSS to seconds
7879: 0000: \***
7880: 0000: \***   Output   : = 4 byte integer
7881: 0000: \***
7882: 0000: \******************************************************************************
7883: 0000: 
7884: 0000:    FUNCTION FN.SECONDS( TIME.VALUE$ )
7885: 0029: 
7886: 0029:       STRING                                                                  \
7887: 0029:          TIME.VALUE$
7888: 0029:       INTEGER*4                                                               \
7889: 0029:          FN.SECONDS
7890: 0029: 
7891: 0029:       FN.SECONDS = VAL(MID$(TIME.VALUE$,1,2)) * 3600 +                        \
7892: 00fb:                    VAL(MID$(TIME.VALUE$,3,2)) * 60 +                          \
7893: 00fb:                    VAL(MID$(TIME.VALUE$,5,2))
7894: 00fb: 
7895: 00fb:    END FUNCTION
7896: 011a: 
7897: 011a: \******************************************************************************
7898: 011a: \***
7899: 011a: \***   Function : FN.Z.PACK( NUM.STRING$, LENGTH% )
7900: 011a: \***
7901: 011a: \***   Purpose  : Zero pack (to the left) NUM.STRING$ out to LENGTH%
7902: 011a: \***
7903: 011a: \******************************************************************************
7904: 011a: 
7905: 011a:    FUNCTION FN.Z.PACK(NUM.STRING$, LENGTH%)
7906: 0143: 
7907: 0143:       STRING                                                                 \
7908: 0143:          FN.Z.PACK,                                                          \
7909: 0143:          NUM.STRING$
7910: 0143:       INTEGER*2                                                              \
7911: 0143:          LENGTH%
7912: 0143: 
7913: 0143:       FN.Z.PACK = RIGHT$(STRING$(LENGTH%,"0")+NUM.STRING$,LENGTH%)
7914: 018c: 
7915: 018c:    END FUNCTION
7916: 01aa: 
7917: 01aa: \******************************************************************************
7918: 01aa: \***
7919: 01aa: \***   Function : FN.VALIDATE.DATA( RECORD$, FORMAT% )
7920: 01aa: \***
7921: 01aa: \***   Purpose  : Test received record RECORD$ is in correct format for
7922: 01aa: \***              data format FORMAT%
7923: 01aa: \***
7924: 01aa: \***   Output   : = 0 if RECORD$ does not conform to data format FORMAT%
7925: 01aa: \***              = 1 if RECORD$ does conform to data format FORMAT%
7926: 01aa: \***
7927: 01aa: \******************************************************************************
7928: 01aa: 
7929: 01aa:    FUNCTION FN.VALIDATE.DATA(RECORD$, FORMAT%)
7930: 01d3: 
7931: 01d3:       STRING                                                                  \
7932: 01d3:          CHECK$,                                                              \
7933: 01d3:          DATA$,                                                               \
7934: 01d3:          RECORD$,                                                             \
7935: 01d3:          TEST$,                                                               \
7936: 01d3:          TYPE$,                                                               \
7937: 01d3:          VALID.FLAG$
7938: 01d3:       INTEGER*1                                                               \
7939: 01d3:          FORMAT%,                                                             \
7940: 01d3:          FN.VALIDATE.DATA
7941: 01d3:       INTEGER*2                                                               \
7942: 01d3:          BYTE.PTR%,                                                           \
7943: 01d3:          CHECK.PTR%,                                                          \
7944: 01d3:          REC.LENGTH%
7945: 01d3: 
7946: 01d3:       REC.LENGTH% = LEN(RECORD$)
7947: 01eb:       IF REC.LENGTH% < 1                                                      \
7948: 0220:       OR FORMAT% < 1 OR FORMAT% > REC.MAX% THEN BEGIN                         \
7949: 0220:          FN.VALIDATE.DATA = 0
7950: 022c:          EXIT FUNCTION
7951: 0237:       ENDIF
7952: 023f: 
7953: 023f:       CHECK$ = REC.CHECK$(FORMAT%)
7954: 026a:       CHECK.PTR% = 1
7955: 0278:       BYTE.PTR% = 1
7956: 0286:       VALID.FLAG$ = "Y"
7957: 029b: 
7958: 029b:       WHILE BYTE.PTR% <= REC.LENGTH%                                          \
7959: 02a6:         AND CHECK.PTR% < LEN(CHECK$)
7960: 02a6: 
7961: 02a6:          TYPE$ = MID$(CHECK$, CHECK.PTR%, 1)
7962: 02ca:          DATA$ = MID$(CHECK$, CHECK.PTR%+1, 1)
7963: 02ef:          CHECK.PTR% = CHECK.PTR% + 2
7964: 02fc: 
7965: 02fc:          IF TYPE$ = "B" THEN BEGIN
7966: 0317:             IF MID$(RECORD$, BYTE.PTR%, 1) <> DATA$ THEN BEGIN
7967: 034d:                VALID.FLAG$ = "N"
7968: 0362:             ENDIF
7969: 036a:             BYTE.PTR% = BYTE.PTR% + 1
7970: 0376:          ENDIF
7971: 037e: 
7972: 037e:          IF TYPE$ = "N" THEN BEGIN
7973: 039c:             WHILE BYTE.PTR% <= REC.LENGTH% AND DATA$ <> CHR$(0)
7974: 03a7:                TEST$ = MID$(RECORD$, BYTE.PTR%, 1)
7975: 03c9:                IF (TEST$ < "0" OR TEST$ > "9")                               \
7976: 0484:               AND TEST$ <> "-" AND TEST$ <> "+"                              \
7977: 0484:               AND TEST$ <> "." THEN VALID.FLAG$ = "N"
7978: 0499:                BYTE.PTR% = BYTE.PTR% + 1
7979: 04a5:                DATA$ = CHR$(ASC(DATA$) - 1)
7980: 04ca:             WEND
7981: 050a:             IF BYTE.PTR% > REC.LENGTH%                                       \
7982: 0547:            AND DATA$ <> CHR$(0) THEN VALID.FLAG$ = "N"
7983: 055c:          ENDIF
7984: 0564: 
7985: 0564:          IF TYPE$ = "A" THEN BYTE.PTR% = BYTE.PTR% + ASC(DATA$)
7986: 0590: 
7987: 0590:       WEND
7988: 05c5: 
7989: 05c5:       IF CHECK.PTR% <= LEN(CHECK$) THEN VALID.FLAG$ = "N"
7990: 05ee: 
7991: 05ee:       IF VALID.FLAG$ = "Y" THEN BEGIN
7992: 0609:          FN.VALIDATE.DATA = 1
7993: 0615:          LAST.ACTIVE.DATE$ = DATE$
7994: 062d:          LAST.ACTIVE% = FN.SECONDS(TIME$)
7995: 0655:       ENDIF ELSE BEGIN
7996: 065d:          FN.VALIDATE.DATA = 0
7997: 0669:       ENDIF
7998: 0671: 
7999: 0671:    END FUNCTION
8000: 068d: 
8001: 068d: \******************************************************************************
8002: 068d: \***
8003: 068d: \***   Function : FN.CONV.TO.INTEGER( NUM.STRING$ )
8004: 068d: \***
8005: 068d: \***   Purpose  : Convert passed string to a 1, 2 or 4 byte (dependant on
8006: 068d: \***              length of passed string) signed integer.
8007: 068d: \***
8008: 068d: \***   Output   : = 1, 2 or 4 byte integer
8009: 068d: \***
8010: 068d: \******************************************************************************
8011: 068d: 
8012: 068d:    FUNCTION FN.CONV.TO.INTEGER( NUM.STRING$ )
8013: 06b6: 
8014: 06b6:       INTEGER*4                                                              \
8015: 06b6:          BYTE%,                                                              \
8016: 06b6:          BYTE.POS%,                                                          \
8017: 06b6:          BYTES%,                                                             \
8018: 06b6:          SIGN.BIT%
8019: 06b6:       REAL                                                                   \
8020: 06b6:          FN.CONV.TO.INTEGER,                                                 \
8021: 06b6:          NUMBER
8022: 06b6:       STRING                                                                 \
8023: 06b6:          NUM.STRING$
8024: 06b6: 
8025: 06b6:       BYTES% = LEN(NUM.STRING$)
8026: 06db:       NUMBER = 0
8027: 06f6:       FOR BYTE.POS% = 1 TO BYTES%
8028: 070e:          BYTE% = ASC(MID$(NUM.STRING$, BYTE.POS%, 1))
8029: 073f:          IF BYTE.POS% = BYTES% THEN BEGIN
8030: 075a:             SIGN.BIT% = BYTE% AND 80h
8031: 0773:             BYTE% = BYTE% AND (SIGN.BIT% XOR 0FFh)
8032: 079f:          ENDIF
8033: 07a7:          NUMBER = NUMBER + (100h ^ (BYTE.POS% - 1)) * BYTE%
8034: 07fd:       NEXT BYTE.POS%
8035: 082a:       IF SIGN.BIT% <> 0 THEN NUMBER = NUMBER - (80h * (100h ^ (BYTES% - 1)))
8036: 0893: 
8037: 0893:       FN.CONV.TO.INTEGER = NUMBER
8038: 08a9: 
8039: 08a9:    END FUNCTION
8040: 08c2: 
8041: 08c2: \******************************************************************************
8042: 08c2: \***
8043: 08c2: \***   Function : FN.ZERO.PL( TEXT$,
8044: 08c2: \***                          LENGTH% )
8045: 08c2: \***
8046: 08c2: \***   Purpose  : Zero pack, to the left, the passed string TEXT$ to the
8047: 08c2: \***              specified length.
8048: 08c2: \***
8049: 08c2: \******************************************************************************
8050: 08c2: 
8051: 08c2:    FUNCTION FN.ZERO.PL(TEXT$,LENGTH%)
8052: 08eb: 
8053: 08eb:       STRING    FN.ZERO.PL, TEXT$
8054: 08eb:       INTEGER*2 LENGTH%
8055: 08eb: 
8056: 08eb:       FN.ZERO.PL = RIGHT$( STRING$( LENGTH%, "0" ) + TEXT$ , LENGTH% )
8057: 0934: 
8058: 0934:    END FUNCTION
8059: 0952: 
8060: 0952: \*****************************************************************************
8061: 0952: \*****************************************************************************
8062: 0952: \***                                                                       ***
8063: 0952: \*** E N D   OF   G L O B A L   D E F N S   F O R   P S S 3 7              ***
8064: 0952: \***                                                                       ***
8065: 0952: \*****************************************************************************
8066: 0952: \*****************************************************************************
8067: 0952: 
8068: 0952:    FUNCTION ADXSTART(NAME$, PARM$, MESS$) EXTERNAL                      ! CLC
8069: 0952:       INTEGER*2 ADXSTART                                                ! CLC
8070: 0952:       STRING    NAME$, PARM$, MESS$                                     ! CLC
8071: 0952:    END FUNCTION                                                         ! CLC
8072: 0952: 
8073: 0952: !  %INCLUDE PSBF18E.J86                                                 !1.3BG
8074: 0952:    %INCLUDE DIROREXT.J86                                                ! BLC
8075: 0952: \*****************************************************************************
8076: 0952: \***
8077: 0952: \***         FUNCTION DEFINITIONS FOR THE DIRORD FILE
8078: 0952: \***
8079: 0952: \***                 REFERENCE:   DIROREXT.J86
8080: 0952: \***
8081: 0952: \***      VERSION A         Les Cook     17th August 1992
8082: 0952: \***
8083: 0952: \***      VERSION B         Les Cook     27th April 1993
8084: 0952: \***      To fix WRITE.UNLOCK problem - not defined as EXTERNAL in Version A
8085: 0952: \***
8086: 0952: \*****************************************************************************
8087: 0952: 
8088: 0952:    FUNCTION DIRORD.SET EXTERNAL
8089: 0952:    END FUNCTION
8090: 0952:    
8091: 0952:    FUNCTION READ.DIRORD.LOCK EXTERNAL
8092: 0952:       INTEGER*2 READ.DIRORD.LOCK
8093: 0952:    END FUNCTION
8094: 0952:    
8095: 0952:    FUNCTION READ.DIRORD EXTERNAL
8096: 0952:       INTEGER*2 READ.DIRORD
8097: 0952:    END FUNCTION
8098: 0952:    
8099: 0952:    FUNCTION WRITE.DIRORD.UNLOCK EXTERNAL
8100: 0952:       INTEGER*2 WRITE.DIRORD.UNLOCK
8101: 0952:    END FUNCTION
8102: 0952:    
8103: 0952:    FUNCTION WRITE.DIRORD EXTERNAL
8104: 0952:       INTEGER*2 WRITE.DIRORD
8105: 0952:    END FUNCTION
8106: 0952:    
8107: 0952:    
8108: 0952:    %INCLUDE DIRSUEXT.J86                                                ! BLC
8109: 0952: \*****************************************************************************
8110: 0952: \*****************************************************************************
8111: 0952: \***
8112: 0952: \***           EXTERNAL FUNCTION DEFINITIONS FOR DIRECT SUPPLIER FILE
8113: 0952: \***
8114: 0952: \***                         REFERENCE: DIRSUEXT.J86
8115: 0952: \***
8116: 0952: \***           Version A            Les Cook                8/9/92
8117: 0952: \***
8118: 0952: \***           Version B            Les Cook               29/3/93
8119: 0952: \***           To fix WRITE.UNLOCK problem - not defined as EXTERNAL in ver A
8120: 0952: \*** 
8121: 0952: \*****************************************************************************
8122: 0952: \*****************************************************************************
8123: 0952: 
8124: 0952:      FUNCTION DIRSUP.SET EXTERNAL
8125: 0952:      END FUNCTION
8126: 0952:      
8127: 0952:      FUNCTION READ.DIRSUP.LOCK EXTERNAL
8128: 0952:         INTEGER*2 READ.DIRSUP.LOCK
8129: 0952:      END FUNCTION
8130: 0952:      
8131: 0952:      FUNCTION READ.DIRSUP EXTERNAL
8132: 0952:         INTEGER*2 READ.DIRSUP
8133: 0952:      END FUNCTION
8134: 0952:      
8135: 0952:      FUNCTION WRITE.DIRSUP EXTERNAL
8136: 0952:         INTEGER*2 WRITE.DIRSUP
8137: 0952:      END FUNCTION
8138: 0952:      
8139: 0952:      FUNCTION WRITE.DIRSUP.UNLOCK EXTERNAL
8140: 0952:         INTEGER*2 WRITE.DIRSUP.UNLOCK
8141: 0952:      END FUNCTION
8142: 0952:      
8143: 0952:      
8144: 0952:    %INCLUDE DIRWFEXT.J86                                                ! BLC
8145: 0952: \*****************************************************************************
8146: 0952: \*****************************************************************************
8147: 0952: \***
8148: 0952: \***       EXTYERNAL FUNCTION DEFINTIONS FOR DIRWF - DIRECT WORK FILE
8149: 0952: \***
8150: 0952: \***       REFERENCE: DIRWFEXT.J86
8151: 0952: \***
8152: 0952: \*****************************************************************************
8153: 0952: \*****************************************************************************
8154: 0952: 
8155: 0952:    FUNCTION DIRWF.SET EXTERNAL
8156: 0952:    END FUNCTION
8157: 0952:    
8158: 0952:    FUNCTION READ.DIRWF EXTERNAL
8159: 0952:       INTEGER*2 READ.DIRWF
8160: 0952:    END FUNCTION
8161: 0952:    
8162: 0952:    FUNCTION WRITE.DIRWF EXTERNAL
8163: 0952:       INTEGER*2 WRITE.DIRWF
8164: 0952:    END FUNCTION
8165: 0952:    
8166: 0952:    %INCLUDE LDTCFEXT.J86                                                ! BLC
8167: 0952: \*****************************************************************************
8168: 0952: \*****************************************************************************
8169: 0952: \***
8170: 0952: \***      EXTERNAL FUNCTION DEFINITIONS FOR LDTCF
8171: 0952: \***
8172: 0952: \***      REFERENCE: LDTCFEXT.J86
8173: 0952: \***
8174: 0952: \***      Version A             Les Cook         12/10/92
8175: 0952: \***
8176: 0952: \*****************************************************************************
8177: 0952: \*****************************************************************************
8178: 0952: 
8179: 0952:     FUNCTION LDTCF.SET EXTERNAL
8180: 0952:     END FUNCTION
8181: 0952:     
8182: 0952:     FUNCTION READ.LDTCF EXTERNAL
8183: 0952:        INTEGER*2 READ.LDTCF
8184: 0952:     END FUNCTION
8185: 0952:     
8186: 0952:     FUNCTION WRITE.LDTCF EXTERNAL
8187: 0952:        INTEGER*2 WRITE.LDTCF
8188: 0952:     END FUNCTION
8189: 0952:     
8190: 0952:     
8191: 0952:    %INCLUDE DRSMQEXT.J86                                                ! BLC
8192: 0952: \*****************************************************************************
8193: 0952: \*****************************************************************************
8194: 0952: \***
8195: 0952: \***        EXTERNAL FUNCTION DEFINITIONS FOR DRSMQ
8196: 0952: \***
8197: 0952: \***        REFERENCE:  DRSMQEXT.J86
8198: 0952: \***
8199: 0952: \***        Version A         Les Cook         12/10/1992
8200: 0952: \***
8201: 0952: \*****************************************************************************
8202: 0952: \*****************************************************************************
8203: 0952: 
8204: 0952:    FUNCTION DRSMQ.SET EXTERNAL
8205: 0952:    END FUNCTION
8206: 0952:    
8207: 0952:    FUNCTION READ.DRSMQ EXTERNAL
8208: 0952:       INTEGER*2 READ.DRSMQ
8209: 0952:    END FUNCTION
8210: 0952:    
8211: 0952:    FUNCTION WRITE.DRSMQ EXTERNAL
8212: 0952:       INTEGER*2 WRITE.DRSMQ
8213: 0952:    END FUNCTION
8214: 0952:    
8215: 0952:    
8216: 0952: !  %INCLUDE STOCKEXT.J86                                                !1.3BG !1.4BG
8217: 0952: !  %INCLUDE IMSTCEXT.J86                                                !1.3BG !1.4BG
8218: 0952: !   %INCLUDE LSSSTEXT.J86                                                !1.3BG !1.5CS
8219: 0952: 
8220: 0952:    SUB PSS3702 PUBLIC
8221: 0976: 
8222: 0976: REAL GAP
8223: 0976: 
8224: 0976: INTEGER*1                                                               \
8225: 0976:         CURR.SESS.NUM%,                                                 \
8226: 0976:         END.OF.DRSMQ,                                                   \
8227: 0976:         END.OF.UODTF,                                                   \ ELC
8228: 0976:         PORT.EVENT%,                                                    \
8229: 0976:         SB.EVENT.NO%,                                                   \
8230: 0976:         SB.FILE.SESS.NUM%,                                              \
8231: 0976:         ORDER.HEADER.WRITTEN,                                           \
8232: 0976:         ORDER.FOUND,                                                    \
8233: 0976:         SUPERCEDED%,                                                    \ 1.6NWB
8234: 0976:         SUPPLIER.FOUND,                                                 \
8235: 0976:         MORE.BAR.CODES,                                                 \
8236: 0976:         FINISHED,                                                       \
8237: 0976:         SWAPPED,                                                        \
8238: 0976:         ORDERS.IN.TABLE%
8239: 0976: 
8240: 0976: INTEGER*2                                                               \
8241: 0976:         MESSAGE.NO%,                                                    \
8242: 0976:         NO.SECTORS%,                                                    \
8243: 0976:         SECTOR.NUMBER%,                                                 \
8244: 0976:         RECORD.NUMBER%,                                                 \
8245: 0976:         RECORD.LENGTH%,                                                 \
8246: 0976:         COUNT%,                                                         \
8247: 0976:         INDEX%,                                                         \
8248: 0976:         ITEM.COUNT%,                                                    \
8249: 0976:         ITEM.TOTAL%,                                                    \
8250: 0976:         ORDER.INDEX%,                                                   \
8251: 0976:         BC.INDEX%,                                                      \
8252: 0976:         BC.TOTAL%,                                                      \
8253: 0976:         HEADER.TOTAL%,                                                  \
8254: 0976:         HEADER.INDEX%,                                                  \
8255: 0976:         NO.RECORDS%,                                                    \
8256: 0976:         ITEMS.IN.ORDER%,                                                \
8257: 0976:         SB.FILE.REP.NUM%,                                               \
8258: 0976:         SB.INTEGER%,                                                    \
8259: 0976:         SINGLES.IN.ORDER%,                                              \
8260: 0976:         SINGLES.BOOKED.IN%,                                             \
8261: 0976:         START.OF.ORDER%,                                                \
8262: 0976:         NO.OF.BAR.CODES%,                                               \
8263: 0976:         NO.OF.REQUESTED.ORDERS%,                                        \
8264: 0976:         BAR.CODE.TOTAL%,                                                \
8265: 0976:         PAGE.NO%,                                                       \
8266: 0976:         QUANTITY.GOOD%,                                                 \
8267: 0976:         QUANTITY.STOLEN%,                                               \
8268: 0976:         QUANTITY.DAMAGED%                                               !
8269: 0976: 
8270: 0976: 
8271: 0976: INTEGER*4                                                               \
8272: 0976:         ADX.RET.CODE%,                                                  \
8273: 0976:         A%,                                                             \
8274: 0976:         B%,                                                             \
8275: 0976:         MAX%                                                            !
8276: 0976: 
8277: 0976: STRING                                                                  \
8278: 0976:         SB.ACTION$,                                                     \
8279: 0976:         SB.ERRF$,                                                       \
8280: 0976:         SB.ERRL$,                                                       \
8281: 0976:         SB.ERRS$,                                                       \
8282: 0976:         SB.MESSAGE$,                                                    \
8283: 0976:         SB.UNIQUE$,                                                     \
8284: 0976:         SB.STRING$,                                                     \
8285: 0976:         TEMP$,                                                          \
8286: 0976:         BAR.ITEM.CODE$,                                                 \ ELC
8287: 0976:         BAR.ITEM.CODE.FLAG$,                                            \ ELC
8288: 0976:         CURRENT.KEY$,                                                   \
8289: 0976:         TEMP.STATE$,                                                    \
8290: 0976:         UNIQUE.2$,                                                      \
8291: 0976:         SECTOR.FORMAT$,                                                 \
8292: 0976:         SECTOR$,                                                        \
8293: 0976:         DRSMQ.STRING$,                                                  \
8294: 0976:         RECORD$,                                                        \
8295: 0976:         NULL.KEY$,                                                      \
8296: 0976:         VERSION.DETAILS$,                                               \
8297: 0976:         ITEM.CODE$,                                                     \
8298: 0976:         ITEM.POS.STRING$,                                               \
8299: 0976:         ORDER.DETAILS$,                                                 \
8300: 0976:         PAGE.NUMBER$,                                                   \
8301: 0976:         SUPPLIER.NO.PACKED$,                                            \
8302: 0976:         DIRWF.DETAIL.TABLE$(1),                                         \
8303: 0976:         ORDER.TABLE$(1),                                                \
8304: 0976:         BAR.CODE.TABLE$(1),                                             \
8305: 0976:         ITEM.POSITION.TABLE$(1),                                        \
8306: 0976:         HEADER.TABLE$(1),                                               \
8307: 0976:         BC.LETTER.TABLE$(1),                                            \
8308: 0976:         REJECT.REASON$,                                                 \
8309: 0976:         DIRWF.HEADER.RECORD$,                                           \
8310: 0976:         DIRWF.NO.OF.ORDERS$,                                            \
8311: 0976:         DIRWF.RECORD.TYPE$,                                             \
8312: 0976:         DIRWF.SUPPLIER.NUMBER$,                                         \
8313: 0976:         DIRWF.ORDER.NUMBER$,                                            \
8314: 0976:         DIRWF.ORDER.SUFFIX$,                                            \
8315: 0976:         DIRWF.ITEMS.IN.ORDER$,                                          \
8316: 0976:         DIRWF.SINGLES.IN.ORDER$,                                        \
8317: 0976:         DIRWF.ITEMS.BOOKED.IN$,                                         \
8318: 0976:         DIRWF.SINGLES.BOOKED.IN$,                                       \
8319: 0976:         DIRWF.SUPPLIER.NAME$,                                           \
8320: 0976:         DIRWF.HIGH.QTY.LIMIT$,                                          \
8321: 0976:         DIRWF.QTY.LIMIT$,                                               \
8322: 0976:         DIRWF.DISCREP.QTY$,                                             \
8323: 0976:         DIRWF.DISCREP.PERC$,                                            \
8324: 0976:         DIRWF.REJECT.REASON$,                                           \
8325: 0976:         DIRWF.SOURCE.FLAG$,                                             \
8326: 0976:         DIRWF.APPLICATION.NO$,                                          \
8327: 0976:         DIRWF.TERMINAL.NO$,                                             \
8328: 0976:         DIRWF.BARCODE$,                                                 \
8329: 0976:         DIRWF.NO.OF.BARCODES$,                                          \
8330: 0976:         DIRWF.ITEM.POSITION$,                                           \
8331: 0976:         DIRWF.ITEM.CODE$,                                               \
8332: 0976:         DIRWF.EXPECTED.QTY$,                                            \
8333: 0976:         DIRWF.ORDER.FLAG$,                                              \
8334: 0976:         DIRWF.CHK.QTY.FOR.NO.ORDER$,                                    \
8335: 0976:         DIRWF.PAGE.NO$,                                                 \
8336: 0976:         LDTBF.WRITTEN.FLAG$,                                            \ CLC
8337: 0976:         OPENING.UODBF$                                                  ! ELC
8338: 0976: 
8339: 0976: \******************************************************************************
8340: 0976: \******************************************************************************
8341: 0976: \***                                                                        ***
8342: 0976: \***   M A I N L I N E   C O D E                                            ***
8343: 0976: \***                                                                        ***
8344: 0976: \******************************************************************************
8345: 0976: \******************************************************************************
8346: 0976: 
8347: 0976: \******************************************************************************
8348: 0976: \***
8349: 0976: \***   for any errors, pass control to ERROR.DETECTED
8350: 0976: \***
8351: 0976: \***   pass control to the appropriate section of code, depending upon
8352: 0976: \***   the value of RECEIVE.STATE$
8353: 0976: \***   (!!!NOTE!!!  The use of lower case letters is necessary to allow us
8354: 0976: \***    to use more than 26 data states.  The characters between Z and a are
8355: 0976: \***    the ASCII characters that occur between these two letters)
8356: 0976: \***
8357: 0976: \***   MODULE.EXIT:
8358: 0976: \***     return to calling module
8359: 0976: \***
8360: 0976: \***   PROGRAM.EXIT:
8361: 0976: \***     stop
8362: 0976: \***
8363: 0976: \******************************************************************************
8364: 0976: 
8365: 0976: ON ERROR GOTO ERROR.DETECTED
8366: 098b: 
8367: 098b:       IF MATCH(RECEIVE.STATE$,"RSTUVWXYZ[\]^_`abcdef",1) > 0 THEN BEGIN ! ELC
8368: 09b1:          ON (ASC(RECEIVE.STATE$) - ASC("Q")) GOSUB                      \
8369: 09f6:                RECEIVED.CHECK.VERSION.REQUEST,                          \
8370: 09f6:                RECEIVED.PROGRAM.TRAILER,                                \
8371: 09f6:                RECEIVED.DIRECT.ORDERS.REQUEST,                          \
8372: 09f6:                RECEIVED.DIRECT.FILE.HEADER,                             \
8373: 09f6:                RECEIVED.DIRECT.ORDERS.HEADER,                           \
8374: 09f6:                RECEIVED.DIRECT.ORDERS.DETAIL,                           \
8375: 09f6:                RECEIVED.DIRECT.ORDERS.TRAILER,                          \
8376: 09f6:                RECEIVED.DIRECT.FILE.TRAILER,                            \
8377: 09f6:                RECEIVED.DIRECT.EOT,                                     \ ELC
8378: 09f6:                DUMMY.ROUTINE,                                           \ ELC
8379: 09f6:                DUMMY.ROUTINE,                                           \ ELC
8380: 09f6:                DUMMY.ROUTINE,                                           \ ELC
8381: 09f6:                DUMMY.ROUTINE,                                           \ ELC
8382: 09f6:                DUMMY.ROUTINE,                                           \ ELC
8383: 09f6:                DUMMY.ROUTINE,                                           \ ELC
8384: 09f6:                RECEIVED.UOD.FILE.HEADER,                                \ ELC
8385: 09f6:                RECEIVED.UOD.HEADER,                                     \ ELC
8386: 09f6:                RECEIVED.UOD.DETAIL,                                     \ ELC
8387: 09f6:                RECEIVED.UOD.TRAILER,                                    \ ELC
8388: 09f6:                RECEIVED.UOD.FILE.TRAILER,                               \ ELC
8389: 09f6:                RECEIVED.UOD.EOT                                         ! ELC
8390: 09f6:          GOTO MODULE.EXIT
8391: 0a00:       ENDIF
8392: 0a08: 
8393: 0a08: MODULE.EXIT:
8394: 0a18: 
8395: 0a18:    IF RECEIVE.STATE$ = "*" THEN BEGIN
8396: 0a36:       GOSUB CREATE.DIRECT.TEMP.STKMQ
8397: 0a48:    ENDIF
8398: 0a50: 
8399: 0a50:    EXIT SUB
8400: 0a5b: 
8401: 0a5b: PROGRAM.EXIT:
8402: 0a6b: 
8403: 0a6b:    STOP
8404: 0a78: 
8405: 0a78: 
8406: 0a78: \******************************************************************************
8407: 0a78: \******************************************************************************
8408: 0a78: \***                                                                        ***
8409: 0a78: \***   S U B R O U T I N E S                                                ***
8410: 0a78: \***                                                                        ***
8411: 0a78: \******************************************************************************
8412: 0a78: \******************************************************************************
8413: 0a78: 
8414: 0a78: \******************************************************************************
8415: 0a78: \***
8416: 0a78: \***   RECEIVED.CHECK.VERSION.REQUEST:                          STATE : R
8417: 0a78: \***
8418: 0a78: \***      display "PDT support - LDT Check Version Received" on
8419: 0a78: \***      background screen
8420: 0a78: \***
8421: 0a78: \***      if received data is not valid then set the RECEIVE.STATE$ to "*" and
8422: 0a78: \***      return
8423: 0a78: \***
8424: 0a78: \***      Command PSS38 to hold PDT
8425: 0a78: \***
8426: 0a78: \***      Open LDT check file (LDTCF)
8427: 0a78: \***
8428: 0a78: \***      Read LDTCF
8429: 0a78: \***
8430: 0a78: \***      IF the version number from the LDT is either zeroes or is an earlier
8431: 0a78: \***      version than on the LDTCF then format version details from the LDTCF.
8432: 0a78: \***      If the LDT version number is greater than or equal to the version
8433: 0a78: \***      number on the LDTCF, then set version details to zeroes.
8434: 0a78: \***
8435: 0a78: \***      Close LDTCF
8436: 0a78: \***
8437: 0a78: \***      Command PSS38 to release LDT
8438: 0a78: \***
8439: 0a78: \***      Format a program header using version details
8440: 0a78: \***
8441: 0a78: \***      Send program header to PSS38
8442: 0a78: \***
8443: 0a78: \***   RETURN
8444: 0a78: \***
8445: 0a78: \******************************************************************************
8446: 0a78: 
8447: 0a78:    RECEIVED.CHECK.VERSION.REQUEST:
8448: 0a88: 
8449: 0a88:       SB.MESSAGE$ = "PDT Support - LDT Check Version Received"          ! ELC
8450: 0a9d:       GOSUB SB.BG.MESSAGE
8451: 0aaf: 
8452: 0aaf:       IF FN.VALIDATE.DATA(DATA.IN$, 19) = 0 THEN BEGIN
8453: 0ad1:          RECEIVE.STATE$ = "*"
8454: 0ae8:          RETURN
8455: 0af8:       ENDIF
8456: 0b00: 
8457: 0b00:       GOSUB HOLD.PDT
8458: 0b12: 
8459: 0b12:       CURR.SESS.NUM% = LDTCF.SESS.NUM%
8460: 0b24:       CURRENT.KEY$ = ""
8461: 0b39:       IF END #LDTCF.SESS.NUM% THEN OPEN.ERROR
8462: 0b55:       OPEN LDTCF.FILE.NAME$ AS LDTCF.SESS.NUM% NOWRITE NODEL
8463: 0b7d:       LDTCF.OPEN.FLAG$ = "Y"
8464: 0b94: 
8465: 0b94:       RC% = READ.LDTCF                                                  ! BLC
8466: 0ba8:       IF RC% = 1 THEN GOTO READ.ERROR                                   ! BLC
8467: 0bbd: 
8468: 0bbd:       IF MID$(DATA.IN$,3,3) = "000" THEN BEGIN
8469: 0bf5:          CSR.AUDIT.DATA$ = "LDT REQUESTED PROGRAM UPDATE AT " +         \
8470: 0c9b:                            LEFT$(TIME$,2) + ":" +                       \
8471: 0c9b:                            MID$(TIME$,3,2) + ":" +                      \
8472: 0c9b:                            RIGHT$(TIME$,2) +                            \
8473: 0c9b:                            " VERSION LOADING = " +                      \
8474: 0c9b:                            LDTCF.VERSION.NO$ + LDTCF.VERSION.DATE$
8475: 0c9b:          GOSUB LOG.TO.AUDIT.FILE
8476: 0cad:          VERSION.DETAILS$ = LDTCF.VERSION.NO$ + LDTCF.VERSION.DATE$
8477: 0cda:       ENDIF ELSE IF MID$(DATA.IN$,3,3) < LDTCF.VERSION.NO$ THEN BEGIN
8478: 0d19:                     CSR.AUDIT.DATA$ = "AUTOMATIC PROGRAM UPDATE AT " +  \
8479: 0dbf:                                       LEFT$(TIME$,2) + ":" +            \
8480: 0dbf:                                       MID$(TIME$,3,2) + ":" +           \
8481: 0dbf:                                       RIGHT$(TIME$,2) +                 \
8482: 0dbf:                                       " VERSION LOADING = " +           \
8483: 0dbf:                                       LDTCF.VERSION.NO$ + LDTCF.VERSION.DATE$
8484: 0dbf:                     GOSUB LOG.TO.AUDIT.FILE
8485: 0dd1:                     VERSION.DETAILS$ = LDTCF.VERSION.NO$ + LDTCF.VERSION.DATE$
8486: 0dfd:                  ENDIF ELSE BEGIN
8487: 0e05:                        VERSION.DETAILS$ = "000000000"
8488: 0e1a:                  ENDIF
8489: 0e22: 
8490: 0e22:       CLOSE LDTCF.SESS.NUM%
8491: 0e36: 
8492: 0e36:       GOSUB RELEASE.PDT
8493: 0e48: 
8494: 0e48:       PIPE.OUT$ = "VPH" + VERSION.DETAILS$
8495: 0e6a: 
8496: 0e6a:       GOSUB SEND.TO.PSS38
8497: 0e7c: 
8498: 0e7c:    RETURN
8499: 0e8c: 
8500: 0e8c: 
8501: 0e8c: \******************************************************************************
8502: 0e8c: \***
8503: 0e8c: \***   RECEIVED.PROGRAM.TRAILER:                                STATE : S
8504: 0e8c: \***
8505: 0e8c: \***      display "PDT support - LDT Program Trailer Received" on
8506: 0e8c: \***      background screen
8507: 0e8c: \***
8508: 0e8c: \***      if received data is not valid then set the RECEIVE.STATE$ to "*" and
8509: 0e8c: \***      return
8510: 0e8c: \***
8511: 0e8c: \***   RETURN
8512: 0e8c: \***
8513: 0e8c: \******************************************************************************
8514: 0e8c: 
8515: 0e8c:    RECEIVED.PROGRAM.TRAILER:
8516: 0e9c: 
8517: 0e9c:       SB.MESSAGE$ = "PDT Support - LDT Program Trailer Received"
8518: 0eb1:       GOSUB SB.BG.MESSAGE
8519: 0ec3: 
8520: 0ec3:       IF FN.VALIDATE.DATA(DATA.IN$, 20) = 0 THEN BEGIN
8521: 0ee5:          RECEIVE.STATE$ = "*"
8522: 0efc:          RETURN
8523: 0f0c:       ENDIF
8524: 0f14: 
8525: 0f14:       LDTAF.LINK.TYPE% = 3                                              ! FMJK
8526: 0f24:       IF MONITORED.PORT$ = "B" THEN LDTAF.LINK.TYPE% =                  \ FMJK
8527: 0f52:         (LDTAF.LINK.TYPE% OR 80H)                                       ! FMJK
8528: 0f5a:       LDTAF.START.DATE$ = PACK$(LOG.ON.DATE$)                           ! FMJK
8529: 0f7d:       LDTAF.START.TIME$ = PACK$(LOG.ON.TIME$)                           ! FMJK
8530: 0fa0:       TEMP.TIME$ = TIME$                                                ! GMJK
8531: 0fb8:       LDTAF.DURATION% = ( (VAL(LEFT$(TEMP.TIME$,2))*3600) +             \ GMJK
8532: 11a4:                           (VAL(MID$(TEMP.TIME$,3,2))*60) +              \ GMJK
8533: 11a4:                            VAL(RIGHT$(TEMP.TIME$,2)) ) -                \ GMJK
8534: 11a4:                       ( (VAL(UNPACK$(LEFT$(LDTAF.START.TIME$,1)))*3600)+\ GMJK
8535: 11a4:                         (VAL(UNPACK$(MID$(LDTAF.START.TIME$,2,1)))*60)+ \ GMJK
8536: 11a4:                          VAL(UNPACK$(RIGHT$(LDTAF.START.TIME$,1))) )    ! GMJK
8537: 11a4:       LDTAF.DATA.VOLUME.1% = 0                                          ! FMJK
8538: 11bb:       LDTAF.DATA.VOLUME.1% = SIZE ("LDTPF")                             ! FDS
8539: 11db:       LDTAF.DATA.VOLUME.2% = 0                                          ! FMJK
8540: 11f2:       GOSUB LOG.TO.LDTAF.FILE                                           ! FMJK
8541: 1204: 
8542: 1204:       CSR.AUDIT.DATA$ = "PROGRAM LOAD FINISHED AT " +                   \
8543: 1285:                         LEFT$(TIME$,2) + ":" +                          \
8544: 1285:                         MID$(TIME$,3,2) + ":" +                         \
8545: 1285:                         RIGHT$(TIME$,2)
8546: 1285:       GOSUB LOG.TO.AUDIT.FILE
8547: 1297: 
8548: 1297:    RETURN
8549: 12a7: 
8550: 12a7: 
8551: 12a7: \******************************************************************************
8552: 12a7: \***
8553: 12a7: \***   RECEIVED.DIRECT.ORDERS.REQUEST:                          STATE : T
8554: 12a7: \***
8555: 12a7: \***      display "PDT support - DIRECT Order Request Received" on background
8556: 12a7: \***      screen
8557: 12a7: \***
8558: 12a7: \***      set up non variable portion of REC.CHECK$(21)
8559: 12a7: \***
8560: 12a7: \***      find length of record and build validation string
8561: 12a7: \***
8562: 12a7: \***      if received data is not valid then set the RECEIVE.STATE$ to "*" and
8563: 12a7: \***      return
8564: 12a7: \***
8565: 12a7: \***      dimension tables
8566: 12a7: \***
8567: 12a7: \***      GOSUB HOLD.PDT to command PSS38 to 'hold' the PDT
8568: 12a7: \***
8569: 12a7: \***      GOSUB OPEN.FILES.FOR.DIRECT to open all relevant files for Direct
8570: 12a7: \***
8571: 12a7: \***      GOSUB BUILD.BUS.CENTRE.LETTER.TABLE to build a business centre table
8572: 12a7: \***      from the BCSMF
8573: 12a7: \***
8574: 12a7: \***      GOSUB BUILD.ORDER.TABLE.FROM.PDT to build all orders (maximum of 10)
8575: 12a7: \***      requested from the PDT
8576: 12a7: \***
8577: 12a7: \***      set ORDER.INDEX% to 1
8578: 12a7: \***      While the supplier is not found search through DIRSUP file using
8579: 12a7: \***      supplier number from each order.
8580: 12a7: \***
8581: 12a7: \***      If a supplier was found (doesn't matter which), set DIRWF check
8582: 12a7: \***      quantity for no order to DIRSUP maximum check quantity, otherwise
8583: 12a7: \***      set to zeroes.
8584: 12a7: \***
8585: 12a7: \***      GOSUB WRITE.DIRWF.FILE.HEADER
8586: 12a7: \***
8587: 12a7: \***      for each order in table
8588: 12a7: \***          GOSUB PROCESS.A.DIRECT.ORDER
8589: 12a7: \***      end for
8590: 12a7: \***
8591: 12a7: \***      log DIRECTS information to audit file
8592: 12a7: \***
8593: 12a7: \***      GOSUB WRITE.DIRWF.FILE.TRAILER
8594: 12a7: \***
8595: 12a7: \***      IF DIRWF file is open then close
8596: 12a7: \***
8597: 12a7: \***      GOSUB RELEASE.PDT
8598: 12a7: \***
8599: 12a7: \***      GOSUB TRANSMIT.DIRECT.FILE
8600: 12a7: \***
8601: 12a7: \***      GOSUB TIDY.UP.FOR.DIRECT
8602: 12a7: \***
8603: 12a7: \***   RETURN
8604: 12a7: \***
8605: 12a7: \******************************************************************************
8606: 12a7: 
8607: 12a7:    RECEIVED.DIRECT.ORDERS.REQUEST:
8608: 12b7: 
8609: 12b7:       SB.MESSAGE$ = "PDT Support - DIRECT Order Request Received"
8610: 12cc:       GOSUB SB.BG.MESSAGE
8611: 12de: 
8612: 12de:       REC.CHECK$(21) = "A"+CHR$(2) + "N"+CHR$(2) + "N"+CHR$(6)
8613: 1337: 
8614: 1337:       RECORD.LENGTH% = LEN(DATA.IN$)
8615: 1354: 
8616: 1354:       NO.OF.REQUESTED.ORDERS% = ((RECORD.LENGTH% - 10)/11)
8617: 136b:       FOR COUNT% = 1 TO NO.OF.REQUESTED.ORDERS%
8618: 137b:           REC.CHECK$(21) = REC.CHECK$(21) + "N"+CHR$(6) + "N"+CHR$(4)   \
8619: 13eb:                            + "A"+CHR$(1)
8620: 13eb:       NEXT COUNT%
8621: 1406: 
8622: 1406:       IF FN.VALIDATE.DATA(DATA.IN$, 21) = 0 THEN BEGIN
8623: 1428:          RECEIVE.STATE$ = "*"
8624: 143f:          RETURN
8625: 144f:       ENDIF
8626: 1457: 
8627: 1457:       DIM ORDER.TABLE$(10)
8628: 1480:       DIM DIRWF.DETAIL.TABLE$(1600)
8629: 14aa:       DIM BAR.CODE.TABLE$(9000)
8630: 14d4:       DIM ITEM.POSITION.TABLE$(9000)
8631: 14fe:       DIM HEADER.TABLE$(10)
8632: 1527:       DIM BC.LETTER.TABLE$(16)
8633: 1550: 
8634: 1550:       GOSUB HOLD.PDT
8635: 1562: 
8636: 1562:       GOSUB OPEN.FILES.FOR.DIRECT
8637: 1574: 
8638: 1574:       GOSUB BUILD.BUS.CENTRE.LETTER.TABLE
8639: 1586: 
8640: 1586:       GOSUB BUILD.ORDER.TABLE.FROM.PDT
8641: 1598: 
8642: 1598:       ORDER.INDEX% = 0
8643: 15a6:       SUPPLIER.FOUND = FALSE
8644: 15b8:       WHILE NOT SUPPLIER.FOUND AND                                      \
8645: 15c2:             ORDER.INDEX% <> ORDERS.IN.TABLE%
8646: 15c2:             ORDER.INDEX% = ORDER.INDEX% + 1
8647: 15ce:             GOSUB LOOK.FOR.SUPPLIER
8648: 15e0:       WEND
8649: 15ff: 
8650: 15ff:       IF SUPPLIER.FOUND THEN BEGIN
8651: 160e:          DIRWF.CHK.QTY.FOR.NO.ORDER$ = UNPACK$(DIRSUP.MAX.CHECK.QTY$)
8652: 1631:       ENDIF ELSE BEGIN
8653: 1639:             DIRWF.CHK.QTY.FOR.NO.ORDER$ = "0000"
8654: 164e:       ENDIF
8655: 1656: 
8656: 1656:       GOSUB WRITE.DIRWF.FILE.HEADER
8657: 1668: 
8658: 1668:       FOR ORDER.INDEX% = 1 TO ORDERS.IN.TABLE%
8659: 1678:           GOSUB PROCESS.A.DIRECT.ORDER
8660: 168a:       NEXT ORDER.INDEX%
8661: 16a3: 
8662: 16a3:       GOSUB WRITE.DIRWF.FILE.TRAILER
8663: 16b5: 
8664: 16b5:       IF DIRWF.OPEN.FLAG$ = "Y" THEN BEGIN
8665: 16d3:          CLOSE DIRWF.SESS.NUM%
8666: 16e7:          DIRWF.OPEN.FLAG$ = "N"
8667: 16fe:       ENDIF
8668: 1706: 
8669: 1706:       GOSUB RELEASE.PDT
8670: 1718: 
8671: 1718:       GOSUB TRANSMIT.DIRECT.FILE
8672: 172a: 
8673: 172a:       GOSUB TIDY.UP.FOR.DIRECT
8674: 173c: 
8675: 173c:    RETURN
8676: 174c: 
8677: 174c: 
8678: 174c: \******************************************************************************
8679: 174c: \***
8680: 174c: \***   OPEN.FILES.FOR.DIRECT:
8681: 174c: \***
8682: 174c: \***      open all files required for DIRECT processing
8683: 174c: \***      and create the DIRWF
8684: 174c: \***
8685: 174c: \***   RETURN
8686: 174c: \***
8687: 174c: \******************************************************************************
8688: 174c: 
8689: 174c:    OPEN.FILES.FOR.DIRECT:
8690: 175c: 
8691: 175c:       CURR.SESS.NUM% = IDF.SESS.NUM%
8692: 176e:       IF END #IDF.SESS.NUM% THEN OPEN.ERROR
8693: 178a:       OPEN IDF.FILE.NAME$ KEYED RECL IDF.RECL% AS IDF.SESS.NUM%         \
8694: 17b7:            NOWRITE NODEL
8695: 17b7:       IDF.OPEN.FLAG$ = "Y"
8696: 17ce: 
8697: 17ce:       CURR.SESS.NUM% = IEF.SESS.NUM%
8698: 17e0:       IF END #IEF.SESS.NUM% THEN OPEN.ERROR
8699: 17fc:       OPEN IEF.FILE.NAME$ KEYED RECL IEF.RECL% AS IEF.SESS.NUM%         \
8700: 1829:            NOWRITE NODEL
8701: 1829:       IEF.OPEN.FLAG$ = "Y"
8702: 1840: 
8703: 1840:       CURR.SESS.NUM% = STKMQ.SESS.NUM%
8704: 1852:       IF END #STKMQ.SESS.NUM% THEN OPEN.ERROR
8705: 186e:       OPEN STKMQ.FILE.NAME$ AS STKMQ.SESS.NUM% BUFFSIZE 512 READONLY    \ DLC
8706: 1897:            NODEL APPEND
8707: 1897:       STKMQ.OPEN.FLAG$ = "Y"
8708: 18ae: 
8709: 18ae:       CURR.SESS.NUM% = BCSMF.SESS.NUM%
8710: 18c0:       IF END #BCSMF.SESS.NUM% THEN OPEN.ERROR
8711: 18dc:       OPEN BCSMF.FILE.NAME$ RECL 512 AS BCSMF.SESS.NUM%                 \
8712: 1905:            NOWRITE NODEL
8713: 1905:       BCSMF.OPEN.FLAG$ = "Y"
8714: 191c: 
8715: 191c:       CURR.SESS.NUM% = DIRSUP.SESS.NUM%
8716: 192e:       IF END #DIRSUP.SESS.NUM% THEN OPEN.ERROR
8717: 194a:       OPEN DIRSUP.FILE.NAME$ KEYED RECL DIRSUP.RECL%                    \
8718: 1977:            AS DIRSUP.SESS.NUM% NOWRITE NODEL
8719: 1977:       DIRSUP.OPEN.FLAG$ = "Y"
8720: 198e: 
8721: 198e:       CURR.SESS.NUM% = DIRORD.SESS.NUM%
8722: 19a0:       IF END #DIRORD.SESS.NUM% THEN OPEN.ERROR
8723: 19bc:       OPEN DIRORD.FILE.NAME$ KEYED RECL DIRORD.RECL%                    \
8724: 19e9:            AS DIRORD.SESS.NUM% NODEL
8725: 19e9:       DIRORD.OPEN.FLAG$ = "Y"
8726: 1a00: 
8727: 1a00:       CURR.SESS.NUM% = DIRWF.SESS.NUM%
8728: 1a12:       IF END #DIRWF.SESS.NUM% THEN CREATE.ERROR
8729: 1a2e:       CREATE POSFILE DIRWF.FILE.NAME$ AS DIRWF.SESS.NUM%                \
8730: 1a55:              BUFFSIZE 10240 LOCKED
8731: 1a55:       DIRWF.OPEN.FLAG$ = "Y"
8732: 1a6c: 
8733: 1a6c:    RETURN
8734: 1a7c: 
8735: 1a7c: 
8736: 1a7c: \******************************************************************************
8737: 1a7c: \***
8738: 1a7c: \***   BUILD.BUS.CENTRE.LETTER.TABLE:
8739: 1a7c: \***
8740: 1a7c: \***      initialize business centre table to blanks
8741: 1a7c: \***
8742: 1a7c: \***      set up variables for reading BCSMF by sector
8743: 1a7c: \***
8744: 1a7c: \***      ignore first sector.
8745: 1a7c: \***      extract each BCSMF record from remaining sectors.
8746: 1a7c: \***      add to business centre table if not a null key and not
8747: 1a7c: \***      a pseudo business centre.
8748: 1a7c: \***
8749: 1a7c: \***      add a business centre letter of blank to table
8750: 1a7c: \***
8751: 1a7c: \***   RETURN
8752: 1a7c: \***
8753: 1a7c: \******************************************************************************
8754: 1a7c: 
8755: 1a7c:    BUILD.BUS.CENTRE.LETTER.TABLE:
8756: 1a8c: 
8757: 1a8c:       FOR BC.INDEX% = 1 TO 16
8758: 1a9c:           BC.LETTER.TABLE$(BC.INDEX%) = " "
8759: 1abe:       NEXT BC.INDEX%
8760: 1ad4: 
8761: 1ad4:       NO.SECTORS% = SIZE (BCSMF.FILE.NAME$) / 512
8762: 1afc:       SECTOR.FORMAT$ =  "T5 C508"
8763: 1b11:       NULL.KEY$ = PACK$("00")
8764: 1b2b:       BC.INDEX% = 0
8765: 1b39:       NO.RECORDS% = 508 / 33
8766: 1b47: 
8767: 1b47:       FOR SECTOR.NUMBER% = 2 TO NO.SECTORS%
8768: 1b58: 
8769: 1b58:           READ FORM SECTOR.FORMAT$;#BCSMF.SESS.NUM%,                     \
8770: 1b8f:                                    SECTOR.NUMBER%;SECTOR$
8771: 1b8f:           FOR RECORD.NUMBER%= 1 TO NO.RECORDS%
8772: 1ba0:               RECORD$ = LEFT$(SECTOR$,33)
8773: 1bc2:               SECTOR$ = RIGHT$(SECTOR$,LEN(SECTOR$)-33)
8774: 1bf2:               IF LEFT$(RECORD$,1) <> NULL.KEY$                           \
8775: 1c6d:                  AND MID$(RECORD$,29,1) <> "Y" THEN BEGIN
8776: 1c6d:                  BC.INDEX% = BC.INDEX% + 1
8777: 1c79:                  BC.LETTER.TABLE$(BC.INDEX%) = LEFT$(RECORD$,1)
8778: 1ca8:               ENDIF
8779: 1cb0:           NEXT RECORD.NUMBER%
8780: 1ccb:       NEXT SECTOR.NUMBER%
8781: 1ce6: 
8782: 1ce6:       BC.INDEX% = BC.INDEX% + 1
8783: 1cf2:       BC.LETTER.TABLE$(BC.INDEX%) = " "
8784: 1d14:       BC.TOTAL% = BC.INDEX%
8785: 1d22: 
8786: 1d22:    RETURN
8787: 1d32: 
8788: 1d32: 
8789: 1d32: \******************************************************************************
8790: 1d32: \***
8791: 1d32: \***   BUILD.ORDER.TABLE.FROM.PDT:
8792: 1d32: \***
8793: 1d32: \***      set variables to 0
8794: 1d32: \***
8795: 1d32: \***      FOR each requested order
8796: 1d32: \***          set order found flag to "N"
8797: 1d32: \***          extract order details
8798: 1d32: \***          IF order is already in order table then
8799: 1d32: \***             set order found flag to "Y"
8800: 1d32: \***          ENDIF
8801: 1d32: \***          IF order found flag is "N" then
8802: 1d32: \***             add order to table
8803: 1d32: \***          ENDIF
8804: 1d32: \***      end for
8805: 1d32: \***
8806: 1d32: \***   RETURN
8807: 1d32: \***
8808: 1d32: \******************************************************************************
8809: 1d32: 
8810: 1d32:    BUILD.ORDER.TABLE.FROM.PDT:
8811: 1d42: 
8812: 1d42:       ORDERS.IN.TABLE% = 0
8813: 1d4f:       START.OF.ORDER% = 0
8814: 1d5d: 
8815: 1d5d:       FOR INDEX% = 1 TO NO.OF.REQUESTED.ORDERS%
8816: 1d6e:           ORDER.FOUND = FALSE
8817: 1d80:           START.OF.ORDER% = START.OF.ORDER% + 11
8818: 1d8d:           ORDER.DETAILS$ = MID$(DATA.IN$,START.OF.ORDER%,11)
8819: 1db4:           FOR ORDER.INDEX% = 1 TO ORDERS.IN.TABLE%
8820: 1dc4:               IF ORDER.DETAILS$ = ORDER.TABLE$(ORDER.INDEX%) THEN BEGIN
8821: 1df1:                  ORDER.FOUND = TRUE
8822: 1e03:               ENDIF
8823: 1e0b:           NEXT ORDER.INDEX%
8824: 1e24:           IF ORDER.FOUND = FALSE THEN BEGIN
8825: 1e39:              ORDERS.IN.TABLE% = ORDERS.IN.TABLE% + 1
8826: 1e45:              ORDER.TABLE$(ORDERS.IN.TABLE%) = ORDER.DETAILS$
8827: 1e6c:           ENDIF
8828: 1e74:       NEXT INDEX%
8829: 1e8f: 
8830: 1e8f:    RETURN
8831: 1e9f: 
8832: 1e9f: 
8833: 1e9f: \******************************************************************************
8834: 1e9f: \***
8835: 1e9f: \***   WRITE.DIRWF.FILE.HEADER:
8836: 1e9f: \***
8837: 1e9f: \***      set up variables for DIRWF file header
8838: 1e9f: \***
8839: 1e9f: \***      write DIRWF file header
8840: 1e9f: \***
8841: 1e9f: \***   RETURN
8842: 1e9f: \***
8843: 1e9f: \******************************************************************************
8844: 1e9f: 
8845: 1e9f:    WRITE.DIRWF.FILE.HEADER:
8846: 1eaf: 
8847: 1eaf:       DIRWF.RECORD.TYPE$ = "FH"
8848: 1ec4:       DIRWF.APPLICATION.NO$ = APPLICATION.NO$
8849: 1ee0:       DIRWF.TERMINAL.NO$ = CURR.TERMINAL$
8850: 1efc:       DIRWF.NO.OF.ORDERS$ = RIGHT$("00" + STR$(ORDERS.IN.TABLE%),2)
8851: 1f41: 
8852: 1f41:       DIRWF.RECORD$ = DIRWF.RECORD.TYPE$ +                              \
8853: 1f7f:                       DIRWF.APPLICATION.NO$ +                           \
8854: 1f7f:                       DIRWF.TERMINAL.NO$ +                              \
8855: 1f7f:                       DIRWF.CHK.QTY.FOR.NO.ORDER$ +                     \
8856: 1f7f:                       DIRWF.NO.OF.ORDERS$
8857: 1f7f: 
8858: 1f7f:       GOSUB WRITE.DIRWF.RECORD
8859: 1f91: 
8860: 1f91:    RETURN
8861: 1fa1: 
8862: 1fa1: 
8863: 1fa1: \******************************************************************************
8864: 1fa1: \***
8865: 1fa1: \***   WRITE.DIRWF.FILE.TRAILER:
8866: 1fa1: \***
8867: 1fa1: \***      set up variables for DIRWF file trailer
8868: 1fa1: \***
8869: 1fa1: \***      write DIRWF file trailer
8870: 1fa1: \***
8871: 1fa1: \***      set the respond option to a LDT trailer to false
8872: 1fa1: \***
8873: 1fa1: \***   RETURN
8874: 1fa1: \***
8875: 1fa1: \******************************************************************************
8876: 1fa1: 
8877: 1fa1:    WRITE.DIRWF.FILE.TRAILER:
8878: 1fb1: 
8879: 1fb1:       DIRWF.RECORD.TYPE$ = "FT"
8880: 1fc6:       DIRWF.APPLICATION.NO$ = APPLICATION.NO$
8881: 1fe2:       DIRWF.TERMINAL.NO$ = CURR.TERMINAL$
8882: 1ffe:       DIRWF.NO.OF.ORDERS$ = RIGHT$("00" + STR$(ORDERS.IN.TABLE%),2)
8883: 2043: 
8884: 2043:       DIRWF.RECORD$ = DIRWF.RECORD.TYPE$ +                              \
8885: 2079:                       DIRWF.APPLICATION.NO$ +                           \
8886: 2079:                       DIRWF.TERMINAL.NO$ +                              \
8887: 2079:                       DIRWF.NO.OF.ORDERS$
8888: 2079: 
8889: 2079:       GOSUB WRITE.DIRWF.RECORD
8890: 208b: 
8891: 208b:       LDT.TRANSMIT = FALSE
8892: 20a1: 
8893: 20a1:    RETURN
8894: 20b1: 
8895: 20b1: 
8896: 20b1: \******************************************************************************
8897: 20b1: \***
8898: 20b1: \***   PROCESS.A.DIRECT.ORDER:
8899: 20b1: \***
8900: 20b1: \***      set REJECT.REASON$ to blank
8901: 20b1: \***      set ITEM.TOTAL% to zero
8902: 20b1: \***      set BAR.CODE.TOTAL% to zero
8903: 20b1: \***      set SINGLES.BOOKED.IN% to zero
8904: 20b1: \***
8905: 20b1: \***      GOSUB LOG.REQUESTED.ORDER to add order details to audit data string
8906: 20b1: \***
8907: 20b1: \***      GOSUB LOOK.FOR.SUPPLIER to find supplier on DIRSUP
8908: 20b1: \***
8909: 20b1: \***      IF a supplier was not found then
8910: 20b1: \***         set reason for rejection to "S"
8911: 20b1: \***         GOSUB WRITE.DIRWF.REJECT.ORD.HEADER
8912: 20b1: \***         GOSUB WRITE.DIRWF.DUMMY.ORD.TRAILER
8913: 20b1: \***         RETURN
8914: 20b1: \***      ENDIF
8915: 20b1: \***
8916: 20b1: \***      GOSUB BUILD.ORDER.HEADER.TABLE to extract orders from
8917: 20b1: \***            DIRORD using requested orders
8918: 20b1: \***
8919: 20b1: \***      IF there are no entries in header table then
8920: 20b1: \***         set reason for rejection to "O"
8921: 20b1: \***         GOSUB WRITE.DIRWF.REJECT.ORD.HEADER
8922: 20b1: \***         GOSUB WRITE.DIRWF.DUMMY.ORD.TRAILER
8923: 20b1: \***         RETURN
8924: 20b1: \***      ENDIF
8925: 20b1: \***
8926: 20b1: \***      GOSUB PROCESS.ORDER.HEADER.TABLE to process orders and
8927: 20b1: \***            write DIRWF header record
8928: 20b1: \***
8929: 20b1: \***      GOSUB PROCESS.ITEMS to extract all items, write DIRWF
8930: 20b1: \***      detail records and add barcodes to barcode table.
8931: 20b1: \***
8932: 20b1: \***      redimension tables ready for next order
8933: 20b1: \***
8934: 20b1: \***   RETURN
8935: 20b1: \***
8936: 20b1: \******************************************************************************
8937: 20b1: 
8938: 20b1:    PROCESS.A.DIRECT.ORDER:
8939: 20c1: 
8940: 20c1:       REJECT.REASON$ = " "
8941: 20d6:       ITEM.TOTAL% = 0
8942: 20e4:       BAR.CODE.TOTAL% = 0
8943: 20f2:       SINGLES.BOOKED.IN% = 0
8944: 2100: 
8945: 2100:       GOSUB LOG.REQUESTED.ORDER
8946: 2112: 
8947: 2112:       GOSUB LOOK.FOR.SUPPLIER
8948: 2124: 
8949: 2124:       IF NOT SUPPLIER.FOUND THEN BEGIN
8950: 2133:          REJECT.REASON$ = "S"
8951: 2148:          GOSUB WRITE.DIRWF.REJECT.ORD.HEADER
8952: 215a:          GOSUB WRITE.DIRWF.DUMMY.ORD.TRAILER
8953: 216c:          RETURN
8954: 217c:       ENDIF
8955: 2184: 
8956: 2184:       GOSUB BUILD.ORDER.HEADER.TABLE
8957: 2196: 
8958: 2196:       IF ASN.ACTIVE%                                                    \ 1.6NWB
8959: 21ab:      AND SUPERCEDED% THEN BEGIN                                         ! 1.6NWB
8960: 21ab:          REJECT.REASON$ = "C"                                           ! 1.6NWB
8961: 21c0:          GOSUB WRITE.DIRWF.REJECT.ORD.HEADER                            ! 1.6NWB
8962: 21d2:          GOSUB WRITE.DIRWF.DUMMY.ORD.TRAILER                            ! 1.6NWB
8963: 21e4:          RETURN                                                         ! 1.6NWB
8964: 21f4:       ENDIF                                                             ! 1.6NWB
8965: 21fc: 
8966: 21fc:       IF HEADER.TOTAL% = 0 THEN BEGIN
8967: 220b:          REJECT.REASON$ = "O"
8968: 2220:          GOSUB WRITE.DIRWF.REJECT.ORD.HEADER
8969: 2232:          GOSUB WRITE.DIRWF.DUMMY.ORD.TRAILER
8970: 2244:          RETURN
8971: 2254:       ENDIF
8972: 225c: 
8973: 225c:       GOSUB PROCESS.ORDER.HEADER.TABLE
8974: 226e: 
8975: 226e:       GOSUB PROCESS.ITEMS
8976: 2280: 
8977: 2280:       IF REJECT.REASON$ = " " AND                                       \
8978: 22af:          NOT ORDER.HEADER.WRITTEN THEN BEGIN
8979: 22af:          REJECT.REASON$ = "O"
8980: 22c4:          GOSUB WRITE.DIRWF.REJECT.ORD.HEADER
8981: 22d6:          GOSUB WRITE.DIRWF.DUMMY.ORD.TRAILER
8982: 22e8:       ENDIF
8983: 22f0: 
8984: 22f0:       IF REJECT.REASON$ = " " THEN BEGIN
8985: 230b:          GOSUB PROCESS.BAR.CODE.TABLE
8986: 231d:          GOSUB WRITE.DIRWF.ORDER.TRAILER
8987: 232f:       ENDIF
8988: 2337: 
8989: 2337:       DIM BAR.CODE.TABLE$(9000)
8990: 2361:       DIM DIRWF.DETAIL.TABLE$(1600)
8991: 238b:       DIM ITEM.POSITION.TABLE$(9000)
8992: 23b5:       DIM HEADER.TABLE$(10)
8993: 23de: 
8994: 23de:    RETURN
8995: 23ee: 
8996: 23ee: 
8997: 23ee: \******************************************************************************
8998: 23ee: \***
8999: 23ee: \***   LOG.REQUESTED.ORDER:
9000: 23ee: \***
9001: 23ee: \***      set up CSRAF audit line with direct order information
9002: 23ee: \***      write to audit file
9003: 23ee: \***
9004: 23ee: \***   RETURN
9005: 23ee: \***
9006: 23ee: \******************************************************************************
9007: 23ee: 
9008: 23ee:    LOG.REQUESTED.ORDER:
9009: 23fe: 
9010: 23fe:       CSR.AUDIT.DATA$ = "DIRECT ORDER REQUESTED: " +                    \
9011: 2469:                         " SUPPLIER NO = " +                             \
9012: 2469:                         LEFT$(ORDER.TABLE$(ORDER.INDEX%),6) +           \
9013: 2469:                         " ORDER NO = " +                                \
9014: 2469:                         MID$(ORDER.TABLE$(ORDER.INDEX%),7,5)
9015: 2469: 
9016: 2469:       GOSUB LOG.TO.AUDIT.FILE
9017: 247b: 
9018: 247b:    RETURN
9019: 248b: 
9020: 248b: 
9021: 248b: \******************************************************************************
9022: 248b: \***
9023: 248b: \***   LOOK.FOR.SUPPLIER:
9024: 248b: \***
9025: 248b: \***
9026: 248b: \***      pack supplier number from order table and set other variables
9027: 248b: \***
9028: 248b: \***      While the supplier has not been found and
9029: 248b: \***            there are business centres left to check
9030: 248b: \***            increment BC.INDEX
9031: 248b: \***            format DIRSUP key using business centre letter and
9032: 248b: \***                   packed supplier number
9033: 248b: \***            key read DIRSUP
9034: 248b: \***            IF record not found then
9035: 248b: \***               continue with next business centre letter
9036: 248b: \***            ELSE
9037: 248b: \***               set SUPPLIER.FOUND to true
9038: 248b: \***            ENDIF
9039: 248b: \***      Wend
9040: 248b: \***
9041: 248b: \***   RETURN
9042: 248b: \***
9043: 248b: \******************************************************************************
9044: 248b: 
9045: 248b:    LOOK.FOR.SUPPLIER:
9046: 249b: 
9047: 249b:       BC.INDEX% = 0
9048: 24a9:       SUPPLIER.FOUND = FALSE
9049: 24bb:       SUPPLIER.NO.PACKED$ = PACK$(LEFT$(ORDER.TABLE$(ORDER.INDEX%),6))
9050: 24f0:       CURR.SESS.NUM% = DIRSUP.SESS.NUM%
9051: 2502: 
9052: 2502:       WHILE NOT SUPPLIER.FOUND AND                                    \
9053: 250d:             BC.INDEX% <> BC.TOTAL%
9054: 250d:             BC.INDEX% = BC.INDEX% + 1
9055: 2519:             DIRSUP.RECKEY$ = BC.LETTER.TABLE$(BC.INDEX%) + SUPPLIER.NO.PACKED$
9056: 254d:             RC% = READ.DIRSUP                                           ! BLC
9057: 2561:             IF RC% = 1 THEN GOTO SUPPLIER.NOT.FOUND                     ! BLC
9058: 2575:             SUPPLIER.FOUND = TRUE
9059: 2587:    SUPPLIER.NOT.FOUND:
9060: 2597:       WEND
9061: 25b9: 
9062: 25b9:       RETURN
9063: 25c9: 
9064: 25c9: 
9065: 25c9: \******************************************************************************
9066: 25c9: \***
9067: 25c9: \***   WRITE.DIRWF.REJECT.ORD.HEADER:
9068: 25c9: \***
9069: 25c9: \***      set up variables for DIRWF header
9070: 25c9: \***
9071: 25c9: \***      write DIRWF header
9072: 25c9: \***
9073: 25c9: \***   RETURN
9074: 25c9: \***
9075: 25c9: \******************************************************************************
9076: 25c9: 
9077: 25c9:    WRITE.DIRWF.REJECT.ORD.HEADER:
9078: 25d9: 
9079: 25d9:       DIRWF.RECORD.TYPE$ = "OH"
9080: 25ee:       DIRWF.SUPPLIER.NUMBER$ = LEFT$(ORDER.TABLE$(ORDER.INDEX%),6)
9081: 261e:       DIRWF.ORDER.NUMBER$ = MID$(ORDER.TABLE$(ORDER.INDEX%),7,4)
9082: 264e:       DIRWF.ORDER.SUFFIX$ = RIGHT$(ORDER.TABLE$(ORDER.INDEX%),1)
9083: 267c:       DIRWF.ITEMS.IN.ORDER$ = "0000"
9084: 2691:       DIRWF.SINGLES.IN.ORDER$ = "00000"
9085: 26a6:       DIRWF.ITEMS.BOOKED.IN$ = "0000"
9086: 26bb:       DIRWF.SINGLES.BOOKED.IN$ = "00000"
9087: 26d0:       IF REJECT.REASON$ = "S" THEN BEGIN
9088: 26eb:          DIRWF.SUPPLIER.NAME$ = "UNKNOWN   "
9089: 2700:          DIRWF.HIGH.QTY.LIMIT$ = "000"
9090: 2715:          DIRWF.QTY.LIMIT$ = "000"
9091: 272a:          DIRWF.DISCREP.QTY$ = "000"
9092: 273f:          DIRWF.DISCREP.PERC$ = "000"
9093: 2757:       ENDIF ELSE BEGIN
9094: 275f:          DIRWF.SUPPLIER.NAME$ = DIRSUP.SUPPLIER.NAME$
9095: 277b:          DIRWF.HIGH.QTY.LIMIT$ = RIGHT$(UNPACK$(DIRSUP.MAX.CHECK.QTY$),3)
9096: 27ae:          DIRWF.QTY.LIMIT$ = RIGHT$(UNPACK$(DIRSUP.CHECK.QTY$),3)
9097: 27e1:          DIRWF.DISCREP.QTY$ = RIGHT$(UNPACK$(DIRSUP.DISCREPANCY.QTY$),3)
9098: 2814:          DIRWF.DISCREP.PERC$ = RIGHT$(UNPACK$(DIRSUP.DISCREPANCY.PERC$),3)
9099: 2847:       ENDIF
9100: 284f:       DIRWF.REJECT.REASON$ = REJECT.REASON$
9101: 2868:       DIRWF.ORDER.FLAG$ = " "
9102: 287d: 
9103: 287d:       DIRWF.RECORD$ = DIRWF.RECORD.TYPE$ +                              \
9104: 290b:                       DIRWF.SUPPLIER.NUMBER$ +                          \
9105: 290b:                       DIRWF.ORDER.NUMBER$ +                             \
9106: 290b:                       DIRWF.ORDER.SUFFIX$ +                             \
9107: 290b:                       DIRWF.ITEMS.IN.ORDER$ +                           \
9108: 290b:                       DIRWF.SINGLES.IN.ORDER$ +                         \
9109: 290b:                       DIRWF.ITEMS.BOOKED.IN$ +                          \
9110: 290b:                       DIRWF.SINGLES.BOOKED.IN$ +                        \
9111: 290b:                       DIRWF.SUPPLIER.NAME$ +                            \
9112: 290b:                       DIRWF.HIGH.QTY.LIMIT$ +                           \
9113: 290b:                       DIRWF.QTY.LIMIT$ +                                \
9114: 290b:                       DIRWF.DISCREP.QTY$ +                              \
9115: 290b:                       DIRWF.DISCREP.PERC$ +                             \
9116: 290b:                       DIRWF.REJECT.REASON$ +                            \
9117: 290b:                       DIRWF.ORDER.FLAG$
9118: 290b: 
9119: 290b:       GOSUB WRITE.DIRWF.RECORD
9120: 291d: 
9121: 291d:    RETURN
9122: 292d: 
9123: 292d: 
9124: 292d: \******************************************************************************
9125: 292d: \***
9126: 292d: \***   WRITE.DIRWF.DUMMY.ORD.TRAILER:
9127: 292d: \***
9128: 292d: \***      set up variables for DIRWF trailer
9129: 292d: \***
9130: 292d: \***      write DIRWF trailer
9131: 292d: \***
9132: 292d: \***   RETURN
9133: 292d: \***
9134: 292d: \******************************************************************************
9135: 292d: 
9136: 292d:    WRITE.DIRWF.DUMMY.ORD.TRAILER:
9137: 293d: 
9138: 293d:       DIRWF.RECORD.TYPE$ = "OT"
9139: 2952:       DIRWF.NO.OF.BARCODES$ = "00000"
9140: 2967: 
9141: 2967:       DIRWF.RECORD$ = DIRWF.RECORD.TYPE$ +                              \
9142: 298d:                       DIRWF.NO.OF.BARCODES$
9143: 298d: 
9144: 298d:       GOSUB WRITE.DIRWF.RECORD
9145: 299f: 
9146: 299f:    RETURN
9147: 29af: 
9148: 29af: 
9149: 29af: \******************************************************************************
9150: 29af: \***
9151: 29af: \***   BUILD.ORDER.HEADER.TABLE:
9152: 29af: \***
9153: 29af: \***
9154: 29af: \***      set header table index to 0
9155: 29af: \***
9156: 29af: \***      set up first part of DIRORD key from order table
9157: 29af: \***
9158: 29af: \***      For each business centre letter in table
9159: 29af: \***          format a DIRORD record key using key details from
9160: 29af: \***                 order table, business letter table and
9161: 29af: \***                 source of record set to " "
9162: 29af: \***          key read DIRORD
9163: 29af: \***          IF record found then
9164: 29af: \***             store DIRORD record key in header table
9165: 29af: \***          ENDIF
9166: 29af: \***      end for
9167: 29af: \***
9168: 29af: \***      manual direct orders will have a business centre letter set
9169: 29af: \***      to blank and a source of record set to "D"
9170: 29af: \***
9171: 29af: \***      key read DIRORD again for a manual direct order
9172: 29af: \***      if DIRORD not found then GOTO MANUAL.ORD.NOT.FOUND
9173: 29af: \***
9174: 29af: \***      if the header table has only one entry then
9175: 29af: \***         set the manual order flag to "M" in header table
9176: 29af: \***      else
9177: 29af: \***         if the header table has no entries then
9178: 29af: \***            add an entry with manual order flag set to " "
9179: 29af: \***         endif
9180: 29af: \***      endif
9181: 29af: \***
9182: 29af: \***      (if the header table has more than 1 entry it is not
9183: 29af: \***       possible to match the manual order against a particular
9184: 29af: \***       entry.  In this case, the manual order is ignored.)
9185: 29af: \***
9186: 29af: \***   MANUAL.ORD.NOT.FOUND:
9187: 29af: \***
9188: 29af: \***   RETURN
9189: 29af: \***
9190: 29af: \******************************************************************************
9191: 29af: 
9192: 29af:    BUILD.ORDER.HEADER.TABLE:
9193: 29bf: 
9194: 29bf:       HEADER.TOTAL% = 0
9195: 29cd:       SUPERCEDED% = 0                                                   ! 1.6NWB
9196: 29da:       ORDER.DETAILS$ = PACK$(LEFT$(ORDER.TABLE$(ORDER.INDEX%),10)) +     \
9197: 2a45:                        RIGHT$(ORDER.TABLE$(ORDER.INDEX%),1)
9198: 2a45:       CURR.SESS.NUM% = DIRORD.SESS.NUM%
9199: 2a57: 
9200: 2a57:       FOR BC.INDEX% = 1 TO BC.TOTAL%
9201: 2a68:           DIRORD.RECKEY$ = ORDER.DETAILS$ +                              \
9202: 2aa9:                            BC.LETTER.TABLE$(BC.INDEX%) +                 \
9203: 2aa9:                            " " + PACK$("00")
9204: 2aa9:           RC% = READ.DIRORD                                             ! HLC
9205: 2abd:           IF RC% = 1 THEN GOTO DIRORD.NOT.FOUND                         ! HLC
9206: 2ad1:           IF DIRORD.SUPERCEDED$ = "Y" THEN SUPERCEDED% = -1             ! 1.6NWB
9207: 2af4:           HEADER.TOTAL% = HEADER.TOTAL% + 1
9208: 2b00:           HEADER.TABLE$(HEADER.TOTAL%) = DIRORD.RECKEY$ + " "
9209: 2b30:    DIRORD.NOT.FOUND:
9210: 2b40:       NEXT BC.INDEX%
9211: 2b5b: 
9212: 2b5b:       DIRORD.RECKEY$ = ORDER.DETAILS$ +  " " + "D" + PACK$("00")
9213: 2b8a:       RC% = READ.DIRORD                                                 ! HLC
9214: 2b9e:       IF RC% = 1 THEN GOTO MANUAL.ORD.NOT.FOUND                         ! HLC
9215: 2bb3: 
9216: 2bb3:       IF HEADER.TOTAL% = 1 THEN BEGIN
9217: 2bc2:          HEADER.TABLE$(1) = LEFT$(HEADER.TABLE$(1),9) + "M"
9218: 2c0f:       ENDIF ELSE BEGIN
9219: 2c17:          IF HEADER.TOTAL% = 0 THEN BEGIN
9220: 2c26:             HEADER.TOTAL% = HEADER.TOTAL% + 1
9221: 2c32:             HEADER.TABLE$(HEADER.TOTAL%) = DIRORD.RECKEY$ + " "
9222: 2c62:          ENDIF
9223: 2c6a:       ENDIF
9224: 2c72: 
9225: 2c72:    MANUAL.ORD.NOT.FOUND:
9226: 2c82: 
9227: 2c82:       RETURN
9228: 2c92: 
9229: 2c92: 
9230: 2c92: \******************************************************************************
9231: 2c92: \***
9232: 2c92: \***   PROCESS.ORDER.HEADER.TABLE:
9233: 2c92: \***
9234: 2c92: \***      format DIRSUP record key from first entry in header table
9235: 2c92: \***      set SUPPLIER.FOUND to false
9236: 2c92: \***      set BC.INDEX% to 0
9237: 2c92: \***
9238: 2c92: \***      key read DIRSUP
9239: 2c92: \***
9240: 2c92: \***      while DIRSUP record not found then
9241: 2c92: \***         key read DIRSUP for each business centre in turn
9242: 2c92: \***      wend
9243: 2c92: \***
9244: 2c92: \***      key read DIRORD
9245: 2c92: \***
9246: 2c92: \***      format a DIRWF header record
9247: 2c92: \***
9248: 2c92: \***      if more than one entry in header table
9249: 2c92: \***          for each remaining entry in header table
9250: 2c92: \***              add items in order to total number of items
9251: 2c92: \***              add singles in order to total number of singles
9252: 2c92: \***          end for
9253: 2c92: \***          set lines booked in so far to 0
9254: 2c92: \***      endif
9255: 2c92: \***
9256: 2c92: \***   RETURN
9257: 2c92: \***
9258: 2c92: \******************************************************************************
9259: 2c92: 
9260: 2c92:    PROCESS.ORDER.HEADER.TABLE:
9261: 2ca2: 
9262: 2ca2:       DIRSUP.RECKEY$ = MID$(HEADER.TABLE$(1),7,1) +                    \
9263: 2cfd:                        LEFT$(HEADER.TABLE$(1),3)
9264: 2cfd:       SUPPLIER.FOUND = FALSE
9265: 2d0f:       BC.INDEX% = 0
9266: 2d1d: 
9267: 2d1d:       CURR.SESS.NUM% = DIRSUP.SESS.NUM%
9268: 2d2f:       RC% = READ.DIRSUP                                                 ! BLC
9269: 2d43:       IF RC% = 1 THEN GOTO TRY.ANOTHER.BC                               ! BLC
9270: 2d57:       SUPPLIER.FOUND = TRUE
9271: 2d69: 
9272: 2d69:   TRY.ANOTHER.BC:
9273: 2d79: 
9274: 2d79:       WHILE NOT SUPPLIER.FOUND AND                                      \
9275: 2d84:         BC.INDEX% <> BC.TOTAL%
9276: 2d84:         BC.INDEX% = BC.INDEX% + 1
9277: 2d90:         DIRSUP.RECKEY$ = BC.LETTER.TABLE$(BC.INDEX%) + RIGHT$(DIRSUP.RECKEY$,3)
9278: 2dce:         IF END# DIRSUP.SESS.NUM% THEN SUPPLIER.NOT.FOUND2
9279: 2dea:         RC% = READ.DIRSUP                                               ! BLC
9280: 2dfe:         IF RC% = 1 THEN GOTO SUPPLIER.NOT.FOUND2                        ! BLC
9281: 2e12:         SUPPLIER.FOUND = TRUE
9282: 2e24:   SUPPLIER.NOT.FOUND2:
9283: 2e34:       WEND
9284: 2e56: 
9285: 2e56:       CURR.SESS.NUM% = DIRORD.SESS.NUM%
9286: 2e68:       DIRORD.RECKEY$ = LEFT$(HEADER.TABLE$(1),9)
9287: 2e98:       CURRENT.KEY$ = UNPACK$(LEFT$(DIRORD.RECKEY$,4))
9288: 2ec2:       RC% = READ.DIRORD                                                 ! BLC
9289: 2ed6:       IF RC% = 1 THEN GOTO READ.ERROR                                   ! BLC
9290: 2eeb: 
9291: 2eeb:       DIRWF.RECORD.TYPE$ = "OH"
9292: 2f00:       DIRWF.SUPPLIER.NUMBER$ = LEFT$(ORDER.TABLE$(ORDER.INDEX%),6)
9293: 2f30:       DIRWF.ORDER.NUMBER$ = MID$(ORDER.TABLE$(ORDER.INDEX%),7,4)
9294: 2f60:       DIRWF.ORDER.SUFFIX$ = RIGHT$(ORDER.TABLE$(ORDER.INDEX%),1)
9295: 2f8e: 
9296: 2f8e:       ITEMS.IN.ORDER% = VAL(UNPACK$(DIRORD.NO.ORDER.ITEM$))
9297: 2fb3:       SINGLES.IN.ORDER% = VAL(UNPACK$(DIRORD.NO.ORDER.SNGL$))
9298: 2fd8: 
9299: 2fd8:       DIRWF.ITEMS.BOOKED.IN$ = UNPACK$(DIRORD.NO.ITEMS.BOOKED$)
9300: 2ff9:       DIRWF.SUPPLIER.NAME$ = DIRSUP.SUPPLIER.NAME$
9301: 3015:       DIRWF.HIGH.QTY.LIMIT$ = RIGHT$(UNPACK$(DIRSUP.MAX.CHECK.QTY$),3)
9302: 3048:       DIRWF.QTY.LIMIT$ = RIGHT$(UNPACK$(DIRSUP.CHECK.QTY$),3)
9303: 307b:       DIRWF.DISCREP.QTY$ = RIGHT$(UNPACK$(DIRSUP.DISCREPANCY.QTY$),3)
9304: 30ae:       DIRWF.DISCREP.PERC$ = RIGHT$(UNPACK$(DIRSUP.DISCREPANCY.PERC$),3)
9305: 30e1:       DIRWF.REJECT.REASON$ = " "
9306: 30f6:       DIRWF.ORDER.FLAG$ = RIGHT$(HEADER.TABLE$(1),1)
9307: 3122: 
9308: 3122:       IF HEADER.TOTAL% > 1 THEN BEGIN
9309: 3134:          FOR INDEX% = 2 TO HEADER.TOTAL%
9310: 3145:              DIRORD.RECKEY$ = LEFT$(HEADER.TABLE$(INDEX%),9)
9311: 3177:              CURRENT.KEY$ = UNPACK$(LEFT$(DIRORD.RECKEY$,4))
9312: 31a1:              RC% = READ.DIRORD                                          ! BLC
9313: 31b5:              IF RC% = 1 THEN GOTO READ.ERROR                            ! BLC
9314: 31ca:              ITEMS.IN.ORDER% = ITEMS.IN.ORDER% +                        \
9315: 3219:                                VAL(UNPACK$(DIRORD.NO.ORDER.ITEM$))
9316: 3219:              SINGLES.IN.ORDER% = SINGLES.IN.ORDER% +                    \
9317: 3268:                                  VAL(UNPACK$(DIRORD.NO.ORDER.SNGL$))
9318: 3268:          NEXT INDEX%
9319: 3283:          DIRWF.ITEMS.BOOKED.IN$ = "0000"
9320: 3298:          DIRWF.SINGLES.BOOKED.IN$ = "00000"
9321: 32ad:       ENDIF
9322: 32b5: 
9323: 32b5:       DIRWF.ITEMS.IN.ORDER$ = FN.Z.PACK(STR$(ITEMS.IN.ORDER%),4)
9324: 32e2:       DIRWF.SINGLES.IN.ORDER$ = FN.Z.PACK(STR$(SINGLES.IN.ORDER%),5)
9325: 330f: 
9326: 330f:       RETURN
9327: 331f: 
9328: 331f: 
9329: 331f: \******************************************************************************
9330: 331f: \***
9331: 331f: \***   BUILD.DIRWF.ORDER.HEADER:
9332: 331f: \***
9333: 331f: \***      build dirwf record
9334: 331f: \***
9335: 331f: \***   RETURN
9336: 331f: \***
9337: 331f: \******************************************************************************
9338: 331f: 
9339: 331f:    BUILD.DIRWF.ORDER.HEADER:
9340: 332f: 
9341: 332f:       DIRWF.HEADER.RECORD$ = DIRWF.RECORD.TYPE$ +                       \
9342: 33bb:                              DIRWF.SUPPLIER.NUMBER$ +                   \
9343: 33bb:                              DIRWF.ORDER.NUMBER$ +                      \
9344: 33bb:                              DIRWF.ORDER.SUFFIX$ +                      \
9345: 33bb:                              DIRWF.ITEMS.IN.ORDER$ +                    \
9346: 33bb:                              DIRWF.SINGLES.IN.ORDER$ +                  \
9347: 33bb:                              DIRWF.ITEMS.BOOKED.IN$ +                   \
9348: 33bb:                              DIRWF.SINGLES.BOOKED.IN$ +                 \
9349: 33bb:                              DIRWF.SUPPLIER.NAME$ +                     \
9350: 33bb:                              DIRWF.HIGH.QTY.LIMIT$ +                    \
9351: 33bb:                              DIRWF.QTY.LIMIT$ +                         \
9352: 33bb:                              DIRWF.DISCREP.QTY$ +                       \
9353: 33bb:                              DIRWF.DISCREP.PERC$ +                      \
9354: 33bb:                              DIRWF.REJECT.REASON$ +                     \
9355: 33bb:                              DIRWF.ORDER.FLAG$
9356: 33bb: 
9357: 33bb: 
9358: 33bb:    RETURN
9359: 33cb: 
9360: 33cb: 
9361: 33cb: \******************************************************************************
9362: 33cb: \***
9363: 33cb: \***   PROCESS.ITEMS:
9364: 33cb: \***
9365: 33cb: \***      set order header written to false
9366: 33cb: \***
9367: 33cb: \***      for each entry in header table
9368: 33cb: \***          for page number 1 to 99
9369: 33cb: \***              format a DIRORD record key using header table and page no
9370: 33cb: \***              if DIRORD not found then goto READ.NEXT.PAGE
9371: 33cb: \***              for each item in DIRORD record
9372: 33cb: \***                  GOSUB CHECK.ITEM
9373: 33cb: \***              next item
9374: 33cb: \***   READ.NEXT.PAGE:
9375: 33cb: \***          next page number
9376: 33cb: \***      next header table entry
9377: 33cb: \***
9378: 33cb: \***      if detail records were found then
9379: 33cb: \***         write DIRWF header record
9380: 33cb: \***         write all DIRWF detail records
9381: 33cb: \***      endif
9382: 33cb: \***
9383: 33cb: \***   RETURN
9384: 33cb: \***
9385: 33cb: \******************************************************************************
9386: 33cb: 
9387: 33cb:    PROCESS.ITEMS:
9388: 33db: 
9389: 33db:       ORDER.HEADER.WRITTEN = FALSE
9390: 33ed: 
9391: 33ed:       FOR HEADER.INDEX% = 1 TO HEADER.TOTAL%
9392: 33fe:           ORDER.DETAILS$ = LEFT$(HEADER.TABLE$(HEADER.INDEX%),8)
9393: 342e:           FOR PAGE.NO% = 1 TO 99
9394: 343f:               DIRORD.RECKEY$ = ORDER.DETAILS$ +                         \
9395: 3495:                                PACK$(RIGHT$("00" + STR$(PAGE.NO%),2))
9396: 3495:               CURR.SESS.NUM% = DIRORD.SESS.NUM%
9397: 34a7:               RC% = READ.DIRORD                                         ! BLC
9398: 34bb:               IF RC% = 1 THEN GOTO READ.NEXT.PAGE                       ! BLC
9399: 34cf:               FOR ITEM.COUNT% = 1 TO VAL(UNPACK$(DIRORD.ITEM.COUNT$))
9400: 34df:                   GOSUB CHECK.ITEM
9401: 34f1:               NEXT ITEM.COUNT%
9402: 3520:    READ.NEXT.PAGE:
9403: 3530:           NEXT PAGE.NO%
9404: 3549:       NEXT HEADER.INDEX%
9405: 3564: 
9406: 3564:       IF ITEM.TOTAL% <> 0 THEN BEGIN
9407: 3576:          IF HEADER.TOTAL% = 1 THEN BEGIN
9408: 3585:             DIRWF.SINGLES.BOOKED.IN$ = FN.Z.PACK(STR$(SINGLES.BOOKED.IN%),5)
9409: 35b2:          ENDIF
9410: 35ba:          GOSUB BUILD.DIRWF.ORDER.HEADER
9411: 35cc:          DIRWF.RECORD$ = DIRWF.HEADER.RECORD$
9412: 35e7:          GOSUB WRITE.DIRWF.RECORD
9413: 35f9:          ORDER.HEADER.WRITTEN = TRUE
9414: 360b:          FOR ITEM.COUNT% = 1 TO ITEM.TOTAL%
9415: 361b:              GOSUB WRITE.DIRWF.DETAIL.RECORD
9416: 362d:          NEXT ITEM.COUNT%
9417: 3645:       ENDIF
9418: 364d: 
9419: 364d:       RETURN
9420: 365d: 
9421: 365d: 
9422: 365d: \******************************************************************************
9423: 365d: \***
9424: 365d: \***   CHECK.ITEM:
9425: 365d: \***
9426: 365d: \***      extract item code from DIRORD
9427: 365d: \***
9428: 365d: \***      if not blank item code then
9429: 365d: \***         add details to table
9430: 365d: \***         add barcodes to table
9431: 365d: \***      endif
9432: 365d: \***
9433: 365d: \***   RETURN
9434: 365d: \***
9435: 365d: \******************************************************************************
9436: 365d: 
9437: 365d:    CHECK.ITEM:
9438: 366d: 
9439: 366d:        ITEM.CODE$ = RIGHT$(UNPACK$(DIRORD.ITEM.DETAILS$(ITEM.COUNT%,1)),7)
9440: 36b0: 
9441: 36b0:        IF ITEM.CODE$ = "0000000" THEN BEGIN
9442: 36cb:           RETURN
9443: 36dd:        ENDIF ELSE BEGIN
9444: 36e5:              ITEM.TOTAL% = ITEM.TOTAL% + 1
9445: 36f1:              GOSUB ADD.DETAIL.RECORD.TO.TABLE
9446: 3703:              GOSUB ADD.BARCODES.TO.TABLE
9447: 3715:        ENDIF
9448: 371d: 
9449: 371d:    RETURN
9450: 372d: 
9451: 372d: 
9452: 372d: \******************************************************************************
9453: 372d: \***
9454: 372d: \***   ADD.DETAIL.RECORD.TO.TABLE:
9455: 372d: \***
9456: 372d: \***      format DIRWF details and add to table
9457: 372d: \***
9458: 372d: \***      sum all singles booked in
9459: 372d: \***
9460: 372d: \***   RETURN
9461: 372d: \***
9462: 372d: \******************************************************************************
9463: 372d: 
9464: 372d:    ADD.DETAIL.RECORD.TO.TABLE:
9465: 373d: 
9466: 373d:       DIRWF.ITEM.CODE$ =                                                \
9467: 3780:                  RIGHT$(UNPACK$(DIRORD.ITEM.DETAILS$(ITEM.COUNT%,1)),7)
9468: 3780:       DIRWF.EXPECTED.QTY$ =                                             \
9469: 37c1:                  FN.Z.PACK(STR$(DIRORD.ITEM.QTY%(ITEM.COUNT%,1)),4)
9470: 37c1:       DIRWF.PAGE.NO$ = FN.Z.PACK(STR$(PAGE.NO%),2)
9471: 37ee: 
9472: 37ee:       DIRWF.DETAIL.TABLE$(ITEM.TOTAL%) = DIRWF.ITEM.CODE$ +             \
9473: 3827:                                          DIRWF.EXPECTED.QTY$ +          \
9474: 3827:                                          DIRWF.PAGE.NO$
9475: 3827: 
9476: 3827:       SINGLES.BOOKED.IN% = SINGLES.BOOKED.IN% +                         \
9477: 3889:                            DIRORD.ITEM.QTY%(ITEM.COUNT%,2) +            \
9478: 3889:                            DIRORD.ITEM.QTY%(ITEM.COUNT%,3) +            \
9479: 3889:                            DIRORD.ITEM.QTY%(ITEM.COUNT%,4)
9480: 3889: 
9481: 3889: 
9482: 3889:    RETURN
9483: 3899: 
9484: 3899: 
9485: 3899: \******************************************************************************
9486: 3899: \***
9487: 3899: \***   WRITE.DIRWF.DETAIL.RECORD:
9488: 3899: \***
9489: 3899: \***      format DIRWF record
9490: 3899: \***
9491: 3899: \***      write DIRWF detail record
9492: 3899: \***
9493: 3899: \***   RETURN
9494: 3899: \***
9495: 3899: \******************************************************************************
9496: 3899: 
9497: 3899:    WRITE.DIRWF.DETAIL.RECORD:
9498: 38a9: 
9499: 38a9:       DIRWF.RECORD$ = "OD" + DIRWF.DETAIL.TABLE$(ITEM.COUNT%)
9500: 38d9: 
9501: 38d9:       GOSUB WRITE.DIRWF.RECORD
9502: 38eb: 
9503: 38eb:    RETURN
9504: 38fb: 
9505: 38fb: 
9506: 38fb: \******************************************************************************
9507: 38fb: \***
9508: 38fb: \***   ADD.BARCODES.TO.TABLE:
9509: 38fb: \***
9510: 38fb: \***      read IDF using DIRORD boots code
9511: 38fb: \***      if IDF record not found then GOTO NOT.ON.IDF
9512: 38fb: \***
9513: 38fb: \***      set number of bar codes to IDF number of bar codes
9514: 38fb: \***      reformat ITEM.TOTAL% to a 3 digit string for adding to table
9515: 38fb: \***
9516: 38fb: \***      if number of bar codes < 3 then
9517: 38fb: \***         add 1 to bar code total
9518: 38fb: \***         move IDF first bar code into bar code table
9519: 38fb: \***         move position of this item code into item position table
9520: 38fb: \***         if number of bar codes = 2 then
9521: 38fb: \***            add 1 to bar code total
9522: 38fb: \***            move IDF second bar code into bar code table
9523: 38fb: \***            move position of this item code into item position table
9524: 38fb: \***         endif
9525: 38fb: \***      else
9526: 38fb: \***         add 1 to bar code total
9527: 38fb: \***         move IDF first bar code into bar code table
9528: 38fb: \***         move position of this item code into item position table
9529: 38fb: \***         add 1 to bar code total
9530: 38fb: \***         move IDF second bar code into bar code table
9531: 38fb: \***         move position of this item code into item position table
9532: 38fb: \***         set function bar code counter to 1
9533: 38fb: \***         set function key to next bar code to IDF second bar code
9534: 38fb: \***         set MORE.BAR.CODES to true
9535: 38fb: \***         set CURR.SESS.NUM% to IEF session number
9536: 38fb: \***         while there are more bar codes to read
9537: 38fb: \***               call READ.NEXT.IEF to get next bar code
9538: 38fb: \***               if bar code zeroes or
9539: 38fb: \***                  return code not = 0 then
9540: 38fb: \***                  set MORE.BAR.CODES to false
9541: 38fb: \***               else
9542: 38fb: \***                  add 1 to bar code total
9543: 38fb: \***                  move next IEF bar code into bar code table
9544: 38fb: \***                  move position of this item code into item position table
9545: 38fb: \***               endif
9546: 38fb: \***         wend
9547: 38fb: \***      endif
9548: 38fb: \***
9549: 38fb: \***   NOT.ON.IDF:
9550: 38fb: \***
9551: 38fb: \***   RETURN
9552: 38fb: \***
9553: 38fb: \******************************************************************************
9554: 38fb: 
9555: 38fb:    ADD.BARCODES.TO.TABLE:
9556: 390b:        CURR.SESS.NUM% = IDF.SESS.NUM%
9557: 391d:        IDF.BOOTS.CODE$ = DIRORD.ITEM.DETAILS$(ITEM.COUNT%,1)
9558: 394b:        IF IDF.BOOTS.CODE$ = PACK$("00000000") THEN BEGIN
9559: 3971:           GOTO NOT.ON.IDF
9560: 397c:        ENDIF
9561: 3984:        CURRENT.KEY$ = UNPACK$(IDF.BOOTS.CODE$)
9562: 39a5:        RC% = READ.IDF                                           ! BLC
9563: 39b9:        IF RC% = 1 THEN GOTO NOT.ON.IDF                          ! BLC
9564: 39ce:        NO.OF.BAR.CODES% = VAL(UNPACK$(IDF.NO.OF.BAR.CODES$))
9565: 39f3:        ITEM.POS.STRING$ = FN.Z.PACK(STR$(ITEM.TOTAL%),3)
9566: 3a20:        IF NO.OF.BAR.CODES% < 3 THEN BEGIN
9567: 3a32:           BAR.CODE.TOTAL% = BAR.CODE.TOTAL% + 1
9568: 3a3e:           BAR.CODE.TABLE$(BAR.CODE.TOTAL%) = IDF.FIRST.BAR.CODE$
9569: 3a67:           ITEM.POSITION.TABLE$(BAR.CODE.TOTAL%) = ITEM.POS.STRING$
9570: 3a8d:           IF NO.OF.BAR.CODES% = 2 THEN BEGIN
9571: 3a9c:              BAR.CODE.TOTAL% = BAR.CODE.TOTAL% + 1
9572: 3aa8:              BAR.CODE.TABLE$(BAR.CODE.TOTAL%) = IDF.SECOND.BAR.CODE$
9573: 3ad1:              ITEM.POSITION.TABLE$(BAR.CODE.TOTAL%) = ITEM.POS.STRING$
9574: 3af7:           ENDIF
9575: 3b02:        ENDIF ELSE BEGIN
9576: 3b0a:              BAR.CODE.TOTAL% = BAR.CODE.TOTAL% + 1
9577: 3b16:              BAR.CODE.TABLE$(BAR.CODE.TOTAL%) = IDF.FIRST.BAR.CODE$
9578: 3b3f:              ITEM.POSITION.TABLE$(BAR.CODE.TOTAL%) = ITEM.POS.STRING$
9579: 3b65:              BAR.CODE.TOTAL% = BAR.CODE.TOTAL% + 1
9580: 3b71:              BAR.CODE.TABLE$(BAR.CODE.TOTAL%) = IDF.SECOND.BAR.CODE$
9581: 3b9a:              ITEM.POSITION.TABLE$(BAR.CODE.TOTAL%) = ITEM.POS.STRING$
9582: 3bc0:              F11.CURRENT.COUNT% = 1
9583: 3bd1:              F11.NEXT.BAR.CODE$ = IDF.SECOND.BAR.CODE$
9584: 3bef:              MORE.BAR.CODES = TRUE
9585: 3c01:              CURR.SESS.NUM% = IEF.SESS.NUM%
9586: 3c13:              WHILE MORE.BAR.CODES
9587: 3c1e:                    RC% = READ.NEXT.IEF(F11.NEXT.BAR.CODE$,              \ BLC
9588: 3c69:                                        NO.OF.BAR.CODES%,                \
9589: 3c69:                                        RIGHT$(UNPACK$(IDF.BOOTS.CODE$),7))
9590: 3c69:                    IF UNPACK$(F11.NEXT.BAR.CODE$) = STRING$(12,"0")     \
9591: 3cbf:                       OR RC% <> 0 THEN BEGIN
9592: 3cbf:                       MORE.BAR.CODES = FALSE
9593: 3cd3:                    ENDIF ELSE BEGIN
9594: 3cdb:                       BAR.CODE.TOTAL% = BAR.CODE.TOTAL% + 1
9595: 3ce7:                       BAR.CODE.TABLE$(BAR.CODE.TOTAL%) = F11.NEXT.BAR.CODE$
9596: 3d10:                       ITEM.POSITION.TABLE$(BAR.CODE.TOTAL%) = ITEM.POS.STRING$
9597: 3d36:                    ENDIF
9598: 3d3e:              WEND
9599: 3d50:        ENDIF
9600: 3d58: 
9601: 3d58:    NOT.ON.IDF:
9602: 3d68: 
9603: 3d68:        RETURN
9604: 3d78: 
9605: 3d78: 
9606: 3d78: \******************************************************************************
9607: 3d78: \***
9608: 3d78: \***   PROCESS.BAR.CODE.TABLE:
9609: 3d78: \***
9610: 3d78: \***      sort bar code table and corresponding item position table
9611: 3d78: \***      into ascending order using COMBSORT.
9612: 3d78: \***
9613: 3d78: \***      for each entry in barcode table
9614: 3d78: \***          GOSUB WRITE.DIRWF.BARCODE.RECORD
9615: 3d78: \***      end for
9616: 3d78: \***
9617: 3d78: \***   RETURN
9618: 3d78: \***
9619: 3d78: \******************************************************************************
9620: 3d78: 
9621: 3d78:    PROCESS.BAR.CODE.TABLE:
9622: 3d88: 
9623: 3d88:        IF BAR.CODE.TOTAL% = 0 THEN BEGIN
9624: 3d97:           RETURN
9625: 3da7:        ENDIF
9626: 3daf: 
9627: 3daf:        MAX% = BAR.CODE.TOTAL%
9628: 3dc6:        FINISHED = FALSE
9629: 3dd8: 
9630: 3dd8:        GAP = MAX%
9631: 3df3:        WHILE NOT FINISHED
9632: 3dfe:              GAP = INT(GAP / 1.3)
9633: 3e2b:              IF GAP = 0 THEN GAP = 1
9634: 3e62:              IF GAP = 9 OR GAP = 10 THEN GAP = 11
9635: 3ed7:              SWAPPED = FALSE
9636: 3ee9:              FOR A%=1 TO (MAX% - GAP)
9637: 3f01:                  B% = A% + GAP
9638: 3f38:                  IF BAR.CODE.TABLE$(A%) > BAR.CODE.TABLE$(B%) THEN BEGIN
9639: 3f7e:                     TEMP$ = BAR.CODE.TABLE$(A%)
9640: 3fa9:                     BAR.CODE.TABLE$(A%) = BAR.CODE.TABLE$(B%)
9641: 3fe5:                     BAR.CODE.TABLE$(B%) = TEMP$
9642: 400f:                     TEMP$ = ITEM.POSITION.TABLE$(A%)
9643: 403a:                     ITEM.POSITION.TABLE$(A%) = ITEM.POSITION.TABLE$(B%)
9644: 4076:                     ITEM.POSITION.TABLE$(B%) = TEMP$
9645: 40a0:                     SWAPPED = TRUE
9646: 40b2:                  ENDIF
9647: 40ba:              NEXT A%
9648: 4104:              IF (NOT SWAPPED) AND GAP = 1 THEN FINISHED = TRUE
9649: 4148:        WEND
9650: 415a: 
9651: 415a:        FOR INDEX% = 1 TO BAR.CODE.TOTAL%
9652: 416a:            GOSUB WRITE.DIRWF.BARCODE.RECORD
9653: 417c:        NEXT INDEX%
9654: 4194: 
9655: 4194:        RETURN
9656: 41a4: 
9657: 41a4: 
9658: 41a4: \******************************************************************************
9659: 41a4: \***
9660: 41a4: \***   WRITE.DIRWF.BARCODE.RECORD:
9661: 41a4: \***
9662: 41a4: \***      set up variables for DIRWF barcode record
9663: 41a4: \***
9664: 41a4: \***      write DIRWF barcode record
9665: 41a4: \***
9666: 41a4: \***   RETURN
9667: 41a4: \***
9668: 41a4: \******************************************************************************
9669: 41a4: 
9670: 41a4:    WRITE.DIRWF.BARCODE.RECORD:
9671: 41b4: 
9672: 41b4:       DIRWF.RECORD.TYPE$ = "BD"
9673: 41c9:       DIRWF.BARCODE$ = "0" + UNPACK$(BAR.CODE.TABLE$(INDEX%))
9674: 41fc:       DIRWF.ITEM.POSITION$ = ITEM.POSITION.TABLE$(INDEX%)
9675: 4223:       DIRWF.RECORD$ = DIRWF.RECORD.TYPE$ +                              \
9676: 4251:                       DIRWF.BARCODE$ +                                  \
9677: 4251:                       DIRWF.ITEM.POSITION$
9678: 4251: 
9679: 4251:       GOSUB WRITE.DIRWF.RECORD
9680: 4263: 
9681: 4263:    RETURN
9682: 4273: 
9683: 4273: 
9684: 4273: \******************************************************************************
9685: 4273: \***
9686: 4273: \***   WRITE.DIRWF.ORDER.TRAILER:
9687: 4273: \***
9688: 4273: \***      set up variables for DIRWF trailer
9689: 4273: \***
9690: 4273: \***      write DIRWF trailer record
9691: 4273: \***
9692: 4273: \***   RETURN
9693: 4273: \***
9694: 4273: \******************************************************************************
9695: 4273: 
9696: 4273:    WRITE.DIRWF.ORDER.TRAILER:
9697: 4283: 
9698: 4283:       DIRWF.RECORD.TYPE$ = "OT"
9699: 4298:       DIRWF.NO.OF.BARCODES$ = FN.Z.PACK(STR$(BAR.CODE.TOTAL%),5)
9700: 42c5:       DIRWF.RECORD$ = DIRWF.RECORD.TYPE$ +                              \
9701: 42eb:                       DIRWF.NO.OF.BARCODES$
9702: 42eb: 
9703: 42eb:       GOSUB WRITE.DIRWF.RECORD
9704: 42fd: 
9705: 42fd:    RETURN
9706: 430d: 
9707: 430d: 
9708: 430d: \******************************************************************************
9709: 430d: \***
9710: 430d: \***   RECEIVED.DIRECT.FILE.HEADER
9711: 430d: \***
9712: 430d: \***      display message "PDT support - DIRECT File Header Received" on
9713: 430d: \***      background screen
9714: 430d: \***
9715: 430d: \***      if received data is not valid then set the RECEIVE.STATE$ to "*"
9716: 430d: \***      and RETURN
9717: 430d: \***
9718: 430d: \***      create LDTBF file
9719: 430d: \***
9720: 430d: \***      if received terminal number or application number is invalid then
9721: 430d: \***      set RECEIVE.STATE$ to "*" and RETURN
9722: 430d: \***
9723: 430d: \***      set number of direct headers to 0
9724: 430d: \***      store number of orders in file
9725: 430d: \***
9726: 430d: \***      dimension an order line table for 16 entries
9727: 430d: \***
9728: 430d: \***      reset fields
9729: 430d: \***
9730: 430d: \***      GOSUB CREATE.DIRECT.TEMP.STKMQ
9731: 430d: \***
9732: 430d: \***   RETURN
9733: 430d: \***
9734: 430d: \******************************************************************************
9735: 430d: 
9736: 430d:    RECEIVED.DIRECT.FILE.HEADER:
9737: 431d: 
9738: 431d:       LDTBF.OPEN.FLAG$ = "Y"                                            ! CLC
9739: 4334:       LDTBF.NUM.OF.ITEMS% = 0                                           ! CLC
9740: 4345: 
9741: 4345:       SB.MESSAGE$ = "PDT Support - DIRECT File Header Received"
9742: 435a:       GOSUB SB.BG.MESSAGE
9743: 436c: 
9744: 436c:       IF FN.VALIDATE.DATA(DATA.IN$, 22) = 0 THEN BEGIN
9745: 438e:          RECEIVE.STATE$ = "*"
9746: 43a5:          RETURN
9747: 43b5:       ENDIF
9748: 43bd: 
9749: 43bd:       IF MID$(DATA.IN$,3,2) <> APPLICATION.NO$                          \
9750: 4448:          OR MID$(DATA.IN$,5,6) <> CURR.TERMINAL$ THEN BEGIN
9751: 4448:          RECEIVE.STATE$ = "*"
9752: 445f:          RETURN
9753: 446f:       ENDIF
9754: 4477: 
9755: 4477:       CURR.SESS.NUM% = LDTBF.SESS.NUM%                                  ! CLC
9756: 4489:       IF END #LDTBF.SESS.NUM% THEN CREATE.ERROR                         ! CLC
9757: 44a7:       CREATE LDTBF.FILE.NAME$                                           \ CLC
9758: 44d0:          AS LDTBF.SESS.NUM% LOCKED                                      !1.2SH
9759: 44d0:       LDTBF.WRITTEN.FLAG$ = "N"                                         ! CLC
9760: 44e5: 
9761: 44e5:       ORDERS.FOUND% = 0
9762: 44f6:       ORDERS.EXPECTED% = VAL(MID$(DATA.IN$,11,2))
9763: 4523: 
9764: 4523:       DIM ORDER.LINE.TABLE$(16)
9765: 4552: 
9766: 4552:       LINE.TOTAL% = 0
9767: 4563:       LINES.BOOKED.IN% = 0
9768: 4574:       LINES.ADDED% = 0
9769: 4585:       SINGLES.ADDED% = 0
9770: 4596: 
9771: 4596:       GOSUB CREATE.DIRECT.TEMP.STKMQ
9772: 45a8: 
9773: 45a8: 
9774: 45a8:    RETURN
9775: 45b8: 
9776: 45b8: 
9777: 45b8: \******************************************************************************
9778: 45b8: \***
9779: 45b8: \***   RECEIVED.DIRECT.ORDERS.HEADER
9780: 45b8: \***
9781: 45b8: \***      display message "PDT support - DIRECT Order Header Received" on
9782: 45b8: \***      background screen
9783: 45b8: \***
9784: 45b8: \***      if received data is not valid then set the RECEIVE.STATE$ to "*"
9785: 45b8: \***      and RETURN
9786: 45b8: \***
9787: 45b8: \***      increment number of direct headers
9788: 45b8: \***
9789: 45b8: \***      store supplier number, order number, order suffix,
9790: 45b8: \***            booking in times and number of items booked in.
9791: 45b8: \***
9792: 45b8: \***      set type 17 written flag to false
9793: 45b8: \***
9794: 45b8: \***      set first time flag to true
9795: 45b8: \***
9796: 45b8: \***   RETURN
9797: 45b8: \***
9798: 45b8: \******************************************************************************
9799: 45b8: 
9800: 45b8:    RECEIVED.DIRECT.ORDERS.HEADER:
9801: 45c8: 
9802: 45c8:       SB.MESSAGE$ = "PDT Support - DIRECT order header received"
9803: 45dd:       GOSUB SB.BG.MESSAGE
9804: 45ef: 
9805: 45ef:       IF FN.VALIDATE.DATA(DATA.IN$, 23) = 0 THEN BEGIN
9806: 4611:          RECEIVE.STATE$ = "*"
9807: 4628:          RETURN
9808: 4638:       ENDIF
9809: 4640: 
9810: 4640:       ORDERS.FOUND% = ORDERS.FOUND% + 1
9811: 464f: 
9812: 464f: !     IF STORE.NUMBER$ = "2999" THEN BEGIN                                    !1.3BG
9813: 464f: !
9814: 464f: !         IF LSSST.OPEN.FLAG$ <> "Y" THEN BEGIN                                !1.3BG  !1.5CS
9815: 464f: !            IF END #LSSST.SESS.NUM% THEN OPEN.ERROR                           !1.3BG  !1.5CS
9816: 464f: !            CURR.SESS.NUM% = LSSST.SESS.NUM%                                  !1.3BG  !1.5CS
9817: 464f: !            CREATE LSSST.FILE.NAME$ AS LSSST.SESS.NUM% LOCKED                 !1.3BG  !1.5CS
9818: 464f: !            LSSST.OPEN.FLAG$ = "Y"                                            !1.3BG  !1.5CS
9819: 464f: !         ENDIF                                                                !1.3BG  !1.5CS
9820: 464f: !                                                                                      !1.5CS
9821: 464f: !         IF STOCK.OPEN.FLAG$ <> "Y" THEN BEGIN                                !1.3BG  !1.5CS
9822: 464f: !            IF END #STOCK.SESS.NUM% THEN OPEN.ERROR                           !1.3BG  !1.5CS
9823: 464f: !            CURR.SESS.NUM% = STOCK.SESS.NUM%                                  !1.3BG  !1.5CS
9824: 464f: !            OPEN STOCK.FILE.NAME$ KEYED RECL STOCK.RECL%                      \1.3BG  !1.5CS
9825: 464f: !                 AS STOCK.SESS.NUM% NODEL                                     !1.3BG  !1.5CS
9826: 464f: !            STOCK.OPEN.FLAG$ = "Y"                                            !1.3BG  !1.5CS
9827: 464f: !         ENDIF                                                                !1.3BG  !1.5CS
9828: 464f: !                                                                                      !1.5CS
9829: 464f: !         IF IMSTC.OPEN.FLAG$ <> "Y" THEN BEGIN                                !1.3BG  !1.5CS
9830: 464f: !            IF END #IMSTC.SESS.NUM% THEN OPEN.ERROR                           !1.3BG  !1.5CS
9831: 464f: !            CURR.SESS.NUM% = IMSTC.SESS.NUM%                                  !1.3BG  !1.5CS
9832: 464f: !            OPEN IMSTC.FILE.NAME$ KEYED RECL IMSTC.RECL%                      \1.3BG  !1.5CS
9833: 464f: !                 AS IMSTC.SESS.NUM% NODEL                                     !1.3BG  !1.5CS
9834: 464f: !            IMSTC.OPEN.FLAG$ = "Y"                                            !1.3BG  !1.5CS
9835: 464f: !         ENDIF                                                                !1.3BG  !1.5CS
9836: 464f: !                                                                                      !1.5CS
9837: 464f: !         IF IRF.OPEN.FLAG$ <> "Y" THEN BEGIN                                  !1.3BG  !1.5CS
9838: 464f: !            IF END #IRF.SESS.NUM% THEN OPEN.ERROR                             !1.3BG  !1.5CS
9839: 464f: !            CURR.SESS.NUM% = IRF.SESS.NUM%                                    !1.3BG  !1.5CS
9840: 464f: !            OPEN IRF.FILE.NAME$ KEYED RECL IRF.RECL% AS IRF.SESS.NUM%         \1.3BG  !1.5CS
9841: 464f: !                 NOWRITE NODEL                                                !1.3BG  !1.5CS
9842: 464f: !            IRF.OPEN.FLAG$ = "Y"                                              !1.3BG  !1.5CS
9843: 464f: !         ENDIF                                                                !1.3BG  !1.5CS
9844: 464f: !                                                                                      !1.5CS
9845: 464f: !         IF STKMQ.OPEN.FLAG$ <> "Y" THEN BEGIN                                !1.3BG  !1.5CS
9846: 464f: !            IF END #STKMQ.SESS.NUM% THEN OPEN.ERROR                           !1.3BG  !1.5CS
9847: 464f: !            CURR.SESS.NUM% = STKMQ.SESS.NUM%                                  !1.3BG  !1.5CS
9848: 464f: !            OPEN STKMQ.FILE.NAME$ AS STKMQ.SESS.NUM% NODEL APPEND             !1.3BG  !1.5CS
9849: 464f: !            STKMQ.OPEN.FLAG$ = "Y"                                            !1.3BG  !1.5CS
9850: 464f: !         ENDIF                                                                !1.3BG  !1.5CS
9851: 464f: !                                                                                      !1.5CS
9852: 464f: !      ENDIF ELSE BEGIN                                                        !1.3BG  !1.5CS
9853: 464f: 
9854: 464f:          SAVED.SUPPLIER.NO$ = MID$(DATA.IN$,3,6)
9855: 4676:          SAVED.ORDER.NO$ = MID$(DATA.IN$,9,4)
9856: 469d:          SAVED.ORDER.SUFFIX$ = MID$(DATA.IN$,13,1)
9857: 46c4:          BOOKING.STARTED$ = MID$(DATA.IN$,14,4)
9858: 46eb:          BOOKING.ENDED$ = MID$(DATA.IN$,18,4)
9859: 4712:          ITEMS.BOOKED.IN% = VAL(MID$(DATA.IN$,22,4))
9860: 473f: 
9861: 473f:          TYPE.17.WRITTEN = FALSE
9862: 4756: 
9863: 4756:          FIRST.TIME = TRUE
9864: 476d: 
9865: 476d: !      ENDIF                                                                   !1.3BG !1.5CS
9866: 476d: 
9867: 476d:    RETURN
9868: 477d: 
9869: 477d: 
9870: 477d: \******************************************************************************
9871: 477d: \***
9872: 477d: \***   RECEIVED.DIRECT.ORDERS.DETAIL
9873: 477d: \***
9874: 477d: \***      if received data is not valid then set the RECEIVE.STATE$ to "*"
9875: 477d: \***      and RETURN
9876: 477d: \***
9877: 477d: \***      extract quantity fields from record
9878: 477d: \***
9879: 477d: \***      if any of the quantities are non-zero then
9880: 477d: \***         add 1 to number of lines booked in
9881: 477d: \***      endif
9882: 477d: \***
9883: 477d: \***      write the information to the LDTBF
9884: 477d: \***
9885: 477d: \***      extract page number from record
9886: 477d: \***
9887: 477d: \***      if this is the first direct orders detail record processed then
9888: 477d: \***         save page number
9889: 477d: \***      endif
9890: 477d: \***
9891: 477d: \***      if page number is 0 (unexpected line) then
9892: 477d: \***         add 1 to lines added
9893: 477d: \***         add quantities to singles added
9894: 477d: \***      endif
9895: 477d: \***
9896: 477d: \***      if page number is not = saved page number or
9897: 477d: \***         number of entries in order line table = 16 then
9898: 477d: \***         GOSUB WRITE.DRSMQ.TYPE.17
9899: 477d: \***         clear order line table
9900: 477d: \***         set line total to 0
9901: 477d: \***         GOSUB ADD.TO.ORDER.LINE.TABLE to add this entry
9902: 477d: \***         save page number
9903: 477d: \***         if page number is 1 then
9904: 477d: \***            GOSUB WRITE.DRSMQ.TYPE.19
9905: 477d: \***            set lines booked in, lines added and singles added to 0
9906: 477d: \***         endif
9907: 477d: \***      else
9908: 477d: \***         GOSUB ADD.TO.ORDER.LINE.TABLE to add this entry
9909: 477d: \***      endif
9910: 477d: \***
9911: 477d: \***   RETURN
9912: 477d: \***
9913: 477d: \******************************************************************************
9914: 477d: 
9915: 477d:    RECEIVED.DIRECT.ORDERS.DETAIL:
9916: 478d: 
9917: 478d:       IF FN.VALIDATE.DATA(DATA.IN$, 24) = 0 THEN BEGIN
9918: 47af:             RECEIVE.STATE$ = "*"
9919: 47c6:             RETURN
9920: 47d6:       ENDIF
9921: 47de: 
9922: 47de: !     IF STORE.NUMBER$ = "2999" THEN BEGIN                                    !1.3BG  !1.5CS
9923: 47de: 
9924: 47de: !         GOSUB LSS.COUNTS                                                     !1.3BG !1.5CS
9925: 47de: 
9926: 47de: !      ENDIF ELSE BEGIN                                                        !1.3BG  !1.5CS
9927: 47de: 
9928: 47de:          QUANTITY.GOOD%    = VAL(MID$(DATA.IN$,19,4))
9929: 4807:          QUANTITY.DAMAGED% = VAL(MID$(DATA.IN$,23,4))
9930: 4830:          QUANTITY.STOLEN%  = VAL(MID$(DATA.IN$,27,4))
9931: 4859: 
9932: 4859:          IF DIRORD.OPEN.FLAG$ <> "Y" THEN BEGIN                            !1.2SH
9933: 4877:             CURR.SESS.NUM% = DIRORD.SESS.NUM%                              !1.2SH
9934: 4889:             IF END #DIRORD.SESS.NUM% THEN OPEN.ERROR                       !1.2SH
9935: 48a5:             OPEN DIRORD.FILE.NAME$ KEYED RECL DIRORD.RECL%                 \1.2SH
9936: 48d2:                  AS DIRORD.SESS.NUM% NODEL                                 !1.2SH
9937: 48d2:             DIRORD.OPEN.FLAG$ = "Y"                                        !1.2SH
9938: 48e9:          ENDIF                                                             !1.2SH
9939: 48f1: 
9940: 48f1:          IF LDTBF.HEADER.WRITTEN$ = "N" THEN BEGIN                         ! CLC
9941: 4912:             LDTBF.RECORD.ID$    = "OH"                                     ! CLC
9942: 4929:             LDTBF.SUPPLIER.NUM$ = PACK$(SAVED.SUPPLIER.NO$)                ! CLC
9943: 494c:             LDTBF.ORDER.NUM$    = PACK$(SAVED.ORDER.NO$)                   ! CLC
9944: 496f:             LDTBF.ORDER.SUFFIX$ = SAVED.ORDER.SUFFIX$                      ! CLC
9945: 498d:             LDTBF.START.TIME$   = PACK$(BOOKING.STARTED$)                  !1.2SH
9946: 49b0:             LDTBF.END.TIME$     = PACK$(BOOKING.ENDED$)                    !1.2SH
9947: 49d3:             LDTBF.DATE$         = PACK$(DATE$)                             !1.2SH
9948: 49f0:             GOSUB GET.ALREADY.BOOKED.QTY                                   !1.2SH
9949: 4a02:             RC% = WRITE.LDTBF                                              ! CLC
9950: 4a16:             IF RC% = 1 THEN GOTO WRITE.ERROR                               ! CLC
9951: 4a2b:             LDTBF.HEADER.WRITTEN$ = "Y"                                    ! CLC
9952: 4a42:             LDTBF.WRITTEN.FLAG$ = "Y"                                      ! CLC
9953: 4a57:          ENDIF                                                             ! CLC
9954: 4a5f:          LDTBF.RECORD.ID$ = "OD"                                           ! CLC
9955: 4a76:          LDTBF.REF.CODE$  = PACK$(MID$(DATA.IN$,7,12))                     ! CLC
9956: 4aa2:          LDTBF.DAMAGED.QTY% = QUANTITY.DAMAGED%                            ! CLC
9957: 4ab4:          LDTBF.STOLEN.QTY%  = QUANTITY.STOLEN%                             ! CLC
9958: 4ac6:          LDTBF.GOOD.QTY%    = QUANTITY.GOOD%                               !1.2SH
9959: 4ad8:          GOSUB GET.ORDERED.QUANTITY                                        !1.2SH
9960: 4aea:          RC% = WRITE.LDTBF                                                 ! CLC
9961: 4afe:          IF RC% = 1 THEN GOTO WRITE.ERROR                                  ! CLC
9962: 4b13:          LDTBF.NUM.OF.ITEMS% = LDTBF.NUM.OF.ITEMS% +                       \ CLC
9963: 4b35:                                QUANTITY.DAMAGED%   +                       \ CLC
9964: 4b35:                                QUANTITY.STOLEN%    +                       \1.2SH
9965: 4b35:                                QUANTITY.GOOD%                              !1.2SH
9966: 4b35: 
9967: 4b35:          IF QUANTITY.GOOD%    <> 0 OR                                      \
9968: 4b69:             QUANTITY.DAMAGED% <> 0 OR                                      \
9969: 4b69:             QUANTITY.STOLEN%  <> 0 THEN BEGIN
9970: 4b69:              LINES.BOOKED.IN% = LINES.BOOKED.IN% + 1
9971: 4b78:          ENDIF
9972: 4b80: 
9973: 4b80:          IF FIRST.TIME THEN BEGIN
9974: 4b93:             SAVED.PAGE.NO$ = PAGE.NUMBER$
9975: 4bae:             FIRST.TIME = FALSE
9976: 4bc5:          ENDIF
9977: 4bcd: 
9978: 4bcd:          IF PAGE.NUMBER$ = "00" THEN BEGIN
9979: 4be8:             LINES.ADDED% = LINES.ADDED% + 1
9980: 4bf7:             SINGLES.ADDED% = SINGLES.ADDED% +                              \
9981: 4c19:                              QUANTITY.GOOD% +                              \
9982: 4c19:                              QUANTITY.DAMAGED% +                           \
9983: 4c19:                              QUANTITY.STOLEN%
9984: 4c19:          ENDIF
9985: 4c21: 
9986: 4c21:          IF SAVED.PAGE.NO$ <> PAGE.NUMBER$ OR                              \
9987: 4c64:             LINE.TOTAL% = 16 THEN BEGIN
9988: 4c64:             GOSUB WRITE.DRSMQ.TYPE.17
9989: 4c76:             DIM ORDER.LINE.TABLE$(16)
9990: 4ca5:             LINE.TOTAL% = 0
9991: 4cb6:             GOSUB ADD.TO.ORDER.LINE.TABLE
9992: 4cc8:             SAVED.PAGE.NO$ = PAGE.NUMBER$
9993: 4ce3:             IF PAGE.NUMBER$ = "01" THEN BEGIN
9994: 4cfe:                GOSUB WRITE.DRSMQ.TYPE.19
9995: 4d10:                LINES.BOOKED.IN% = 0
9996: 4d21:                LINES.ADDED% = 0
9997: 4d32:                SINGLES.ADDED% = 0
9998: 4d43:             ENDIF
9999: 4d4d:          ENDIF ELSE BEGIN
10000: 4d55:                GOSUB ADD.TO.ORDER.LINE.TABLE
10001: 4d67:          ENDIF
10002: 4d6f: 
10003: 4d6f: !      ENDIF                                                                   !1.3BG  !1.5CS
10004: 4d6f: 
10005: 4d6f:    RETURN
10006: 4d7f: 
10007: 4d7f: \*****************************************************************************
10008: 4d7f: \***                                                                         *
10009: 4d7f: \***   LSS.COUNTS                    COMMENTED OUT 1.5CS                     *
10010: 4d7f: \***                                                                         *
10011: 4d7f: \*****************************************************************************
10012: 4d7f: 
10013: 4d7f: !LSS.COUNTS:
10014: 4d7f: !
10015: 4d7f: !    STOCK.BOOTS.CODE$ = PACK$("00000000")                                         !1.3BG
10016: 4d7f: !    LSSST.TSF$ = "     "                                                          !1.3BG
10017: 4d7f: !    LSSST.STOCK.COUNT$ = "     "                                                  !1.3BG
10018: 4d7f: !    !GET INPUT CODE FROM DEVICE                                                   !1.3BG
10019: 4d7f: !    IF MID$(DATA.IN$, 5, 1) = "I" THEN BEGIN                                      !1.3BG
10020: 4d7f: !       IRF.BAR.CODE$ = PACK$("0000000000" + MID$(DATA.IN$, 6, 12))                !1.3BG
10021: 4d7f: !    ENDIF ELSE BEGIN                                                              !1.3BG
10022: 4d7f: !       IF MID$(DATA.IN$, 5, 1) = "B" THEN BEGIN                                   !1.3BG
10023: 4d7f: !          IRF.BAR.CODE$ = PACK$("000000000" + MID$(DATA.IN$, 6, 13))              !1.3BG
10024: 4d7f: !       ENDIF                                                                      !1.3BG
10025: 4d7f: !    ENDIF                                                                         !1.3BG
10026: 4d7f: !    RC% = READ.IRF                                                                !1.3BG
10027: 4d7f: !    IF RC% = 0 THEN BEGIN                                                         !1.3BG
10028: 4d7f: !       STOCK.BOOTS.CODE$ = UNPACK$(IRF.BOOTS.CODE$)                               !1.3BG
10029: 4d7f: !       RC% = CALC.BOOTS.CODE.CHECK.DIGIT (STOCK.BOOTS.CODE$)                      !1.3BG
10030: 4d7f: !       IF RC% = 0 AND F18.CHECK.DIGIT$ <> "A" THEN BEGIN                          !1.3BG
10031: 4d7f: !          STOCK.BOOTS.CODE$ = STOCK.BOOTS.CODE$ + F18.CHECK.DIGIT$                !1.3BG
10032: 4d7f: !          STOCK.BOOTS.CODE$ = PACK$(RIGHT$("00000000" + STOCK.BOOTS.CODE$, 8))    !1.3BG
10033: 4d7f: !
10034: 4d7f: !          !CHECK FOR IMSTC RECORD FOR MOST RECENT TSF                             !1.3BG
10035: 4d7f: !          IMSTC.BAR.CODE$ = PACK$(STRING$(16, "0")) + IRF.BOOTS.CODE$             !1.3BG
10036: 4d7f: !          RC% = READ.IMSTC                                                        !1.3BG
10037: 4d7f: !          IF RC% = 0 THEN BEGIN                                                   !1.3BG
10038: 4d7f: !             LSSST.TSF$ = RIGHT$("00000" + STR$(IMSTC.STOCK.FIGURE%), 5)          !1.3BG
10039: 4d7f: !          ENDIF ELSE BEGIN                                                        !1.3BG
10040: 4d7f: !             !NO IMSTC RECORD SO GET OFF STOCK FILE                               !1.3BG
10041: 4d7f: !             RC% = READ.STOCK                                                     !1.3BG
10042: 4d7f: !             IF RC% = 0 THEN BEGIN                                                !1.3BG
10043: 4d7f: !                LSSST.TSF$ = RIGHT$("00000" + STR$(STOCK.STOCK.FIG%), 5)          !1.3BG
10044: 4d7f: !             ENDIF                                                                !1.3BG
10045: 4d7f: !          ENDIF                                                                   !1.3BG
10046: 4d7f: !       ENDIF                                                                      !1.3BG
10047: 4d7f: !
10048: 4d7f: !       !IF WE HAVE A TSF, WRITE THE STOCK COUNT TO THE STOCK FILE                 !1.3BG
10049: 4d7f: !       IF LSSST.TSF$ <> "     " THEN BEGIN                                        !1.3BG
10050: 4d7f: !          LSSST.STOCK.COUNT$ = RIGHT$("00000" + MID$(DATA.IN$, 19, 5), 5)         !1.3BG
10051: 4d7f: !          !WRITE STKMQ TYPE 11 RECORD TO REPLACE TSF                              !1.3BG
10052: 4d7f: !          STKMQ.RECORD$ = CHR$(34) +           \                                  !1.3BG
10053: 4d7f: !                          PACK$("11") +        \                                  !1.3BG
10054: 4d7f: !                          CHR$(59) +           \                                  !1.3BG
10055: 4d7f: !                          PACK$(DATE$) +       \                                  !1.3BG
10056: 4d7f: !                          PACK$(TIME$) +       \                                  !1.3BG
10057: 4d7f: !                          STOCK.BOOTS.CODE$ +  \                                  !1.3BG
10058: 4d7f: !                          CHR$(59) +           \                                  !1.3BG
10059: 4d7f: !                          LSSST.STOCK.COUNT$ + \                                  !1.3BG
10060: 4d7f: !                          CHR$(34) +           \                                  !1.3BG
10061: 4d7f: !                          CHR$(13) + CHR$(10)                                     !1.3BG
10062: 4d7f: !          IF END# STKMQ.SESS.NUM% THEN WRITE.ERROR                                !1.3BG
10063: 4d7f: !          CURR.SESS.NUM% = STKMQ.SESS.NUM%                                        !1.3BG
10064: 4d7f: !          CURRENT.KEY$ = ""                                                       !1.3BG
10065: 4d7f: !          CALL WRITE.STKMQ                                                        !1.3BG
10066: 4d7f: !       ENDIF                                                                      !1.3BG
10067: 4d7f: !    ENDIF                                                                         !1.3BG
10068: 4d7f: !
10069: 4d7f: !    !WRITE REPORT FILE RECORD                                                     !1.3BG
10070: 4d7f: !    IF LSSST.OPEN.FLAG$="Y" THEN BEGIN                                            !1.3BG
10071: 4d7f: !       LSSST.IRF.BAR.CODE$ = IRF.BAR.CODE$                                        !1.3BG
10072: 4d7f: !       LSSST.STOCK.BOOTS.CODE$ = STOCK.BOOTS.CODE$                                !1.3BG
10073: 4d7f: !       IF END #LSSST.SESS.NUM% THEN WRITE.ERROR                                   !1.3BG
10074: 4d7f: !       CURR.SESS.NUM% = LSSST.SESS.NUM%                                           !1.3BG
10075: 4d7f: !       CURRENT.KEY$ = ""                                                          !1.3BG
10076: 4d7f: !       CALL WRITE.LSSST                                                           !1.3BG
10077: 4d7f: !    ENDIF                                                                         !1.3BG
10078: 4d7f: !
10079: 4d7f: !RETURN
10080: 4d7f: 
10081: 4d7f: 
10082: 4d7f: \*****************************************************************************
10083: 4d7f: \***                                                                         *
10084: 4d7f: \***   GET.AREADY.BOOKED.QTY                                                 *
10085: 4d7f: \***                                                                         *
10086: 4d7f: \*****************************************************************************
10087: 4d7f: 
10088: 4d7f: GET.ALREADY.BOOKED.QTY:                                                !1.2SH
10089: 4d8f: 
10090: 4d8f:    LDTBF.LOGGED.QTY% = 0                                               !1.2SH
10091: 4da0: 
10092: 4da0:    IF BCSMF.OPEN.FLAG$ <> "Y" THEN BEGIN                               !1.2SH
10093: 4dbe:       CURR.SESS.NUM% = BCSMF.SESS.NUM%                                 !1.2SH
10094: 4dd0:       IF END #BCSMF.SESS.NUM% THEN OPEN.ERROR                          !1.2SH
10095: 4dec:       OPEN BCSMF.FILE.NAME$ RECL 512 AS BCSMF.SESS.NUM%                \1.2SH
10096: 4e15:            NOWRITE NODEL                                               !1.2SH
10097: 4e15:       BCSMF.OPEN.FLAG$ = "Y"                                           !1.2SH
10098: 4e2c:    ENDIF                                                               !1.2SH
10099: 4e34: 
10100: 4e34:    DIM BC.LETTER.TABLE$(16)                                            !1.2SH
10101: 4e5d:    GOSUB BUILD.BUS.CENTRE.LETTER.TABLE                                 !1.2SH
10102: 4e6f: 
10103: 4e6f:    IF BCSMF.OPEN.FLAG$ = "Y" THEN BEGIN                                !1.2SH
10104: 4e8d:       CLOSE BCSMF.SESS.NUM%                                            !1.2SH
10105: 4ea1:       BCSMF.OPEN.FLAG$ = "N"                                           !1.2SH
10106: 4eb8:    ENDIF                                                               !1.2SH
10107: 4ec0: 
10108: 4ec0:    ORDER.DETAILS$ = PACK$(SAVED.SUPPLIER.NO$) +                        \1.2SH
10109: 4f15:                     PACK$(SAVED.ORDER.NO$)    +                        \1.2SH
10110: 4f15:                     SAVED.ORDER.SUFFIX$                                !1.2SH
10111: 4f15:    CURR.SESS.NUM% = DIRORD.SESS.NUM%                                   !1.2SH
10112: 4f27: 
10113: 4f27:    TEMP$ = "  "                                                        !1.2SH
10114: 4f3c:    FOR BC.INDEX% = 1 TO BC.TOTAL%                                      !1.2SH
10115: 4f4d:       DIRORD.RECKEY$ = LEFT$(ORDER.DETAILS$              +             \1.2SH
10116: 4fc5:                              BC.LETTER.TABLE$(BC.INDEX%) +             \1.2SH
10117: 4fc5:                              " " + CHR$(0)               +             \1.2SH
10118: 4fc5:                              STRING$(9," ")               ,9)          !1.2SH
10119: 4fc5:       RC% = READ.DIRORD                                                !1.2SH
10120: 4fd9:       IF RC% = 1 THEN GOTO DIRORD.REC.NOT.FOUND                        !1.2SH
10121: 4fed:       TEMP$ = BC.LETTER.TABLE$(BC.INDEX%) + " "                        !1.2SH
10122: 501b:       LDTBF.LOGGED.QTY% = VAL(UNPACK$(DIRORD.NO.ITEMS.BOOKED$))        !1.2SH
10123: 5044:       BC.INDEX% = BC.TOTAL%                                            !1.2SH
10124: 5052:    DIRORD.REC.NOT.FOUND:                                               !1.2SH
10125: 5062:    NEXT BC.INDEX%                                                      !1.2SH
10126: 507d: 
10127: 507d:    ! Check manual order                                                !1.2SH
10128: 507d:    DIRORD.RECKEY$ = ORDER.DETAILS$ +  " " + "D" + PACK$("00")          !1.2SH
10129: 50ac:    RC% = READ.DIRORD                                                   !1.2SH
10130: 50c0:    IF RC% = 0 THEN BEGIN                                               !1.2SH
10131: 50d2:       LDTBF.LOGGED.QTY% = VAL(UNPACK$(DIRORD.NO.ITEMS.BOOKED$))        !1.2SH
10132: 50fb:       TEMP$ = " D"                                                     !1.2SH
10133: 5110:    ENDIF                                                               !1.2SH
10134: 5118: 
10135: 5118: RETURN
10136: 5128: 
10137: 5128: 
10138: 5128: \*****************************************************************************
10139: 5128: \***                                                                         *
10140: 5128: \***   GET.ORDERED.QUANTITY                                                  *
10141: 5128: \***                                                                         *
10142: 5128: \*****************************************************************************
10143: 5128: 
10144: 5128: GET.ORDERED.QUANTITY:                                                  !1.2SH
10145: 5138: 
10146: 5138:   PAGE.NUMBER$ = MID$(DATA.IN$,3,2)                                    !1.2SH
10147: 515d: 
10148: 515d:   LDTBF.ORDERED.QTY% = 0                                               !1.2SH
10149: 516e: 
10150: 516e:   ! TEMP$ = Business Centre Letter + Source                            !1.2SH
10151: 516e:   DIRORD.RECKEY$ = ORDER.DETAILS$ + TEMP$ + PACK$(PAGE.NUMBER$)        !1.2SH
10152: 51a1:   RC% = READ.DIRORD                                                    !1.2SH
10153: 51b5:   IF RC% = 1 THEN GOTO NO.RECORD                                       !1.2SH
10154: 51ca: 
10155: 51ca:   FOR INDEX% = 1 TO 16                                                 !1.2SH
10156: 51db:      IF (DIRORD.ITEM.DETAILS$(INDEX%,1) = STRING$(4,CHR$(0)) AND       \1.2SH
10157: 52ed:          DIRORD.ITEM.DETAILS$(INDEX%,2) = LDTBF.REF.CODE$)             \1.2SH
10158: 52ed:      OR                                                                \1.2SH
10159: 52ed:         (DIRORD.ITEM.DETAILS$(INDEX%,1) = RIGHT$(LDTBF.REF.CODE$,4) AND\1.2SH
10160: 52ed:          DIRORD.ITEM.DETAILS$(INDEX%,2) = STRING$(6,CHR$(0)))          \1.2SH
10161: 52ed:      THEN BEGIN                                                        !1.2SH
10162: 52ed:         LDTBF.ORDERED.QTY% = DIRORD.ITEM.QTY%(INDEX%,1)                !1.2SH
10163: 5313:         INDEX% = 16                                                    !1.2SH
10164: 5321:      ENDIF                                                             !1.2SH
10165: 5329:   NEXT INDEX%                                                          !1.2SH
10166: 5342: 
10167: 5342: NO.RECORD:                                                             !1.2SH
10168: 5352: 
10169: 5352: RETURN                                                                 !1.2SH
10170: 5362: 
10171: 5362: 
10172: 5362: \******************************************************************************
10173: 5362: \***
10174: 5362: \***   RECEIVED.DIRECT.ORDERS.TRAILER
10175: 5362: \***
10176: 5362: \***      display message "PDT support - DIRECT Order Trailer Received" on
10177: 5362: \***      background screen
10178: 5362: \***
10179: 5362: \***      if received data is not valid then set the RECEIVE.STATE$ to "*"
10180: 5362: \***      and RETURN
10181: 5362: \***
10182: 5362: \***      write item details to audit file
10183: 5362: \***
10184: 5362: \***      if there are any items in the LDTBF then write the order trailer
10185: 5362: \***      to the LDTBF
10186: 5362: \***
10187: 5362: \***      if there any entries in order line table then
10188: 5362: \***         GOSUB WRITE.DRSMQ.TYPE.17
10189: 5362: \***         clear order line table
10190: 5362: \***         set line total to zero
10191: 5362: \***      endif
10192: 5362: \***
10193: 5362: \***      if any DRSMQ type 17 records were written then
10194: 5362: \***         GOSUB WRITE.DRSMQ.TYPE.19
10195: 5362: \***      endif
10196: 5362: \***
10197: 5362: \***      set lines booked in, singles added and lines added to 0
10198: 5362: \***
10199: 5362: \***
10200: 5362: \***      set the respond option to a LDT trailer to true
10201: 5362: \***
10202: 5362: \***   RETURN
10203: 5362: \***
10204: 5362: \******************************************************************************
10205: 5362: 
10206: 5362:    RECEIVED.DIRECT.ORDERS.TRAILER:
10207: 5372: 
10208: 5372:        SB.MESSAGE$ = "PDT Support - DIRECT Order Trailer Received"
10209: 5387:        GOSUB SB.BG.MESSAGE
10210: 5399: 
10211: 5399:        IF FN.VALIDATE.DATA(DATA.IN$, 25) = 0 THEN BEGIN
10212: 53bb:           RECEIVE.STATE$ = "*"
10213: 53d2:           RETURN
10214: 53e2:        ENDIF
10215: 53ea: 
10216: 53ea: !       IF STORE.NUMBER$ = "2999" THEN BEGIN                                    !1.3BG !1.5CS
10217: 53ea: !                                                                                      !1.5CS
10218: 53ea: !          IF STKMQ.OPEN.FLAG$="Y" THEN BEGIN                                   !1.3BG !1.5CS
10219: 53ea: !             CLOSE STKMQ.SESS.NUM%                                             !1.3BG !1.5CS
10220: 53ea: !             STKMQ.OPEN.FLAG$="N"                                              !1.3BG !1.5CS
10221: 53ea: !          ENDIF                                                                !1.3BG !1.5CS
10222: 53ea: !          IF IRF.OPEN.FLAG$="Y" THEN BEGIN                                     !1.3BG !1.5CS
10223: 53ea: !             CLOSE IRF.SESS.NUM%                                               !1.3BG !1.5CS
10224: 53ea: !             IRF.OPEN.FLAG$="N"                                                !1.3BG !1.5CS
10225: 53ea: !          ENDIF                                                                !1.3BG !1.5CS
10226: 53ea: !          IF IMSTC.OPEN.FLAG$="Y" THEN BEGIN                                   !1.3BG !1.5CS
10227: 53ea: !             CLOSE IMSTC.SESS.NUM%                                             !1.3BG !1.5CS
10228: 53ea: !             IMSTC.OPEN.FLAG$="N"                                              !1.3BG !1.5CS
10229: 53ea: !          ENDIF                                                                !1.3BG !1.5CS
10230: 53ea: !          IF STOCK.OPEN.FLAG$="Y" THEN BEGIN                                   !1.3BG !1.5CS
10231: 53ea: !             CLOSE STOCK.SESS.NUM%                                             !1.3BG !1.5CS
10232: 53ea: !             STOCK.OPEN.FLAG$="N"                                              !1.3BG !1.5CS
10233: 53ea: !          ENDIF                                                                !1.3BG !1.5CS
10234: 53ea: !          IF LSSST.OPEN.FLAG$="Y" THEN BEGIN                                   !1.3BG !1.5CS
10235: 53ea: !             CLOSE LSSST.SESS.NUM%                                             !1.3BG !1.5CS
10236: 53ea: !             LSSST.OPEN.FLAG$="N"                                              !1.3BG !1.5CS
10237: 53ea: !          ENDIF                                                                !1.3BG !1.5CS
10238: 53ea: !                                                                                      !1.5CS
10239: 53ea: !          ADX.RET.CODE% = ADXSTART("ADX_UPGM:LSSST.286", \                     !1.3BG !1.5CS
10240: 53ea: !                          MONITORED.PORT$,             \                       !1.3BG !1.5CS
10241: 53ea: !                          "LSS Stock count report")                            !1.3BG !1.5CS
10242: 53ea: !                                                                                      !1.5CS
10243: 53ea: !       ENDIF ELSE BEGIN                                                        !1.3BG !1.5CS
10244: 53ea: 
10245: 53ea:           CSR.AUDIT.DATA$ = "SUPPLIER " + SAVED.SUPPLIER.NO$ + " ORDER " + \
10246: 5465:                            SAVED.ORDER.NO$ + SAVED.ORDER.SUFFIX$ +         \
10247: 5465:                            " had " + STR$(LINES.BOOKED.IN%) +              \
10248: 5465:                            " items booked in, between times " +            \
10249: 5465:                            BOOKING.STARTED$ + " - " + BOOKING.ENDED$
10250: 5465: 
10251: 5465: 
10252: 5465:           GOSUB LOG.TO.AUDIT.FILE
10253: 5477: 
10254: 5477:           IF LDTBF.HEADER.WRITTEN$ = "Y" THEN BEGIN                        ! CLC
10255: 5495:              LDTBF.RECORD.ID$ = "OT"                                       ! CLC
10256: 54ac:              RC% = WRITE.LDTBF                                             ! CLC
10257: 54c0:              IF RC% = 1 THEN GOTO WRITE.ERROR                              ! CLC
10258: 54d5:              LDTBF.HEADER.WRITTEN$ = "N"                                   ! CLC
10259: 54ec:              LDTBF.NUM.OF.ITEMS% = 0                                       ! CLC
10260: 54fd:           ENDIF                                                            ! CLC
10261: 5505: 
10262: 5505:           IF LINE.TOTAL% <> 0 THEN BEGIN
10263: 5517:              GOSUB WRITE.DRSMQ.TYPE.17
10264: 5529:              DIM ORDER.LINE.TABLE$(16)
10265: 5558:              LINE.TOTAL% = 0
10266: 5569:           ENDIF
10267: 5571: 
10268: 5571:           IF TYPE.17.WRITTEN THEN BEGIN
10269: 5584:              GOSUB WRITE.DRSMQ.TYPE.19
10270: 5596:           ENDIF
10271: 559e: 
10272: 559e:           LINES.BOOKED.IN% = 0
10273: 55af:           LINES.ADDED% = 0
10274: 55c0:           SINGLES.ADDED% = 0
10275: 55d1: 
10276: 55d1: !       ENDIF                                                                   !1.3BG !1.5CS
10277: 55d1: 
10278: 55d1:        LDT.TRANSMIT = TRUE
10279: 55e7: 
10280: 55e7:    RETURN
10281: 55f7: 
10282: 55f7: 
10283: 55f7: \******************************************************************************
10284: 55f7: \***
10285: 55f7: \***   RECEIVED.DIRECT.FILE.TRAILER
10286: 55f7: \***
10287: 55f7: \***      display message "PDT support - DIRECT File Trailer Received" on
10288: 55f7: \***      background screen
10289: 55f7: \***
10290: 55f7: \***      if received data is not valid then set the RECEIVE.STATE$ to "*"
10291: 55f7: \***      and RETURN
10292: 55f7: \***
10293: 55f7: \***      if received terminal number or application number is invalid then
10294: 55f7: \***      set RECEIVE.STATE$ to "*" and RETURN
10295: 55f7: \***
10296: 55f7: \***      if DRSMQ file open then close
10297: 55f7: \***
10298: 55f7: \***      if LDTBF is open, close it and start PSS79 on the background
10299: 55f7: \***
10300: 55f7: \***      if no response is expected from the LDT then return
10301: 55f7: \***
10302: 55f7: \***      if number of orders expected <> number received then
10303: 55f7: \***         log an error
10304: 55f7: \***      endif
10305: 55f7: \***
10306: 55f7: \***      GOSUB TRANSMIT.DIRECT.FILE.TRAILER
10307: 55f7: \***
10308: 55f7: \***   RETURN
10309: 55f7: \***
10310: 55f7: \******************************************************************************
10311: 55f7: 
10312: 55f7:    RECEIVED.DIRECT.FILE.TRAILER:
10313: 5607: 
10314: 5607:        SB.MESSAGE$ = "PDT Support - DIRECT File Trailer Received"
10315: 561c:        GOSUB SB.BG.MESSAGE
10316: 562e: 
10317: 562e:        IF FN.VALIDATE.DATA(DATA.IN$, 26) = 0 THEN BEGIN
10318: 5650:           RECEIVE.STATE$ = "*"
10319: 5667:           RETURN
10320: 5677:        ENDIF
10321: 567f: 
10322: 567f:        IF LDTBF.OPEN.FLAG$ = "Y" THEN BEGIN                             ! CLC
10323: 56a0:           CLOSE LDTBF.SESS.NUM%                                         ! CLC
10324: 56b6:           LDTBF.OPEN.FLAG$ = "N"                                        ! CLC
10325: 56cd:           IF LDTBF.WRITTEN.FLAG$ = "Y" THEN BEGIN                       ! CLC
10326: 56e8:              ADX.RET.CODE% = ADXSTART("ADX_UPGM:PSS79.286",             \1.2SH
10327: 5717:                                       MONITORED.PORT$,                  \ CLC
10328: 5717:                                       "PSS79 - LDT Reporting program")  ! CLC
10329: 5717:              LDTBF.WRITTEN.FLAG$ = "N"                                  ! CLC
10330: 572c:           ENDIF                                                         ! CLC
10331: 5734:        ENDIF                                                            ! CLC
10332: 573c: 
10333: 573c:        IF MID$(DATA.IN$,3,2) <> APPLICATION.NO$                         \
10334: 57c7:           OR MID$(DATA.IN$,5,6) <> CURR.TERMINAL$ THEN BEGIN
10335: 57c7:           RECEIVE.STATE$ = "*"
10336: 57de:           RETURN
10337: 57ee:        ENDIF
10338: 57f6: 
10339: 57f6:        IF DRSMQ.OPEN.FLAG$ =  "Y" THEN BEGIN
10340: 5814:           CLOSE DRSMQ.SESS.NUM%
10341: 5828:           DRSMQ.OPEN.FLAG$ = "N"
10342: 583f:        ENDIF
10343: 5847: 
10344: 5847:        IF DIRORD.OPEN.FLAG$ = "Y" THEN BEGIN                           !1.2SH
10345: 5865:           CLOSE DIRORD.SESS.NUM%                                       !1.2SH
10346: 5879:           DIRORD.OPEN.FLAG$ = "N"                                      !1.2SH
10347: 5890:        ENDIF                                                           !1.2SH
10348: 5898: 
10349: 5898:        IF NOT LDT.TRANSMIT THEN BEGIN
10350: 58aa:           RETURN
10351: 58ba:        ENDIF
10352: 58c2: 
10353: 58c2:        IF ORDERS.EXPECTED% <> ORDERS.FOUND% THEN BEGIN
10354: 58dd:           SB.EVENT.NO% = 91
10355: 58ea:           SB.UNIQUE$ = PACK$(SAVED.SUPPLIER.NO$) +                          \
10356: 599f:                        PACK$(SAVED.ORDER.NO$) +                             \
10357: 599f:                        SAVED.ORDER.SUFFIX$ +                                \
10358: 599f:                        PACK$(FN.Z.PACK(STR$(ORDERS.EXPECTED%), 4)) +        \
10359: 599f:                        PACK$(FN.Z.PACK(STR$(ORDERS.FOUND%), 4))
10360: 599f:           GOSUB SB.LOG.AN.EVENT
10361: 59b1:        ENDIF
10362: 59b9: 
10363: 59b9:        GOSUB TRANSMIT.DIRECT.FILE.TRAILER
10364: 59cb: 
10365: 59cb:    RETURN
10366: 59db: 
10367: 59db: 
10368: 59db: \******************************************************************************
10369: 59db: \***
10370: 59db: \***   RECEIVED.DIRECT.EOT:                                     STATE : Z
10371: 59db: \***
10372: 59db: \***      if received data is not valid then set the RECEIVE.STATE$ to "*" and
10373: 59db: \***      return
10374: 59db: \***
10375: 59db: \***      if DRSMQ is open then close
10376: 59db: \***
10377: 59db: \***      open DRSMQ
10378: 59db: \***
10379: 59db: \***      if data exists on DRSMQ then
10380: 59db: \***         GOSUB WRITE.STKMQ.FROM DRSMQ
10381: 59db: \***         GOSUB CREATE.DIRECT.TEMP.DRSMQ to clear down file
10382: 59db: \***      endif
10383: 59db: \***
10384: 59db: \***      close the DIR file
10385: 59db: \***
10386: 59db: \***      write information to audit file
10387: 59db: \***
10388: 59db: \***      set RECEIVE.STATE$ to "?" and RE.CHAIN to TRUE
10389: 59db: \***
10390: 59db: \***   RETURN
10391: 59db: \***
10392: 59db: \******************************************************************************
10393: 59db: 
10394: 59db:    RECEIVED.DIRECT.EOT:
10395: 59eb: 
10396: 59eb:       SB.MESSAGE$ = "PDT Support - DIRECT E.O.T. received"
10397: 5a00:       GOSUB SB.BG.MESSAGE
10398: 5a12: 
10399: 5a12:       IF FN.VALIDATE.DATA(DATA.IN$, 27) = 0 THEN BEGIN
10400: 5a34:          RECEIVE.STATE$ = "*"
10401: 5a4b:          RETURN
10402: 5a5b:       ENDIF
10403: 5a63: 
10404: 5a63:       CURR.SESS.NUM% = DRSMQ.SESS.NUM%
10405: 5a75: 
10406: 5a75:       IF DRSMQ.OPEN.FLAG$ = "Y" THEN BEGIN
10407: 5a93:          CLOSE DRSMQ.SESS.NUM%
10408: 5aa7:          DRSMQ.OPEN.FLAG$ = "N"
10409: 5abe:       ENDIF
10410: 5ac6: 
10411: 5ac6:       OPEN DRSMQ.FILE.NAME$ AS DRSMQ.SESS.NUM% NOWRITE NODEL
10412: 5aee:       DRSMQ.OPEN.FLAG$ = "Y"
10413: 5b05: 
10414: 5b05:       LDTAF.LINK.TYPE% = 4                                              ! FMJK
10415: 5b15:       LDTAF.DATA.VOLUME.1% = 0                                          ! KMJK
10416: 5b2c:       LDTAF.DATA.VOLUME.2% = 0                                          ! KMJK
10417: 5b43:       LDTAF.DATA.VOLUME.1% = SIZE (DRSMQ.FILE.NAME$)                    ! KMJK
10418: 5b6a:       IF NOT LDT.TRANSMIT THEN LDTAF.DATA.VOLUME.2% =                   \ GMJK
10419: 5b9b:          SIZE (DIRWF.FILE.NAME$)                                        ! GMJK
10420: 5ba3: 
10421: 5ba3:       IF SIZE(DRSMQ.FILE.NAME$) <> 0 THEN BEGIN
10422: 5bc9:          GOSUB WRITE.STKMQ.FROM.DRSMQ
10423: 5bdb:          GOSUB CREATE.DIRECT.TEMP.STKMQ
10424: 5bed:       ENDIF
10425: 5bf5: 
10426: 5bf5:       IF DIREC.OPEN.FLAG$ = "Y" THEN BEGIN
10427: 5c13:          CLOSE DIREC.SESS.NUM%
10428: 5c27:          DIREC.OPEN.FLAG$ = "N"
10429: 5c3e:       ENDIF
10430: 5c46: 
10431: 5c46:       IF MONITORED.PORT$ = "B" THEN LDTAF.LINK.TYPE% =                  \ FMJK
10432: 5c74:         (LDTAF.LINK.TYPE% OR 80H)                                       ! FMJK
10433: 5c7c:       LDTAF.START.DATE$ = PACK$(LOG.ON.DATE$)                           ! FMJK
10434: 5c9f:       LDTAF.START.TIME$ = PACK$(LOG.ON.TIME$)                           ! FMJK
10435: 5cc2:       TEMP.TIME$ = TIME$                                                ! GMJK
10436: 5cda:       LDTAF.DURATION% = ( (VAL(LEFT$(TEMP.TIME$,2))*3600) +             \ GMJK
10437: 5ec6:                           (VAL(MID$(TEMP.TIME$,3,2))*60) +              \ GMJK
10438: 5ec6:                            VAL(RIGHT$(TEMP.TIME$,2)) ) -                \ GMJK
10439: 5ec6:                       ( (VAL(UNPACK$(LEFT$(LDTAF.START.TIME$,1)))*3600)+\ GMJK
10440: 5ec6:                         (VAL(UNPACK$(MID$(LDTAF.START.TIME$,2,1)))*60)+ \ GMJK
10441: 5ec6:                          VAL(UNPACK$(RIGHT$(LDTAF.START.TIME$,1))) )    ! GMJK
10442: 5ec6:       GOSUB LOG.TO.LDTAF.FILE                                           ! FMJK
10443: 5ed8: 
10444: 5ed8:       CSR.AUDIT.DATA$ = "Direct session complete at " +                 \
10445: 5f59:                          LEFT$(TIME$,2) + ":" +                         \
10446: 5f59:                          MID$(TIME$,3,2) + ":" +                        \
10447: 5f59:                          RIGHT$(TIME$,2)                                !
10448: 5f59:       CSR.AUDIT.DATA$ = "[PORT " + MONITORED.PORT$ + "] " +             \
10449: 5f8d:           CSR.AUDIT.DATA$
10450: 5f8d:       GOSUB LOG.TO.AUDIT.FILE
10451: 5f9f: 
10452: 5f9f:       IF CSR.AUDIT.OPEN.FLAG$ = "Y" THEN BEGIN
10453: 5fbd:          CLOSE CSR.AUDIT.SESS.NUM%
10454: 5fd1:          CSR.AUDIT.OPEN.FLAG$ = "N"
10455: 5fe8:       ENDIF
10456: 5ff0: 
10457: 5ff0:       RE.CHAIN = TRUE                                                   ! ILC
10458: 6006:       RECEIVE.STATE$ = "?"                                              ! ILC
10459: 601d: 
10460: 601d:    RETURN
10461: 602d: 
10462: 602d: \******************************************************************************
10463: 602d: \***
10464: 602d: \***   WRITE.STKMQ.FROM.DRSMQ
10465: 602d: \***
10466: 602d: \***
10467: 602d: \***   RETURN
10468: 602d: \***
10469: 602d: \******************************************************************************
10470: 602d: 
10471: 602d:    WRITE.STKMQ.FROM.DRSMQ:
10472: 603d: 
10473: 603d:       END.OF.DRSMQ = FALSE
10474: 604f: 
10475: 604f:       IF STKMQ.OPEN.FLAG$ = "N" THEN BEGIN
10476: 606d:          OPEN STKMQ.FILE.NAME$ AS STKMQ.SESS.NUM% BUFFSIZE 512 READONLY \ DLC
10477: 6096:               NODEL APPEND
10478: 6096:          STKMQ.OPEN.FLAG$ = "Y"
10479: 60ad:       ENDIF
10480: 60b5: 
10481: 60b5:       WHILE NOT END.OF.DRSMQ
10482: 60c0: 
10483: 60c0:             CURR.SESS.NUM% = DRSMQ.SESS.NUM%
10484: 60d2:             RC% = READ.DRSMQ                                            ! BLC
10485: 60e6:             IF RC% = 1 THEN GOTO END.OF.DRSMQ.FILE                      ! BLC
10486: 60fb: 
10487: 60fb:             STKMQ.RECORD$ = DRSMQ.RECORD$ + DRSMQ.ENDREC.MARKER$
10488: 6127: 
10489: 6127:             CURR.SESS.NUM% = STKMQ.SESS.NUM%
10490: 6139:             RC% = WRITE.STKMQ                                           ! BLC
10491: 614d:             IF RC% = 1 THEN GOTO WRITE.ERROR                            ! BLC
10492: 6162: 
10493: 6162:       END.OF.DRSMQ.RETURN:
10494: 6172: 
10495: 6172:       WEND
10496: 6184: 
10497: 6184:       IF STKMQ.OPEN.FLAG$ = "Y" THEN BEGIN
10498: 61a2:          CLOSE STKMQ.SESS.NUM%
10499: 61b6:          STKMQ.OPEN.FLAG$ = "N"
10500: 61cd:       ENDIF
10501: 61d5: 
10502: 61d5:       IF DRSMQ.OPEN.FLAG$ = "Y" THEN BEGIN
10503: 61f3:          CLOSE DRSMQ.SESS.NUM%
10504: 6207:          DRSMQ.OPEN.FLAG$ = "N"
10505: 621e:       ENDIF
10506: 6226: 
10507: 6226:    RETURN
10508: 6236: 
10509: 6236: 
10510: 6236: \******************************************************************************
10511: 6236: \***
10512: 6236: \***   END.OF.DRSMQ.FILE:
10513: 6236: \***
10514: 6236: \***
10515: 6236: \***   RETURN
10516: 6236: \***
10517: 6236: \******************************************************************************
10518: 6236: 
10519: 6236:    END.OF.DRSMQ.FILE:                                                   ! HDS
10520: 6246: 
10521: 6246:        END.OF.DRSMQ = TRUE                                              ! HDS
10522: 6258:        GOTO END.OF.DRSMQ.RETURN                                         ! HDS
10523: 6263: 
10524: 6263:    RETURN                                                               ! HDS
10525: 6273: 
10526: 6273: 
10527: 6273: 
10528: 6273: 
10529: 6273: \******************************************************************************
10530: 6273: \***
10531: 6273: \***   CREATE.DIRECT.TEMP.STKMQ:
10532: 6273: \***
10533: 6273: \***      if a DRSMQ already exists then close it
10534: 6273: \***      create a new DRSMQ
10535: 6273: \***
10536: 6273: \***   RETURN
10537: 6273: \***
10538: 6273: \******************************************************************************
10539: 6273: 
10540: 6273:    CREATE.DIRECT.TEMP.STKMQ:
10541: 6283: 
10542: 6283: 
10543: 6283:       CURR.SESS.NUM% = DRSMQ.SESS.NUM%
10544: 6295: 
10545: 6295:       IF DRSMQ.OPEN.FLAG$ = "Y" THEN BEGIN
10546: 62b3:          CLOSE DRSMQ.SESS.NUM%
10547: 62c7:          DRSMQ.OPEN.FLAG$ = "N"
10548: 62de:       ENDIF
10549: 62e6: 
10550: 62e6:       IF END #DRSMQ.SESS.NUM% THEN CREATE.ERROR
10551: 6302:       CREATE POSFILE DRSMQ.FILE.NAME$ AS DRSMQ.SESS.NUM%                 \
10552: 6329:              BUFFSIZE 10240 LOCKED
10553: 6329:       DRSMQ.OPEN.FLAG$ = "Y"
10554: 6340: 
10555: 6340:    RETURN
10556: 6350: 
10557: 6350: 
10558: 6350: \******************************************************************************
10559: 6350: \***
10560: 6350: \***   TRANSMIT.DIRECT.FILE.TRAILER:
10561: 6350: \***
10562: 6350: \***      send a file trailer to the PSS38
10563: 6350: \***
10564: 6350: \***   RETURN
10565: 6350: \***
10566: 6350: \******************************************************************************
10567: 6350: 
10568: 6350:    TRANSMIT.DIRECT.FILE.TRAILER:
10569: 6360: 
10570: 6360:       PIPE.OUT$ = "L" +                                                 \
10571: 63d6:                   "FT" +                                                \
10572: 63d6:                   FN.Z.PACK(APPLICATION.NO$,2) +                        \
10573: 63d6:                   FN.Z.PACK(CURR.TERMINAL$,6) +                         \
10574: 63d6:                   FN.Z.PACK(STR$(ORDERS.FOUND%),2)
10575: 63d6: 
10576: 63d6: 
10577: 63d6:       GOSUB SEND.TO.PSS38
10578: 63e8: 
10579: 63e8:    RETURN
10580: 63f8: 
10581: 63f8: 
10582: 63f8: \******************************************************************************
10583: 63f8: \***
10584: 63f8: \***   TRANSMIT.DIRECT.FILE:
10585: 63f8: \***
10586: 63f8: \***      set PIPE.OUT$ to "D" to activate DIRWF transmission
10587: 63f8: \***      GOSUB SEND.TO.PSS38
10588: 63f8: \***
10589: 63f8: \***   RETURN
10590: 63f8: \***
10591: 63f8: \******************************************************************************
10592: 63f8: 
10593: 63f8:    TRANSMIT.DIRECT.FILE:
10594: 6408: 
10595: 6408:       PIPE.OUT$ = "D"
10596: 641f:       GOSUB SEND.TO.PSS38
10597: 6431: 
10598: 6431:    RETURN:
10599: 6441: 
10600: 6441: 
10601: 6441: \******************************************************************************
10602: 6441: \***
10603: 6441: \***   TIDY.UP.FOR.DIRECT:
10604: 6441: \***
10605: 6441: \***      close all open files required for DIRECT processing
10606: 6441: \***
10607: 6441: \***      release table space
10608: 6441: \***
10609: 6441: \***   RETURN
10610: 6441: \***
10611: 6441: \******************************************************************************
10612: 6441: 
10613: 6441:    TIDY.UP.FOR.DIRECT:
10614: 6451: 
10615: 6451:       IF IDF.OPEN.FLAG$ = "Y" THEN BEGIN
10616: 646f:          CLOSE IDF.SESS.NUM%
10617: 6483:          IDF.OPEN.FLAG$ = "N"
10618: 649a:       ENDIF
10619: 64a2: 
10620: 64a2:       IF IEF.OPEN.FLAG$ = "Y" THEN BEGIN
10621: 64c0:          CLOSE IEF.SESS.NUM%
10622: 64d4:          IEF.OPEN.FLAG$ = "N"
10623: 64eb:       ENDIF
10624: 64f3: 
10625: 64f3:       IF STKMQ.OPEN.FLAG$ = "Y" THEN BEGIN
10626: 6511:          CLOSE STKMQ.SESS.NUM%
10627: 6525:          STKMQ.OPEN.FLAG$ = "N"
10628: 653c:       ENDIF
10629: 6544: 
10630: 6544:       IF BCSMF.OPEN.FLAG$ = "Y" THEN BEGIN
10631: 6562:          CLOSE BCSMF.SESS.NUM%
10632: 6576:          BCSMF.OPEN.FLAG$ = "N"
10633: 658d:       ENDIF
10634: 6595: 
10635: 6595:       IF DIRSUP.OPEN.FLAG$ = "Y" THEN BEGIN
10636: 65b3:          CLOSE DIRSUP.SESS.NUM%
10637: 65c7:          DIRSUP.OPEN.FLAG$ = "N"
10638: 65de:       ENDIF
10639: 65e6: 
10640: 65e6:       IF DIRORD.OPEN.FLAG$ = "Y" THEN BEGIN
10641: 6604:          CLOSE DIRORD.SESS.NUM%
10642: 6618:          DIRORD.OPEN.FLAG$ = "N"
10643: 662f:       ENDIF
10644: 6637: 
10645: 6637:       IF DIRWF.OPEN.FLAG$ = "Y" THEN BEGIN
10646: 6655:          CLOSE DIRWF.SESS.NUM%
10647: 6669:          DIRWF.OPEN.FLAG$ = "N"
10648: 6680:       ENDIF
10649: 6688: 
10650: 6688:       IF DRSMQ.OPEN.FLAG$ = "Y" THEN BEGIN
10651: 66a6:          CLOSE DRSMQ.SESS.NUM%
10652: 66ba:          DRSMQ.OPEN.FLAG$ = "N"
10653: 66d1:       ENDIF
10654: 66d9: 
10655: 66d9:       IF CSR.AUDIT.OPEN.FLAG$ = "Y" THEN BEGIN
10656: 66f7:          CLOSE CSR.AUDIT.SESS.NUM%
10657: 670b:          CSR.AUDIT.OPEN.FLAG$ = "N"
10658: 6722:       ENDIF
10659: 672a: 
10660: 672a:       DIM ORDER.TABLE$(0)
10661: 6753:       DIM DIRWF.DETAIL.TABLE$(0)
10662: 677c:       DIM BAR.CODE.TABLE$(0)
10663: 67a5:       DIM ITEM.POSITION.TABLE$(0)
10664: 67ce:       DIM HEADER.TABLE$(0)
10665: 67f7:       DIM BC.LETTER.TABLE$(0)
10666: 6820: 
10667: 6820: 
10668: 6820:    RETURN
10669: 6830: 
10670: 6830: \*****************************************************************************
10671: 6830: \*****************************************************************************
10672: 6830: \***
10673: 6830: \***        U O D   S U B R O U T I N E S   B E L O W
10674: 6830: \***
10675: 6830: \*****************************************************************************
10676: 6830: \*****************************************************************************
10677: 6830: 
10678: 6830: \*****************************************************************************
10679: 6830: \***
10680: 6830: \***   RECEIVED.UOD.FILE.HEADER:                    Data State: a (lower case)
10681: 6830: \***
10682: 6830: \***   Log the count of the number of UOD's to follow to the CSRAF.
10683: 6830: \***   Store this number so that the File Trailer number can be compared.
10684: 6830: \***   Create the UODTF
10685: 6830: \***
10686: 6830: \*****************************************************************************
10687: 6830: 
10688: 6830: RECEIVED.UOD.FILE.HEADER:                                               ! ELC
10689: 6840: 
10690: 6840:    SB.MESSAGE$ = "PDT Support - UOD File Header Received"               ! ELC
10691: 6855:    GOSUB SB.BG.MESSAGE                                                  ! ELC
10692: 6867: 
10693: 6867:    IF FN.VALIDATE.DATA(DATA.IN$,28) = 0 THEN BEGIN                      ! ELC
10694: 6889:         RECEIVE.STATE$ = "*"                                            ! ELC
10695: 68a0:         RETURN                                                          ! ELC
10696: 68b0:    ENDIF                                                                ! ELC
10697: 68b8: 
10698: 68b8:    DETAIL.RECORDS.RECEIVED$ = "N"                                       ! ELC
10699: 68cf:    ACTUAL.NUM.OF.UODS% = 0                                              ! ELC
10700: 68e0:    EXPECTED.NUM.OF.UODS% = VAL(MID$(DATA.IN$,11,4))                     ! ELC
10701: 690d:    CSR.AUDIT.DATA$ = "UOD File Header. " +                              \ ELC
10702: 6945:                      STR$(EXPECTED.NUM.OF.UODS%) + " UOD's."            ! ELC
10703: 6945:    CSR.AUDIT.DATA$ = "[PORT " + MONITORED.PORT$ + "] " +                \ ELC
10704: 6979:                      CSR.AUDIT.DATA$                                    ! ELC
10705: 6979:    GOSUB LOG.TO.AUDIT.FILE                                              ! ELC
10706: 698b: 
10707: 698b:    GOSUB CREATE.UODTF                                                   ! ELC
10708: 699d: 
10709: 699d: RETURN                                                                  ! ELC
10710: 69ad: 
10711: 69ad: 
10712: 69ad: \*****************************************************************************
10713: 69ad: \***
10714: 69ad: \***   RECEIVED.UOD.HEADER:                         Data State: b (lower case)
10715: 69ad: \***
10716: 69ad: \***   If the UOD is scanned at item level it will have a status of "P", "O"
10717: 69ad: \***   or "I", with a count of the number of scanned items.
10718: 69ad: \***
10719: 69ad: \***   If the UOD is scanned at UOD level the status will be " ".
10720: 69ad: \***
10721: 69ad: \***   The UOD number, status flag and number of items (where appl.) are
10722: 69ad: \***   written to the CSRAF.
10723: 69ad: \***
10724: 69ad: \***   If status flag is blank then write a UOD type 21 record to the UODTF.
10725: 69ad: \***
10726: 69ad: \***   Otherwise, store the UOD file header details.
10727: 69ad: \***
10728: 69ad: \*****************************************************************************
10729: 69ad: 
10730: 69ad: RECEIVED.UOD.HEADER:
10731: 69bd: 
10732: 69bd:    UOD.NUM.ITEMS$ = ""                                                  ! ELC
10733: 69d4: 
10734: 69d4:    SB.MESSAGE$ = "PDT Support - UOD Header Received"                    ! ELC
10735: 69e9:    GOSUB SB.BG.MESSAGE                                                  ! ELC
10736: 69fb: 
10737: 69fb:    IF FN.VALIDATE.DATA(DATA.IN$,29) = 0 THEN BEGIN                      ! ELC
10738: 6a1d:       IF MID$(DATA.IN$,3,14) <> STRING$(14,"?") THEN RECEIVE.STATE$ = "*"  !GMJK
10739: 6a68:       RETURN                                                            ! ELC
10740: 6a78:    ENDIF                                                                ! ELC
10741: 6a80: 
10742: 6a80:    UOD.STATUS.FLAG$ = MID$(DATA.IN$,17,1)                               ! ELC
10743: 6aa7:    UOD.NUMBER$ = MID$(DATA.IN$,3,14)                                    ! ELC
10744: 6ace: 
10745: 6ace:    IF UOD.STATUS.FLAG$ <> "B" THEN BEGIN                                ! ELC
10746: 6aef:       IF UOD.STATUS.FLAG$ = "U" THEN UOD.STATUS.FLAG$ = "I"             \ FMJK
10747: 6b1e:         ELSE IF UOD.STATUS.FLAG$ <> "P" THEN UOD.STATUS.FLAG$ = "O"     ! FMJK
10748: 6b4b:       UOD.NUM.ITEMS% = VAL(MID$(DATA.IN$,18,4))                         ! ELC
10749: 6b78:       UOD.NUM.ITEMS$ = STR$(UOD.NUM.ITEMS%)                             ! ELC
10750: 6b9a:       COUNTED.ITEMS% = 0                                                ! ELC
10751: 6bab:       IF LEFT$(UOD.NUMBER$,4)="9999" THEN BEGIN                         ! GMJK
10752: 6be0:         CSR.AUDIT.DATA$ = "UOD Number: " + UOD.NUMBER$ +                \ GMJK
10753: 6c0b:                           " not written to STKMQ"                       ! GMJK
10754: 6c0b:       ENDIF ELSE BEGIN                                                  ! GMJK
10755: 6c13:         CSR.AUDIT.DATA$ = "UOD Number: " + UOD.NUMBER$ +                \ GMJK
10756: 6c56:                           " Status: " + UOD.STATUS.FLAG$ +              \ GMJK
10757: 6c56:                           " Number of items: " + UOD.NUM.ITEMS$         ! GMJK
10758: 6c56:       ENDIF                                                             ! GMJK
10759: 6c5e:       STORED.UOD.HEADER$ = LEFT$(DATA.IN$,16) + UOD.STATUS.FLAG$ +      \ GMJK
10760: 6cc6:                            RIGHT$(DATA.IN$,LEN(DATA.IN$)-17)            ! GMJK
10761: 6cc6:    ENDIF ELSE                                                           \ GMJK
10762: 6cce:      IF (NOT (RIGHT$(UOD.NUMBER$,6)="000000" AND                        \ GMJK
10763: 6d8a:               LEFT$(UOD.NUMBER$,4)<>"0000")) AND                        \ GMJK
10764: 6d8a:          LEFT$(UOD.NUMBER$,4)<>"9999" THEN BEGIN                        ! GMJK
10765: 6d8a:        CSR.AUDIT.DATA$ = "UOD Number: " + UOD.NUMBER$                   ! ELC
10766: 6daf:        UODTF.RECORD$ = CHR$(34) + PACK$("21") + CHR$(59) +              \ ELC
10767: 6e8e:                        PACK$(DATE$) + PACK$(TIME$) +                    \ ELC
10768: 6e8e:                        PACK$(UOD.NUMBER$) +                             \ ELC
10769: 6e8e:                        UOD.STATUS.FLAG$ +                               \ ELC
10770: 6e8e:                        CHR$(34) + CHR$(0Dh) + CHR$(0Ah)                 ! ELC
10771: 6e8e:        RC% = WRITE.UODTF                                                ! ELC
10772: 6ea2:        IF RC% = 1 THEN GOTO WRITE.ERROR                                 ! ELC
10773: 6eb9:      ENDIF ELSE BEGIN                                                   ! GMJK
10774: 6ec1:        CSR.AUDIT.DATA$ = "UOD Number: " + UOD.NUMBER$ +                 \ GMJK
10775: 6eea:                          " not written to STKMQ"                        ! GMJK
10776: 6eea:      ENDIF                                                              ! GMJK
10777: 6ef2:    GOSUB LOG.TO.AUDIT.FILE                                              ! ELC
10778: 6f04: 
10779: 6f04: RETURN                                                                  ! ELC
10780: 6f14: 
10781: 6f14: 
10782: 6f14: \*****************************************************************************
10783: 6f14: \***
10784: 6f14: \***   RECEIVED.UOD.DETAIL:                         Data State: c (lower case)
10785: 6f14: \***
10786: 6f14: \***   Write UOD type 23 record to UODTF.
10787: 6f14: \***
10788: 6f14: \***   Increment the number of detail records.
10789: 6f14: \***
10790: 6f14: \*****************************************************************************
10791: 6f14: 
10792: 6f14: RECEIVED.UOD.DETAIL:
10793: 6f24: 
10794: 6f24:    DETAIL.RECORDS.RECEIVED$ = "Y"                                       ! ELC
10795: 6f3b: 
10796: 6f3b:    SB.MESSAGE$ = "PDT Support - UOD Detail Record Received"             ! ELC
10797: 6f50:    GOSUB SB.BG.MESSAGE                                                  ! ELC
10798: 6f62: 
10799: 6f62:    IF FN.VALIDATE.DATA(DATA.IN$,30) = 0 THEN BEGIN                      ! ELC
10800: 6f84:       RECEIVE.STATE$ = "*"                                              ! ELC
10801: 6f9b:       RETURN                                                            ! ELC
10802: 6fab:    ENDIF                                                                ! ELC
10803: 6fb3: 
10804: 6fb3:    IF LEFT$(UOD.NUMBER$,4)="9999" THEN BEGIN                            ! GMJK
10805: 6fe8:      COUNTED.ITEMS% = COUNTED.ITEMS% + 1                                ! GMJK
10806: 6ff7:      RETURN                                                             ! GMJK
10807: 7007:    ENDIF                                                                ! GMJK
10808: 700f: 
10809: 700f:    IF MID$(DATA.IN$,3,1) = "I" THEN BEGIN                               ! ELC
10810: 7044:       BAR.ITEM.CODE$ = MID$(DATA.IN$,5,12)                              ! ELC
10811: 7069:       BAR.ITEM.CODE.FLAG$ = "B"                                         ! ELC
10812: 7080:    ENDIF ELSE BEGIN                                                     ! ELC
10813: 7088:       BAR.ITEM.CODE$ = MID$(DATA.IN$,5,12)                              ! ELC
10814: 70ad:       BAR.ITEM.CODE.FLAG$ = "E"                                         ! ELC
10815: 70c2:    ENDIF                                                                ! ELC
10816: 70ca: 
10817: 70ca: ! lines deleted here for the alteration of the UOD.STATUS.FLAG$           FMJK
10818: 70ca: 
10819: 70ca:    UODTF.RECORD$ = CHR$(34) + PACK$("23") + CHR$(59) +                  \ ELC
10820: 723a:                    PACK$(DATE$) + PACK$(TIME$) +                        \ ELC
10821: 723a:                    PACK$(UOD.NUMBER$) +                                 \ ELC
10822: 723a:                    UOD.STATUS.FLAG$ +                                   \ ELC
10823: 723a:                    PACK$(BAR.ITEM.CODE$) +                              \ ELC
10824: 723a:                    BAR.ITEM.CODE.FLAG$ +                                \ ELC
10825: 723a:                    STR$(VAL(MID$(DATA.IN$,17,4))) +                     \ ELC
10826: 723a:                    ";" + "0" + PACK$("0000") + "0" + PACK$("0000") +    \ ELC
10827: 723a:                    " " + CHR$(34) +                                     \ ELC
10828: 723a:                    CHR$(0Dh) + CHR$(0Ah)                                ! ELC
10829: 723a:    RC% = WRITE.UODTF                                                    ! ELC
10830: 724e:    IF RC% = 1 THEN GOTO WRITE.ERROR                                     ! ELC
10831: 7263: 
10832: 7263:    COUNTED.ITEMS% = COUNTED.ITEMS% + 1                                  ! ELC
10833: 7272: 
10834: 7272: RETURN                                                                  ! ELC
10835: 7282: 
10836: 7282: 
10837: 7282: \*****************************************************************************
10838: 7282: \***
10839: 7282: \***   RECEIVED.UOD.TRAILER:                        Data State: d (lower case)
10840: 7282: \***
10841: 7282: \*****************************************************************************
10842: 7282: 
10843: 7282: RECEIVED.UOD.TRAILER:
10844: 7292: 
10845: 7292:    SB.MESSAGE$ = "PDT Support - UOD Trailer Received"                   ! ELC
10846: 72a7:    GOSUB SB.BG.MESSAGE                                                  ! ELC
10847: 72b9: 
10848: 72b9:    IF FN.VALIDATE.DATA(DATA.IN$,31) = 0 THEN BEGIN                      ! ELC
10849: 72db:       RECEIVE.STATE$ = "*"                                              ! ELC
10850: 72f2:       RETURN                                                            ! ELC
10851: 7302:    ENDIF                                                                ! ELC
10852: 730a: 
10853: 730a:    IF DETAIL.RECORDS.RECEIVED$ = "Y" THEN BEGIN                         ! ELC
10854: 732b:       IF COUNTED.ITEMS% <> UOD.NUM.ITEMS% THEN BEGIN                    ! ELC
10855: 7346:          SB.EVENT.NO% = 92                                              ! ELC
10856: 7353:          SB.UNIQUE$ = PACK$(STR$(UOD.REPORT.NUM%)) +                    \ ELC
10857: 741f:                       PACK$(RIGHT$("00000000"+STR$(UOD.NUM.ITEMS%),8)) +\ ELC
10858: 741f:                       PACK$(RIGHT$("00000000"+STR$(COUNTED.ITEMS%),8))  ! ELC
10859: 741f:          GOSUB SB.LOG.AN.EVENT                                          ! ELC
10860: 7431:          RECEIVE.STATE$ = "*"                                           ! ELC
10861: 7448:          RETURN                                                         ! ELC
10862: 7458:       ENDIF                                                             ! ELC
10863: 7460:       IF LEFT$(UOD.NUMBER$,4)<>"9999" THEN BEGIN                        ! GMJK
10864: 7498:         UOD.STATUS.FLAG$ = MID$(STORED.UOD.HEADER$,17,1)                ! ELC
10865: 74bf:  ! Three lines deleted here, that changes <>P to O                      ! GMJK
10866: 74bf:         UODTF.RECORD$ = CHR$(34) + PACK$("21") + CHR$(59)       +       \ ELC
10867: 75b2:                         PACK$(DATE$) + PACK$(TIME$) +                   \ ELC
10868: 75b2:                         PACK$(MID$(STORED.UOD.HEADER$,3,14)) +          \ ELC
10869: 75b2:                         UOD.STATUS.FLAG$ +                              \ ELC
10870: 75b2:                         CHR$(34) + CHR$(0Dh) + CHR$(0Ah)                ! ELC
10871: 75b2:         RC% = WRITE.UODTF                                               ! ELC
10872: 75c6:         IF RC% = 1 THEN GOTO WRITE.ERROR                                ! ELC
10873: 75db:        ENDIF                                                            ! GMJK
10874: 75e3:       DETAIL.RECORDS.RECEIVED$ = "N"                                    ! ELC
10875: 75fa:    ENDIF                                                                ! ELC
10876: 7602: 
10877: 7602:    ACTUAL.NUM.OF.UODS% = ACTUAL.NUM.OF.UODS% + 1                        ! ELC
10878: 7611: 
10879: 7611: RETURN                                                                  ! ELC
10880: 7621: 
10881: 7621: 
10882: 7621: \*****************************************************************************
10883: 7621: \***
10884: 7621: \***   RECEIVED.UOD.FILE.TRAILER:                   Data State: e (lower case)
10885: 7621: \***
10886: 7621: \***   If actual number of UOD's <> expected number of UOD's
10887: 7621: \***   (from File Header), then log an error, set DATA.STATE$ to "*" and
10888: 7621: \***   RETURN
10889: 7621: \***
10890: 7621: \***   Append UODTF records to the STKMQ and UODBF.
10891: 7621: \***
10892: 7621: \***   Send a File Trailer to the LDT.
10893: 7621: \***
10894: 7621: \***   Start PSS45 as a background application.
10895: 7621: \***
10896: 7621: \***
10897: 7621: \*****************************************************************************
10898: 7621: 
10899: 7621: RECEIVED.UOD.FILE.TRAILER:
10900: 7631: 
10901: 7631:    SB.MESSAGE$ = "PDT Support - UOD File Trailer Received"              ! ELC
10902: 7646:    GOSUB SB.BG.MESSAGE                                                  ! ELC
10903: 7658: 
10904: 7658:    IF FN.VALIDATE.DATA(DATA.IN$,32) = 0 THEN BEGIN                      ! ELC
10905: 767a:       RECEIVE.STATE$ = "*"                                              ! ELC
10906: 7691:       RETURN                                                            ! ELC
10907: 76a1:    ENDIF                                                                ! ELC
10908: 76a9: 
10909: 76a9:    IF ACTUAL.NUM.OF.UODS% <> EXPECTED.NUM.OF.UODS% THEN BEGIN           ! ELC
10910: 76c4:       SB.EVENT.NO% = 92                                                 ! ELC
10911: 76d1:       SB.UNIQUE$ = PACK$(STR$(UOD.REPORT.NUM%)) +                       \ ELC
10912: 779d:          PACK$(RIGHT$("00000000" + STR$(EXPECTED.NUM.OF.UODS%),8)) +    \ ELC
10913: 779d:          PACK$(RIGHT$("00000000" + STR$(ACTUAL.NUM.OF.UODS%),8))        ! ELC
10914: 779d:       GOSUB SB.LOG.AN.EVENT                                             ! ELC
10915: 77af:       RECEIVE.STATE$ = "*"                                              ! ELC
10916: 77c6:       RETURN                                                            ! ELC
10917: 77d6:    ENDIF                                                                ! ELC
10918: 77de: 
10919: 77de:    PIPE.OUT$ = "L" +                                                    \ ELC
10920: 787c:                "UR" +                                                   \ ELC
10921: 787c:                FN.Z.PACK(APPLICATION.NO$,2) +                           \ ELC
10922: 787c:                FN.Z.PACK(CURR.TERMINAL$,6) +                            \ ELC
10923: 787c:                FN.Z.PACK(RIGHT$("0000" + STR$(ACTUAL.NUM.OF.UODS%),4),4)! ELC
10924: 787c:    GOSUB SEND.TO.PSS38                                                  ! ELC
10925: 788e: 
10926: 788e: RETURN                                                                  ! ELC
10927: 789e: 
10928: 789e: 
10929: 789e: \*****************************************************************************
10930: 789e: \***
10931: 789e: \***   END.OF.UODTF.FILE:
10932: 789e: \***
10933: 789e: \*****************************************************************************
10934: 789e: 
10935: 789e: END.OF.UODTF.FILE:
10936: 78ae: 
10937: 78ae:    END.OF.UODTF = TRUE
10938: 78c0:    GOTO END.OF.UODTF.RETURN
10939: 78cb: 
10940: 78cb: RETURN
10941: 78db: 
10942: 78db: \*****************************************************************************
10943: 78db: \***
10944: 78db: \***   RECEIVED.UOD.EOT:                            Data State: f (lower case)
10945: 78db: \***
10946: 78db: \***   Log message to CSRAF
10947: 78db: \***
10948: 78db: \***   Set RE.CHAIN to true.
10949: 78db: \*****************************************************************************
10950: 78db: 
10951: 78db: RECEIVED.UOD.EOT:
10952: 78eb: 
10953: 78eb:    SB.MESSAGE$ = "PDT Support - UOD EOT Received"                       ! ELC
10954: 7900:    GOSUB SB.BG.MESSAGE                                                  ! ELC
10955: 7912: 
10956: 7912:    IF FN.VALIDATE.DATA(DATA.IN$,33) = 0 THEN BEGIN                      ! ELC
10957: 7934:       RECEIVE.STATE$ = "*"                                              ! ELC
10958: 794b:       RETURN                                                            ! ELC
10959: 795b:    ENDIF                                                                ! ELC
10960: 7963: 
10961: 7963:    ! Line deleted here that called HOLD.PDT routine                       GMJK
10962: 7963: 
10963: 7963:    IF STKMQ.OPEN.FLAG$ <> "Y" THEN BEGIN                                ! ELC
10964: 7981:       IF END# STKMQ.SESS.NUM% THEN OPEN.ERROR                           ! ELC
10965: 799d:       CURR.SESS.NUM% = STKMQ.SESS.NUM%                                  ! ELC
10966: 79af:       OPEN STKMQ.FILE.NAME$ AS STKMQ.SESS.NUM% BUFFSIZE 512 READONLY    \ ELC
10967: 79d8:          NODEL APPEND                                                   ! ELC
10968: 79d8:       STKMQ.OPEN.FLAG$ = "Y"                                            ! ELC
10969: 79ef:    ENDIF                                                                ! ELC
10970: 79f7: 
10971: 79f7:    IF UODBF.OPEN.FLAG$ <> "Y" THEN BEGIN                                ! ELC
10972: 7a18:       OPENING.UODBF$ = "Y"                                              ! ELC
10973: 7a2d:       IF END# UODBF.SESS.NUM% THEN CREATE.UODBF                         ! ESMG
10974: 7a49:       CURR.SESS.NUM% = UODBF.SESS.NUM%                                  ! ELC
10975: 7a5b:       RETURN.FROM.CREATE.UODBF:                                         ! ELC
10976: 7a6b:       OPEN UODBF.FILE.NAME$ AS UODBF.SESS.NUM% BUFFSIZE 512 READONLY    \ ELC
10977: 7a94:          NODEL APPEND                                                   ! ELC
10978: 7a94:       UODBF.OPEN.FLAG$ = "Y"                                            ! ELC
10979: 7aab:    ENDIF                                                                ! ELC
10980: 7ab3: 
10981: 7ab3:    END.OF.UODTF = FALSE                                                 ! ELC
10982: 7ac5: 
10983: 7ac5:    WHILE NOT END.OF.UODTF                                               ! ELC
10984: 7ad0: 
10985: 7ad0:       CURR.SESS.NUM% = UODTF.SESS.NUM%                                  ! ELC
10986: 7ae2:       RC% = READ.UODTF                                                  ! ELC
10987: 7af6:       IF RC% = 1 THEN GOTO END.OF.UODTF.FILE                            ! ELC
10988: 7b0b: 
10989: 7b0b:       STKMQ.RECORD$ = UODTF.RECORD$ + CHR$(0Dh) + CHR$(0Ah)             ! ELC
10990: 7b45: 
10991: 7b45:       CURR.SESS.NUM% = STKMQ.SESS.NUM%                                  ! ELC
10992: 7b57:       RC% = WRITE.STKMQ                                                 ! ELC
10993: 7b6b:       IF RC% = 1 THEN GOTO WRITE.ERROR                                  ! ELC
10994: 7b80: 
10995: 7b80:       UODBF.RECORD$ = STKMQ.RECORD$                                     ! ELC
10996: 7b9e: 
10997: 7b9e:       CURR.SESS.NUM% = UODBF.SESS.NUM%                                  ! ELC
10998: 7bb0:       RC% = WRITE.UODBF                                                 ! ELC
10999: 7bc4:       IF RC% = 1 THEN GOTO WRITE.ERROR                                  ! ELC
11000: 7bd9: 
11001: 7bd9:       END.OF.UODTF.RETURN:                                              ! ELC
11002: 7be9: 
11003: 7be9:    WEND                                                                 ! ELC
11004: 7bfb: 
11005: 7bfb:    CLOSE STKMQ.SESS.NUM%                                                ! ELC
11006: 7c0f:    STKMQ.OPEN.FLAG$ = "N"                                               ! ELC
11007: 7c26: 
11008: 7c26:    CLOSE UODBF.SESS.NUM%                                                ! ELC
11009: 7c3a:    UODBF.OPEN.FLAG$ = "N"                                               ! ELC
11010: 7c51: 
11011: 7c51:    ! Line deleted here that called RELEASE.PDT routine                    GMJK
11012: 7c51: 
11013: 7c51:    ADX.RET.CODE% = ADXSTART("ADX_UPGM:PSS45.286",                       \ ELC
11014: 7c80:                              MONITORED.PORT$,                           \ ELC
11015: 7c80:                              "PSS45 - Outstanding UOD Report")          ! ELC
11016: 7c80: 
11017: 7c80:    LDTAF.LINK.TYPE% = 5                                                 ! FMJK
11018: 7c90:    IF MONITORED.PORT$ = "B" THEN LDTAF.LINK.TYPE% =                     \ FMJK
11019: 7cbe:      (LDTAF.LINK.TYPE% OR 80H)                                          ! FMJK
11020: 7cc6:    LDTAF.START.DATE$ = PACK$(LOG.ON.DATE$)                              ! FMJK
11021: 7ce9:    LDTAF.START.TIME$ = PACK$(LOG.ON.TIME$)                              ! FMJK
11022: 7d0c:    TEMP.TIME$ = TIME$                                                   ! GMJK
11023: 7d24:    LDTAF.DURATION% = ( (VAL(LEFT$(TEMP.TIME$,2))*3600) +                \ GMJK
11024: 7f10:                        (VAL(MID$(TEMP.TIME$,3,2))*60) +                 \ GMJK
11025: 7f10:                         VAL(RIGHT$(TEMP.TIME$,2)) ) -                   \ GMJK
11026: 7f10:                      ( (VAL(UNPACK$(LEFT$(LDTAF.START.TIME$,1)))*3600)+ \ GMJK
11027: 7f10:                        (VAL(UNPACK$(MID$(LDTAF.START.TIME$,2,1)))*60)+  \ GMJK
11028: 7f10:                         VAL(UNPACK$(RIGHT$(LDTAF.START.TIME$,1))) )     ! GMJK
11029: 7f10:    LDTAF.DATA.VOLUME.2% = 0                                             ! FMJK
11030: 7f27:    LDTAF.DATA.VOLUME.1% = SIZE (UODTF.FILE.NAME$)                       ! GMJK
11031: 7f4e:    GOSUB LOG.TO.LDTAF.FILE                                              ! FMJK
11032: 7f60: 
11033: 7f60:    CSR.AUDIT.DATA$ = "UOD session complete at " +                       \ FMJK
11034: 7fd2:                          LEFT$(TEMP.TIME$,2) + ":" +                    \ FMJK
11035: 7fd2:                          MID$(TEMP.TIME$,3,2) + ":" +                   \ FMJK
11036: 7fd2:                          RIGHT$(TEMP.TIME$,2)                           ! FMJK
11037: 7fd2:    CSR.AUDIT.DATA$ = "[PORT " + MONITORED.PORT$ + "] " +                \ ELC
11038: 8006:        CSR.AUDIT.DATA$                                                  ! ELC
11039: 8006:    GOSUB LOG.TO.AUDIT.FILE                                              ! ELC
11040: 8018: 
11041: 8018:    IF CSR.AUDIT.OPEN.FLAG$ = "Y" THEN BEGIN                             ! ELC
11042: 8036:       CLOSE CSR.AUDIT.SESS.NUM%                                         ! ELC
11043: 804a:       CSR.AUDIT.OPEN.FLAG$ = "N"                                        ! ELC
11044: 8061:    ENDIF                                                                ! ELC
11045: 8069: 
11046: 8069:    RE.CHAIN = TRUE                                                      ! ELC
11047: 807f:    RECEIVE.STATE$ = "?"                                                 ! ELC
11048: 8096: 
11049: 8096: RETURN                                                                  ! ELC
11050: 80a6: 
11051: 80a6: 
11052: 80a6: \*****************************************************************************
11053: 80a6: \***
11054: 80a6: \***   DUMMY.ROUTINE:
11055: 80a6: \***
11056: 80a6: \***   Will not be called
11057: 80a6: \***
11058: 80a6: \*****************************************************************************
11059: 80a6: 
11060: 80a6: DUMMY.ROUTINE:                                                          ! ELC
11061: 80b6: 
11062: 80b6: RETURN                                                                  ! ELC
11063: 80c6: 
11064: 80c6: 
11065: 80c6: \******************************************************************************
11066: 80c6: \***
11067: 80c6: \***   CREATE.UODTF:
11068: 80c6: \***
11069: 80c6: \***      if a UODTF already exists then close it
11070: 80c6: \***      create a new UODTF
11071: 80c6: \***
11072: 80c6: \***   RETURN
11073: 80c6: \***
11074: 80c6: \******************************************************************************
11075: 80c6: 
11076: 80c6:    CREATE.UODTF:                                                        ! ELC
11077: 80d6: 
11078: 80d6:       CURR.SESS.NUM% = UODTF.SESS.NUM%                                  ! ELC
11079: 80e8: 
11080: 80e8:       IF UODTF.OPEN.FLAG$ = "Y" THEN BEGIN                              ! ELC
11081: 8106:          CLOSE UODTF.SESS.NUM%                                          ! ELC
11082: 811a:          UODTF.OPEN.FLAG$ = "N"                                         ! ELC
11083: 8131:       ENDIF                                                             ! ELC
11084: 8139: 
11085: 8139:       IF END #UODTF.SESS.NUM% THEN CREATE.ERROR                         ! ELC
11086: 8155:       CREATE UODTF.FILE.NAME$ AS UODTF.SESS.NUM%                        \ ELC
11087: 817d:              BUFFSIZE 10240 LOCKED                                      ! ELC
11088: 817d:       UODTF.OPEN.FLAG$ = "Y"                                            ! ELC
11089: 8194: 
11090: 8194:    RETURN                                                               ! ELC
11091: 81a4: 
11092: 81a4: \******************************************************************************
11093: 81a4: \***
11094: 81a4: \***   CREATE.UODBF:
11095: 81a4: \***
11096: 81a4: \******************************************************************************
11097: 81a4: 
11098: 81a4:    CREATE.UODBF:                                                        ! ESMG
11099: 81b4: 
11100: 81b4:          IF END #UODBF.SESS.NUM% THEN CREATE.ERROR                      ! ESMG
11101: 81d0:          CREATE UODBF.FILE.NAME$ AS UODBF.SESS.NUM% BUFFSIZE 512        \ ESMG
11102: 81f8:             READONLY                                                    ! ESMG
11103: 81f8:          CLOSE UODBF.SESS.NUM%                                          ! ESMG
11104: 820c:          OPENING.UODBF$ = "N"                                           ! ESMG
11105: 8221:          GOTO RETURN.FROM.CREATE.UODBF                                  ! ESMG
11106: 822c: 
11107: 822c:    RETURN                                                               ! ESMG
11108: 823c: 
11109: 823c: \******************************************************************************
11110: 823c: \***
11111: 823c: \***   SEND.TO.PSS38:
11112: 823c: \***
11113: 823c: \***      transmit data to PSS38 (data contained in PIPE.OUT$)
11114: 823c: \***
11115: 823c: \***   RETURN
11116: 823c: \***
11117: 823c: \******************************************************************************
11118: 823c: 
11119: 823c:    SEND.TO.PSS38:
11120: 824c: 
11121: 824c:       IF END# PIPEI.SESS.NUM% THEN WRITE.ERROR
11122: 826a:       CURR.SESS.NUM% = PIPEI.SESS.NUM%
11123: 827c:       WRITE# PIPEI.SESS.NUM%; PIPE.OUT$
11124: 82a4: 
11125: 82a4:    RETURN
11126: 82b4: 
11127: 82b4: 
11128: 82b4: \******************************************************************************
11129: 82b4: \***
11130: 82b4: \***   HOLD.PDT:
11131: 82b4: \***
11132: 82b4: \***      send a hold PDT command to PSS38
11133: 82b4: \***
11134: 82b4: \***   RETURN
11135: 82b4: \***
11136: 82b4: \******************************************************************************
11137: 82b4: 
11138: 82b4:    HOLD.PDT:
11139: 82c4: 
11140: 82c4:       PIPE.OUT$ = "HY"
11141: 82db:       GOSUB SEND.TO.PSS38
11142: 82ed:       HOLD.FLAG$ = "Y"
11143: 8304: 
11144: 8304:    RETURN
11145: 8314: 
11146: 8314: 
11147: 8314: \******************************************************************************
11148: 8314: \***
11149: 8314: \***   RELEASE.PDT:
11150: 8314: \***
11151: 8314: \***      send a release PDT command to PSS38
11152: 8314: \***
11153: 8314: \***   RETURN
11154: 8314: \***
11155: 8314: \******************************************************************************
11156: 8314: 
11157: 8314:    RELEASE.PDT:
11158: 8324: 
11159: 8324:       PIPE.OUT$ = "HN"
11160: 833b:       GOSUB SEND.TO.PSS38
11161: 834d:       HOLD.FLAG$ = "N"
11162: 8364: 
11163: 8364:    RETURN
11164: 8374: 
11165: 8374: 
11166: 8374: \******************************************************************************
11167: 8374: \***
11168: 8374: \***   WRITE.DIRWF.RECORD:
11169: 8374: \***
11170: 8374: \***     write DIRWF record
11171: 8374: \***
11172: 8374: \***   RETURN
11173: 8374: \***
11174: 8374: \******************************************************************************
11175: 8374: 
11176: 8374:    WRITE.DIRWF.RECORD:
11177: 8384: 
11178: 8384:       CURR.SESS.NUM% = DIRWF.SESS.NUM%
11179: 8396:       RC% = WRITE.DIRWF                                                 ! BLC
11180: 83aa:       IF RC% = 1 THEN GOTO WRITE.ERROR                                  ! BLC
11181: 83bf: 
11182: 83bf:    RETURN
11183: 83cf: 
11184: 83cf: 
11185: 83cf: \******************************************************************************
11186: 83cf: \***
11187: 83cf: \***   WRITE.DRSMQ.TYPE.17
11188: 83cf: \***
11189: 83cf: \***      if a training order then
11190: 83cf: \***         return
11191: 83cf: \***      endif
11192: 83cf: \***
11193: 83cf: \***      format DRSMQ type 17 record
11194: 83cf: \***
11195: 83cf: \***      write DRSMQ record
11196: 83cf: \***
11197: 83cf: \***   RETURN
11198: 83cf: \***
11199: 83cf: \******************************************************************************
11200: 83cf: 
11201: 83cf:    WRITE.DRSMQ.TYPE.17:
11202: 83df: 
11203: 83df:        IF VAL(SAVED.SUPPLIER.NO$) > 999000 THEN BEGIN
11204: 8414:           RETURN
11205: 8424:        ENDIF
11206: 842c: 
11207: 842c:        DRSMQ.RECORD.DELIMITER$ = CHR$(34)
11208: 8446:        DRSMQ.FIELD.DELIMITER$ = CHR$(59)
11209: 8460:        DRSMQ.ENDREC.MARKER$ = CHR$(0Dh) + CHR$(0Ah)
11210: 848f: 
11211: 848f:        DRSMQ.STRING$ = ""
11212: 84a4:        FOR COUNT% = 1 TO LINE.TOTAL%
11213: 84b5:            IF MID$(ORDER.LINE.TABLE$(COUNT%),3,1) = "I" THEN BEGIN
11214: 84f8:               DRSMQ.BOOTS.CODE$ = PACK$(MID$(ORDER.LINE.TABLE$(COUNT%),9,8))
11215: 8532:               DRSMQ.BAR.CODE$ = PACK$("000000000000")
11216: 8550:            ENDIF ELSE BEGIN
11217: 8558:               DRSMQ.BOOTS.CODE$ = PACK$("00000000")
11218: 8574:               DRSMQ.BAR.CODE$ = PACK$(MID$(ORDER.LINE.TABLE$(COUNT%),5,12))
11219: 85ae:            ENDIF
11220: 85b6:            DRSMQ.QTY.GOOD$ = STR$(VAL(MID$(ORDER.LINE.TABLE$(COUNT%),17,4)))
11221: 8605:            DRSMQ.QTY.BAD$ = STR$(VAL(MID$(ORDER.LINE.TABLE$(COUNT%),21,4)))
11222: 8654:            DRSMQ.QTY.STOLEN$ = STR$(VAL(MID$(ORDER.LINE.TABLE$(COUNT%),25,4)))
11223: 86a3: 
11224: 86a3:            DRSMQ.STRING$ = DRSMQ.STRING$ +                              \
11225: 8717:                            DRSMQ.FIELD.DELIMITER$ +                     \
11226: 8717:                            DRSMQ.BOOTS.CODE$ +                          \
11227: 8717:                            DRSMQ.BAR.CODE$ +                            \
11228: 8717:                            DRSMQ.QTY.GOOD$ +                            \
11229: 8717:                            DRSMQ.FIELD.DELIMITER$ +                     \
11230: 8717:                            DRSMQ.QTY.BAD$ +                             \
11231: 8717:                            DRSMQ.FIELD.DELIMITER$ +                     \
11232: 8717:                            DRSMQ.QTY.STOLEN$                            !
11233: 8717:        NEXT COUNT%
11234: 8736: 
11235: 8736:        DRSMQ.TRANS.TYPE$ = PACK$("17")
11236: 8752:        DRSMQ.DATE$ = PACK$(DATE$)
11237: 876f:        DRSMQ.TIME$ = PACK$(TIME$)
11238: 878c:        DRSMQ.SOURCE$ = "P"
11239: 87a3:        DRSMQ.SUPPLIER.NO$ = PACK$(SAVED.SUPPLIER.NO$)
11240: 87c6:        DRSMQ.ORDER.NO$ = PACK$(SAVED.ORDER.NO$)
11241: 87e9:        DRSMQ.ORDER.SFX$ = SAVED.ORDER.SUFFIX$
11242: 8807:        DRSMQ.PAGE.NO$ = PACK$(LEFT$(ORDER.LINE.TABLE$(1),2))
11243: 883f: \      DRSMQ.ITEM.COUNT$ = PACK$(FN.Z.PACK(STR$(LINE.TOTAL%),2))        ! 1.6NWB
11244: 883f:        DRSMQ.ITEM.COUNT$ = PACK$(FN.Z.PACK(STR$(LINE.TOTAL%),8))
11245: 8877:        DRSMQ.CARTON.NO$ = PACK$("00000000")                             ! 1.6NWB
11246: 8893:        DRSMQ.CARTON.FLAG$ = " "                                         ! 1.6NWB
11247: 88aa: 
11248: 88aa:        DRSMQ.RECORD$ = DRSMQ.RECORD.DELIMITER$ +                        \
11249: 896d:                        DRSMQ.TRANS.TYPE$ +                              \
11250: 896d:                        DRSMQ.FIELD.DELIMITER$ +                         \
11251: 896d:                        DRSMQ.DATE$ +                                    \
11252: 896d:                        DRSMQ.TIME$ +                                    \
11253: 896d:                        DRSMQ.SOURCE$ +                                  \
11254: 896d:                        DRSMQ.SUPPLIER.NO$ +                             \
11255: 896d:                        DRSMQ.ORDER.NO$ +                                \
11256: 896d:                        DRSMQ.ORDER.SFX$ +                               \
11257: 896d:                        DRSMQ.PAGE.NO$ +                                 \
11258: 896d:                        DRSMQ.ITEM.COUNT$ +                              \
11259: 896d:                        DRSMQ.CARTON.NO$ +                               \ 1.6NWB
11260: 896d:                        DRSMQ.CARTON.FLAG$ +                             \ 1.6NWB
11261: 896d:                        DRSMQ.STRING$ +                                  \
11262: 896d:                        DRSMQ.RECORD.DELIMITER$ +                        \
11263: 896d:                        DRSMQ.ENDREC.MARKER$
11264: 896d: 
11265: 896d:        CURR.SESS.NUM% = DRSMQ.SESS.NUM%
11266: 897f:        CURRENT.KEY$ = ""
11267: 8994:        RC% = WRITE.DRSMQ                                                ! BLC
11268: 89a8:        IF RC% = 1 THEN GOTO WRITE.ERROR                                 ! BLC
11269: 89bd: 
11270: 89bd:        TYPE.17.WRITTEN = TRUE
11271: 89d4: 
11272: 89d4:    RETURN
11273: 89e4: 
11274: 89e4: 
11275: 89e4: \******************************************************************************
11276: 89e4: \***
11277: 89e4: \***   ADD.TO.ORDER.LINE.TABLE
11278: 89e4: \***
11279: 89e4: \***       add 1 to line total
11280: 89e4: \***       add detail entry to order line table
11281: 89e4: \***
11282: 89e4: \***   RETURN
11283: 89e4: \***
11284: 89e4: \******************************************************************************
11285: 89e4: 
11286: 89e4:    ADD.TO.ORDER.LINE.TABLE:
11287: 89f4: 
11288: 89f4:        LINE.TOTAL% = LINE.TOTAL% + 1
11289: 8a03:        ORDER.LINE.TABLE$(LINE.TOTAL%) = MID$(DATA.IN$,3,28)
11290: 8a3b: 
11291: 8a3b:    RETURN
11292: 8a4b: 
11293: 8a4b: 
11294: 8a4b: \******************************************************************************
11295: 8a4b: \***
11296: 8a4b: \***   WRITE.DRSMQ.TYPE.19
11297: 8a4b: \***
11298: 8a4b: \***      if a training order then
11299: 8a4b: \***         return
11300: 8a4b: \***      endif
11301: 8a4b: \***
11302: 8a4b: \***      format DRSMQ type 19 record
11303: 8a4b: \***
11304: 8a4b: \***      write DRSMQ record
11305: 8a4b: \***
11306: 8a4b: \***   RETURN
11307: 8a4b: \***
11308: 8a4b: \******************************************************************************
11309: 8a4b: 
11310: 8a4b:    WRITE.DRSMQ.TYPE.19:
11311: 8a5b: 
11312: 8a5b:        IF VAL(SAVED.SUPPLIER.NO$) > 999000 THEN BEGIN
11313: 8a90:           RETURN
11314: 8aa0:        ENDIF
11315: 8aa8: 
11316: 8aa8:        DRSMQ.RECORD.DELIMITER$ = CHR$(34)
11317: 8ac2:        DRSMQ.FIELD.DELIMITER$ = CHR$(59)
11318: 8adc:        DRSMQ.ENDREC.MARKER$ = CHR$(0Dh) + CHR$(0Ah)
11319: 8b0b: 
11320: 8b0b:        DRSMQ.TRANS.TYPE$ = PACK$("19")
11321: 8b27:        DRSMQ.DATE$ = PACK$(DATE$)
11322: 8b44:        DRSMQ.TIME$ = PACK$(TIME$)
11323: 8b61:        DRSMQ.SUPPLIER.NO$ = PACK$(SAVED.SUPPLIER.NO$)
11324: 8b84:        DRSMQ.ORDER.NO$ = PACK$(SAVED.ORDER.NO$)
11325: 8ba7:        DRSMQ.ORDER.SFX$ = SAVED.ORDER.SUFFIX$
11326: 8bc5:        DRSMQ.CONF.AMND.FLAG$ = "A"
11327: 8bdc:        DRSMQ.START.TIME$ = PACK$(BOOKING.STARTED$)
11328: 8bff:        DRSMQ.END.TIME$ = PACK$(BOOKING.ENDED$)
11329: 8c22:        DRSMQ.SNGLS.ADDED$ = FN.Z.PACK(STR$(SINGLES.ADDED%),5)
11330: 8c55:        DRSMQ.ITEMS.ADDED$ = FN.Z.PACK(STR$(LINES.ADDED%),5)
11331: 8c88:        DRSMQ.ITEMS.BOOKED$ = FN.Z.PACK(STR$(LINES.BOOKED.IN%),5)
11332: 8cbb: 
11333: 8cbb:        DRSMQ.RECORD$ = DRSMQ.RECORD.DELIMITER$ +                        \
11334: 8d81:                        DRSMQ.TRANS.TYPE$ +                              \
11335: 8d81:                        DRSMQ.FIELD.DELIMITER$ +                         \
11336: 8d81:                        DRSMQ.DATE$ +                                    \
11337: 8d81:                        DRSMQ.TIME$ +                                    \
11338: 8d81:                        DRSMQ.SUPPLIER.NO$ +                             \
11339: 8d81:                        DRSMQ.ORDER.NO$ +                                \
11340: 8d81:                        DRSMQ.ORDER.SFX$ +                               \
11341: 8d81:                        DRSMQ.CONF.AMND.FLAG$ +                          \
11342: 8d81:                        DRSMQ.START.TIME$ +                              \
11343: 8d81:                        DRSMQ.END.TIME$ +                                \
11344: 8d81:                        DRSMQ.SNGLS.ADDED$ +                             \
11345: 8d81:                        DRSMQ.ITEMS.ADDED$ +                             \
11346: 8d81:                        DRSMQ.ITEMS.BOOKED$ +                            \
11347: 8d81:                        DRSMQ.RECORD.DELIMITER$ +                        \
11348: 8d81:                        DRSMQ.ENDREC.MARKER$
11349: 8d81: 
11350: 8d81:        CURR.SESS.NUM% = DRSMQ.SESS.NUM%
11351: 8d93:        CURRENT.KEY$ = ""
11352: 8da8:        RC% = WRITE.DRSMQ                                                ! BLC
11353: 8dbc:        IF RC% = 1 THEN GOTO WRITE.ERROR                                 ! BLC
11354: 8dd1: 
11355: 8dd1:    RETURN
11356: 8de1: 
11357: 8de1: 
11358: 8de1: \******************************************************************************
11359: 8de1: \***
11360: 8de1: \***   LOG.TO.AUDIT.FILE
11361: 8de1: \***
11362: 8de1: \***   RETURN
11363: 8de1: \***
11364: 8de1: \******************************************************************************
11365: 8de1: 
11366: 8de1:    LOG.TO.AUDIT.FILE:
11367: 8df1: 
11368: 8df1:       IF CSR.AUDIT.OPEN.FLAG$ = "N" THEN BEGIN
11369: 8e0f:          IF END #CSR.AUDIT.SESS.NUM% THEN AUDIT.FAIL
11370: 8e2b:          OPEN CSR.AUDIT.FILE$ AS CSR.AUDIT.SESS.NUM% APPEND
11371: 8e52:          CSR.AUDIT.OPEN.FLAG$ = "Y"
11372: 8e69:       ENDIF
11373: 8e71: 
11374: 8e71:       PRINT USING "&"; #CSR.AUDIT.SESS.NUM%;CSR.AUDIT.DATA$
11375: 8ea0: 
11376: 8ea0:    AUDIT.FAIL:
11377: 8eb0: 
11378: 8eb0:    RETURN
11379: 8ec0: 
11380: 8ec0: \******************************************************************************
11381: 8ec0: \***
11382: 8ec0: \***   LOG.TO.LDTAF.FILE
11383: 8ec0: \***
11384: 8ec0: \******************************************************************************
11385: 8ec0: 
11386: 8ec0:    LOG.TO.LDTAF.FILE:                                                   ! FMJK
11387: 8ed0:                                                                         ! FMJK
11388: 8ed0:         CURRENT.KEY$ = ""                                               ! FMJK
11389: 8ee5:         CURR.SESS.NUM% = LDTAF.SESS.NUM%                                ! FMJK
11390: 8ef7:         IF LDTAF.OPEN.FLAG$ = "N" THEN BEGIN                            ! FMJK
11391: 8f15:            IF END #LDTAF.SESS.NUM% THEN CREATE.LDTAF.FILE               ! FMJK
11392: 8f31:            OPEN LDTAF.FILE.NAME$ AS LDTAF.SESS.NUM% APPEND              ! FMJK
11393: 8f58:            LDTAF.OPEN.FLAG$ = "Y"                                       ! FMJK
11394: 8f6f:         ENDIF                                                           ! FMJK
11395: 8f77:         IF LDTAF.LINK.TYPE% <> 0 THEN                                   \ FMJK
11396: 8f89:           IF WRITE.LDTAF THEN GOTO WRITE.ERROR                          ! FMJK
11397: 8f9d:         LDTAF.LINK.TYPE% = 0                                            ! FMJK
11398: 8fad:         LDTAF.OPEN.FLAG$ = "N"                                          ! FMJK
11399: 8fc4:         CLOSE LDTAF.SESS.NUM%                                           ! FMJK
11400: 8fd8:                                                                         ! FMJK
11401: 8fd8:    RETURN                                                               ! FMJK
11402: 8fe8:                                                                         ! FMJK
11403: 8fe8:    CREATE.LDTAF.FILE:                                                   ! FMJK
11404: 8ff8:                                                                         ! FMJK
11405: 8ff8:         IF END #LDTAF.SESS.NUM% THEN CREATE.ERROR                       ! FMJK
11406: 9014:         CREATE POSFILE LDTAF.FILE.NAME$ AS LDTAF.SESS.NUM%              \ FMJK
11407: 903a:            MIRRORED ATCLOSE                                             ! FMJK
11408: 903a:         LDTAF.OPEN.FLAG$ = "Y"                                          ! FMJK
11409: 9051:         IF LDTAF.LINK.TYPE% <> 0 THEN                                   \ FMJK
11410: 9063:           IF WRITE.LDTAF THEN GOTO WRITE.ERROR                          ! FMJK
11411: 9077:         LDTAF.LINK.TYPE% = 0                                            ! FMJK
11412: 9087:         LDTAF.OPEN.FLAG$ = "N"                                          ! FMJK
11413: 909e:         CLOSE LDTAF.SESS.NUM%                                           ! FMJK
11414: 90b2:                                                                         ! FMJK
11415: 90b2:    RETURN                                                               ! FMJK
11416: 90c2: 
11417: 90c2: \******************************************************************************
11418: 90c2: \******************************************************************************
11419: 90c2: \***                                                                        ***
11420: 90c2: \***                                                                        ***
11421: 90c2: \***   L O W   L E V E L   S U B R O U T I N E S                            ***
11422: 90c2: \***                                                                        ***
11423: 90c2: \***                                                                        ***
11424: 90c2: \***   - SB.FILE.UTILS                                                      ***
11425: 90c2: \***   - SB.BG.MESSAGE                                                      ***
11426: 90c2: \***   - SB.LOG.AN.EVENT                                                    ***
11427: 90c2: \***   - SB.FORMAT.ERROR.DATA                                               ***
11428: 90c2: \***   - SB.FILE.OPEN.ERROR                                                 ***
11429: 90c2: \***   - SB.FILE.READ.ERROR                                                 ***
11430: 90c2: \***   - SB.FILE.WRITE.ERROR                                                ***
11431: 90c2: \***                                                                        ***
11432: 90c2: \******************************************************************************
11433: 90c2: \******************************************************************************
11434: 90c2: 
11435: 90c2: \******************************************************************************
11436: 90c2: \***
11437: 90c2: \***   Subroutine : SB.FILE.UTILS
11438: 90c2: \***
11439: 90c2: \***   Purpose    : Allocate / report / de-allocate a file session number
11440: 90c2: \***
11441: 90c2: \***   Parameters : 2 or 3 (depending on action)
11442: 90c2: \***
11443: 90c2: \***      SB.ACTION$  = "O" for allocate file session number
11444: 90c2: \***                    "R" for report file session number
11445: 90c2: \***                    "C" for de-allocate file session number
11446: 90c2: \***      SB.INTEGER% = file reporting number for action "O" or
11447: 90c2: \***                  = file session number for actions "R" or "C"
11448: 90c2: \***
11449: 90c2: \***      SB.STRING$  = logical file name for action "O" or
11450: 90c2: \***                    null ("") for actions "R" and "C"
11451: 90c2: \***
11452: 90c2: \***   Output     : 1 or 2 (depending on action)
11453: 90c2: \***      SB.FILE.SESS.NUM% = file session number for action "O" or
11454: 90c2: \***                          undefined for action "C"
11455: 90c2: \***      or
11456: 90c2: \***      SB.FILE.REP.NUM%  = file reporting number for action "R" or
11457: 90c2: \***                          undefined for action "C"
11458: 90c2: \***
11459: 90c2: \***   Error action : log event 48 and end program
11460: 90c2: \***
11461: 90c2: \******************************************************************************
11462: 90c2: 
11463: 90c2:    SB.FILE.UTILS:
11464: 90d2: 
11465: 90d2:       RC% = SESS.NUM.UTILITY(SB.ACTION$,                                \ BLC
11466: 90fd:                              SB.INTEGER%,                               \
11467: 90fd:                              SB.STRING$ )
11468: 90fd: 
11469: 90fd:       IF RC% <> 0 THEN BEGIN
11470: 910f:          SB.EVENT.NO% = 48
11471: 911c:          SB.UNIQUE$ = FN.Z.PACK(STR$(F20.INTEGER.FILE.NO%), 10)
11472: 914d:          SB.MESSAGE$ = "SESSION NUMBER ALLOCATION ROUTINE FAILED"
11473: 9162:          GOSUB SB.LOG.AN.EVENT
11474: 9174:          GOTO PROGRAM.EXIT
11475: 917f:       ENDIF
11476: 9187: 
11477: 9187:       IF SB.ACTION$ = "O" THEN                                          \
11478: 91a2:          SB.FILE.SESS.NUM% = F20.INTEGER.FILE.NO%
11479: 91b4:       IF SB.ACTION$ = "R" THEN                                          \
11480: 91cf:          SB.FILE.REP.NUM% = F20.INTEGER.FILE.NO%
11481: 91e1: 
11482: 91e1:    RETURN
11483: 91f1: 
11484: 91f1: 
11485: 91f1: \******************************************************************************
11486: 91f1: \***
11487: 91f1: \***   Subroutine : SB.BG.MESSAGE
11488: 91f1: \***
11489: 91f1: \***   Purpose    : Display a message to the background screen
11490: 91f1: \***
11491: 91f1: \***   Parameters : 1
11492: 91f1: \***
11493: 91f1: \***      SB.MESSAGE$ = message to be displayed (message will be truncated to
11494: 91f1: \***                    46 characters if the message is longer than 46 chars)
11495: 91f1: \***                    Minus the port letter.
11496: 91f1: \***
11497: 91f1: \***   Output     : 1
11498: 91f1: \***      SB.MESSAGE$ = null
11499: 91f1: \***
11500: 91f1: \***   Error action : log an event 23 and end program
11501: 91f1: \***
11502: 91f1: \******************************************************************************
11503: 91f1: 
11504: 91f1:    SB.BG.MESSAGE:
11505: 9201: 
11506: 9201:       IF SB.MESSAGE$ = LAST.MESSAGE$ THEN RETURN
11507: 922b:       LAST.MESSAGE$ = SB.MESSAGE$
11508: 9246: 
11509: 9246:       SB.MESSAGE$ = MONITORED.PORT$ + ": " + SB.MESSAGE$
11510: 9271:       SB.MESSAGE$ = LEFT$(SB.MESSAGE$ + STRING$(46, " "), 46)
11511: 92bb:       CALL ADXSERVE( ADX.RET.CODE%, 26, 0, SB.MESSAGE$)
11512: 92f3: 
11513: 92f3:       IF ADX.RET.CODE% <> 0 THEN BEGIN
11514: 930e:          SB.EVENT.NO% = 23
11515: 931b:          SB.UNIQUE$ = FN.Z.PACK(STR$(ADX.RET.CODE%),5) + "04   "
11516: 935c:          SB.MESSAGE$ = ""
11517: 9371:          GOSUB SB.LOG.AN.EVENT
11518: 9383:       ENDIF
11519: 938b: 
11520: 938b:       SB.MESSAGE$ = ""
11521: 93a0: 
11522: 93a0:    RETURN
11523: 93b0: 
11524: 93b0: 
11525: 93b0: \******************************************************************************
11526: 93b0: \***
11527: 93b0: \***   Subroutine : SB.LOG.AN.EVENT
11528: 93b0: \***
11529: 93b0: \***   Purpose    : General routine to log an event using passed data. If
11530: 93b0: \***                program has been started manually for a re-run then also
11531: 93b0: \***                display a message on the background screen.
11532: 93b0: \***                The event will be preceded by one indicating the port
11533: 93b0: \***                being monitored by the program in error.
11534: 93b0: \***
11535: 93b0: \***   Parameters : 2
11536: 93b0: \***
11537: 93b0: \***      SB.EVENT.NO% = number of event to be logged
11538: 93b0: \***      SB.UNIQUE$   = 10 byte block of data unique to event
11539: 93b0: \***
11540: 93b0: \***   Output     : none
11541: 93b0: \***
11542: 93b0: \***   Error action : none
11543: 93b0: \***
11544: 93b0: \******************************************************************************
11545: 93b0: 
11546: 93b0:    SB.LOG.AN.EVENT:
11547: 93c0: 
11548: 93c0:       MESSAGE.NO% = 0
11549: 93ce:       UNIQUE.2$ = ""
11550: 93e3: 
11551: 93e3:       PORT.STRING$ = "PORT : " + MONITORED.PORT$ + "  "
11552: 940c:       PORT.EVENT% = 75
11553: 9419: 
11554: 9419:       RC% = APPLICATION.LOG(MESSAGE.NO%,                                \
11555: 944c:                             PORT.STRING$,                               \
11556: 944c:                             UNIQUE.2$,                                  \
11557: 944c:                             PORT.EVENT% )
11558: 944c: 
11559: 944c:       RC% = APPLICATION.LOG(MESSAGE.NO%,                                \
11560: 947c:                             SB.UNIQUE$,                                 \
11561: 947c:                             UNIQUE.2$,                                  \
11562: 947c:                             SB.EVENT.NO% )
11563: 947c: 
11564: 947c:    RETURN
11565: 948c: 
11566: 948c: 
11567: 948c: \******************************************************************************
11568: 948c: \***
11569: 948c: \***   Subroutine : SB.FORMAT.ERROR.DATA
11570: 948c: \***
11571: 948c: \***   Purpose    : General routine to format the common error reporting
11572: 948c: \***                data
11573: 948c: \***
11574: 948c: \***   Parameters : 0
11575: 948c: \***
11576: 948c: \***   Output     :
11577: 948c: \***      SB.ERRS$   = ERRN converted to a 4 byte string
11578: 948c: \***      SB.ERRL$   = ERRL zero packed up to 6 bytes
11579: 948c: \***      SB.ERRF$   = ERRF converted to a reporting number (1 byte)
11580: 948c: \***
11581: 948c: \***   Error action : if hex conversion or string conversion fails then the
11582: 948c: \***                  program ends
11583: 948c: \***
11584: 948c: \******************************************************************************
11585: 948c: 
11586: 948c:    SB.FORMAT.ERROR.DATA:
11587: 949c: 
11588: 949c:       RC% = CONV.TO.HEX( ERRN )                                         ! BLC
11589: 94bc:       IF RC% <> 0 THEN                                                  \ BLC
11590: 94ce:          GOTO PROGRAM.EXIT
11591: 94d9: 
11592: 94d9:       RC% = CONV.TO.STRING(0,                                           \ BLC
11593: 94fd:                            ERRN )
11594: 94fd:       IF RC% <> 0 THEN                                                  \ BLC
11595: 950f:          GOTO PROGRAM.EXIT
11596: 951a:       SB.ERRS$ = F17.RETURNED.STRING$
11597: 9536: 
11598: 9536:       SB.ERRL$ = FN.Z.PACK(STR$(ERRL), 6)
11599: 9565:       SB.ACTION$ = "R" : SB.INTEGER% = ERRF% : SB.STRING$ = ""
11600: 958f:       GOSUB SB.FILE.UTILS
11601: 95a1:       SB.ERRF$ = CHR$(SHIFT(SB.FILE.REP.NUM%,8)) +                      \ FMJK
11602: 95ea:                  CHR$(SHIFT(SB.FILE.REP.NUM%,0))                        ! FMJK
11603: 95ea: 
11604: 95ea:    RETURN
11605: 95fa: 
11606: 95fa: 
11607: 95fa: \******************************************************************************
11608: 95fa: \***
11609: 95fa: \***   Subroutine : SB.FILE.OPEN.ERROR
11610: 95fa: \***
11611: 95fa: \***   Purpose    : Log an event 6 with unique data indicating an error has
11612: 95fa: \***                occurred whilst attempting to open a file.
11613: 95fa: \***
11614: 95fa: \***   Parameters : 1
11615: 95fa: \***
11616: 95fa: \***      CURR.SESS.NUM% = file session number of the file that caused the
11617: 95fa: \***                       error, this is used to look-up the file reporting
11618: 95fa: \***                       number that is logged in the event's unique data.
11619: 95fa: \***
11620: 95fa: \***   Output     : none
11621: 95fa: \***
11622: 95fa: \***   Error action : none
11623: 95fa: \***
11624: 95fa: \******************************************************************************
11625: 95fa: 
11626: 95fa:    SB.FILE.OPEN.ERROR:
11627: 960a: 
11628: 960a:       SB.ACTION$ = "R"
11629: 961f:       SB.INTEGER% = CURR.SESS.NUM%
11630: 962e:       SB.STRING$ = ""
11631: 9643:       GOSUB SB.FILE.UTILS
11632: 9655:         SB.EVENT.NO% = 106                                              ! ESMG
11633: 9662:         SB.UNIQUE$ = "O" + CHR$(SHIFT(SB.FILE.REP.NUM%,8)) +            \ ESMG
11634: 96ca:                      CHR$(SHIFT(SB.FILE.REP.NUM%,0)) +                  \ ESMG
11635: 96ca:                      PACK$(STRING$(16,"0"))                             ! ESMG
11636: 96ca: 
11637: 96ca:       GOSUB SB.LOG.AN.EVENT
11638: 96dc: 
11639: 96dc:    RETURN
11640: 96ec: 
11641: 96ec: 
11642: 96ec: \******************************************************************************
11643: 96ec: \***
11644: 96ec: \***   Subroutine : SB.FILE.READ.ERROR
11645: 96ec: \***
11646: 96ec: \***   Purpose    : Log an event 6 with unique data indicating an error has
11647: 96ec: \***                occurred whilst attempting to read a file.
11648: 96ec: \***
11649: 96ec: \***   Parameters : 2
11650: 96ec: \***
11651: 96ec: \***      CURR.SESS.NUM%  = file session number of the file that caused the
11652: 96ec: \***                        error, this is used to look-up the file reporting
11653: 96ec: \***                        number that is logged in the event's unique data.
11654: 96ec: \***      CURRENT.KEY$    = value of key used to try to read from file.
11655: 96ec: \***
11656: 96ec: \***   Output     : none
11657: 96ec: \***
11658: 96ec: \***   Error action : none
11659: 96ec: \***
11660: 96ec: \******************************************************************************
11661: 96ec: 
11662: 96ec:   SB.FILE.READ.ERROR:
11663: 96fc: 
11664: 96fc:       SB.ACTION$ = "R"
11665: 9711:       SB.INTEGER% = CURR.SESS.NUM%
11666: 9720:       SB.STRING$ = ""
11667: 9735:       GOSUB SB.FILE.UTILS
11668: 9747: 
11669: 9747:         SB.EVENT.NO% = 106                                              ! ESMG
11670: 9754:         SB.UNIQUE$ = "R" + CHR$(SHIFT(SB.FILE.REP.NUM%,8)) +            \ ESMG
11671: 97ba:                      CHR$(SHIFT(SB.FILE.REP.NUM%,0)) +                  \ ESMG
11672: 97ba:                      FN.Z.PACK(CURRENT.KEY$,8)                          ! ESMG
11673: 97ba: 
11674: 97ba:       GOSUB SB.LOG.AN.EVENT
11675: 97cc: 
11676: 97cc:    RETURN
11677: 97dc: 
11678: 97dc: 
11679: 97dc: \******************************************************************************
11680: 97dc: \***
11681: 97dc: \***   Subroutine : SB.FILE.WRITE.ERROR
11682: 97dc: \***
11683: 97dc: \***   Purpose    : Log an event 6 with unique data indicating an error has
11684: 97dc: \***                occurred whilst attempting to write a file.
11685: 97dc: \***
11686: 97dc: \***   Parameters : 2
11687: 97dc: \***
11688: 97dc: \***      CURR.SESS.NUM%  = file session number of the file that caused the
11689: 97dc: \***                        error, this is used to look-up the file reporting
11690: 97dc: \***                        number that is logged in the event's unique data.
11691: 97dc: \***    CURRENT.KEY$    = value of key used to try to write to file.
11692: 97dc: \***
11693: 97dc: \***   Output     : none
11694: 97dc: \***
11695: 97dc: \***   Error action : none
11696: 97dc: \***
11697: 97dc: \******************************************************************************
11698: 97dc: 
11699: 97dc:    SB.FILE.WRITE.ERROR:
11700: 97ec: 
11701: 97ec:       SB.ACTION$ = "R"
11702: 9801:       SB.INTEGER% = CURR.SESS.NUM%
11703: 9810:       SB.STRING$ = ""
11704: 9825:       GOSUB SB.FILE.UTILS
11705: 9837: 
11706: 9837:         SB.EVENT.NO% = 106                                              ! ESMG
11707: 9844:         SB.UNIQUE$ = "W" + CHR$(SHIFT(SB.FILE.REP.NUM%,8)) +            \ ESMG
11708: 98aa:                      CHR$(SHIFT(SB.FILE.REP.NUM%,0)) +                  \ ESMG
11709: 98aa:                      FN.Z.PACK(CURRENT.KEY$,8)                          ! ESMG
11710: 98aa: 
11711: 98aa:       GOSUB SB.LOG.AN.EVENT
11712: 98bc: 
11713: 98bc:    RETURN
11714: 98cc: 
11715: 98cc: 
11716: 98cc: \******************************************************************************
11717: 98cc: \***
11718: 98cc: \***   Subroutine : SB.FILE.CREATE.ERROR
11719: 98cc: \***
11720: 98cc: \***   Purpose    : Log an event 6 with unique data indicating an error has
11721: 98cc: \***                occurred whilst attempting to create a file.
11722: 98cc: \***
11723: 98cc: \***   Parameters : 2
11724: 98cc: \***
11725: 98cc: \***      CURR.SESS.NUM%  = file session number of the file that caused the
11726: 98cc: \***                        error, this is used to look-up the file reporting
11727: 98cc: \***                        number that is logged in the event's unique data.
11728: 98cc: \***
11729: 98cc: \***   Output     : none
11730: 98cc: \***
11731: 98cc: \***   Error action : none
11732: 98cc: \***
11733: 98cc: \******************************************************************************
11734: 98cc: 
11735: 98cc:    SB.FILE.CREATE.ERROR:
11736: 98dc: 
11737: 98dc:       SB.ACTION$ = "R"
11738: 98f1:       SB.INTEGER% = CURR.SESS.NUM%
11739: 9900:       SB.STRING$ = ""
11740: 9915:       GOSUB SB.FILE.UTILS
11741: 9927: 
11742: 9927:         SB.EVENT.NO% = 106                                              ! ESMG
11743: 9934:         SB.UNIQUE$ = "C" + CHR$(SHIFT(SB.FILE.REP.NUM%,8)) +            \ ESMG
11744: 9981:                      CHR$(SHIFT(SB.FILE.REP.NUM%,4))                    ! ESMG
11745: 9981: 
11746: 9981:       GOSUB SB.LOG.AN.EVENT
11747: 9993: 
11748: 9993:    RETURN
11749: 99a3: 
11750: 99a3: 
11751: 99a3: \******************************************************************************
11752: 99a3: \******************************************************************************
11753: 99a3: \***                                                                        ***
11754: 99a3: \***                                                                        ***
11755: 99a3: \***   E R R O R   H A N D L I N G                                          ***
11756: 99a3: \***                                                                        ***
11757: 99a3: \***                                                                        ***
11758: 99a3: \******************************************************************************
11759: 99a3: \******************************************************************************
11760: 99a3: 
11761: 99a3: \******************************************************************************
11762: 99a3: \***
11763: 99a3: \***   OPEN.ERROR:
11764: 99a3: \***
11765: 99a3: \***      log an event 6 (open error)
11766: 99a3: \***      set RECEIVE.STATE$ to "*"
11767: 99a3: \***
11768: 99a3: \***      if the source of the error is known then return to one of the
11769: 99a3: \***      specified return points so the program does not end
11770: 99a3: \***
11771: 99a3: \***   GOTO MODULE.EXIT (no return is possible)
11772: 99a3: \***
11773: 99a3: \******************************************************************************
11774: 99a3: 
11775: 99a3:    OPEN.ERROR:
11776: 99b3: 
11777: 99b3:       TEMP.STATE$ = RECEIVE.STATE$
11778: 99cf:       GOSUB SB.FILE.OPEN.ERROR
11779: 99e1:       RECEIVE.STATE$ = "*"
11780: 99f8: 
11781: 99f8:       GOTO MODULE.EXIT
11782: 9a03: 
11783: 9a03: 
11784: 9a03: \******************************************************************************
11785: 9a03: \***
11786: 9a03: \***   READ.ERROR:
11787: 9a03: \***
11788: 9a03: \***      log an event 6 (read error)
11789: 9a03: \***      set RECEIVE.STATE$ to "*"
11790: 9a03: \***      if the source of the error is known then return to one of the
11791: 9a03: \***      specified return points so the program does not end
11792: 9a03: \***
11793: 9a03: \***   GOTO MODULE.EXIT (no return is possible)
11794: 9a03: \***
11795: 9a03: \******************************************************************************
11796: 9a03: 
11797: 9a03:    READ.ERROR:
11798: 9a13: 
11799: 9a13:       TEMP.STATE$ = RECEIVE.STATE$
11800: 9a2f:       GOSUB SB.FILE.READ.ERROR
11801: 9a41:       RECEIVE.STATE$ = "*"
11802: 9a58: 
11803: 9a58:       GOTO MODULE.EXIT
11804: 9a63: 
11805: 9a63: 
11806: 9a63: \******************************************************************************
11807: 9a63: \***
11808: 9a63: \***   WRITE.ERROR:
11809: 9a63: \***
11810: 9a63: \***      log an event 6 (write error)
11811: 9a63: \***      set RECEIVE.STATE$ to "*"
11812: 9a63: \***
11813: 9a63: \***      if the source of the error is known then return to one of the
11814: 9a63: \***      specified return points so the program does not end
11815: 9a63: \***
11816: 9a63: \***   GOTO MODULE.EXIT (no return is possible)
11817: 9a63: \***
11818: 9a63: \******************************************************************************
11819: 9a63: 
11820: 9a63:    WRITE.ERROR:
11821: 9a73: 
11822: 9a73:       TEMP.STATE$ = RECEIVE.STATE$
11823: 9a8f:       GOSUB SB.FILE.WRITE.ERROR
11824: 9aa1:       RECEIVE.STATE$ = "*"
11825: 9ab8: 
11826: 9ab8:    GOTO MODULE.EXIT
11827: 9ac3: 
11828: 9ac3: 
11829: 9ac3: \******************************************************************************
11830: 9ac3: \***
11831: 9ac3: \***   CREATE.ERROR:
11832: 9ac3: \***
11833: 9ac3: \***      log an event 6 (create error)
11834: 9ac3: \***      set RECEIVE.STATE$ to "*"
11835: 9ac3: \***
11836: 9ac3: \***      if the source of the error is known then return to one of the
11837: 9ac3: \***      specified return points so the program does not end
11838: 9ac3: \***
11839: 9ac3: \***   GOTO MODULE.EXIT (no return is possible)
11840: 9ac3: \***
11841: 9ac3: \******************************************************************************
11842: 9ac3: 
11843: 9ac3:    CREATE.ERROR:
11844: 9ad3: 
11845: 9ad3:       TEMP.STATE$ = RECEIVE.STATE$
11846: 9aef:       GOSUB SB.FILE.CREATE.ERROR
11847: 9b01:       RECEIVE.STATE$ = "*"
11848: 9b18: 
11849: 9b18:    GOTO MODULE.EXIT
11850: 9b23: 
11851: 9b23: 
11852: 9b23: \******************************************************************************
11853: 9b23: \***
11854: 9b23: \***   ERROR.DETECTED:
11855: 9b23: \***
11856: 9b23: \***      if an error has occurred after a 'fatal' error then quit program
11857: 9b23: \***
11858: 9b23: \***      increment ERROR.COUNT%
11859: 9b23: \***      NOTE : all returns from error detected should decrement the
11860: 9b23: \***             variable ERROR.COUNT% and exit using the RESUME command
11861: 9b23: \***      if ERROR.COUNT% > 1 then end program (error within error detected)
11862: 9b23: \***
11863: 9b23: \***      set-up common error reporting information
11864: 9b23: \***
11865: 9b23: \***      if an access conflict occurs on a session then retry
11866: 9b23: \***
11867: 9b23: \***      if error is out of memory then log an event, using ADXERROR and
11868: 9b23: \***      quit program
11869: 9b23: \***
11870: 9b23: \***      log an event 1
11871: 9b23: \***
11872: 9b23: \***   resume MODULE.EXIT
11873: 9b23: \***
11874: 9b23: \******************************************************************************
11875: 9b23: 
11876: 9b23: ERROR.DETECTED:
11877: 9b33: 
11878: 9b33:    IF ERR = "CU" OR ERR = "DF" THEN RESUME
11879: 9ba1: 
11880: 9ba1:    IF (ERRN = 00000052h) AND (LDTAF.LINK.TYPE%<>0) THEN RESUME          ! FMJK
11881: 9be6: 
11882: 9be6:    ERROR.COUNT% = ERROR.COUNT% + 1
11883: 9bf5:    IF ERROR.COUNT% > 1 THEN RESUME PROGRAM.EXIT
11884: 9c16: 
11885: 9c16:    GOSUB SB.FORMAT.ERROR.DATA
11886: 9c28: 
11887: 9c28:    IF (ERRN AND 0000FFFFh) = 400Ch THEN BEGIN
11888: 9c62:       ERROR.COUNT% = ERROR.COUNT% - 1
11889: 9c71:       RESUME RETRY
11890: 9c88:    ENDIF
11891: 9c90: 
11892: 9c90:    IF ERR = "OM" THEN BEGIN
11893: 9cb9:       SB.UNIQUE$ = SB.ERRS$ + SB.ERRF$ +                                \ FMJK
11894: 9d19:                    PACK$(RIGHT$(STRING$(8,"0")+SB.ERRL$,8))             ! FMJK
11895: 9d19:       CALL ADXERROR(0, 74, 0, 3, 1, SB.UNIQUE$ )
11896: 9d41:       ERROR.COUNT% = ERROR.COUNT% - 1
11897: 9d50:       RESUME PROGRAM.EXIT
11898: 9d67:    ENDIF
11899: 9d6f: 
11900: 9d6f:    SB.EVENT.NO% = 101
11901: 9d7c:    SB.UNIQUE$ = SB.ERRS$ + SB.ERRF$ +                                   \ FMJK
11902: 9ddc:                 PACK$(RIGHT$(STRING$(8,"0")+SB.ERRL$,8))                ! FMJK
11903: 9ddc:    GOSUB SB.LOG.AN.EVENT
11904: 9dee: 
11905: 9dee:    ERROR.COUNT% = ERROR.COUNT% - 1
11906: 9dfd:    RECEIVE.STATE$ = "*"
11907: 9e14:    RESUME MODULE.EXIT
11908: 9e2b: 
11909: 9e2b: END SUB
11910: 9e3f: End of Compilation
